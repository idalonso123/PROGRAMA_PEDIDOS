2026-02-01 21:12:47 - INFO - ======================================================================
2026-02-01 21:12:47 - INFO - SISTEMA DE PEDIDOS DE COMPRA - VIVERO ARANJUEZ V2
2026-02-01 21:12:47 - INFO - Fecha de ejecucion: 2026-02-01 21:12:47
2026-02-01 21:12:47 - INFO - ======================================================================
2026-02-01 21:12:47 - INFO - StateManager inicializado. Archivo de estado: ././data/state.json
2026-02-01 21:12:47 - INFO - Cargando estado desde: ././data/state.json
2026-02-01 21:12:47 - INFO - Estado cargado correctamente
2026-02-01 21:12:47 - INFO - SchedulerService inicializado correctamente
2026-02-01 21:12:47 - INFO - Horario configurado: sunday a las 15:00
2026-02-01 21:12:47 - INFO - Semana forzada por argumento: 14
2026-02-01 21:12:47 - INFO - ======================================================================
2026-02-01 21:12:47 - INFO - PROCESANDO PEDIDO PARA SEMANA 14
2026-02-01 21:12:47 - INFO - ======================================================================
2026-02-01 21:12:47 - INFO - DataLoader inicializado correctamente
2026-02-01 21:12:47 - INFO - ForecastEngine inicializado correctamente
2026-02-01 21:12:47 - INFO - OrderGenerator inicializado correctamente
2026-02-01 21:12:47 - INFO - SchedulerService inicializado correctamente
2026-02-01 21:12:47 - INFO - Horario configurado: sunday a las 15:00
2026-02-01 21:12:47 - INFO - Período de la semana: 2026-03-30 al 2026-04-05
2026-02-01 21:12:47 - INFO - Stock acumulado cargado: 0 artículos
2026-02-01 21:12:47 - INFO - 
==================================================
2026-02-01 21:12:47 - INFO - SECCION: MAF
2026-02-01 21:12:47 - INFO - ==================================================
2026-02-01 21:12:47 - INFO - === LEYENDO DATOS PARA SECCIÓN: MAF ===
2026-02-01 21:12:47 - WARNING - No se encontró archivo específico para 'maf', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-01 21:12:47 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-01 21:12:47 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-01 21:12:47 - INFO - Clasificación ABC cargada para 'maf': 555 registros
2026-02-01 21:12:47 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-01 21:12:52 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-01 21:12:52 - INFO - Usando hoja: Ventas por vendedor
2026-02-01 21:12:52 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-01 21:12:52 - INFO - Ventas cargadas: 44082 registros
2026-02-01 21:12:52 - INFO - Filtrados 10970 registros de sección 'maf' de 44082 total
2026-02-01 21:12:52 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-01 21:12:55 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-01 21:12:55 - INFO - Costes cargados: 22145 registros
2026-02-01 21:12:55 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MAF ===
2026-02-01 21:12:55 - INFO -   ABC: 555 registros
2026-02-01 21:12:55 - INFO -   Ventas: 10970 registros
2026-02-01 21:12:55 - INFO -   Costes: 22145 registros
2026-02-01 21:12:55 - INFO - Datos de ventas: 1011 registros
2026-02-01 21:12:55 - INFO - Calculando pedido para semana 14 (1011 registros)
2026-02-01 21:12:56 - INFO -   Objetivo: 7050.65€, Actual (ABC): 7177.24€
2026-02-01 21:12:56 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-01 21:12:56 - INFO -   Factor total: 1.3125
2026-02-01 21:12:56 - INFO -   Factor escalado: 1.2894
2026-02-01 21:12:56 - INFO -   Ventas preliminares (con ceil): 9955.95€
2026-02-01 21:12:56 - INFO -   Objetivo final: 9253.98€
2026-02-01 21:12:56 - INFO -   Delta: 701.97€
2026-02-01 21:12:56 - INFO -   Ventas finales: 9254.64€
2026-02-01 21:12:56 - INFO - Generando archivo: ././data/output/Pedido_Semana_14_2026-02-01_maf.xlsx
2026-02-01 21:12:56 - INFO - Archivo guardado: ././data/output/Pedido_Semana_14_2026-02-01_maf.xlsx
2026-02-01 21:12:56 - INFO - Archivo generado: ././data/output/Pedido_Semana_14_2026-02-01_maf.xlsx
2026-02-01 21:12:56 - INFO -   Articulos: 221
2026-02-01 21:12:56 - INFO -   Importe: 9254.64€
2026-02-01 21:12:56 - INFO - 
==================================================
2026-02-01 21:12:56 - INFO - SECCION: DECO_INTERIOR
2026-02-01 21:12:56 - INFO - ==================================================
2026-02-01 21:12:56 - INFO - === LEYENDO DATOS PARA SECCIÓN: DECO_INTERIOR ===
2026-02-01 21:12:56 - WARNING - No se encontró archivo específico para 'deco_interior', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-01 21:12:56 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-01 21:12:56 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-01 21:12:56 - INFO - Clasificación ABC cargada para 'deco_interior': 555 registros
2026-02-01 21:12:56 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-01 21:13:01 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-01 21:13:01 - INFO - Usando hoja: Ventas por vendedor
2026-02-01 21:13:01 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-01 21:13:01 - INFO - Ventas cargadas: 44082 registros
2026-02-01 21:13:01 - INFO - Filtrados 2468 registros de sección 'deco_interior' de 44082 total
2026-02-01 21:13:01 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-01 21:13:04 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-01 21:13:04 - INFO - Costes cargados: 22145 registros
2026-02-01 21:13:04 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA DECO_INTERIOR ===
2026-02-01 21:13:04 - INFO -   ABC: 555 registros
2026-02-01 21:13:04 - INFO -   Ventas: 2468 registros
2026-02-01 21:13:04 - INFO -   Costes: 22145 registros
2026-02-01 21:13:04 - INFO - Datos de ventas: 180 registros
2026-02-01 21:13:04 - INFO - Calculando pedido para semana 14 (180 registros)
2026-02-01 21:13:05 - INFO -   Objetivo: 1962.99€, Actual (ABC): 1494.40€
2026-02-01 21:13:05 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-01 21:13:05 - INFO -   Factor total: 1.3125
2026-02-01 21:13:05 - INFO -   Factor escalado: 1.7241
2026-02-01 21:13:05 - INFO -   Ventas preliminares (con ceil): 2961.52€
2026-02-01 21:13:05 - INFO -   Objetivo final: 2576.42€
2026-02-01 21:13:05 - INFO -   Delta: 385.10€
2026-02-01 21:13:05 - INFO -   Ventas finales: 2583.25€
2026-02-01 21:13:05 - INFO - Generando archivo: ././data/output/Pedido_Semana_14_2026-02-01_deco_interior.xlsx
2026-02-01 21:13:05 - INFO - Archivo guardado: ././data/output/Pedido_Semana_14_2026-02-01_deco_interior.xlsx
2026-02-01 21:13:05 - INFO - Archivo generado: ././data/output/Pedido_Semana_14_2026-02-01_deco_interior.xlsx
2026-02-01 21:13:05 - INFO -   Articulos: 138
2026-02-01 21:13:05 - INFO -   Importe: 2583.25€
2026-02-01 21:13:05 - INFO - 
==================================================
2026-02-01 21:13:05 - INFO - SECCION: SEMILLAS
2026-02-01 21:13:05 - INFO - ==================================================
2026-02-01 21:13:05 - INFO - === LEYENDO DATOS PARA SECCIÓN: SEMILLAS ===
2026-02-01 21:13:05 - WARNING - No se encontró archivo específico para 'semillas', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-01 21:13:05 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-01 21:13:05 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-01 21:13:05 - INFO - Clasificación ABC cargada para 'semillas': 555 registros
2026-02-01 21:13:05 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-01 21:13:10 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-01 21:13:10 - INFO - Usando hoja: Ventas por vendedor
2026-02-01 21:13:10 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-01 21:13:10 - INFO - Ventas cargadas: 44082 registros
2026-02-01 21:13:11 - INFO - Filtrados 1180 registros de sección 'semillas' de 44082 total
2026-02-01 21:13:11 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-01 21:13:13 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-01 21:13:13 - INFO - Costes cargados: 22145 registros
2026-02-01 21:13:13 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA SEMILLAS ===
2026-02-01 21:13:13 - INFO -   ABC: 555 registros
2026-02-01 21:13:13 - INFO -   Ventas: 1180 registros
2026-02-01 21:13:13 - INFO -   Costes: 22145 registros
2026-02-01 21:13:13 - INFO - Datos de ventas: 136 registros
2026-02-01 21:13:13 - INFO - Calculando pedido para semana 14 (136 registros)
2026-02-01 21:13:14 - INFO -   Objetivo: 694.34€, Actual (ABC): 566.70€
2026-02-01 21:13:14 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-01 21:13:14 - INFO -   Factor total: 1.3125
2026-02-01 21:13:14 - INFO -   Factor escalado: 1.6081
2026-02-01 21:13:14 - INFO -   Ventas preliminares (con ceil): 1062.05€
2026-02-01 21:13:14 - INFO -   Objetivo final: 911.32€
2026-02-01 21:13:14 - INFO -   Delta: 150.73€
2026-02-01 21:13:14 - INFO -   Ventas finales: 913.86€
2026-02-01 21:13:14 - INFO - Generando archivo: ././data/output/Pedido_Semana_14_2026-02-01_semillas.xlsx
2026-02-01 21:13:14 - INFO - Archivo guardado: ././data/output/Pedido_Semana_14_2026-02-01_semillas.xlsx
2026-02-01 21:13:14 - INFO - Archivo generado: ././data/output/Pedido_Semana_14_2026-02-01_semillas.xlsx
2026-02-01 21:13:14 - INFO -   Articulos: 84
2026-02-01 21:13:14 - INFO -   Importe: 913.86€
2026-02-01 21:13:14 - INFO - 
==================================================
2026-02-01 21:13:14 - INFO - SECCION: MASCOTAS_VIVO
2026-02-01 21:13:14 - INFO - ==================================================
2026-02-01 21:13:14 - INFO - === LEYENDO DATOS PARA SECCIÓN: MASCOTAS_VIVO ===
2026-02-01 21:13:14 - WARNING - No se encontró archivo específico para 'mascotas_vivo', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-01 21:13:14 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-01 21:13:14 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-01 21:13:14 - INFO - Clasificación ABC cargada para 'mascotas_vivo': 555 registros
2026-02-01 21:13:14 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-01 21:13:19 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-01 21:13:19 - INFO - Usando hoja: Ventas por vendedor
2026-02-01 21:13:19 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-01 21:13:19 - INFO - Ventas cargadas: 44082 registros
2026-02-01 21:13:19 - INFO - Filtrados 1124 registros de sección 'mascotas_vivo' de 44082 total
2026-02-01 21:13:19 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-01 21:13:22 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-01 21:13:22 - INFO - Costes cargados: 22145 registros
2026-02-01 21:13:22 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MASCOTAS_VIVO ===
2026-02-01 21:13:22 - INFO -   ABC: 555 registros
2026-02-01 21:13:22 - INFO -   Ventas: 1124 registros
2026-02-01 21:13:22 - INFO -   Costes: 22145 registros
2026-02-01 21:13:22 - INFO - Datos de ventas: 88 registros
2026-02-01 21:13:22 - INFO - Calculando pedido para semana 14 (88 registros)
2026-02-01 21:13:22 - INFO -   Objetivo: 1087.15€, Actual (ABC): 1144.11€
2026-02-01 21:13:22 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-01 21:13:22 - INFO -   Factor total: 1.3125
2026-02-01 21:13:22 - INFO -   Factor escalado: 1.2472
2026-02-01 21:13:22 - INFO -   Ventas preliminares (con ceil): 1759.51€
2026-02-01 21:13:22 - INFO -   Objetivo final: 1426.88€
2026-02-01 21:13:22 - INFO -   Delta: 332.63€
2026-02-01 21:13:22 - INFO -   Ventas finales: 1451.48€
2026-02-01 21:13:22 - INFO - Generando archivo: ././data/output/Pedido_Semana_14_2026-02-01_mascotas_vivo.xlsx
2026-02-01 21:13:22 - INFO - Archivo guardado: ././data/output/Pedido_Semana_14_2026-02-01_mascotas_vivo.xlsx
2026-02-01 21:13:22 - INFO - Archivo generado: ././data/output/Pedido_Semana_14_2026-02-01_mascotas_vivo.xlsx
2026-02-01 21:13:22 - INFO -   Articulos: 43
2026-02-01 21:13:22 - INFO -   Importe: 1451.48€
2026-02-01 21:13:22 - INFO - 
==================================================
2026-02-01 21:13:22 - INFO - SECCION: MASCOTAS_MANUFACTURADO
2026-02-01 21:13:22 - INFO - ==================================================
2026-02-01 21:13:22 - INFO - === LEYENDO DATOS PARA SECCIÓN: MASCOTAS_MANUFACTURADO ===
2026-02-01 21:13:22 - WARNING - No se encontró archivo específico para 'mascotas_manufacturado', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-01 21:13:22 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-01 21:13:22 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-01 21:13:22 - INFO - Clasificación ABC cargada para 'mascotas_manufacturado': 555 registros
2026-02-01 21:13:22 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-01 21:13:28 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-01 21:13:28 - INFO - Usando hoja: Ventas por vendedor
2026-02-01 21:13:28 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-01 21:13:28 - INFO - Ventas cargadas: 44082 registros
2026-02-01 21:13:28 - INFO - Filtrados 9784 registros de sección 'mascotas_manufacturado' de 44082 total
2026-02-01 21:13:28 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-01 21:13:31 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-01 21:13:31 - INFO - Costes cargados: 22145 registros
2026-02-01 21:13:31 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MASCOTAS_MANUFACTURADO ===
2026-02-01 21:13:31 - INFO -   ABC: 555 registros
2026-02-01 21:13:31 - INFO -   Ventas: 9784 registros
2026-02-01 21:13:31 - INFO -   Costes: 22145 registros
2026-02-01 21:13:31 - INFO - Datos de ventas: 822 registros
2026-02-01 21:13:31 - INFO - Calculando pedido para semana 14 (822 registros)
2026-02-01 21:13:33 - INFO -   Objetivo: 6839.82€, Actual (ABC): 8422.22€
2026-02-01 21:13:33 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-01 21:13:33 - INFO -   Factor total: 1.3125
2026-02-01 21:13:33 - INFO -   Factor escalado: 1.0659
2026-02-01 21:13:33 - INFO -   Ventas preliminares (con ceil): 14128.59€
2026-02-01 21:13:33 - INFO -   Objetivo final: 8977.26€
2026-02-01 21:13:33 - INFO -   Delta: 5151.33€
2026-02-01 21:13:33 - INFO -   Ventas finales: 8979.81€
2026-02-01 21:13:33 - INFO - Generando archivo: ././data/output/Pedido_Semana_14_2026-02-01_mascotas_manufacturado.xlsx
2026-02-01 21:13:33 - INFO - Archivo guardado: ././data/output/Pedido_Semana_14_2026-02-01_mascotas_manufacturado.xlsx
2026-02-01 21:13:33 - INFO - Archivo generado: ././data/output/Pedido_Semana_14_2026-02-01_mascotas_manufacturado.xlsx
2026-02-01 21:13:33 - INFO -   Articulos: 534
2026-02-01 21:13:33 - INFO -   Importe: 8979.81€
2026-02-01 21:13:33 - INFO - 
==================================================
2026-02-01 21:13:33 - INFO - SECCION: INTERIOR
2026-02-01 21:13:33 - INFO - ==================================================
2026-02-01 21:13:33 - INFO - === LEYENDO DATOS PARA SECCIÓN: INTERIOR ===
2026-02-01 21:13:33 - WARNING - No se encontró archivo específico para 'interior', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-01 21:13:33 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-01 21:13:33 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-01 21:13:33 - INFO - Clasificación ABC cargada para 'interior': 555 registros
2026-02-01 21:13:33 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-01 21:13:38 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-01 21:13:38 - INFO - Usando hoja: Ventas por vendedor
2026-02-01 21:13:39 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-01 21:13:39 - INFO - Ventas cargadas: 44082 registros
2026-02-01 21:13:39 - INFO - Filtrados 3624 registros de sección 'interior' de 44082 total
2026-02-01 21:13:39 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-01 21:13:41 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-01 21:13:41 - INFO - Costes cargados: 22145 registros
2026-02-01 21:13:41 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA INTERIOR ===
2026-02-01 21:13:41 - INFO -   ABC: 555 registros
2026-02-01 21:13:41 - INFO -   Ventas: 3624 registros
2026-02-01 21:13:41 - INFO -   Costes: 22145 registros
2026-02-01 21:13:41 - INFO - Datos de ventas: 286 registros
2026-02-01 21:13:41 - INFO - Calculando pedido para semana 14 (286 registros)
2026-02-01 21:13:42 - INFO -   Objetivo: 2930.63€, Actual (ABC): 2409.44€
2026-02-01 21:13:42 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-01 21:13:42 - INFO -   Factor total: 1.3125
2026-02-01 21:13:42 - INFO -   Factor escalado: 1.5964
2026-02-01 21:13:42 - INFO -   Ventas preliminares (con ceil): 4541.81€
2026-02-01 21:13:42 - INFO -   Objetivo final: 3846.45€
2026-02-01 21:13:42 - INFO -   Delta: 695.36€
2026-02-01 21:13:42 - INFO -   Ventas finales: 3855.17€
2026-02-01 21:13:42 - INFO - Generando archivo: ././data/output/Pedido_Semana_14_2026-02-01_interior.xlsx
2026-02-01 21:13:42 - INFO - Archivo guardado: ././data/output/Pedido_Semana_14_2026-02-01_interior.xlsx
2026-02-01 21:13:42 - INFO - Archivo generado: ././data/output/Pedido_Semana_14_2026-02-01_interior.xlsx
2026-02-01 21:13:42 - INFO -   Articulos: 121
2026-02-01 21:13:42 - INFO -   Importe: 3855.17€
2026-02-01 21:13:42 - INFO - 
==================================================
2026-02-01 21:13:42 - INFO - SECCION: FITOS
2026-02-01 21:13:42 - INFO - ==================================================
2026-02-01 21:13:42 - INFO - === LEYENDO DATOS PARA SECCIÓN: FITOS ===
2026-02-01 21:13:42 - WARNING - No se encontró archivo específico para 'fitos', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-01 21:13:42 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-01 21:13:42 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-01 21:13:42 - INFO - Clasificación ABC cargada para 'fitos': 555 registros
2026-02-01 21:13:42 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-01 21:13:47 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-01 21:13:47 - INFO - Usando hoja: Ventas por vendedor
2026-02-01 21:13:48 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-01 21:13:48 - INFO - Ventas cargadas: 44082 registros
2026-02-01 21:13:48 - INFO - Filtrados 1987 registros de sección 'fitos' de 44082 total
2026-02-01 21:13:48 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-01 21:13:50 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-01 21:13:50 - INFO - Costes cargados: 22145 registros
2026-02-01 21:13:50 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA FITOS ===
2026-02-01 21:13:50 - INFO -   ABC: 555 registros
2026-02-01 21:13:50 - INFO -   Ventas: 1987 registros
2026-02-01 21:13:50 - INFO -   Costes: 22145 registros
2026-02-01 21:13:50 - INFO - Datos de ventas: 157 registros
2026-02-01 21:13:50 - INFO - Calculando pedido para semana 14 (157 registros)
2026-02-01 21:13:51 - INFO -   Objetivo: 1798.25€, Actual (ABC): 1585.02€
2026-02-01 21:13:51 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-01 21:13:51 - INFO -   Factor total: 1.3125
2026-02-01 21:13:51 - INFO -   Factor escalado: 1.4891
2026-02-01 21:13:51 - INFO -   Ventas preliminares (con ceil): 2690.29€
2026-02-01 21:13:51 - INFO -   Objetivo final: 2360.20€
2026-02-01 21:13:51 - INFO -   Delta: 330.09€
2026-02-01 21:13:51 - INFO -   Ventas finales: 2361.02€
2026-02-01 21:13:51 - INFO - Generando archivo: ././data/output/Pedido_Semana_14_2026-02-01_fitos.xlsx
2026-02-01 21:13:51 - INFO - Archivo guardado: ././data/output/Pedido_Semana_14_2026-02-01_fitos.xlsx
2026-02-01 21:13:51 - INFO - Archivo generado: ././data/output/Pedido_Semana_14_2026-02-01_fitos.xlsx
2026-02-01 21:13:51 - INFO -   Articulos: 84
2026-02-01 21:13:51 - INFO -   Importe: 2361.02€
2026-02-01 21:13:51 - INFO - 
==================================================
2026-02-01 21:13:51 - INFO - SECCION: VIVERO
2026-02-01 21:13:51 - INFO - ==================================================
2026-02-01 21:13:51 - INFO - === LEYENDO DATOS PARA SECCIÓN: VIVERO ===
2026-02-01 21:13:51 - WARNING - No se encontró archivo específico para 'vivero', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-01 21:13:51 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-01 21:13:51 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-01 21:13:51 - INFO - Clasificación ABC cargada para 'vivero': 555 registros
2026-02-01 21:13:51 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-01 21:13:56 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-01 21:13:56 - INFO - Usando hoja: Ventas por vendedor
2026-02-01 21:13:56 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-01 21:13:56 - INFO - Ventas cargadas: 44082 registros
2026-02-01 21:13:56 - INFO - Filtrados 2460 registros de sección 'vivero' de 44082 total
2026-02-01 21:13:56 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-01 21:13:59 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-01 21:13:59 - INFO - Costes cargados: 22145 registros
2026-02-01 21:13:59 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA VIVERO ===
2026-02-01 21:13:59 - INFO -   ABC: 555 registros
2026-02-01 21:13:59 - INFO -   Ventas: 2460 registros
2026-02-01 21:13:59 - INFO -   Costes: 22145 registros
2026-02-01 21:13:59 - INFO - Datos de ventas: 189 registros
2026-02-01 21:13:59 - INFO - Calculando pedido para semana 14 (189 registros)
2026-02-01 21:13:59 - INFO -   Objetivo: 5297.17€, Actual (ABC): 4464.03€
2026-02-01 21:13:59 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-01 21:13:59 - INFO -   Factor total: 1.3125
2026-02-01 21:13:59 - INFO -   Factor escalado: 1.5575
2026-02-01 21:13:59 - INFO -   Ventas preliminares (con ceil): 8225.51€
2026-02-01 21:13:59 - INFO -   Objetivo final: 6952.54€
2026-02-01 21:13:59 - INFO -   Delta: 1272.97€
2026-02-01 21:13:59 - INFO -   Ventas finales: 6955.79€
2026-02-01 21:14:00 - INFO - Generando archivo: ././data/output/Pedido_Semana_14_2026-02-01_vivero.xlsx
2026-02-01 21:14:00 - INFO - Archivo guardado: ././data/output/Pedido_Semana_14_2026-02-01_vivero.xlsx
2026-02-01 21:14:00 - INFO - Archivo generado: ././data/output/Pedido_Semana_14_2026-02-01_vivero.xlsx
2026-02-01 21:14:00 - INFO -   Articulos: 107
2026-02-01 21:14:00 - INFO -   Importe: 6955.79€
2026-02-01 21:14:00 - INFO - 
==================================================
2026-02-01 21:14:00 - INFO - SECCION: UTILES_JARDIN
2026-02-01 21:14:00 - INFO - ==================================================
2026-02-01 21:14:00 - INFO - === LEYENDO DATOS PARA SECCIÓN: UTILES_JARDIN ===
2026-02-01 21:14:00 - WARNING - No se encontró archivo específico para 'utiles_jardin', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-01 21:14:00 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-01 21:14:00 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-01 21:14:00 - INFO - Clasificación ABC cargada para 'utiles_jardin': 555 registros
2026-02-01 21:14:00 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-01 21:14:05 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-01 21:14:05 - INFO - Usando hoja: Ventas por vendedor
2026-02-01 21:14:05 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-01 21:14:05 - INFO - Ventas cargadas: 44082 registros
2026-02-01 21:14:05 - INFO - Filtrados 1009 registros de sección 'utiles_jardin' de 44082 total
2026-02-01 21:14:05 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-01 21:14:08 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-01 21:14:08 - INFO - Costes cargados: 22145 registros
2026-02-01 21:14:08 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA UTILES_JARDIN ===
2026-02-01 21:14:08 - INFO -   ABC: 555 registros
2026-02-01 21:14:08 - INFO -   Ventas: 1009 registros
2026-02-01 21:14:08 - INFO -   Costes: 22145 registros
2026-02-01 21:14:08 - INFO - Datos de ventas: 89 registros
2026-02-01 21:14:08 - INFO - Calculando pedido para semana 14 (89 registros)
2026-02-01 21:14:08 - INFO -   Objetivo: 1044.77€, Actual (ABC): 764.57€
2026-02-01 21:14:08 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-01 21:14:08 - INFO -   Factor total: 1.3125
2026-02-01 21:14:08 - INFO -   Factor escalado: 1.7935
2026-02-01 21:14:08 - INFO -   Ventas preliminares (con ceil): 1516.64€
2026-02-01 21:14:08 - INFO -   Objetivo final: 1371.26€
2026-02-01 21:14:08 - INFO -   Delta: 145.38€
2026-02-01 21:14:08 - INFO -   Ventas finales: 1373.85€
2026-02-01 21:14:08 - INFO - Generando archivo: ././data/output/Pedido_Semana_14_2026-02-01_utiles_jardin.xlsx
2026-02-01 21:14:08 - INFO - Archivo guardado: ././data/output/Pedido_Semana_14_2026-02-01_utiles_jardin.xlsx
2026-02-01 21:14:08 - INFO - Archivo generado: ././data/output/Pedido_Semana_14_2026-02-01_utiles_jardin.xlsx
2026-02-01 21:14:08 - INFO -   Articulos: 78
2026-02-01 21:14:08 - INFO -   Importe: 1373.85€
2026-02-01 21:14:08 - INFO - 
==================================================
2026-02-01 21:14:08 - INFO - SECCION: TIERRAS_ARIDOS
2026-02-01 21:14:08 - INFO - ==================================================
2026-02-01 21:14:08 - INFO - === LEYENDO DATOS PARA SECCIÓN: TIERRAS_ARIDOS ===
2026-02-01 21:14:08 - WARNING - No se encontró archivo específico para 'tierras_aridos', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-01 21:14:08 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-01 21:14:08 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-01 21:14:08 - INFO - Clasificación ABC cargada para 'tierras_aridos': 555 registros
2026-02-01 21:14:08 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-01 21:14:14 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-01 21:14:14 - INFO - Usando hoja: Ventas por vendedor
2026-02-01 21:14:14 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-01 21:14:14 - INFO - Ventas cargadas: 44082 registros
2026-02-01 21:14:14 - INFO - Filtrados 3264 registros de sección 'tierras_aridos' de 44082 total
2026-02-01 21:14:14 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-01 21:14:17 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-01 21:14:17 - INFO - Costes cargados: 22145 registros
2026-02-01 21:14:17 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA TIERRAS_ARIDOS ===
2026-02-01 21:14:17 - INFO -   ABC: 555 registros
2026-02-01 21:14:17 - INFO -   Ventas: 3264 registros
2026-02-01 21:14:17 - INFO -   Costes: 22145 registros
2026-02-01 21:14:17 - INFO - Datos de ventas: 302 registros
2026-02-01 21:14:17 - INFO - Calculando pedido para semana 14 (302 registros)
2026-02-01 21:14:17 - INFO -   Objetivo: 4097.24€, Actual (ABC): 4019.19€
2026-02-01 21:14:17 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-01 21:14:17 - INFO -   Factor total: 1.3125
2026-02-01 21:14:17 - INFO -   Factor escalado: 1.3380
2026-02-01 21:14:17 - INFO -   Ventas preliminares (con ceil): 5809.66€
2026-02-01 21:14:17 - INFO -   Objetivo final: 5377.63€
2026-02-01 21:14:17 - INFO -   Delta: 432.03€
2026-02-01 21:14:17 - INFO -   Ventas finales: 5387.14€
2026-02-01 21:14:17 - INFO - Generando archivo: ././data/output/Pedido_Semana_14_2026-02-01_tierras_aridos.xlsx
2026-02-01 21:14:17 - INFO - Archivo guardado: ././data/output/Pedido_Semana_14_2026-02-01_tierras_aridos.xlsx
2026-02-01 21:14:17 - INFO - Archivo generado: ././data/output/Pedido_Semana_14_2026-02-01_tierras_aridos.xlsx
2026-02-01 21:14:17 - INFO -   Articulos: 71
2026-02-01 21:14:17 - INFO -   Importe: 5387.14€
2026-02-01 21:14:17 - INFO - 
==================================================
2026-02-01 21:14:17 - INFO - SECCION: DECO_EXTERIOR
2026-02-01 21:14:17 - INFO - ==================================================
2026-02-01 21:14:17 - INFO - === LEYENDO DATOS PARA SECCIÓN: DECO_EXTERIOR ===
2026-02-01 21:14:17 - WARNING - No se encontró archivo específico para 'deco_exterior', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-01 21:14:17 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-01 21:14:17 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-01 21:14:17 - INFO - Clasificación ABC cargada para 'deco_exterior': 555 registros
2026-02-01 21:14:17 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-01 21:14:23 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-01 21:14:23 - INFO - Usando hoja: Ventas por vendedor
2026-02-01 21:14:23 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-01 21:14:23 - INFO - Ventas cargadas: 44082 registros
2026-02-01 21:14:23 - INFO - Filtrados 4018 registros de sección 'deco_exterior' de 44082 total
2026-02-01 21:14:23 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-01 21:14:25 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-01 21:14:25 - INFO - Costes cargados: 22145 registros
2026-02-01 21:14:25 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA DECO_EXTERIOR ===
2026-02-01 21:14:25 - INFO -   ABC: 555 registros
2026-02-01 21:14:25 - INFO -   Ventas: 4018 registros
2026-02-01 21:14:25 - INFO -   Costes: 22145 registros
2026-02-01 21:14:25 - INFO - Datos de ventas: 316 registros
2026-02-01 21:14:25 - INFO - Calculando pedido para semana 14 (316 registros)
2026-02-01 21:14:26 - INFO -   Objetivo: 3740.34€, Actual (ABC): 3720.75€
2026-02-01 21:14:26 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-01 21:14:26 - INFO -   Factor total: 1.3125
2026-02-01 21:14:26 - INFO -   Factor escalado: 1.3194
2026-02-01 21:14:26 - INFO -   Ventas preliminares (con ceil): 6159.28€
2026-02-01 21:14:26 - INFO -   Objetivo final: 4909.20€
2026-02-01 21:14:26 - INFO -   Delta: 1250.08€
2026-02-01 21:14:26 - INFO -   Ventas finales: 4934.68€
2026-02-01 21:14:26 - INFO - Generando archivo: ././data/output/Pedido_Semana_14_2026-02-01_deco_exterior.xlsx
2026-02-01 21:14:27 - INFO - Archivo guardado: ././data/output/Pedido_Semana_14_2026-02-01_deco_exterior.xlsx
2026-02-01 21:14:27 - INFO - Archivo generado: ././data/output/Pedido_Semana_14_2026-02-01_deco_exterior.xlsx
2026-02-01 21:14:27 - INFO -   Articulos: 221
2026-02-01 21:14:27 - INFO -   Importe: 4934.68€
2026-02-01 21:14:27 - INFO - Estado guardado correctamente
2026-02-01 21:14:27 - INFO - Generando resumen: ././data/output/Resumen_Pedidos_VIVERO_2026-02-01.xlsx
2026-02-01 21:14:27 - INFO - Resumen guardado: ././data/output/Resumen_Pedidos_VIVERO_2026-02-01.xlsx
2026-02-01 21:14:27 - INFO - Estado guardado correctamente
2026-02-01 21:14:27 - INFO - 
======================================================================
2026-02-01 21:14:27 - INFO - RESUMEN DE EJECUCION
2026-02-01 21:14:27 - INFO - ======================================================================
2026-02-01 21:14:27 - INFO - Semana procesada: 14
2026-02-01 21:14:27 - INFO - Archivos generados: 12
2026-02-01 21:14:27 - INFO - Total articulos: 1702
2026-02-01 21:14:27 - INFO - Total importe: 48050.69€
2026-02-01 21:14:27 - INFO - ======================================================================
2026-02-01 21:14:27 - INFO - 
¡PEDIDO GENERADO EXITOSAMENTE!
2026-02-01 21:14:27 - INFO - Archivo: ././data/output/Pedido_Semana_14_2026-02-01_maf.xlsx
2026-02-01 21:14:27 - INFO - Articulos: 1702
2026-02-01 21:14:27 - INFO - Importe: 48050.69€
2026-02-01 21:15:15 - INFO - ======================================================================
2026-02-01 21:15:15 - INFO - SISTEMA DE PEDIDOS DE COMPRA - VIVERO ARANJUEZ V2
2026-02-01 21:15:15 - INFO - Fecha de ejecucion: 2026-02-01 21:15:15
2026-02-01 21:15:15 - INFO - ======================================================================
2026-02-01 21:15:15 - INFO - StateManager inicializado. Archivo de estado: ././data/state.json
2026-02-01 21:15:15 - INFO - Cargando estado desde: ././data/state.json
2026-02-01 21:15:15 - INFO - Estado cargado correctamente
2026-02-01 21:15:15 - INFO - SchedulerService inicializado correctamente
2026-02-01 21:15:15 - INFO - Horario configurado: sunday a las 15:00
2026-02-01 21:15:15 - INFO - Semana forzada por argumento: 15
2026-02-01 21:15:15 - INFO - ======================================================================
2026-02-01 21:15:15 - INFO - PROCESANDO PEDIDO PARA SEMANA 15
2026-02-01 21:15:15 - INFO - ======================================================================
2026-02-01 21:15:15 - INFO - DataLoader inicializado correctamente
2026-02-01 21:15:15 - INFO - ForecastEngine inicializado correctamente
2026-02-01 21:15:15 - INFO - OrderGenerator inicializado correctamente
2026-02-01 21:15:15 - INFO - SchedulerService inicializado correctamente
2026-02-01 21:15:15 - INFO - Horario configurado: sunday a las 15:00
2026-02-01 21:15:15 - INFO - Período de la semana: 2026-04-06 al 2026-04-12
2026-02-01 21:15:15 - INFO - Stock acumulado cargado: 1727 artículos
2026-02-01 21:15:15 - INFO - 
==================================================
2026-02-01 21:15:15 - INFO - SECCION: MAF
2026-02-01 21:15:15 - INFO - ==================================================
2026-02-01 21:15:15 - INFO - === LEYENDO DATOS PARA SECCIÓN: MAF ===
2026-02-01 21:15:15 - WARNING - No se encontró archivo específico para 'maf', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-01 21:15:15 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-01 21:15:15 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-01 21:15:15 - INFO - Clasificación ABC cargada para 'maf': 555 registros
2026-02-01 21:15:15 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-01 21:15:20 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-01 21:15:20 - INFO - Usando hoja: Ventas por vendedor
2026-02-01 21:15:21 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-01 21:15:21 - INFO - Ventas cargadas: 44082 registros
2026-02-01 21:15:21 - INFO - Filtrados 10970 registros de sección 'maf' de 44082 total
2026-02-01 21:15:21 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-01 21:15:23 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-01 21:15:23 - INFO - Costes cargados: 22145 registros
2026-02-01 21:15:23 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MAF ===
2026-02-01 21:15:23 - INFO -   ABC: 555 registros
2026-02-01 21:15:23 - INFO -   Ventas: 10970 registros
2026-02-01 21:15:23 - INFO -   Costes: 22145 registros
2026-02-01 21:15:23 - INFO - Datos de ventas: 884 registros
2026-02-01 21:15:23 - INFO - Calculando pedido para semana 15 (884 registros)
2026-02-01 21:15:24 - INFO -   Objetivo: 6466.57€, Actual (ABC): 6379.26€
2026-02-01 21:15:24 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.0
2026-02-01 21:15:24 - INFO -   Factor total: 1.0500
2026-02-01 21:15:24 - INFO -   Factor escalado: 1.0644
2026-02-01 21:15:24 - INFO -   Ventas preliminares (con ceil): 7690.29€
2026-02-01 21:15:24 - INFO -   Objetivo final: 6789.90€
2026-02-01 21:15:24 - INFO -   Delta: 900.39€
2026-02-01 21:15:24 - INFO -   Ventas finales: 6794.18€
2026-02-01 21:15:24 - INFO - Generando archivo: ././data/output/Pedido_Semana_15_2026-02-01_maf.xlsx
2026-02-01 21:15:24 - INFO - Archivo guardado: ././data/output/Pedido_Semana_15_2026-02-01_maf.xlsx
2026-02-01 21:15:24 - INFO - Archivo generado: ././data/output/Pedido_Semana_15_2026-02-01_maf.xlsx
2026-02-01 21:15:24 - INFO -   Articulos: 194
2026-02-01 21:15:24 - INFO -   Importe: 6626.79€
2026-02-01 21:15:24 - INFO - 
==================================================
2026-02-01 21:15:24 - INFO - SECCION: DECO_INTERIOR
2026-02-01 21:15:24 - INFO - ==================================================
2026-02-01 21:15:24 - INFO - === LEYENDO DATOS PARA SECCIÓN: DECO_INTERIOR ===
2026-02-01 21:15:24 - WARNING - No se encontró archivo específico para 'deco_interior', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-01 21:15:24 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-01 21:15:25 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-01 21:15:25 - INFO - Clasificación ABC cargada para 'deco_interior': 555 registros
2026-02-01 21:15:25 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-01 21:15:30 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-01 21:15:30 - INFO - Usando hoja: Ventas por vendedor
2026-02-01 21:15:30 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-01 21:15:30 - INFO - Ventas cargadas: 44082 registros
2026-02-01 21:15:30 - INFO - Filtrados 2468 registros de sección 'deco_interior' de 44082 total
2026-02-01 21:15:30 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-01 21:15:33 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-01 21:15:33 - INFO - Costes cargados: 22145 registros
2026-02-01 21:15:33 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA DECO_INTERIOR ===
2026-02-01 21:15:33 - INFO -   ABC: 555 registros
2026-02-01 21:15:33 - INFO -   Ventas: 2468 registros
2026-02-01 21:15:33 - INFO -   Costes: 22145 registros
2026-02-01 21:15:33 - INFO - Datos de ventas: 200 registros
2026-02-01 21:15:33 - INFO - Calculando pedido para semana 15 (200 registros)
2026-02-01 21:15:33 - INFO -   Objetivo: 1823.97€, Actual (ABC): 2348.99€
2026-02-01 21:15:33 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.0
2026-02-01 21:15:33 - INFO -   Factor total: 1.0500
2026-02-01 21:15:33 - INFO -   Factor escalado: 0.8153
2026-02-01 21:15:33 - INFO -   Ventas preliminares (con ceil): 2347.64€
2026-02-01 21:15:33 - INFO -   Objetivo final: 1915.17€
2026-02-01 21:15:33 - INFO -   Delta: 432.47€
2026-02-01 21:15:33 - INFO -   Ventas finales: 1918.92€
2026-02-01 21:15:33 - INFO - Generando archivo: ././data/output/Pedido_Semana_15_2026-02-01_deco_interior.xlsx
2026-02-01 21:15:33 - INFO - Archivo guardado: ././data/output/Pedido_Semana_15_2026-02-01_deco_interior.xlsx
2026-02-01 21:15:33 - INFO - Archivo generado: ././data/output/Pedido_Semana_15_2026-02-01_deco_interior.xlsx
2026-02-01 21:15:33 - INFO -   Articulos: 90
2026-02-01 21:15:33 - INFO -   Importe: 1873.83€
2026-02-01 21:15:33 - INFO - 
==================================================
2026-02-01 21:15:33 - INFO - SECCION: SEMILLAS
2026-02-01 21:15:33 - INFO - ==================================================
2026-02-01 21:15:33 - INFO - === LEYENDO DATOS PARA SECCIÓN: SEMILLAS ===
2026-02-01 21:15:33 - WARNING - No se encontró archivo específico para 'semillas', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-01 21:15:33 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-01 21:15:34 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-01 21:15:34 - INFO - Clasificación ABC cargada para 'semillas': 555 registros
2026-02-01 21:15:34 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-01 21:15:39 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-01 21:15:39 - INFO - Usando hoja: Ventas por vendedor
2026-02-01 21:15:39 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-01 21:15:39 - INFO - Ventas cargadas: 44082 registros
2026-02-01 21:15:39 - INFO - Filtrados 1180 registros de sección 'semillas' de 44082 total
2026-02-01 21:15:39 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-01 21:15:42 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-01 21:15:42 - INFO - Costes cargados: 22145 registros
2026-02-01 21:15:42 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA SEMILLAS ===
2026-02-01 21:15:42 - INFO -   ABC: 555 registros
2026-02-01 21:15:42 - INFO -   Ventas: 1180 registros
2026-02-01 21:15:42 - INFO -   Costes: 22145 registros
2026-02-01 21:15:42 - INFO - Datos de ventas: 86 registros
2026-02-01 21:15:42 - INFO - Calculando pedido para semana 15 (86 registros)
2026-02-01 21:15:42 - INFO -   Objetivo: 459.43€, Actual (ABC): 520.96€
2026-02-01 21:15:42 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.0
2026-02-01 21:15:42 - INFO -   Factor total: 1.0500
2026-02-01 21:15:42 - INFO -   Factor escalado: 0.9260
2026-02-01 21:15:42 - INFO -   Ventas preliminares (con ceil): 520.96€
2026-02-01 21:15:42 - INFO -   Objetivo final: 482.40€
2026-02-01 21:15:42 - INFO -   Delta: 38.56€
2026-02-01 21:15:42 - INFO -   Ventas finales: 483.39€
2026-02-01 21:15:42 - INFO - Generando archivo: ././data/output/Pedido_Semana_15_2026-02-01_semillas.xlsx
2026-02-01 21:15:42 - INFO - Archivo guardado: ././data/output/Pedido_Semana_15_2026-02-01_semillas.xlsx
2026-02-01 21:15:42 - INFO - Archivo generado: ././data/output/Pedido_Semana_15_2026-02-01_semillas.xlsx
2026-02-01 21:15:42 - INFO -   Articulos: 47
2026-02-01 21:15:42 - INFO -   Importe: 441.34€
2026-02-01 21:15:42 - INFO - 
==================================================
2026-02-01 21:15:42 - INFO - SECCION: MASCOTAS_VIVO
2026-02-01 21:15:42 - INFO - ==================================================
2026-02-01 21:15:42 - INFO - === LEYENDO DATOS PARA SECCIÓN: MASCOTAS_VIVO ===
2026-02-01 21:15:42 - WARNING - No se encontró archivo específico para 'mascotas_vivo', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-01 21:15:42 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-01 21:15:42 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-01 21:15:42 - INFO - Clasificación ABC cargada para 'mascotas_vivo': 555 registros
2026-02-01 21:15:42 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-01 21:15:48 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-01 21:15:48 - INFO - Usando hoja: Ventas por vendedor
2026-02-01 21:15:48 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-01 21:15:48 - INFO - Ventas cargadas: 44082 registros
2026-02-01 21:15:48 - INFO - Filtrados 1124 registros de sección 'mascotas_vivo' de 44082 total
2026-02-01 21:15:48 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-01 21:15:50 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-01 21:15:50 - INFO - Costes cargados: 22145 registros
2026-02-01 21:15:50 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MASCOTAS_VIVO ===
2026-02-01 21:15:50 - INFO -   ABC: 555 registros
2026-02-01 21:15:50 - INFO -   Ventas: 1124 registros
2026-02-01 21:15:50 - INFO -   Costes: 22145 registros
2026-02-01 21:15:50 - INFO - Datos de ventas: 94 registros
2026-02-01 21:15:50 - INFO - Calculando pedido para semana 15 (94 registros)
2026-02-01 21:15:51 - INFO -   Objetivo: 872.45€, Actual (ABC): 1183.89€
2026-02-01 21:15:51 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.0
2026-02-01 21:15:51 - INFO -   Factor total: 1.0500
2026-02-01 21:15:51 - INFO -   Factor escalado: 0.7738
2026-02-01 21:15:51 - INFO -   Ventas preliminares (con ceil): 1121.23€
2026-02-01 21:15:51 - INFO -   Objetivo final: 916.07€
2026-02-01 21:15:51 - INFO -   Delta: 205.16€
2026-02-01 21:15:51 - INFO -   Ventas finales: 916.31€
2026-02-01 21:15:51 - INFO - Generando archivo: ././data/output/Pedido_Semana_15_2026-02-01_mascotas_vivo.xlsx
2026-02-01 21:15:51 - INFO - Archivo guardado: ././data/output/Pedido_Semana_15_2026-02-01_mascotas_vivo.xlsx
2026-02-01 21:15:51 - INFO - Archivo generado: ././data/output/Pedido_Semana_15_2026-02-01_mascotas_vivo.xlsx
2026-02-01 21:15:51 - INFO -   Articulos: 36
2026-02-01 21:15:51 - INFO -   Importe: 838.47€
2026-02-01 21:15:51 - INFO - 
==================================================
2026-02-01 21:15:51 - INFO - SECCION: MASCOTAS_MANUFACTURADO
2026-02-01 21:15:51 - INFO - ==================================================
2026-02-01 21:15:51 - INFO - === LEYENDO DATOS PARA SECCIÓN: MASCOTAS_MANUFACTURADO ===
2026-02-01 21:15:51 - WARNING - No se encontró archivo específico para 'mascotas_manufacturado', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-01 21:15:51 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-01 21:15:51 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-01 21:15:51 - INFO - Clasificación ABC cargada para 'mascotas_manufacturado': 555 registros
2026-02-01 21:15:51 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-01 21:15:56 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-01 21:15:56 - INFO - Usando hoja: Ventas por vendedor
2026-02-01 21:15:56 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-01 21:15:56 - INFO - Ventas cargadas: 44082 registros
2026-02-01 21:15:56 - INFO - Filtrados 9784 registros de sección 'mascotas_manufacturado' de 44082 total
2026-02-01 21:15:56 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-01 21:15:59 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-01 21:15:59 - INFO - Costes cargados: 22145 registros
2026-02-01 21:15:59 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MASCOTAS_MANUFACTURADO ===
2026-02-01 21:15:59 - INFO -   ABC: 555 registros
2026-02-01 21:15:59 - INFO -   Ventas: 9784 registros
2026-02-01 21:15:59 - INFO -   Costes: 22145 registros
2026-02-01 21:15:59 - INFO - Datos de ventas: 759 registros
2026-02-01 21:15:59 - INFO - Calculando pedido para semana 15 (759 registros)
2026-02-01 21:16:01 - INFO -   Objetivo: 6689.54€, Actual (ABC): 8539.40€
2026-02-01 21:16:01 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.0
2026-02-01 21:16:01 - INFO -   Factor total: 1.0500
2026-02-01 21:16:01 - INFO -   Factor escalado: 0.8225
2026-02-01 21:16:01 - INFO -   Ventas preliminares (con ceil): 8480.95€
2026-02-01 21:16:01 - INFO -   Objetivo final: 7024.02€
2026-02-01 21:16:01 - INFO -   Delta: 1456.93€
2026-02-01 21:16:01 - INFO -   Ventas finales: 7026.01€
2026-02-01 21:16:01 - INFO - Generando archivo: ././data/output/Pedido_Semana_15_2026-02-01_mascotas_manufacturado.xlsx
2026-02-01 21:16:01 - INFO - Archivo guardado: ././data/output/Pedido_Semana_15_2026-02-01_mascotas_manufacturado.xlsx
2026-02-01 21:16:01 - INFO - Archivo generado: ././data/output/Pedido_Semana_15_2026-02-01_mascotas_manufacturado.xlsx
2026-02-01 21:16:01 - INFO -   Articulos: 304
2026-02-01 21:16:01 - INFO -   Importe: 6993.71€
2026-02-01 21:16:01 - INFO - 
==================================================
2026-02-01 21:16:01 - INFO - SECCION: INTERIOR
2026-02-01 21:16:01 - INFO - ==================================================
2026-02-01 21:16:01 - INFO - === LEYENDO DATOS PARA SECCIÓN: INTERIOR ===
2026-02-01 21:16:01 - WARNING - No se encontró archivo específico para 'interior', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-01 21:16:01 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-01 21:16:02 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-01 21:16:02 - INFO - Clasificación ABC cargada para 'interior': 555 registros
2026-02-01 21:16:02 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-01 21:16:07 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-01 21:16:07 - INFO - Usando hoja: Ventas por vendedor
2026-02-01 21:16:07 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-01 21:16:07 - INFO - Ventas cargadas: 44082 registros
2026-02-01 21:16:07 - INFO - Filtrados 3624 registros de sección 'interior' de 44082 total
2026-02-01 21:16:07 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-01 21:16:10 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-01 21:16:10 - INFO - Costes cargados: 22145 registros
2026-02-01 21:16:10 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA INTERIOR ===
2026-02-01 21:16:10 - INFO -   ABC: 555 registros
2026-02-01 21:16:10 - INFO -   Ventas: 3624 registros
2026-02-01 21:16:10 - INFO -   Costes: 22145 registros
2026-02-01 21:16:10 - INFO - Datos de ventas: 283 registros
2026-02-01 21:16:10 - INFO - Calculando pedido para semana 15 (283 registros)
2026-02-01 21:16:10 - INFO -   Objetivo: 2338.22€, Actual (ABC): 2125.82€
2026-02-01 21:16:10 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.0
2026-02-01 21:16:10 - INFO -   Factor total: 1.0500
2026-02-01 21:16:10 - INFO -   Factor escalado: 1.1549
2026-02-01 21:16:10 - INFO -   Ventas preliminares (con ceil): 3031.79€
2026-02-01 21:16:10 - INFO -   Objetivo final: 2455.13€
2026-02-01 21:16:10 - INFO -   Delta: 576.66€
2026-02-01 21:16:10 - INFO -   Ventas finales: 2456.51€
2026-02-01 21:16:10 - INFO - Generando archivo: ././data/output/Pedido_Semana_15_2026-02-01_interior.xlsx
2026-02-01 21:16:10 - INFO - Archivo guardado: ././data/output/Pedido_Semana_15_2026-02-01_interior.xlsx
2026-02-01 21:16:10 - INFO - Archivo generado: ././data/output/Pedido_Semana_15_2026-02-01_interior.xlsx
2026-02-01 21:16:10 - INFO -   Articulos: 92
2026-02-01 21:16:10 - INFO -   Importe: 2400.45€
2026-02-01 21:16:10 - INFO - 
==================================================
2026-02-01 21:16:10 - INFO - SECCION: FITOS
2026-02-01 21:16:10 - INFO - ==================================================
2026-02-01 21:16:10 - INFO - === LEYENDO DATOS PARA SECCIÓN: FITOS ===
2026-02-01 21:16:10 - WARNING - No se encontró archivo específico para 'fitos', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-01 21:16:10 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-01 21:16:11 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-01 21:16:11 - INFO - Clasificación ABC cargada para 'fitos': 555 registros
2026-02-01 21:16:11 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-01 21:16:16 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-01 21:16:16 - INFO - Usando hoja: Ventas por vendedor
2026-02-01 21:16:16 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-01 21:16:16 - INFO - Ventas cargadas: 44082 registros
2026-02-01 21:16:16 - INFO - Filtrados 1987 registros de sección 'fitos' de 44082 total
2026-02-01 21:16:16 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-01 21:16:19 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-01 21:16:19 - INFO - Costes cargados: 22145 registros
2026-02-01 21:16:19 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA FITOS ===
2026-02-01 21:16:19 - INFO -   ABC: 555 registros
2026-02-01 21:16:19 - INFO -   Ventas: 1987 registros
2026-02-01 21:16:19 - INFO -   Costes: 22145 registros
2026-02-01 21:16:19 - INFO - Datos de ventas: 140 registros
2026-02-01 21:16:19 - INFO - Calculando pedido para semana 15 (140 registros)
2026-02-01 21:16:19 - INFO -   Objetivo: 1708.82€, Actual (ABC): 1560.50€
2026-02-01 21:16:19 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.0
2026-02-01 21:16:19 - INFO -   Factor total: 1.0500
2026-02-01 21:16:19 - INFO -   Factor escalado: 1.1498
2026-02-01 21:16:19 - INFO -   Ventas preliminares (con ceil): 2590.82€
2026-02-01 21:16:19 - INFO -   Objetivo final: 1794.26€
2026-02-01 21:16:19 - INFO -   Delta: 796.56€
2026-02-01 21:16:19 - INFO -   Ventas finales: 1798.71€
2026-02-01 21:16:19 - INFO - Generando archivo: ././data/output/Pedido_Semana_15_2026-02-01_fitos.xlsx
2026-02-01 21:16:19 - INFO - Archivo guardado: ././data/output/Pedido_Semana_15_2026-02-01_fitos.xlsx
2026-02-01 21:16:19 - INFO - Archivo generado: ././data/output/Pedido_Semana_15_2026-02-01_fitos.xlsx
2026-02-01 21:16:19 - INFO -   Articulos: 88
2026-02-01 21:16:19 - INFO -   Importe: 1749.85€
2026-02-01 21:16:19 - INFO - 
==================================================
2026-02-01 21:16:19 - INFO - SECCION: VIVERO
2026-02-01 21:16:19 - INFO - ==================================================
2026-02-01 21:16:19 - INFO - === LEYENDO DATOS PARA SECCIÓN: VIVERO ===
2026-02-01 21:16:19 - WARNING - No se encontró archivo específico para 'vivero', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-01 21:16:19 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-01 21:16:19 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-01 21:16:19 - INFO - Clasificación ABC cargada para 'vivero': 555 registros
2026-02-01 21:16:19 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-01 21:16:24 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-01 21:16:24 - INFO - Usando hoja: Ventas por vendedor
2026-02-01 21:16:25 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-01 21:16:25 - INFO - Ventas cargadas: 44082 registros
2026-02-01 21:16:25 - INFO - Filtrados 2460 registros de sección 'vivero' de 44082 total
2026-02-01 21:16:25 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-01 21:16:27 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-01 21:16:27 - INFO - Costes cargados: 22145 registros
2026-02-01 21:16:27 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA VIVERO ===
2026-02-01 21:16:27 - INFO -   ABC: 555 registros
2026-02-01 21:16:27 - INFO -   Ventas: 2460 registros
2026-02-01 21:16:27 - INFO -   Costes: 22145 registros
2026-02-01 21:16:27 - INFO - Datos de ventas: 196 registros
2026-02-01 21:16:27 - INFO - Calculando pedido para semana 15 (196 registros)
2026-02-01 21:16:28 - INFO -   Objetivo: 4775.39€, Actual (ABC): 6766.07€
2026-02-01 21:16:28 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.0
2026-02-01 21:16:28 - INFO -   Factor total: 1.0500
2026-02-01 21:16:28 - INFO -   Factor escalado: 0.7411
2026-02-01 21:16:28 - INFO -   Ventas preliminares (con ceil): 6205.68€
2026-02-01 21:16:28 - INFO -   Objetivo final: 5014.16€
2026-02-01 21:16:28 - INFO -   Delta: 1191.52€
2026-02-01 21:16:28 - INFO -   Ventas finales: 5036.31€
2026-02-01 21:16:28 - INFO - Generando archivo: ././data/output/Pedido_Semana_15_2026-02-01_vivero.xlsx
2026-02-01 21:16:28 - INFO - Archivo guardado: ././data/output/Pedido_Semana_15_2026-02-01_vivero.xlsx
2026-02-01 21:16:28 - INFO - Archivo generado: ././data/output/Pedido_Semana_15_2026-02-01_vivero.xlsx
2026-02-01 21:16:28 - INFO -   Articulos: 74
2026-02-01 21:16:28 - INFO -   Importe: 4862.41€
2026-02-01 21:16:28 - INFO - 
==================================================
2026-02-01 21:16:28 - INFO - SECCION: UTILES_JARDIN
2026-02-01 21:16:28 - INFO - ==================================================
2026-02-01 21:16:28 - INFO - === LEYENDO DATOS PARA SECCIÓN: UTILES_JARDIN ===
2026-02-01 21:16:28 - WARNING - No se encontró archivo específico para 'utiles_jardin', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-01 21:16:28 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-01 21:16:28 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-01 21:16:28 - INFO - Clasificación ABC cargada para 'utiles_jardin': 555 registros
2026-02-01 21:16:28 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-01 21:16:33 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-01 21:16:33 - INFO - Usando hoja: Ventas por vendedor
2026-02-01 21:16:34 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-01 21:16:34 - INFO - Ventas cargadas: 44082 registros
2026-02-01 21:16:34 - INFO - Filtrados 1009 registros de sección 'utiles_jardin' de 44082 total
2026-02-01 21:16:34 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-01 21:16:36 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-01 21:16:36 - INFO - Costes cargados: 22145 registros
2026-02-01 21:16:36 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA UTILES_JARDIN ===
2026-02-01 21:16:36 - INFO -   ABC: 555 registros
2026-02-01 21:16:36 - INFO -   Ventas: 1009 registros
2026-02-01 21:16:36 - INFO -   Costes: 22145 registros
2026-02-01 21:16:36 - INFO - Datos de ventas: 78 registros
2026-02-01 21:16:36 - INFO - Calculando pedido para semana 15 (78 registros)
2026-02-01 21:16:37 - INFO -   Objetivo: 978.93€, Actual (ABC): 701.37€
2026-02-01 21:16:37 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.0
2026-02-01 21:16:37 - INFO -   Factor total: 1.0500
2026-02-01 21:16:37 - INFO -   Factor escalado: 1.4655
2026-02-01 21:16:37 - INFO -   Ventas preliminares (con ceil): 1303.18€
2026-02-01 21:16:37 - INFO -   Objetivo final: 1027.88€
2026-02-01 21:16:37 - INFO -   Delta: 275.30€
2026-02-01 21:16:37 - INFO -   Ventas finales: 1032.32€
2026-02-01 21:16:37 - INFO - Generando archivo: ././data/output/Pedido_Semana_15_2026-02-01_utiles_jardin.xlsx
2026-02-01 21:16:37 - INFO - Archivo guardado: ././data/output/Pedido_Semana_15_2026-02-01_utiles_jardin.xlsx
2026-02-01 21:16:37 - INFO - Archivo generado: ././data/output/Pedido_Semana_15_2026-02-01_utiles_jardin.xlsx
2026-02-01 21:16:37 - INFO -   Articulos: 66
2026-02-01 21:16:37 - INFO -   Importe: 1030.98€
2026-02-01 21:16:37 - INFO - 
==================================================
2026-02-01 21:16:37 - INFO - SECCION: TIERRAS_ARIDOS
2026-02-01 21:16:37 - INFO - ==================================================
2026-02-01 21:16:37 - INFO - === LEYENDO DATOS PARA SECCIÓN: TIERRAS_ARIDOS ===
2026-02-01 21:16:37 - WARNING - No se encontró archivo específico para 'tierras_aridos', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-01 21:16:37 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-01 21:16:37 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-01 21:16:37 - INFO - Clasificación ABC cargada para 'tierras_aridos': 555 registros
2026-02-01 21:16:37 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-01 21:16:42 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-01 21:16:42 - INFO - Usando hoja: Ventas por vendedor
2026-02-01 21:16:42 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-01 21:16:42 - INFO - Ventas cargadas: 44082 registros
2026-02-01 21:16:43 - INFO - Filtrados 3264 registros de sección 'tierras_aridos' de 44082 total
2026-02-01 21:16:43 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-01 21:16:45 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-01 21:16:45 - INFO - Costes cargados: 22145 registros
2026-02-01 21:16:45 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA TIERRAS_ARIDOS ===
2026-02-01 21:16:45 - INFO -   ABC: 555 registros
2026-02-01 21:16:45 - INFO -   Ventas: 3264 registros
2026-02-01 21:16:45 - INFO -   Costes: 22145 registros
2026-02-01 21:16:45 - INFO - Datos de ventas: 257 registros
2026-02-01 21:16:45 - INFO - Calculando pedido para semana 15 (257 registros)
2026-02-01 21:16:46 - INFO -   Objetivo: 3489.25€, Actual (ABC): 3157.98€
2026-02-01 21:16:46 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.0
2026-02-01 21:16:46 - INFO -   Factor total: 1.0500
2026-02-01 21:16:46 - INFO -   Factor escalado: 1.1601
2026-02-01 21:16:46 - INFO -   Ventas preliminares (con ceil): 4053.35€
2026-02-01 21:16:46 - INFO -   Objetivo final: 3663.71€
2026-02-01 21:16:46 - INFO -   Delta: 389.64€
2026-02-01 21:16:46 - INFO -   Ventas finales: 3666.91€
2026-02-01 21:16:46 - INFO - Generando archivo: ././data/output/Pedido_Semana_15_2026-02-01_tierras_aridos.xlsx
2026-02-01 21:16:46 - INFO - Archivo guardado: ././data/output/Pedido_Semana_15_2026-02-01_tierras_aridos.xlsx
2026-02-01 21:16:46 - INFO - Archivo generado: ././data/output/Pedido_Semana_15_2026-02-01_tierras_aridos.xlsx
2026-02-01 21:16:46 - INFO -   Articulos: 61
2026-02-01 21:16:46 - INFO -   Importe: 3614.01€
2026-02-01 21:16:46 - INFO - 
==================================================
2026-02-01 21:16:46 - INFO - SECCION: DECO_EXTERIOR
2026-02-01 21:16:46 - INFO - ==================================================
2026-02-01 21:16:46 - INFO - === LEYENDO DATOS PARA SECCIÓN: DECO_EXTERIOR ===
2026-02-01 21:16:46 - WARNING - No se encontró archivo específico para 'deco_exterior', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-01 21:16:46 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-01 21:16:46 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-01 21:16:46 - INFO - Clasificación ABC cargada para 'deco_exterior': 555 registros
2026-02-01 21:16:46 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-01 21:16:51 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-01 21:16:51 - INFO - Usando hoja: Ventas por vendedor
2026-02-01 21:16:51 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-01 21:16:51 - INFO - Ventas cargadas: 44082 registros
2026-02-01 21:16:51 - INFO - Filtrados 4018 registros de sección 'deco_exterior' de 44082 total
2026-02-01 21:16:51 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-01 21:16:54 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-01 21:16:54 - INFO - Costes cargados: 22145 registros
2026-02-01 21:16:54 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA DECO_EXTERIOR ===
2026-02-01 21:16:54 - INFO -   ABC: 555 registros
2026-02-01 21:16:54 - INFO -   Ventas: 4018 registros
2026-02-01 21:16:54 - INFO -   Costes: 22145 registros
2026-02-01 21:16:54 - INFO - Datos de ventas: 267 registros
2026-02-01 21:16:54 - INFO - Calculando pedido para semana 15 (267 registros)
2026-02-01 21:16:55 - INFO -   Objetivo: 3413.58€, Actual (ABC): 3177.56€
2026-02-01 21:16:55 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.0
2026-02-01 21:16:55 - INFO -   Factor total: 1.0500
2026-02-01 21:16:55 - INFO -   Factor escalado: 1.1280
2026-02-01 21:16:55 - INFO -   Ventas preliminares (con ceil): 5145.01€
2026-02-01 21:16:55 - INFO -   Objetivo final: 3584.26€
2026-02-01 21:16:55 - INFO -   Delta: 1560.75€
2026-02-01 21:16:55 - INFO -   Ventas finales: 3621.58€
2026-02-01 21:16:55 - INFO - Generando archivo: ././data/output/Pedido_Semana_15_2026-02-01_deco_exterior.xlsx
2026-02-01 21:16:55 - INFO - Archivo guardado: ././data/output/Pedido_Semana_15_2026-02-01_deco_exterior.xlsx
2026-02-01 21:16:55 - INFO - Archivo generado: ././data/output/Pedido_Semana_15_2026-02-01_deco_exterior.xlsx
2026-02-01 21:16:55 - INFO -   Articulos: 183
2026-02-01 21:16:55 - INFO -   Importe: 3551.33€
2026-02-01 21:16:55 - INFO - Estado guardado correctamente
2026-02-01 21:16:55 - INFO - Generando resumen: ././data/output/Resumen_Pedidos_VIVERO_2026-02-01.xlsx
2026-02-01 21:16:55 - INFO - Resumen guardado: ././data/output/Resumen_Pedidos_VIVERO_2026-02-01.xlsx
2026-02-01 21:16:55 - INFO - Estado guardado correctamente
2026-02-01 21:16:55 - INFO - 
======================================================================
2026-02-01 21:16:55 - INFO - RESUMEN DE EJECUCION
2026-02-01 21:16:55 - INFO - ======================================================================
2026-02-01 21:16:55 - INFO - Semana procesada: 15
2026-02-01 21:16:55 - INFO - Archivos generados: 12
2026-02-01 21:16:55 - INFO - Total articulos: 1235
2026-02-01 21:16:55 - INFO - Total importe: 33983.17€
2026-02-01 21:16:55 - INFO - ======================================================================
2026-02-01 21:16:55 - INFO - 
¡PEDIDO GENERADO EXITOSAMENTE!
2026-02-01 21:16:55 - INFO - Archivo: ././data/output/Pedido_Semana_15_2026-02-01_maf.xlsx
2026-02-01 21:16:55 - INFO - Articulos: 1235
2026-02-01 21:16:55 - INFO - Importe: 33983.17€
2026-02-02 06:35:54 - INFO - ======================================================================
2026-02-02 06:35:54 - INFO - SISTEMA DE PEDIDOS DE COMPRA - VIVERO ARANJUEZ V2
2026-02-02 06:35:54 - INFO - Fecha de ejecucion: 2026-02-02 06:35:54
2026-02-02 06:35:54 - INFO - ======================================================================
2026-02-02 06:35:54 - INFO - StateManager inicializado. Archivo de estado: ././data/state.json
2026-02-02 06:35:54 - INFO - Cargando estado desde: ././data/state.json
2026-02-02 06:35:54 - WARNING - Archivo de estado no encontrado. Creando nuevo: ././data/state.json
2026-02-02 06:35:54 - INFO - Estado guardado correctamente
2026-02-02 06:35:54 - INFO - SchedulerService inicializado correctamente
2026-02-02 06:35:54 - INFO - Horario configurado: sunday a las 15:00
2026-02-02 06:36:10 - INFO - ======================================================================
2026-02-02 06:36:10 - INFO - SISTEMA DE PEDIDOS DE COMPRA - VIVERO ARANJUEZ V2
2026-02-02 06:36:10 - INFO - Fecha de ejecucion: 2026-02-02 06:36:10
2026-02-02 06:36:10 - INFO - ======================================================================
2026-02-02 06:36:10 - INFO - StateManager inicializado. Archivo de estado: ././data/state.json
2026-02-02 06:36:10 - INFO - Cargando estado desde: ././data/state.json
2026-02-02 06:36:10 - INFO - Estado cargado correctamente
2026-02-02 06:36:10 - INFO - SchedulerService inicializado correctamente
2026-02-02 06:36:10 - INFO - Horario configurado: sunday a las 15:00
2026-02-02 06:36:10 - WARNING - No es el horario de ejecucion: Hoy es lunes, no es domingo
2026-02-02 06:36:10 - INFO - La próxima ejecución será el domingo 08/02/2026 a las 15:00
2026-02-02 06:36:10 - INFO - pero hay semana pendiente: Semana a procesar: 6
2026-02-02 06:36:10 - INFO - Use --continuo para esperar hasta el horario de ejecucion.
2026-02-02 06:36:20 - INFO - ======================================================================
2026-02-02 06:36:20 - INFO - SISTEMA DE PEDIDOS DE COMPRA - VIVERO ARANJUEZ V2
2026-02-02 06:36:20 - INFO - Fecha de ejecucion: 2026-02-02 06:36:20
2026-02-02 06:36:20 - INFO - ======================================================================
2026-02-02 06:36:20 - INFO - StateManager inicializado. Archivo de estado: ././data/state.json
2026-02-02 06:36:20 - INFO - Cargando estado desde: ././data/state.json
2026-02-02 06:36:20 - INFO - Estado cargado correctamente
2026-02-02 06:36:20 - INFO - SchedulerService inicializado correctamente
2026-02-02 06:36:20 - INFO - Horario configurado: sunday a las 15:00
2026-02-02 06:36:20 - WARNING - No es el horario de ejecucion: Hoy es lunes, no es domingo
2026-02-02 06:36:20 - INFO - La próxima ejecución será el domingo 08/02/2026 a las 15:00
2026-02-02 06:36:20 - INFO - pero hay semana pendiente: Semana a procesar: 6
2026-02-02 06:36:20 - INFO - Use --continuo para esperar hasta el horario de ejecucion.
2026-02-02 06:36:32 - INFO - ======================================================================
2026-02-02 06:36:32 - INFO - SISTEMA DE PEDIDOS DE COMPRA - VIVERO ARANJUEZ V2
2026-02-02 06:36:32 - INFO - Fecha de ejecucion: 2026-02-02 06:36:32
2026-02-02 06:36:32 - INFO - ======================================================================
2026-02-02 06:36:32 - INFO - StateManager inicializado. Archivo de estado: ././data/state.json
2026-02-02 06:36:32 - INFO - Cargando estado desde: ././data/state.json
2026-02-02 06:36:32 - INFO - Estado cargado correctamente
2026-02-02 06:36:32 - INFO - SchedulerService inicializado correctamente
2026-02-02 06:36:32 - INFO - Horario configurado: sunday a las 15:00
2026-02-02 06:36:32 - INFO - Semana forzada por argumento: 6
2026-02-02 06:36:32 - INFO - ======================================================================
2026-02-02 06:36:32 - INFO - PROCESANDO PEDIDO PARA SEMANA 6
2026-02-02 06:36:32 - INFO - ======================================================================
2026-02-02 06:36:32 - INFO - DataLoader inicializado correctamente
2026-02-02 06:36:32 - INFO - ForecastEngine inicializado correctamente
2026-02-02 06:36:32 - INFO - OrderGenerator inicializado correctamente
2026-02-02 06:36:32 - INFO - SchedulerService inicializado correctamente
2026-02-02 06:36:32 - INFO - Horario configurado: sunday a las 15:00
2026-02-02 06:36:32 - INFO - Período de la semana: 2026-02-02 al 2026-02-08
2026-02-02 06:36:32 - INFO - Stock acumulado cargado: 0 artículos
2026-02-02 06:36:32 - INFO - 
==================================================
2026-02-02 06:36:32 - INFO - SECCION: MAF
2026-02-02 06:36:32 - INFO - ==================================================
2026-02-02 06:36:32 - INFO - === LEYENDO DATOS PARA SECCIÓN: MAF ===
2026-02-02 06:36:32 - WARNING - No se encontró archivo específico para 'maf', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-02 06:36:32 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-02 06:36:33 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-02 06:36:33 - INFO - Clasificación ABC cargada para 'maf': 555 registros
2026-02-02 06:36:33 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-02 06:36:38 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 06:36:38 - INFO - Usando hoja: Ventas por vendedor
2026-02-02 06:36:38 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-02 06:36:38 - INFO - Ventas cargadas: 44082 registros
2026-02-02 06:36:38 - INFO - Filtrados 10970 registros de sección 'maf' de 44082 total
2026-02-02 06:36:38 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-02 06:36:41 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 06:36:41 - INFO - Costes cargados: 22145 registros
2026-02-02 06:36:41 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MAF ===
2026-02-02 06:36:41 - INFO -   ABC: 555 registros
2026-02-02 06:36:41 - INFO -   Ventas: 10970 registros
2026-02-02 06:36:41 - INFO -   Costes: 22145 registros
2026-02-02 06:36:41 - WARNING - No hay datos de ventas para la semana 6 en 'maf'
2026-02-02 06:36:41 - INFO - 
==================================================
2026-02-02 06:36:41 - INFO - SECCION: DECO_INTERIOR
2026-02-02 06:36:41 - INFO - ==================================================
2026-02-02 06:36:41 - INFO - === LEYENDO DATOS PARA SECCIÓN: DECO_INTERIOR ===
2026-02-02 06:36:41 - WARNING - No se encontró archivo específico para 'deco_interior', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-02 06:36:41 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-02 06:36:41 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-02 06:36:41 - INFO - Clasificación ABC cargada para 'deco_interior': 555 registros
2026-02-02 06:36:41 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-02 06:36:46 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 06:36:46 - INFO - Usando hoja: Ventas por vendedor
2026-02-02 06:36:46 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-02 06:36:46 - INFO - Ventas cargadas: 44082 registros
2026-02-02 06:36:46 - INFO - Filtrados 2468 registros de sección 'deco_interior' de 44082 total
2026-02-02 06:36:46 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-02 06:36:49 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 06:36:49 - INFO - Costes cargados: 22145 registros
2026-02-02 06:36:49 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA DECO_INTERIOR ===
2026-02-02 06:36:49 - INFO -   ABC: 555 registros
2026-02-02 06:36:49 - INFO -   Ventas: 2468 registros
2026-02-02 06:36:49 - INFO -   Costes: 22145 registros
2026-02-02 06:36:49 - WARNING - No hay datos de ventas para la semana 6 en 'deco_interior'
2026-02-02 06:36:49 - INFO - 
==================================================
2026-02-02 06:36:49 - INFO - SECCION: SEMILLAS
2026-02-02 06:36:49 - INFO - ==================================================
2026-02-02 06:36:49 - INFO - === LEYENDO DATOS PARA SECCIÓN: SEMILLAS ===
2026-02-02 06:36:49 - WARNING - No se encontró archivo específico para 'semillas', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-02 06:36:49 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-02 06:36:49 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-02 06:36:49 - INFO - Clasificación ABC cargada para 'semillas': 555 registros
2026-02-02 06:36:49 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-02 06:36:54 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 06:36:54 - INFO - Usando hoja: Ventas por vendedor
2026-02-02 06:36:54 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-02 06:36:54 - INFO - Ventas cargadas: 44082 registros
2026-02-02 06:36:55 - INFO - Filtrados 1180 registros de sección 'semillas' de 44082 total
2026-02-02 06:36:55 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-02 06:36:57 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 06:36:57 - INFO - Costes cargados: 22145 registros
2026-02-02 06:36:57 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA SEMILLAS ===
2026-02-02 06:36:57 - INFO -   ABC: 555 registros
2026-02-02 06:36:57 - INFO -   Ventas: 1180 registros
2026-02-02 06:36:57 - INFO -   Costes: 22145 registros
2026-02-02 06:36:57 - WARNING - No hay datos de ventas para la semana 6 en 'semillas'
2026-02-02 06:36:57 - INFO - 
==================================================
2026-02-02 06:36:57 - INFO - SECCION: MASCOTAS_VIVO
2026-02-02 06:36:57 - INFO - ==================================================
2026-02-02 06:36:57 - INFO - === LEYENDO DATOS PARA SECCIÓN: MASCOTAS_VIVO ===
2026-02-02 06:36:57 - WARNING - No se encontró archivo específico para 'mascotas_vivo', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-02 06:36:57 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-02 06:36:57 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-02 06:36:57 - INFO - Clasificación ABC cargada para 'mascotas_vivo': 555 registros
2026-02-02 06:36:57 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-02 06:37:03 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 06:37:03 - INFO - Usando hoja: Ventas por vendedor
2026-02-02 06:37:03 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-02 06:37:03 - INFO - Ventas cargadas: 44082 registros
2026-02-02 06:37:03 - INFO - Filtrados 1124 registros de sección 'mascotas_vivo' de 44082 total
2026-02-02 06:37:03 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-02 06:37:06 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 06:37:06 - INFO - Costes cargados: 22145 registros
2026-02-02 06:37:06 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MASCOTAS_VIVO ===
2026-02-02 06:37:06 - INFO -   ABC: 555 registros
2026-02-02 06:37:06 - INFO -   Ventas: 1124 registros
2026-02-02 06:37:06 - INFO -   Costes: 22145 registros
2026-02-02 06:37:06 - WARNING - No hay datos de ventas para la semana 6 en 'mascotas_vivo'
2026-02-02 06:37:06 - INFO - 
==================================================
2026-02-02 06:37:06 - INFO - SECCION: MASCOTAS_MANUFACTURADO
2026-02-02 06:37:06 - INFO - ==================================================
2026-02-02 06:37:06 - INFO - === LEYENDO DATOS PARA SECCIÓN: MASCOTAS_MANUFACTURADO ===
2026-02-02 06:37:06 - WARNING - No se encontró archivo específico para 'mascotas_manufacturado', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-02 06:37:06 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-02 06:37:06 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-02 06:37:06 - INFO - Clasificación ABC cargada para 'mascotas_manufacturado': 555 registros
2026-02-02 06:37:06 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-02 06:37:11 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 06:37:11 - INFO - Usando hoja: Ventas por vendedor
2026-02-02 06:37:11 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-02 06:37:11 - INFO - Ventas cargadas: 44082 registros
2026-02-02 06:37:11 - INFO - Filtrados 9784 registros de sección 'mascotas_manufacturado' de 44082 total
2026-02-02 06:37:11 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-02 06:37:14 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 06:37:14 - INFO - Costes cargados: 22145 registros
2026-02-02 06:37:14 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MASCOTAS_MANUFACTURADO ===
2026-02-02 06:37:14 - INFO -   ABC: 555 registros
2026-02-02 06:37:14 - INFO -   Ventas: 9784 registros
2026-02-02 06:37:14 - INFO -   Costes: 22145 registros
2026-02-02 06:37:14 - WARNING - No hay datos de ventas para la semana 6 en 'mascotas_manufacturado'
2026-02-02 06:37:14 - INFO - 
==================================================
2026-02-02 06:37:14 - INFO - SECCION: INTERIOR
2026-02-02 06:37:14 - INFO - ==================================================
2026-02-02 06:37:14 - INFO - === LEYENDO DATOS PARA SECCIÓN: INTERIOR ===
2026-02-02 06:37:14 - WARNING - No se encontró archivo específico para 'interior', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-02 06:37:14 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-02 06:37:14 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-02 06:37:14 - INFO - Clasificación ABC cargada para 'interior': 555 registros
2026-02-02 06:37:14 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-02 06:37:19 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 06:37:19 - INFO - Usando hoja: Ventas por vendedor
2026-02-02 06:37:20 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-02 06:37:20 - INFO - Ventas cargadas: 44082 registros
2026-02-02 06:37:20 - INFO - Filtrados 3624 registros de sección 'interior' de 44082 total
2026-02-02 06:37:20 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-02 06:37:22 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 06:37:22 - INFO - Costes cargados: 22145 registros
2026-02-02 06:37:22 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA INTERIOR ===
2026-02-02 06:37:22 - INFO -   ABC: 555 registros
2026-02-02 06:37:22 - INFO -   Ventas: 3624 registros
2026-02-02 06:37:22 - INFO -   Costes: 22145 registros
2026-02-02 06:37:22 - WARNING - No hay datos de ventas para la semana 6 en 'interior'
2026-02-02 06:37:22 - INFO - 
==================================================
2026-02-02 06:37:22 - INFO - SECCION: FITOS
2026-02-02 06:37:22 - INFO - ==================================================
2026-02-02 06:37:22 - INFO - === LEYENDO DATOS PARA SECCIÓN: FITOS ===
2026-02-02 06:37:22 - WARNING - No se encontró archivo específico para 'fitos', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-02 06:37:22 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-02 06:37:23 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-02 06:37:23 - INFO - Clasificación ABC cargada para 'fitos': 555 registros
2026-02-02 06:37:23 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-02 06:37:28 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 06:37:28 - INFO - Usando hoja: Ventas por vendedor
2026-02-02 06:37:28 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-02 06:37:28 - INFO - Ventas cargadas: 44082 registros
2026-02-02 06:37:28 - INFO - Filtrados 1987 registros de sección 'fitos' de 44082 total
2026-02-02 06:37:28 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-02 06:37:31 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 06:37:31 - INFO - Costes cargados: 22145 registros
2026-02-02 06:37:31 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA FITOS ===
2026-02-02 06:37:31 - INFO -   ABC: 555 registros
2026-02-02 06:37:31 - INFO -   Ventas: 1987 registros
2026-02-02 06:37:31 - INFO -   Costes: 22145 registros
2026-02-02 06:37:31 - WARNING - No hay datos de ventas para la semana 6 en 'fitos'
2026-02-02 06:37:31 - INFO - 
==================================================
2026-02-02 06:37:31 - INFO - SECCION: VIVERO
2026-02-02 06:37:31 - INFO - ==================================================
2026-02-02 06:37:31 - INFO - === LEYENDO DATOS PARA SECCIÓN: VIVERO ===
2026-02-02 06:37:31 - WARNING - No se encontró archivo específico para 'vivero', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-02 06:37:31 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-02 06:37:31 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-02 06:37:31 - INFO - Clasificación ABC cargada para 'vivero': 555 registros
2026-02-02 06:37:31 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-02 06:37:36 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 06:37:36 - INFO - Usando hoja: Ventas por vendedor
2026-02-02 06:37:36 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-02 06:37:36 - INFO - Ventas cargadas: 44082 registros
2026-02-02 06:37:36 - INFO - Filtrados 2460 registros de sección 'vivero' de 44082 total
2026-02-02 06:37:36 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-02 06:37:39 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 06:37:39 - INFO - Costes cargados: 22145 registros
2026-02-02 06:37:39 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA VIVERO ===
2026-02-02 06:37:39 - INFO -   ABC: 555 registros
2026-02-02 06:37:39 - INFO -   Ventas: 2460 registros
2026-02-02 06:37:39 - INFO -   Costes: 22145 registros
2026-02-02 06:37:39 - WARNING - No hay datos de ventas para la semana 6 en 'vivero'
2026-02-02 06:37:39 - INFO - 
==================================================
2026-02-02 06:37:39 - INFO - SECCION: UTILES_JARDIN
2026-02-02 06:37:39 - INFO - ==================================================
2026-02-02 06:37:39 - INFO - === LEYENDO DATOS PARA SECCIÓN: UTILES_JARDIN ===
2026-02-02 06:37:39 - WARNING - No se encontró archivo específico para 'utiles_jardin', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-02 06:37:39 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-02 06:37:39 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-02 06:37:39 - INFO - Clasificación ABC cargada para 'utiles_jardin': 555 registros
2026-02-02 06:37:39 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-02 06:37:44 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 06:37:44 - INFO - Usando hoja: Ventas por vendedor
2026-02-02 06:37:44 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-02 06:37:45 - INFO - Ventas cargadas: 44082 registros
2026-02-02 06:37:45 - INFO - Filtrados 1009 registros de sección 'utiles_jardin' de 44082 total
2026-02-02 06:37:45 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-02 06:37:47 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 06:37:47 - INFO - Costes cargados: 22145 registros
2026-02-02 06:37:47 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA UTILES_JARDIN ===
2026-02-02 06:37:47 - INFO -   ABC: 555 registros
2026-02-02 06:37:47 - INFO -   Ventas: 1009 registros
2026-02-02 06:37:47 - INFO -   Costes: 22145 registros
2026-02-02 06:37:47 - WARNING - No hay datos de ventas para la semana 6 en 'utiles_jardin'
2026-02-02 06:37:47 - INFO - 
==================================================
2026-02-02 06:37:47 - INFO - SECCION: TIERRAS_ARIDOS
2026-02-02 06:37:47 - INFO - ==================================================
2026-02-02 06:37:47 - INFO - === LEYENDO DATOS PARA SECCIÓN: TIERRAS_ARIDOS ===
2026-02-02 06:37:47 - WARNING - No se encontró archivo específico para 'tierras_aridos', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-02 06:37:47 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-02 06:37:47 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-02 06:37:47 - INFO - Clasificación ABC cargada para 'tierras_aridos': 555 registros
2026-02-02 06:37:47 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-02 06:37:53 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 06:37:53 - INFO - Usando hoja: Ventas por vendedor
2026-02-02 06:37:53 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-02 06:37:53 - INFO - Ventas cargadas: 44082 registros
2026-02-02 06:37:53 - INFO - Filtrados 3264 registros de sección 'tierras_aridos' de 44082 total
2026-02-02 06:37:53 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-02 06:37:56 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 06:37:56 - INFO - Costes cargados: 22145 registros
2026-02-02 06:37:56 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA TIERRAS_ARIDOS ===
2026-02-02 06:37:56 - INFO -   ABC: 555 registros
2026-02-02 06:37:56 - INFO -   Ventas: 3264 registros
2026-02-02 06:37:56 - INFO -   Costes: 22145 registros
2026-02-02 06:37:56 - WARNING - No hay datos de ventas para la semana 6 en 'tierras_aridos'
2026-02-02 06:37:56 - INFO - 
==================================================
2026-02-02 06:37:56 - INFO - SECCION: DECO_EXTERIOR
2026-02-02 06:37:56 - INFO - ==================================================
2026-02-02 06:37:56 - INFO - === LEYENDO DATOS PARA SECCIÓN: DECO_EXTERIOR ===
2026-02-02 06:37:56 - WARNING - No se encontró archivo específico para 'deco_exterior', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-02 06:37:56 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-02 06:37:56 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-02 06:37:56 - INFO - Clasificación ABC cargada para 'deco_exterior': 555 registros
2026-02-02 06:37:56 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-02 06:38:01 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 06:38:01 - INFO - Usando hoja: Ventas por vendedor
2026-02-02 06:38:02 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-02 06:38:02 - INFO - Ventas cargadas: 44082 registros
2026-02-02 06:38:02 - INFO - Filtrados 4018 registros de sección 'deco_exterior' de 44082 total
2026-02-02 06:38:02 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-02 06:38:04 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 06:38:04 - INFO - Costes cargados: 22145 registros
2026-02-02 06:38:04 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA DECO_EXTERIOR ===
2026-02-02 06:38:04 - INFO -   ABC: 555 registros
2026-02-02 06:38:04 - INFO -   Ventas: 4018 registros
2026-02-02 06:38:04 - INFO -   Costes: 22145 registros
2026-02-02 06:38:04 - WARNING - No hay datos de ventas para la semana 6 en 'deco_exterior'
2026-02-02 06:38:04 - INFO - Estado guardado correctamente
2026-02-02 06:38:04 - INFO - 
======================================================================
2026-02-02 06:38:04 - INFO - RESUMEN DE EJECUCION
2026-02-02 06:38:04 - INFO - ======================================================================
2026-02-02 06:38:04 - INFO - Semana procesada: 6
2026-02-02 06:38:04 - INFO - Archivos generados: 0
2026-02-02 06:38:04 - INFO - Total articulos: 0
2026-02-02 06:38:04 - INFO - Total importe: 0.00€
2026-02-02 06:38:04 - INFO - ======================================================================
2026-02-02 06:38:04 - ERROR - 
ERROR: No se pudo generar el pedido.
2026-02-02 06:38:11 - INFO - ======================================================================
2026-02-02 06:38:11 - INFO - SISTEMA DE PEDIDOS DE COMPRA - VIVERO ARANJUEZ V2
2026-02-02 06:38:11 - INFO - Fecha de ejecucion: 2026-02-02 06:38:11
2026-02-02 06:38:11 - INFO - ======================================================================
2026-02-02 06:38:11 - INFO - StateManager inicializado. Archivo de estado: ././data/state.json
2026-02-02 06:38:11 - INFO - Cargando estado desde: ././data/state.json
2026-02-02 06:38:11 - INFO - Estado cargado correctamente
2026-02-02 06:38:11 - INFO - SchedulerService inicializado correctamente
2026-02-02 06:38:11 - INFO - Horario configurado: sunday a las 15:00
2026-02-02 06:38:11 - INFO - Semana forzada por argumento: 14
2026-02-02 06:38:11 - INFO - ======================================================================
2026-02-02 06:38:11 - INFO - PROCESANDO PEDIDO PARA SEMANA 14
2026-02-02 06:38:11 - INFO - ======================================================================
2026-02-02 06:38:11 - INFO - DataLoader inicializado correctamente
2026-02-02 06:38:11 - INFO - ForecastEngine inicializado correctamente
2026-02-02 06:38:11 - INFO - OrderGenerator inicializado correctamente
2026-02-02 06:38:11 - INFO - SchedulerService inicializado correctamente
2026-02-02 06:38:11 - INFO - Horario configurado: sunday a las 15:00
2026-02-02 06:38:11 - INFO - Período de la semana: 2026-03-30 al 2026-04-05
2026-02-02 06:38:11 - INFO - Stock acumulado cargado: 0 artículos
2026-02-02 06:38:11 - INFO - 
==================================================
2026-02-02 06:38:11 - INFO - SECCION: MAF
2026-02-02 06:38:11 - INFO - ==================================================
2026-02-02 06:38:11 - INFO - === LEYENDO DATOS PARA SECCIÓN: MAF ===
2026-02-02 06:38:11 - WARNING - No se encontró archivo específico para 'maf', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-02 06:38:11 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-02 06:38:11 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-02 06:38:11 - INFO - Clasificación ABC cargada para 'maf': 555 registros
2026-02-02 06:38:11 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-02 06:38:16 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 06:38:16 - INFO - Usando hoja: Ventas por vendedor
2026-02-02 06:38:16 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-02 06:38:16 - INFO - Ventas cargadas: 44082 registros
2026-02-02 06:38:16 - INFO - Filtrados 10970 registros de sección 'maf' de 44082 total
2026-02-02 06:38:16 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-02 06:38:19 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 06:38:19 - INFO - Costes cargados: 22145 registros
2026-02-02 06:38:19 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MAF ===
2026-02-02 06:38:19 - INFO -   ABC: 555 registros
2026-02-02 06:38:19 - INFO -   Ventas: 10970 registros
2026-02-02 06:38:19 - INFO -   Costes: 22145 registros
2026-02-02 06:38:19 - INFO - Datos de ventas: 1011 registros
2026-02-02 06:38:19 - INFO - Calculando pedido para semana 14 (1011 registros)
2026-02-02 06:38:20 - INFO -   Objetivo: 7050.65€, Actual (ABC): 7177.24€
2026-02-02 06:38:20 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-02 06:38:20 - INFO -   Factor total: 1.3125
2026-02-02 06:38:20 - INFO -   Factor escalado: 1.2894
2026-02-02 06:38:20 - INFO -   Ventas preliminares (con ceil): 9955.95€
2026-02-02 06:38:20 - INFO -   Objetivo final: 9253.98€
2026-02-02 06:38:20 - INFO -   Delta: 701.97€
2026-02-02 06:38:20 - INFO -   Ventas finales: 9254.64€
2026-02-02 06:38:20 - INFO - Generando archivo: ././data/output/Pedido_Semana_14_2026-02-02_maf.xlsx
2026-02-02 06:38:20 - INFO - Archivo guardado: ././data/output/Pedido_Semana_14_2026-02-02_maf.xlsx
2026-02-02 06:38:20 - INFO - Archivo generado: ././data/output/Pedido_Semana_14_2026-02-02_maf.xlsx
2026-02-02 06:38:20 - INFO -   Articulos: 221
2026-02-02 06:38:20 - INFO -   Importe: 9254.64€
2026-02-02 06:38:20 - INFO - 
==================================================
2026-02-02 06:38:20 - INFO - SECCION: DECO_INTERIOR
2026-02-02 06:38:20 - INFO - ==================================================
2026-02-02 06:38:20 - INFO - === LEYENDO DATOS PARA SECCIÓN: DECO_INTERIOR ===
2026-02-02 06:38:20 - WARNING - No se encontró archivo específico para 'deco_interior', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-02 06:38:20 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-02 06:38:20 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-02 06:38:20 - INFO - Clasificación ABC cargada para 'deco_interior': 555 registros
2026-02-02 06:38:20 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-02 06:38:26 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 06:38:26 - INFO - Usando hoja: Ventas por vendedor
2026-02-02 06:38:26 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-02 06:38:26 - INFO - Ventas cargadas: 44082 registros
2026-02-02 06:38:26 - INFO - Filtrados 2468 registros de sección 'deco_interior' de 44082 total
2026-02-02 06:38:26 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-02 06:38:29 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 06:38:29 - INFO - Costes cargados: 22145 registros
2026-02-02 06:38:29 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA DECO_INTERIOR ===
2026-02-02 06:38:29 - INFO -   ABC: 555 registros
2026-02-02 06:38:29 - INFO -   Ventas: 2468 registros
2026-02-02 06:38:29 - INFO -   Costes: 22145 registros
2026-02-02 06:38:29 - INFO - Datos de ventas: 180 registros
2026-02-02 06:38:29 - INFO - Calculando pedido para semana 14 (180 registros)
2026-02-02 06:38:29 - INFO -   Objetivo: 1962.99€, Actual (ABC): 1494.40€
2026-02-02 06:38:29 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-02 06:38:29 - INFO -   Factor total: 1.3125
2026-02-02 06:38:29 - INFO -   Factor escalado: 1.7241
2026-02-02 06:38:29 - INFO -   Ventas preliminares (con ceil): 2961.52€
2026-02-02 06:38:29 - INFO -   Objetivo final: 2576.42€
2026-02-02 06:38:29 - INFO -   Delta: 385.10€
2026-02-02 06:38:29 - INFO -   Ventas finales: 2583.25€
2026-02-02 06:38:29 - INFO - Generando archivo: ././data/output/Pedido_Semana_14_2026-02-02_deco_interior.xlsx
2026-02-02 06:38:29 - INFO - Archivo guardado: ././data/output/Pedido_Semana_14_2026-02-02_deco_interior.xlsx
2026-02-02 06:38:29 - INFO - Archivo generado: ././data/output/Pedido_Semana_14_2026-02-02_deco_interior.xlsx
2026-02-02 06:38:29 - INFO -   Articulos: 138
2026-02-02 06:38:29 - INFO -   Importe: 2583.25€
2026-02-02 06:38:29 - INFO - 
==================================================
2026-02-02 06:38:29 - INFO - SECCION: SEMILLAS
2026-02-02 06:38:29 - INFO - ==================================================
2026-02-02 06:38:29 - INFO - === LEYENDO DATOS PARA SECCIÓN: SEMILLAS ===
2026-02-02 06:38:29 - WARNING - No se encontró archivo específico para 'semillas', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-02 06:38:29 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-02 06:38:30 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-02 06:38:30 - INFO - Clasificación ABC cargada para 'semillas': 555 registros
2026-02-02 06:38:30 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-02 06:38:35 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 06:38:35 - INFO - Usando hoja: Ventas por vendedor
2026-02-02 06:38:35 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-02 06:38:35 - INFO - Ventas cargadas: 44082 registros
2026-02-02 06:38:35 - INFO - Filtrados 1180 registros de sección 'semillas' de 44082 total
2026-02-02 06:38:35 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-02 06:38:38 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 06:38:38 - INFO - Costes cargados: 22145 registros
2026-02-02 06:38:38 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA SEMILLAS ===
2026-02-02 06:38:38 - INFO -   ABC: 555 registros
2026-02-02 06:38:38 - INFO -   Ventas: 1180 registros
2026-02-02 06:38:38 - INFO -   Costes: 22145 registros
2026-02-02 06:38:38 - INFO - Datos de ventas: 136 registros
2026-02-02 06:38:38 - INFO - Calculando pedido para semana 14 (136 registros)
2026-02-02 06:38:38 - INFO -   Objetivo: 694.34€, Actual (ABC): 566.70€
2026-02-02 06:38:38 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-02 06:38:38 - INFO -   Factor total: 1.3125
2026-02-02 06:38:38 - INFO -   Factor escalado: 1.6081
2026-02-02 06:38:38 - INFO -   Ventas preliminares (con ceil): 1062.05€
2026-02-02 06:38:38 - INFO -   Objetivo final: 911.32€
2026-02-02 06:38:38 - INFO -   Delta: 150.73€
2026-02-02 06:38:38 - INFO -   Ventas finales: 913.86€
2026-02-02 06:38:38 - INFO - Generando archivo: ././data/output/Pedido_Semana_14_2026-02-02_semillas.xlsx
2026-02-02 06:38:38 - INFO - Archivo guardado: ././data/output/Pedido_Semana_14_2026-02-02_semillas.xlsx
2026-02-02 06:38:38 - INFO - Archivo generado: ././data/output/Pedido_Semana_14_2026-02-02_semillas.xlsx
2026-02-02 06:38:38 - INFO -   Articulos: 84
2026-02-02 06:38:38 - INFO -   Importe: 913.86€
2026-02-02 06:38:38 - INFO - 
==================================================
2026-02-02 06:38:38 - INFO - SECCION: MASCOTAS_VIVO
2026-02-02 06:38:38 - INFO - ==================================================
2026-02-02 06:38:38 - INFO - === LEYENDO DATOS PARA SECCIÓN: MASCOTAS_VIVO ===
2026-02-02 06:38:38 - WARNING - No se encontró archivo específico para 'mascotas_vivo', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-02 06:38:38 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-02 06:38:38 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-02 06:38:38 - INFO - Clasificación ABC cargada para 'mascotas_vivo': 555 registros
2026-02-02 06:38:38 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-02 06:38:44 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 06:38:44 - INFO - Usando hoja: Ventas por vendedor
2026-02-02 06:38:44 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-02 06:38:44 - INFO - Ventas cargadas: 44082 registros
2026-02-02 06:38:44 - INFO - Filtrados 1124 registros de sección 'mascotas_vivo' de 44082 total
2026-02-02 06:38:44 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-02 06:38:47 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 06:38:47 - INFO - Costes cargados: 22145 registros
2026-02-02 06:38:47 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MASCOTAS_VIVO ===
2026-02-02 06:38:47 - INFO -   ABC: 555 registros
2026-02-02 06:38:47 - INFO -   Ventas: 1124 registros
2026-02-02 06:38:47 - INFO -   Costes: 22145 registros
2026-02-02 06:38:47 - INFO - Datos de ventas: 88 registros
2026-02-02 06:38:47 - INFO - Calculando pedido para semana 14 (88 registros)
2026-02-02 06:38:47 - INFO -   Objetivo: 1087.15€, Actual (ABC): 1144.11€
2026-02-02 06:38:47 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-02 06:38:47 - INFO -   Factor total: 1.3125
2026-02-02 06:38:47 - INFO -   Factor escalado: 1.2472
2026-02-02 06:38:47 - INFO -   Ventas preliminares (con ceil): 1759.51€
2026-02-02 06:38:47 - INFO -   Objetivo final: 1426.88€
2026-02-02 06:38:47 - INFO -   Delta: 332.63€
2026-02-02 06:38:47 - INFO -   Ventas finales: 1451.48€
2026-02-02 06:38:47 - INFO - Generando archivo: ././data/output/Pedido_Semana_14_2026-02-02_mascotas_vivo.xlsx
2026-02-02 06:38:47 - INFO - Archivo guardado: ././data/output/Pedido_Semana_14_2026-02-02_mascotas_vivo.xlsx
2026-02-02 06:38:47 - INFO - Archivo generado: ././data/output/Pedido_Semana_14_2026-02-02_mascotas_vivo.xlsx
2026-02-02 06:38:47 - INFO -   Articulos: 43
2026-02-02 06:38:47 - INFO -   Importe: 1451.48€
2026-02-02 06:38:47 - INFO - 
==================================================
2026-02-02 06:38:47 - INFO - SECCION: MASCOTAS_MANUFACTURADO
2026-02-02 06:38:47 - INFO - ==================================================
2026-02-02 06:38:47 - INFO - === LEYENDO DATOS PARA SECCIÓN: MASCOTAS_MANUFACTURADO ===
2026-02-02 06:38:47 - WARNING - No se encontró archivo específico para 'mascotas_manufacturado', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-02 06:38:47 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-02 06:38:47 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-02 06:38:47 - INFO - Clasificación ABC cargada para 'mascotas_manufacturado': 555 registros
2026-02-02 06:38:47 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-02 06:38:52 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 06:38:52 - INFO - Usando hoja: Ventas por vendedor
2026-02-02 06:38:52 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-02 06:38:52 - INFO - Ventas cargadas: 44082 registros
2026-02-02 06:38:53 - INFO - Filtrados 9784 registros de sección 'mascotas_manufacturado' de 44082 total
2026-02-02 06:38:53 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-02 06:38:55 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 06:38:55 - INFO - Costes cargados: 22145 registros
2026-02-02 06:38:55 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MASCOTAS_MANUFACTURADO ===
2026-02-02 06:38:55 - INFO -   ABC: 555 registros
2026-02-02 06:38:55 - INFO -   Ventas: 9784 registros
2026-02-02 06:38:55 - INFO -   Costes: 22145 registros
2026-02-02 06:38:55 - INFO - Datos de ventas: 822 registros
2026-02-02 06:38:55 - INFO - Calculando pedido para semana 14 (822 registros)
2026-02-02 06:38:57 - INFO -   Objetivo: 6839.82€, Actual (ABC): 8422.22€
2026-02-02 06:38:57 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-02 06:38:57 - INFO -   Factor total: 1.3125
2026-02-02 06:38:57 - INFO -   Factor escalado: 1.0659
2026-02-02 06:38:57 - INFO -   Ventas preliminares (con ceil): 14128.59€
2026-02-02 06:38:57 - INFO -   Objetivo final: 8977.26€
2026-02-02 06:38:57 - INFO -   Delta: 5151.33€
2026-02-02 06:38:57 - INFO -   Ventas finales: 8979.81€
2026-02-02 06:38:57 - INFO - Generando archivo: ././data/output/Pedido_Semana_14_2026-02-02_mascotas_manufacturado.xlsx
2026-02-02 06:38:58 - INFO - Archivo guardado: ././data/output/Pedido_Semana_14_2026-02-02_mascotas_manufacturado.xlsx
2026-02-02 06:38:58 - INFO - Archivo generado: ././data/output/Pedido_Semana_14_2026-02-02_mascotas_manufacturado.xlsx
2026-02-02 06:38:58 - INFO -   Articulos: 534
2026-02-02 06:38:58 - INFO -   Importe: 8979.81€
2026-02-02 06:38:58 - INFO - 
==================================================
2026-02-02 06:38:58 - INFO - SECCION: INTERIOR
2026-02-02 06:38:58 - INFO - ==================================================
2026-02-02 06:38:58 - INFO - === LEYENDO DATOS PARA SECCIÓN: INTERIOR ===
2026-02-02 06:38:58 - WARNING - No se encontró archivo específico para 'interior', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-02 06:38:58 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-02 06:38:58 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-02 06:38:58 - INFO - Clasificación ABC cargada para 'interior': 555 registros
2026-02-02 06:38:58 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-02 06:39:03 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 06:39:03 - INFO - Usando hoja: Ventas por vendedor
2026-02-02 06:39:03 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-02 06:39:03 - INFO - Ventas cargadas: 44082 registros
2026-02-02 06:39:03 - INFO - Filtrados 3624 registros de sección 'interior' de 44082 total
2026-02-02 06:39:03 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-02 06:39:06 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 06:39:06 - INFO - Costes cargados: 22145 registros
2026-02-02 06:39:06 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA INTERIOR ===
2026-02-02 06:39:06 - INFO -   ABC: 555 registros
2026-02-02 06:39:06 - INFO -   Ventas: 3624 registros
2026-02-02 06:39:06 - INFO -   Costes: 22145 registros
2026-02-02 06:39:06 - INFO - Datos de ventas: 286 registros
2026-02-02 06:39:06 - INFO - Calculando pedido para semana 14 (286 registros)
2026-02-02 06:39:07 - INFO -   Objetivo: 2930.63€, Actual (ABC): 2409.44€
2026-02-02 06:39:07 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-02 06:39:07 - INFO -   Factor total: 1.3125
2026-02-02 06:39:07 - INFO -   Factor escalado: 1.5964
2026-02-02 06:39:07 - INFO -   Ventas preliminares (con ceil): 4541.81€
2026-02-02 06:39:07 - INFO -   Objetivo final: 3846.45€
2026-02-02 06:39:07 - INFO -   Delta: 695.36€
2026-02-02 06:39:07 - INFO -   Ventas finales: 3855.17€
2026-02-02 06:39:07 - INFO - Generando archivo: ././data/output/Pedido_Semana_14_2026-02-02_interior.xlsx
2026-02-02 06:39:07 - INFO - Archivo guardado: ././data/output/Pedido_Semana_14_2026-02-02_interior.xlsx
2026-02-02 06:39:07 - INFO - Archivo generado: ././data/output/Pedido_Semana_14_2026-02-02_interior.xlsx
2026-02-02 06:39:07 - INFO -   Articulos: 121
2026-02-02 06:39:07 - INFO -   Importe: 3855.17€
2026-02-02 06:39:07 - INFO - 
==================================================
2026-02-02 06:39:07 - INFO - SECCION: FITOS
2026-02-02 06:39:07 - INFO - ==================================================
2026-02-02 06:39:07 - INFO - === LEYENDO DATOS PARA SECCIÓN: FITOS ===
2026-02-02 06:39:07 - WARNING - No se encontró archivo específico para 'fitos', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-02 06:39:07 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-02 06:39:07 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-02 06:39:07 - INFO - Clasificación ABC cargada para 'fitos': 555 registros
2026-02-02 06:39:07 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-02 06:39:12 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 06:39:12 - INFO - Usando hoja: Ventas por vendedor
2026-02-02 06:39:12 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-02 06:39:12 - INFO - Ventas cargadas: 44082 registros
2026-02-02 06:39:12 - INFO - Filtrados 1987 registros de sección 'fitos' de 44082 total
2026-02-02 06:39:12 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-02 06:39:15 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 06:39:15 - INFO - Costes cargados: 22145 registros
2026-02-02 06:39:15 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA FITOS ===
2026-02-02 06:39:15 - INFO -   ABC: 555 registros
2026-02-02 06:39:15 - INFO -   Ventas: 1987 registros
2026-02-02 06:39:15 - INFO -   Costes: 22145 registros
2026-02-02 06:39:15 - INFO - Datos de ventas: 157 registros
2026-02-02 06:39:15 - INFO - Calculando pedido para semana 14 (157 registros)
2026-02-02 06:39:16 - INFO -   Objetivo: 1798.25€, Actual (ABC): 1585.02€
2026-02-02 06:39:16 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-02 06:39:16 - INFO -   Factor total: 1.3125
2026-02-02 06:39:16 - INFO -   Factor escalado: 1.4891
2026-02-02 06:39:16 - INFO -   Ventas preliminares (con ceil): 2690.29€
2026-02-02 06:39:16 - INFO -   Objetivo final: 2360.20€
2026-02-02 06:39:16 - INFO -   Delta: 330.09€
2026-02-02 06:39:16 - INFO -   Ventas finales: 2361.02€
2026-02-02 06:39:16 - INFO - Generando archivo: ././data/output/Pedido_Semana_14_2026-02-02_fitos.xlsx
2026-02-02 06:39:16 - INFO - Archivo guardado: ././data/output/Pedido_Semana_14_2026-02-02_fitos.xlsx
2026-02-02 06:39:16 - INFO - Archivo generado: ././data/output/Pedido_Semana_14_2026-02-02_fitos.xlsx
2026-02-02 06:39:16 - INFO -   Articulos: 84
2026-02-02 06:39:16 - INFO -   Importe: 2361.02€
2026-02-02 06:39:16 - INFO - 
==================================================
2026-02-02 06:39:16 - INFO - SECCION: VIVERO
2026-02-02 06:39:16 - INFO - ==================================================
2026-02-02 06:39:16 - INFO - === LEYENDO DATOS PARA SECCIÓN: VIVERO ===
2026-02-02 06:39:16 - WARNING - No se encontró archivo específico para 'vivero', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-02 06:39:16 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-02 06:39:16 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-02 06:39:16 - INFO - Clasificación ABC cargada para 'vivero': 555 registros
2026-02-02 06:39:16 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-02 06:39:21 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 06:39:21 - INFO - Usando hoja: Ventas por vendedor
2026-02-02 06:39:21 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-02 06:39:21 - INFO - Ventas cargadas: 44082 registros
2026-02-02 06:39:21 - INFO - Filtrados 2460 registros de sección 'vivero' de 44082 total
2026-02-02 06:39:21 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-02 06:39:24 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 06:39:24 - INFO - Costes cargados: 22145 registros
2026-02-02 06:39:24 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA VIVERO ===
2026-02-02 06:39:24 - INFO -   ABC: 555 registros
2026-02-02 06:39:24 - INFO -   Ventas: 2460 registros
2026-02-02 06:39:24 - INFO -   Costes: 22145 registros
2026-02-02 06:39:24 - INFO - Datos de ventas: 189 registros
2026-02-02 06:39:24 - INFO - Calculando pedido para semana 14 (189 registros)
2026-02-02 06:39:24 - INFO -   Objetivo: 5297.17€, Actual (ABC): 4464.03€
2026-02-02 06:39:24 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-02 06:39:24 - INFO -   Factor total: 1.3125
2026-02-02 06:39:24 - INFO -   Factor escalado: 1.5575
2026-02-02 06:39:24 - INFO -   Ventas preliminares (con ceil): 8225.51€
2026-02-02 06:39:24 - INFO -   Objetivo final: 6952.54€
2026-02-02 06:39:24 - INFO -   Delta: 1272.97€
2026-02-02 06:39:24 - INFO -   Ventas finales: 6955.79€
2026-02-02 06:39:24 - INFO - Generando archivo: ././data/output/Pedido_Semana_14_2026-02-02_vivero.xlsx
2026-02-02 06:39:25 - INFO - Archivo guardado: ././data/output/Pedido_Semana_14_2026-02-02_vivero.xlsx
2026-02-02 06:39:25 - INFO - Archivo generado: ././data/output/Pedido_Semana_14_2026-02-02_vivero.xlsx
2026-02-02 06:39:25 - INFO -   Articulos: 107
2026-02-02 06:39:25 - INFO -   Importe: 6955.79€
2026-02-02 06:39:25 - INFO - 
==================================================
2026-02-02 06:39:25 - INFO - SECCION: UTILES_JARDIN
2026-02-02 06:39:25 - INFO - ==================================================
2026-02-02 06:39:25 - INFO - === LEYENDO DATOS PARA SECCIÓN: UTILES_JARDIN ===
2026-02-02 06:39:25 - WARNING - No se encontró archivo específico para 'utiles_jardin', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-02 06:39:25 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-02 06:39:25 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-02 06:39:25 - INFO - Clasificación ABC cargada para 'utiles_jardin': 555 registros
2026-02-02 06:39:25 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-02 06:39:30 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 06:39:30 - INFO - Usando hoja: Ventas por vendedor
2026-02-02 06:39:30 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-02 06:39:30 - INFO - Ventas cargadas: 44082 registros
2026-02-02 06:39:30 - INFO - Filtrados 1009 registros de sección 'utiles_jardin' de 44082 total
2026-02-02 06:39:30 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-02 06:39:33 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 06:39:33 - INFO - Costes cargados: 22145 registros
2026-02-02 06:39:33 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA UTILES_JARDIN ===
2026-02-02 06:39:33 - INFO -   ABC: 555 registros
2026-02-02 06:39:33 - INFO -   Ventas: 1009 registros
2026-02-02 06:39:33 - INFO -   Costes: 22145 registros
2026-02-02 06:39:33 - INFO - Datos de ventas: 89 registros
2026-02-02 06:39:33 - INFO - Calculando pedido para semana 14 (89 registros)
2026-02-02 06:39:33 - INFO -   Objetivo: 1044.77€, Actual (ABC): 764.57€
2026-02-02 06:39:33 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-02 06:39:33 - INFO -   Factor total: 1.3125
2026-02-02 06:39:33 - INFO -   Factor escalado: 1.7935
2026-02-02 06:39:33 - INFO -   Ventas preliminares (con ceil): 1516.64€
2026-02-02 06:39:33 - INFO -   Objetivo final: 1371.26€
2026-02-02 06:39:33 - INFO -   Delta: 145.38€
2026-02-02 06:39:33 - INFO -   Ventas finales: 1373.85€
2026-02-02 06:39:33 - INFO - Generando archivo: ././data/output/Pedido_Semana_14_2026-02-02_utiles_jardin.xlsx
2026-02-02 06:39:33 - INFO - Archivo guardado: ././data/output/Pedido_Semana_14_2026-02-02_utiles_jardin.xlsx
2026-02-02 06:39:33 - INFO - Archivo generado: ././data/output/Pedido_Semana_14_2026-02-02_utiles_jardin.xlsx
2026-02-02 06:39:33 - INFO -   Articulos: 78
2026-02-02 06:39:33 - INFO -   Importe: 1373.85€
2026-02-02 06:39:33 - INFO - 
==================================================
2026-02-02 06:39:33 - INFO - SECCION: TIERRAS_ARIDOS
2026-02-02 06:39:33 - INFO - ==================================================
2026-02-02 06:39:33 - INFO - === LEYENDO DATOS PARA SECCIÓN: TIERRAS_ARIDOS ===
2026-02-02 06:39:33 - WARNING - No se encontró archivo específico para 'tierras_aridos', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-02 06:39:33 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-02 06:39:34 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-02 06:39:34 - INFO - Clasificación ABC cargada para 'tierras_aridos': 555 registros
2026-02-02 06:39:34 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-02 06:39:39 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 06:39:39 - INFO - Usando hoja: Ventas por vendedor
2026-02-02 06:39:39 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-02 06:39:39 - INFO - Ventas cargadas: 44082 registros
2026-02-02 06:39:39 - INFO - Filtrados 3264 registros de sección 'tierras_aridos' de 44082 total
2026-02-02 06:39:39 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-02 06:39:42 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 06:39:42 - INFO - Costes cargados: 22145 registros
2026-02-02 06:39:42 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA TIERRAS_ARIDOS ===
2026-02-02 06:39:42 - INFO -   ABC: 555 registros
2026-02-02 06:39:42 - INFO -   Ventas: 3264 registros
2026-02-02 06:39:42 - INFO -   Costes: 22145 registros
2026-02-02 06:39:42 - INFO - Datos de ventas: 302 registros
2026-02-02 06:39:42 - INFO - Calculando pedido para semana 14 (302 registros)
2026-02-02 06:39:42 - INFO -   Objetivo: 4097.24€, Actual (ABC): 4019.19€
2026-02-02 06:39:42 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-02 06:39:42 - INFO -   Factor total: 1.3125
2026-02-02 06:39:42 - INFO -   Factor escalado: 1.3380
2026-02-02 06:39:42 - INFO -   Ventas preliminares (con ceil): 5809.66€
2026-02-02 06:39:42 - INFO -   Objetivo final: 5377.63€
2026-02-02 06:39:42 - INFO -   Delta: 432.03€
2026-02-02 06:39:42 - INFO -   Ventas finales: 5387.14€
2026-02-02 06:39:42 - INFO - Generando archivo: ././data/output/Pedido_Semana_14_2026-02-02_tierras_aridos.xlsx
2026-02-02 06:39:42 - INFO - Archivo guardado: ././data/output/Pedido_Semana_14_2026-02-02_tierras_aridos.xlsx
2026-02-02 06:39:42 - INFO - Archivo generado: ././data/output/Pedido_Semana_14_2026-02-02_tierras_aridos.xlsx
2026-02-02 06:39:42 - INFO -   Articulos: 71
2026-02-02 06:39:42 - INFO -   Importe: 5387.14€
2026-02-02 06:39:42 - INFO - 
==================================================
2026-02-02 06:39:42 - INFO - SECCION: DECO_EXTERIOR
2026-02-02 06:39:42 - INFO - ==================================================
2026-02-02 06:39:42 - INFO - === LEYENDO DATOS PARA SECCIÓN: DECO_EXTERIOR ===
2026-02-02 06:39:42 - WARNING - No se encontró archivo específico para 'deco_exterior', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-02 06:39:42 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-02 06:39:42 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-02 06:39:42 - INFO - Clasificación ABC cargada para 'deco_exterior': 555 registros
2026-02-02 06:39:42 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-02 06:39:48 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 06:39:48 - INFO - Usando hoja: Ventas por vendedor
2026-02-02 06:39:48 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-02 06:39:48 - INFO - Ventas cargadas: 44082 registros
2026-02-02 06:39:48 - INFO - Filtrados 4018 registros de sección 'deco_exterior' de 44082 total
2026-02-02 06:39:48 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-02 06:39:51 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 06:39:51 - INFO - Costes cargados: 22145 registros
2026-02-02 06:39:51 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA DECO_EXTERIOR ===
2026-02-02 06:39:51 - INFO -   ABC: 555 registros
2026-02-02 06:39:51 - INFO -   Ventas: 4018 registros
2026-02-02 06:39:51 - INFO -   Costes: 22145 registros
2026-02-02 06:39:51 - INFO - Datos de ventas: 316 registros
2026-02-02 06:39:51 - INFO - Calculando pedido para semana 14 (316 registros)
2026-02-02 06:39:52 - INFO -   Objetivo: 3740.34€, Actual (ABC): 3720.75€
2026-02-02 06:39:52 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-02 06:39:52 - INFO -   Factor total: 1.3125
2026-02-02 06:39:52 - INFO -   Factor escalado: 1.3194
2026-02-02 06:39:52 - INFO -   Ventas preliminares (con ceil): 6159.28€
2026-02-02 06:39:52 - INFO -   Objetivo final: 4909.20€
2026-02-02 06:39:52 - INFO -   Delta: 1250.08€
2026-02-02 06:39:52 - INFO -   Ventas finales: 4934.68€
2026-02-02 06:39:52 - INFO - Generando archivo: ././data/output/Pedido_Semana_14_2026-02-02_deco_exterior.xlsx
2026-02-02 06:39:52 - INFO - Archivo guardado: ././data/output/Pedido_Semana_14_2026-02-02_deco_exterior.xlsx
2026-02-02 06:39:52 - INFO - Archivo generado: ././data/output/Pedido_Semana_14_2026-02-02_deco_exterior.xlsx
2026-02-02 06:39:52 - INFO -   Articulos: 221
2026-02-02 06:39:52 - INFO -   Importe: 4934.68€
2026-02-02 06:39:52 - INFO - Estado guardado correctamente
2026-02-02 06:39:52 - INFO - Generando resumen: ././data/output/Resumen_Pedidos_VIVERO_2026-02-02.xlsx
2026-02-02 06:39:52 - INFO - Resumen guardado: ././data/output/Resumen_Pedidos_VIVERO_2026-02-02.xlsx
2026-02-02 06:39:52 - INFO - Estado guardado correctamente
2026-02-02 06:39:52 - INFO - 
======================================================================
2026-02-02 06:39:52 - INFO - RESUMEN DE EJECUCION
2026-02-02 06:39:52 - INFO - ======================================================================
2026-02-02 06:39:52 - INFO - Semana procesada: 14
2026-02-02 06:39:52 - INFO - Archivos generados: 12
2026-02-02 06:39:52 - INFO - Total articulos: 1702
2026-02-02 06:39:52 - INFO - Total importe: 48050.69€
2026-02-02 06:39:52 - INFO - ======================================================================
2026-02-02 06:39:52 - INFO - 
¡PEDIDO GENERADO EXITOSAMENTE!
2026-02-02 06:39:52 - INFO - Archivo: ././data/output/Pedido_Semana_14_2026-02-02_maf.xlsx
2026-02-02 06:39:52 - INFO - Articulos: 1702
2026-02-02 06:39:52 - INFO - Importe: 48050.69€
2026-02-03 02:43:23 - INFO - ======================================================================
2026-02-03 02:43:23 - INFO - SISTEMA DE PEDIDOS DE COMPRA - VIVERO ARANJUEZ V2
2026-02-03 02:43:23 - INFO - Fecha de ejecucion: 2026-02-03 02:43:23
2026-02-03 02:43:23 - INFO - ======================================================================
2026-02-03 02:43:23 - INFO - Modo de ejecucion: FASE 1 + FASE 2
2026-02-03 02:43:23 - INFO - StateManager inicializado. Archivo de estado: ././data/state.json
2026-02-03 02:43:23 - INFO - Cargando estado desde: ././data/state.json
2026-02-03 02:43:23 - INFO - Estado cargado correctamente
2026-02-03 02:43:23 - INFO - SchedulerService inicializado correctamente
2026-02-03 02:43:23 - INFO - Horario configurado: sunday a las 15:00
2026-02-03 02:43:23 - INFO - Semana forzada por argumento: 14
2026-02-03 02:43:23 - INFO - ======================================================================
2026-02-03 02:43:23 - INFO - PROCESANDO PEDIDO PARA SEMANA 14
2026-02-03 02:43:23 - INFO - ======================================================================
2026-02-03 02:43:23 - INFO - MODO: FASE 1 (Forecast) + FASE 2 (Corrección)
2026-02-03 02:43:23 - INFO - DataLoader inicializado correctamente
2026-02-03 02:43:23 - INFO - ForecastEngine inicializado correctamente
2026-02-03 02:43:23 - INFO - OrderGenerator inicializado correctamente
2026-02-03 02:43:23 - INFO - SchedulerService inicializado correctamente
2026-02-03 02:43:23 - INFO - Horario configurado: sunday a las 15:00
2026-02-03 02:43:23 - INFO - Período de la semana: 2026-03-30 al 2026-04-05
2026-02-03 02:43:23 - INFO - Stock acumulado cargado: 1727 artículos
2026-02-03 02:43:23 - INFO - 
==================================================
2026-02-03 02:43:23 - INFO - SECCION: MAF
2026-02-03 02:43:23 - INFO - ==================================================
2026-02-03 02:43:23 - INFO - === LEYENDO DATOS PARA SECCIÓN: MAF ===
2026-02-03 02:43:23 - WARNING - No se encontró archivo específico para 'maf', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:43:23 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:43:23 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 02:43:23 - INFO - Clasificación ABC cargada para 'maf': 555 registros
2026-02-03 02:43:23 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-03 02:43:28 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:43:28 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 02:43:29 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 02:43:29 - INFO - Ventas cargadas: 44082 registros
2026-02-03 02:43:29 - INFO - Filtrados 10970 registros de sección 'maf' de 44082 total
2026-02-03 02:43:29 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-03 02:43:31 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:43:31 - INFO - Costes cargados: 22145 registros
2026-02-03 02:43:31 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MAF ===
2026-02-03 02:43:31 - INFO -   ABC: 555 registros
2026-02-03 02:43:31 - INFO -   Ventas: 10970 registros
2026-02-03 02:43:31 - INFO -   Costes: 22145 registros
2026-02-03 02:43:31 - INFO - Datos de ventas: 1011 registros
2026-02-03 02:43:31 - INFO - Calculando pedido para semana 14 (1011 registros)
2026-02-03 02:43:32 - INFO -   Objetivo: 7050.65€, Actual (ABC): 7177.24€
2026-02-03 02:43:32 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 02:43:32 - INFO -   Factor total: 1.3125
2026-02-03 02:43:32 - INFO -   Factor escalado: 1.2894
2026-02-03 02:43:32 - INFO -   Ventas preliminares (con ceil): 9955.95€
2026-02-03 02:43:32 - INFO -   Objetivo final: 9253.98€
2026-02-03 02:43:32 - INFO -   Delta: 701.97€
2026-02-03 02:43:32 - INFO -   Ventas finales: 9254.64€
2026-02-03 02:43:32 - INFO - 
============================================================
2026-02-03 02:43:32 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 02:43:32 - INFO - ============================================================
2026-02-03 02:43:32 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 02:43:32 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 02:43:32 - INFO - DataLoader inicializado correctamente
2026-02-03 02:43:32 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 02:43:32 - INFO - ============================================================
2026-02-03 02:43:32 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 02:43:32 - INFO - ============================================================
2026-02-03 02:43:32 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 02:43:32 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 02:43:32 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:43:32 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:43:32 - INFO - Leyendo archivo de corrección: ././data/input/Stock_actual.xlsx
2026-02-03 02:43:32 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:43:32 - INFO - Stock actual cargado: 30 registros
2026-02-03 02:43:32 - INFO -   Stock: 30 registros
2026-02-03 02:43:32 - WARNING - Archivo de corrección no encontrado: Ventas_semana.xlsx
2026-02-03 02:43:32 - WARNING - Archivo de corrección no encontrado: Ventas_semana_14.xlsx
2026-02-03 02:43:32 - WARNING - Archivo de corrección no encontrado: Ventas_Semana_14.xlsx
2026-02-03 02:43:32 - WARNING - Archivo de corrección no encontrado: Ventas-14.xlsx
2026-02-03 02:43:32 - WARNING - No se encontró archivo de ventas para semana 14
2026-02-03 02:43:32 - WARNING - Archivo de corrección no encontrado: Compras_semana.xlsx
2026-02-03 02:43:32 - WARNING - Archivo de corrección no encontrado: Compras_semana_14.xlsx
2026-02-03 02:43:32 - WARNING - Archivo de corrección no encontrado: Compras_Semana_14.xlsx
2026-02-03 02:43:32 - WARNING - Archivo de corrección no encontrado: Compras-14.xlsx
2026-02-03 02:43:32 - WARNING - No se encontró archivo de compras para semana 14
2026-02-03 02:43:32 - INFO - Datos de corrección cargados: 1/3 archivos
2026-02-03 02:43:32 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 02:43:32 - INFO - Fusión completada: 222 registros
2026-02-03 02:43:32 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 02:43:32 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 02:43:33 - INFO - Corrección completada:
2026-02-03 02:43:33 - INFO -   - Artículos corregidos: 221/222
2026-02-03 02:43:33 - INFO -   - Artículos aumentados: 221
2026-02-03 02:43:33 - INFO -   - Artículos reducidos: 0
2026-02-03 02:43:33 - WARNING - ALERTAS GENERADAS:
2026-02-03 02:43:33 - WARNING -   [ALTO] 222 artículos con stock en 0 o negativo
2026-02-03 02:43:33 - WARNING -   [MEDIO] 43 artículos con cambios superiores al 50%
2026-02-03 02:43:33 - INFO - 
RESUMEN DE CORRECCIÓN:
2026-02-03 02:43:33 - INFO -   Artículos corregidos: 221/222
2026-02-03 02:43:33 - INFO -   Porcentaje corregido: 99.5%
2026-02-03 02:43:33 - ERROR - Error al aplicar corrección: Unknown format code 'd' for object of type 'float'
2026-02-03 02:43:33 - ERROR - Traceback (most recent call last):
  File "/workspace/vivero_pedidos_v2/main.py", line 281, in aplicar_correccion_pedido
    logger.info(f"  Diferencia unidades: {metricas['diferencia_unidades']:+d}")
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ValueError: Unknown format code 'd' for object of type 'float'

2026-02-03 02:43:33 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 02:43:33 - INFO - Generando archivo: ././data/output/Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 02:43:33 - INFO - Archivo guardado: ././data/output/Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 02:43:33 - INFO - Archivo generado: ././data/output/Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 02:43:33 - INFO -   Articulos: 221
2026-02-03 02:43:33 - INFO -   Importe: 9254.64€
2026-02-03 02:43:33 - INFO - 
==================================================
2026-02-03 02:43:33 - INFO - SECCION: DECO_INTERIOR
2026-02-03 02:43:33 - INFO - ==================================================
2026-02-03 02:43:33 - INFO - === LEYENDO DATOS PARA SECCIÓN: DECO_INTERIOR ===
2026-02-03 02:43:33 - WARNING - No se encontró archivo específico para 'deco_interior', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:43:33 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:43:33 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 02:43:33 - INFO - Clasificación ABC cargada para 'deco_interior': 555 registros
2026-02-03 02:43:33 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-03 02:43:38 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:43:38 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 02:43:38 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 02:43:38 - INFO - Ventas cargadas: 44082 registros
2026-02-03 02:43:38 - INFO - Filtrados 2468 registros de sección 'deco_interior' de 44082 total
2026-02-03 02:43:38 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-03 02:43:41 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:43:41 - INFO - Costes cargados: 22145 registros
2026-02-03 02:43:41 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA DECO_INTERIOR ===
2026-02-03 02:43:41 - INFO -   ABC: 555 registros
2026-02-03 02:43:41 - INFO -   Ventas: 2468 registros
2026-02-03 02:43:41 - INFO -   Costes: 22145 registros
2026-02-03 02:43:41 - INFO - Datos de ventas: 180 registros
2026-02-03 02:43:41 - INFO - Calculando pedido para semana 14 (180 registros)
2026-02-03 02:43:42 - INFO -   Objetivo: 1962.99€, Actual (ABC): 1494.40€
2026-02-03 02:43:42 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 02:43:42 - INFO -   Factor total: 1.3125
2026-02-03 02:43:42 - INFO -   Factor escalado: 1.7241
2026-02-03 02:43:42 - INFO -   Ventas preliminares (con ceil): 2961.52€
2026-02-03 02:43:42 - INFO -   Objetivo final: 2576.42€
2026-02-03 02:43:42 - INFO -   Delta: 385.10€
2026-02-03 02:43:42 - INFO -   Ventas finales: 2583.25€
2026-02-03 02:43:42 - INFO - 
============================================================
2026-02-03 02:43:42 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 02:43:42 - INFO - ============================================================
2026-02-03 02:43:42 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 02:43:42 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 02:43:42 - INFO - DataLoader inicializado correctamente
2026-02-03 02:43:42 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 02:43:42 - INFO - ============================================================
2026-02-03 02:43:42 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 02:43:42 - INFO - ============================================================
2026-02-03 02:43:42 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 02:43:42 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 02:43:42 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:43:42 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:43:42 - INFO - Leyendo archivo de corrección: ././data/input/Stock_actual.xlsx
2026-02-03 02:43:42 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:43:42 - INFO - Stock actual cargado: 30 registros
2026-02-03 02:43:42 - INFO -   Stock: 30 registros
2026-02-03 02:43:42 - WARNING - Archivo de corrección no encontrado: Ventas_semana.xlsx
2026-02-03 02:43:42 - WARNING - Archivo de corrección no encontrado: Ventas_semana_14.xlsx
2026-02-03 02:43:42 - WARNING - Archivo de corrección no encontrado: Ventas_Semana_14.xlsx
2026-02-03 02:43:42 - WARNING - Archivo de corrección no encontrado: Ventas-14.xlsx
2026-02-03 02:43:42 - WARNING - No se encontró archivo de ventas para semana 14
2026-02-03 02:43:42 - WARNING - Archivo de corrección no encontrado: Compras_semana.xlsx
2026-02-03 02:43:42 - WARNING - Archivo de corrección no encontrado: Compras_semana_14.xlsx
2026-02-03 02:43:42 - WARNING - Archivo de corrección no encontrado: Compras_Semana_14.xlsx
2026-02-03 02:43:42 - WARNING - Archivo de corrección no encontrado: Compras-14.xlsx
2026-02-03 02:43:42 - WARNING - No se encontró archivo de compras para semana 14
2026-02-03 02:43:42 - INFO - Datos de corrección cargados: 1/3 archivos
2026-02-03 02:43:42 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 02:43:42 - INFO - Fusión completada: 139 registros
2026-02-03 02:43:42 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 02:43:42 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 02:43:42 - INFO - Corrección completada:
2026-02-03 02:43:42 - INFO -   - Artículos corregidos: 138/139
2026-02-03 02:43:42 - INFO -   - Artículos aumentados: 138
2026-02-03 02:43:42 - INFO -   - Artículos reducidos: 0
2026-02-03 02:43:42 - WARNING - ALERTAS GENERADAS:
2026-02-03 02:43:42 - WARNING -   [ALTO] 139 artículos con stock en 0 o negativo
2026-02-03 02:43:42 - WARNING -   [MEDIO] 59 artículos con cambios superiores al 50%
2026-02-03 02:43:42 - INFO - 
RESUMEN DE CORRECCIÓN:
2026-02-03 02:43:42 - INFO -   Artículos corregidos: 138/139
2026-02-03 02:43:42 - INFO -   Porcentaje corregido: 99.3%
2026-02-03 02:43:42 - ERROR - Error al aplicar corrección: Unknown format code 'd' for object of type 'float'
2026-02-03 02:43:42 - ERROR - Traceback (most recent call last):
  File "/workspace/vivero_pedidos_v2/main.py", line 281, in aplicar_correccion_pedido
    logger.info(f"  Diferencia unidades: {metricas['diferencia_unidades']:+d}")
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ValueError: Unknown format code 'd' for object of type 'float'

2026-02-03 02:43:42 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 02:43:42 - INFO - Generando archivo: ././data/output/Pedido_Semana_14_2026-02-03_deco_interior.xlsx
2026-02-03 02:43:42 - INFO - Archivo guardado: ././data/output/Pedido_Semana_14_2026-02-03_deco_interior.xlsx
2026-02-03 02:43:42 - INFO - Archivo generado: ././data/output/Pedido_Semana_14_2026-02-03_deco_interior.xlsx
2026-02-03 02:43:42 - INFO -   Articulos: 138
2026-02-03 02:43:42 - INFO -   Importe: 2583.25€
2026-02-03 02:43:42 - INFO - 
==================================================
2026-02-03 02:43:42 - INFO - SECCION: SEMILLAS
2026-02-03 02:43:42 - INFO - ==================================================
2026-02-03 02:43:42 - INFO - === LEYENDO DATOS PARA SECCIÓN: SEMILLAS ===
2026-02-03 02:43:42 - WARNING - No se encontró archivo específico para 'semillas', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:43:42 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:43:42 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 02:43:42 - INFO - Clasificación ABC cargada para 'semillas': 555 registros
2026-02-03 02:43:42 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-03 02:43:47 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:43:47 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 02:43:47 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 02:43:47 - INFO - Ventas cargadas: 44082 registros
2026-02-03 02:43:48 - INFO - Filtrados 1180 registros de sección 'semillas' de 44082 total
2026-02-03 02:43:48 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-03 02:43:50 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:43:50 - INFO - Costes cargados: 22145 registros
2026-02-03 02:43:50 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA SEMILLAS ===
2026-02-03 02:43:50 - INFO -   ABC: 555 registros
2026-02-03 02:43:50 - INFO -   Ventas: 1180 registros
2026-02-03 02:43:50 - INFO -   Costes: 22145 registros
2026-02-03 02:43:50 - INFO - Datos de ventas: 136 registros
2026-02-03 02:43:50 - INFO - Calculando pedido para semana 14 (136 registros)
2026-02-03 02:43:51 - INFO -   Objetivo: 694.34€, Actual (ABC): 566.70€
2026-02-03 02:43:51 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 02:43:51 - INFO -   Factor total: 1.3125
2026-02-03 02:43:51 - INFO -   Factor escalado: 1.6081
2026-02-03 02:43:51 - INFO -   Ventas preliminares (con ceil): 1062.05€
2026-02-03 02:43:51 - INFO -   Objetivo final: 911.32€
2026-02-03 02:43:51 - INFO -   Delta: 150.73€
2026-02-03 02:43:51 - INFO -   Ventas finales: 913.86€
2026-02-03 02:43:51 - INFO - 
============================================================
2026-02-03 02:43:51 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 02:43:51 - INFO - ============================================================
2026-02-03 02:43:51 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 02:43:51 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 02:43:51 - INFO - DataLoader inicializado correctamente
2026-02-03 02:43:51 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 02:43:51 - INFO - ============================================================
2026-02-03 02:43:51 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 02:43:51 - INFO - ============================================================
2026-02-03 02:43:51 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 02:43:51 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 02:43:51 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:43:51 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:43:51 - INFO - Leyendo archivo de corrección: ././data/input/Stock_actual.xlsx
2026-02-03 02:43:51 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:43:51 - INFO - Stock actual cargado: 30 registros
2026-02-03 02:43:51 - INFO -   Stock: 30 registros
2026-02-03 02:43:51 - WARNING - Archivo de corrección no encontrado: Ventas_semana.xlsx
2026-02-03 02:43:51 - WARNING - Archivo de corrección no encontrado: Ventas_semana_14.xlsx
2026-02-03 02:43:51 - WARNING - Archivo de corrección no encontrado: Ventas_Semana_14.xlsx
2026-02-03 02:43:51 - WARNING - Archivo de corrección no encontrado: Ventas-14.xlsx
2026-02-03 02:43:51 - WARNING - No se encontró archivo de ventas para semana 14
2026-02-03 02:43:51 - WARNING - Archivo de corrección no encontrado: Compras_semana.xlsx
2026-02-03 02:43:51 - WARNING - Archivo de corrección no encontrado: Compras_semana_14.xlsx
2026-02-03 02:43:51 - WARNING - Archivo de corrección no encontrado: Compras_Semana_14.xlsx
2026-02-03 02:43:51 - WARNING - Archivo de corrección no encontrado: Compras-14.xlsx
2026-02-03 02:43:51 - WARNING - No se encontró archivo de compras para semana 14
2026-02-03 02:43:51 - INFO - Datos de corrección cargados: 1/3 archivos
2026-02-03 02:43:51 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 02:43:51 - INFO - Fusión completada: 84 registros
2026-02-03 02:43:51 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 02:43:51 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 02:43:51 - INFO - Corrección completada:
2026-02-03 02:43:51 - INFO -   - Artículos corregidos: 84/84
2026-02-03 02:43:51 - INFO -   - Artículos aumentados: 84
2026-02-03 02:43:51 - INFO -   - Artículos reducidos: 0
2026-02-03 02:43:51 - WARNING - ALERTAS GENERADAS:
2026-02-03 02:43:51 - WARNING -   [ALTO] 84 artículos con stock en 0 o negativo
2026-02-03 02:43:51 - WARNING -   [MEDIO] 42 artículos con cambios superiores al 50%
2026-02-03 02:43:51 - INFO - 
RESUMEN DE CORRECCIÓN:
2026-02-03 02:43:51 - INFO -   Artículos corregidos: 84/84
2026-02-03 02:43:51 - INFO -   Porcentaje corregido: 100.0%
2026-02-03 02:43:51 - ERROR - Error al aplicar corrección: Unknown format code 'd' for object of type 'float'
2026-02-03 02:43:51 - ERROR - Traceback (most recent call last):
  File "/workspace/vivero_pedidos_v2/main.py", line 281, in aplicar_correccion_pedido
    logger.info(f"  Diferencia unidades: {metricas['diferencia_unidades']:+d}")
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ValueError: Unknown format code 'd' for object of type 'float'

2026-02-03 02:43:51 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 02:43:51 - INFO - Generando archivo: ././data/output/Pedido_Semana_14_2026-02-03_semillas.xlsx
2026-02-03 02:43:51 - INFO - Archivo guardado: ././data/output/Pedido_Semana_14_2026-02-03_semillas.xlsx
2026-02-03 02:43:51 - INFO - Archivo generado: ././data/output/Pedido_Semana_14_2026-02-03_semillas.xlsx
2026-02-03 02:43:51 - INFO -   Articulos: 84
2026-02-03 02:43:51 - INFO -   Importe: 913.86€
2026-02-03 02:43:51 - INFO - 
==================================================
2026-02-03 02:43:51 - INFO - SECCION: MASCOTAS_VIVO
2026-02-03 02:43:51 - INFO - ==================================================
2026-02-03 02:43:51 - INFO - === LEYENDO DATOS PARA SECCIÓN: MASCOTAS_VIVO ===
2026-02-03 02:43:51 - WARNING - No se encontró archivo específico para 'mascotas_vivo', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:43:51 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:43:51 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 02:43:51 - INFO - Clasificación ABC cargada para 'mascotas_vivo': 555 registros
2026-02-03 02:43:51 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-03 02:43:56 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:43:56 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 02:43:56 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 02:43:56 - INFO - Ventas cargadas: 44082 registros
2026-02-03 02:43:56 - INFO - Filtrados 1124 registros de sección 'mascotas_vivo' de 44082 total
2026-02-03 02:43:56 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-03 02:43:59 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:43:59 - INFO - Costes cargados: 22145 registros
2026-02-03 02:43:59 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MASCOTAS_VIVO ===
2026-02-03 02:43:59 - INFO -   ABC: 555 registros
2026-02-03 02:43:59 - INFO -   Ventas: 1124 registros
2026-02-03 02:43:59 - INFO -   Costes: 22145 registros
2026-02-03 02:43:59 - INFO - Datos de ventas: 88 registros
2026-02-03 02:43:59 - INFO - Calculando pedido para semana 14 (88 registros)
2026-02-03 02:43:59 - INFO -   Objetivo: 1087.15€, Actual (ABC): 1144.11€
2026-02-03 02:43:59 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 02:43:59 - INFO -   Factor total: 1.3125
2026-02-03 02:43:59 - INFO -   Factor escalado: 1.2472
2026-02-03 02:43:59 - INFO -   Ventas preliminares (con ceil): 1759.51€
2026-02-03 02:43:59 - INFO -   Objetivo final: 1426.88€
2026-02-03 02:43:59 - INFO -   Delta: 332.63€
2026-02-03 02:43:59 - INFO -   Ventas finales: 1451.48€
2026-02-03 02:43:59 - INFO - 
============================================================
2026-02-03 02:43:59 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 02:43:59 - INFO - ============================================================
2026-02-03 02:43:59 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 02:43:59 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 02:43:59 - INFO - DataLoader inicializado correctamente
2026-02-03 02:43:59 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 02:43:59 - INFO - ============================================================
2026-02-03 02:43:59 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 02:43:59 - INFO - ============================================================
2026-02-03 02:43:59 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 02:43:59 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 02:43:59 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:43:59 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:43:59 - INFO - Leyendo archivo de corrección: ././data/input/Stock_actual.xlsx
2026-02-03 02:43:59 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:43:59 - INFO - Stock actual cargado: 30 registros
2026-02-03 02:43:59 - INFO -   Stock: 30 registros
2026-02-03 02:43:59 - WARNING - Archivo de corrección no encontrado: Ventas_semana.xlsx
2026-02-03 02:43:59 - WARNING - Archivo de corrección no encontrado: Ventas_semana_14.xlsx
2026-02-03 02:43:59 - WARNING - Archivo de corrección no encontrado: Ventas_Semana_14.xlsx
2026-02-03 02:43:59 - WARNING - Archivo de corrección no encontrado: Ventas-14.xlsx
2026-02-03 02:43:59 - WARNING - No se encontró archivo de ventas para semana 14
2026-02-03 02:43:59 - WARNING - Archivo de corrección no encontrado: Compras_semana.xlsx
2026-02-03 02:43:59 - WARNING - Archivo de corrección no encontrado: Compras_semana_14.xlsx
2026-02-03 02:43:59 - WARNING - Archivo de corrección no encontrado: Compras_Semana_14.xlsx
2026-02-03 02:43:59 - WARNING - Archivo de corrección no encontrado: Compras-14.xlsx
2026-02-03 02:43:59 - WARNING - No se encontró archivo de compras para semana 14
2026-02-03 02:43:59 - INFO - Datos de corrección cargados: 1/3 archivos
2026-02-03 02:43:59 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 02:43:59 - INFO - Fusión completada: 43 registros
2026-02-03 02:43:59 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 02:43:59 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 02:43:59 - INFO - Corrección completada:
2026-02-03 02:43:59 - INFO -   - Artículos corregidos: 43/43
2026-02-03 02:43:59 - INFO -   - Artículos aumentados: 43
2026-02-03 02:43:59 - INFO -   - Artículos reducidos: 0
2026-02-03 02:43:59 - WARNING - ALERTAS GENERADAS:
2026-02-03 02:43:59 - WARNING -   [ALTO] 43 artículos con stock en 0 o negativo
2026-02-03 02:43:59 - WARNING -   [MEDIO] 16 artículos con cambios superiores al 50%
2026-02-03 02:43:59 - INFO - 
RESUMEN DE CORRECCIÓN:
2026-02-03 02:43:59 - INFO -   Artículos corregidos: 43/43
2026-02-03 02:43:59 - INFO -   Porcentaje corregido: 100.0%
2026-02-03 02:43:59 - ERROR - Error al aplicar corrección: Unknown format code 'd' for object of type 'float'
2026-02-03 02:43:59 - ERROR - Traceback (most recent call last):
  File "/workspace/vivero_pedidos_v2/main.py", line 281, in aplicar_correccion_pedido
    logger.info(f"  Diferencia unidades: {metricas['diferencia_unidades']:+d}")
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ValueError: Unknown format code 'd' for object of type 'float'

2026-02-03 02:43:59 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 02:43:59 - INFO - Generando archivo: ././data/output/Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx
2026-02-03 02:43:59 - INFO - Archivo guardado: ././data/output/Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx
2026-02-03 02:43:59 - INFO - Archivo generado: ././data/output/Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx
2026-02-03 02:43:59 - INFO -   Articulos: 43
2026-02-03 02:43:59 - INFO -   Importe: 1451.48€
2026-02-03 02:43:59 - INFO - 
==================================================
2026-02-03 02:43:59 - INFO - SECCION: MASCOTAS_MANUFACTURADO
2026-02-03 02:43:59 - INFO - ==================================================
2026-02-03 02:43:59 - INFO - === LEYENDO DATOS PARA SECCIÓN: MASCOTAS_MANUFACTURADO ===
2026-02-03 02:43:59 - WARNING - No se encontró archivo específico para 'mascotas_manufacturado', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:43:59 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:44:00 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 02:44:00 - INFO - Clasificación ABC cargada para 'mascotas_manufacturado': 555 registros
2026-02-03 02:44:00 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-03 02:44:05 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:44:05 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 02:44:05 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 02:44:05 - INFO - Ventas cargadas: 44082 registros
2026-02-03 02:44:05 - INFO - Filtrados 9784 registros de sección 'mascotas_manufacturado' de 44082 total
2026-02-03 02:44:05 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-03 02:44:08 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:44:08 - INFO - Costes cargados: 22145 registros
2026-02-03 02:44:08 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MASCOTAS_MANUFACTURADO ===
2026-02-03 02:44:08 - INFO -   ABC: 555 registros
2026-02-03 02:44:08 - INFO -   Ventas: 9784 registros
2026-02-03 02:44:08 - INFO -   Costes: 22145 registros
2026-02-03 02:44:08 - INFO - Datos de ventas: 822 registros
2026-02-03 02:44:08 - INFO - Calculando pedido para semana 14 (822 registros)
2026-02-03 02:44:10 - INFO -   Objetivo: 6839.82€, Actual (ABC): 8422.22€
2026-02-03 02:44:10 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 02:44:10 - INFO -   Factor total: 1.3125
2026-02-03 02:44:10 - INFO -   Factor escalado: 1.0659
2026-02-03 02:44:10 - INFO -   Ventas preliminares (con ceil): 14128.59€
2026-02-03 02:44:10 - INFO -   Objetivo final: 8977.26€
2026-02-03 02:44:10 - INFO -   Delta: 5151.33€
2026-02-03 02:44:10 - INFO -   Ventas finales: 8979.81€
2026-02-03 02:44:10 - INFO - 
============================================================
2026-02-03 02:44:10 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 02:44:10 - INFO - ============================================================
2026-02-03 02:44:10 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 02:44:10 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 02:44:10 - INFO - DataLoader inicializado correctamente
2026-02-03 02:44:10 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 02:44:10 - INFO - ============================================================
2026-02-03 02:44:10 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 02:44:10 - INFO - ============================================================
2026-02-03 02:44:10 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 02:44:10 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 02:44:10 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:44:10 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:44:10 - INFO - Leyendo archivo de corrección: ././data/input/Stock_actual.xlsx
2026-02-03 02:44:10 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:44:10 - INFO - Stock actual cargado: 30 registros
2026-02-03 02:44:10 - INFO -   Stock: 30 registros
2026-02-03 02:44:10 - WARNING - Archivo de corrección no encontrado: Ventas_semana.xlsx
2026-02-03 02:44:10 - WARNING - Archivo de corrección no encontrado: Ventas_semana_14.xlsx
2026-02-03 02:44:10 - WARNING - Archivo de corrección no encontrado: Ventas_Semana_14.xlsx
2026-02-03 02:44:10 - WARNING - Archivo de corrección no encontrado: Ventas-14.xlsx
2026-02-03 02:44:10 - WARNING - No se encontró archivo de ventas para semana 14
2026-02-03 02:44:10 - WARNING - Archivo de corrección no encontrado: Compras_semana.xlsx
2026-02-03 02:44:10 - WARNING - Archivo de corrección no encontrado: Compras_semana_14.xlsx
2026-02-03 02:44:10 - WARNING - Archivo de corrección no encontrado: Compras_Semana_14.xlsx
2026-02-03 02:44:10 - WARNING - Archivo de corrección no encontrado: Compras-14.xlsx
2026-02-03 02:44:10 - WARNING - No se encontró archivo de compras para semana 14
2026-02-03 02:44:10 - INFO - Datos de corrección cargados: 1/3 archivos
2026-02-03 02:44:10 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 02:44:10 - INFO - Fusión completada: 538 registros
2026-02-03 02:44:10 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 02:44:10 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 02:44:10 - INFO - Corrección completada:
2026-02-03 02:44:10 - INFO -   - Artículos corregidos: 534/538
2026-02-03 02:44:10 - INFO -   - Artículos aumentados: 534
2026-02-03 02:44:10 - INFO -   - Artículos reducidos: 0
2026-02-03 02:44:10 - WARNING - ALERTAS GENERADAS:
2026-02-03 02:44:10 - WARNING -   [ALTO] 538 artículos con stock en 0 o negativo
2026-02-03 02:44:10 - WARNING -   [MEDIO] 321 artículos con cambios superiores al 50%
2026-02-03 02:44:10 - INFO - 
RESUMEN DE CORRECCIÓN:
2026-02-03 02:44:10 - INFO -   Artículos corregidos: 534/538
2026-02-03 02:44:10 - INFO -   Porcentaje corregido: 99.3%
2026-02-03 02:44:10 - ERROR - Error al aplicar corrección: Unknown format code 'd' for object of type 'float'
2026-02-03 02:44:10 - ERROR - Traceback (most recent call last):
  File "/workspace/vivero_pedidos_v2/main.py", line 281, in aplicar_correccion_pedido
    logger.info(f"  Diferencia unidades: {metricas['diferencia_unidades']:+d}")
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ValueError: Unknown format code 'd' for object of type 'float'

2026-02-03 02:44:10 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 02:44:10 - INFO - Generando archivo: ././data/output/Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx
2026-02-03 02:44:11 - INFO - Archivo guardado: ././data/output/Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx
2026-02-03 02:44:11 - INFO - Archivo generado: ././data/output/Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx
2026-02-03 02:44:11 - INFO -   Articulos: 534
2026-02-03 02:44:11 - INFO -   Importe: 8979.81€
2026-02-03 02:44:11 - INFO - 
==================================================
2026-02-03 02:44:11 - INFO - SECCION: INTERIOR
2026-02-03 02:44:11 - INFO - ==================================================
2026-02-03 02:44:11 - INFO - === LEYENDO DATOS PARA SECCIÓN: INTERIOR ===
2026-02-03 02:44:11 - WARNING - No se encontró archivo específico para 'interior', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:44:11 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:44:11 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 02:44:11 - INFO - Clasificación ABC cargada para 'interior': 555 registros
2026-02-03 02:44:11 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-03 02:44:16 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:44:16 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 02:44:16 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 02:44:16 - INFO - Ventas cargadas: 44082 registros
2026-02-03 02:44:16 - INFO - Filtrados 3624 registros de sección 'interior' de 44082 total
2026-02-03 02:44:16 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-03 02:44:19 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:44:19 - INFO - Costes cargados: 22145 registros
2026-02-03 02:44:19 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA INTERIOR ===
2026-02-03 02:44:19 - INFO -   ABC: 555 registros
2026-02-03 02:44:19 - INFO -   Ventas: 3624 registros
2026-02-03 02:44:19 - INFO -   Costes: 22145 registros
2026-02-03 02:44:19 - INFO - Datos de ventas: 286 registros
2026-02-03 02:44:19 - INFO - Calculando pedido para semana 14 (286 registros)
2026-02-03 02:44:20 - INFO -   Objetivo: 2930.63€, Actual (ABC): 2409.44€
2026-02-03 02:44:20 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 02:44:20 - INFO -   Factor total: 1.3125
2026-02-03 02:44:20 - INFO -   Factor escalado: 1.5964
2026-02-03 02:44:20 - INFO -   Ventas preliminares (con ceil): 4541.81€
2026-02-03 02:44:20 - INFO -   Objetivo final: 3846.45€
2026-02-03 02:44:20 - INFO -   Delta: 695.36€
2026-02-03 02:44:20 - INFO -   Ventas finales: 3855.17€
2026-02-03 02:44:20 - INFO - 
============================================================
2026-02-03 02:44:20 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 02:44:20 - INFO - ============================================================
2026-02-03 02:44:20 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 02:44:20 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 02:44:20 - INFO - DataLoader inicializado correctamente
2026-02-03 02:44:20 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 02:44:20 - INFO - ============================================================
2026-02-03 02:44:20 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 02:44:20 - INFO - ============================================================
2026-02-03 02:44:20 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 02:44:20 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 02:44:20 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:44:20 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:44:20 - INFO - Leyendo archivo de corrección: ././data/input/Stock_actual.xlsx
2026-02-03 02:44:20 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:44:20 - INFO - Stock actual cargado: 30 registros
2026-02-03 02:44:20 - INFO -   Stock: 30 registros
2026-02-03 02:44:20 - WARNING - Archivo de corrección no encontrado: Ventas_semana.xlsx
2026-02-03 02:44:20 - WARNING - Archivo de corrección no encontrado: Ventas_semana_14.xlsx
2026-02-03 02:44:20 - WARNING - Archivo de corrección no encontrado: Ventas_Semana_14.xlsx
2026-02-03 02:44:20 - WARNING - Archivo de corrección no encontrado: Ventas-14.xlsx
2026-02-03 02:44:20 - WARNING - No se encontró archivo de ventas para semana 14
2026-02-03 02:44:20 - WARNING - Archivo de corrección no encontrado: Compras_semana.xlsx
2026-02-03 02:44:20 - WARNING - Archivo de corrección no encontrado: Compras_semana_14.xlsx
2026-02-03 02:44:20 - WARNING - Archivo de corrección no encontrado: Compras_Semana_14.xlsx
2026-02-03 02:44:20 - WARNING - Archivo de corrección no encontrado: Compras-14.xlsx
2026-02-03 02:44:20 - WARNING - No se encontró archivo de compras para semana 14
2026-02-03 02:44:20 - INFO - Datos de corrección cargados: 1/3 archivos
2026-02-03 02:44:20 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 02:44:20 - INFO - Fusión completada: 138 registros
2026-02-03 02:44:20 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 02:44:20 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 02:44:20 - INFO - Corrección completada:
2026-02-03 02:44:20 - INFO -   - Artículos corregidos: 121/138
2026-02-03 02:44:20 - INFO -   - Artículos aumentados: 121
2026-02-03 02:44:20 - INFO -   - Artículos reducidos: 0
2026-02-03 02:44:20 - WARNING - ALERTAS GENERADAS:
2026-02-03 02:44:20 - WARNING -   [ALTO] 138 artículos con stock en 0 o negativo
2026-02-03 02:44:20 - WARNING -   [MEDIO] 45 artículos con cambios superiores al 50%
2026-02-03 02:44:20 - INFO - 
RESUMEN DE CORRECCIÓN:
2026-02-03 02:44:20 - INFO -   Artículos corregidos: 121/138
2026-02-03 02:44:20 - INFO -   Porcentaje corregido: 87.7%
2026-02-03 02:44:20 - ERROR - Error al aplicar corrección: Unknown format code 'd' for object of type 'float'
2026-02-03 02:44:20 - ERROR - Traceback (most recent call last):
  File "/workspace/vivero_pedidos_v2/main.py", line 281, in aplicar_correccion_pedido
    logger.info(f"  Diferencia unidades: {metricas['diferencia_unidades']:+d}")
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ValueError: Unknown format code 'd' for object of type 'float'

2026-02-03 02:44:20 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 02:44:20 - INFO - Generando archivo: ././data/output/Pedido_Semana_14_2026-02-03_interior.xlsx
2026-02-03 02:44:20 - INFO - Archivo guardado: ././data/output/Pedido_Semana_14_2026-02-03_interior.xlsx
2026-02-03 02:44:20 - INFO - Archivo generado: ././data/output/Pedido_Semana_14_2026-02-03_interior.xlsx
2026-02-03 02:44:20 - INFO -   Articulos: 121
2026-02-03 02:44:20 - INFO -   Importe: 3855.17€
2026-02-03 02:44:20 - INFO - 
==================================================
2026-02-03 02:44:20 - INFO - SECCION: FITOS
2026-02-03 02:44:20 - INFO - ==================================================
2026-02-03 02:44:20 - INFO - === LEYENDO DATOS PARA SECCIÓN: FITOS ===
2026-02-03 02:44:20 - WARNING - No se encontró archivo específico para 'fitos', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:44:20 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:44:20 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 02:44:20 - INFO - Clasificación ABC cargada para 'fitos': 555 registros
2026-02-03 02:44:20 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-03 02:44:25 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:44:25 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 02:44:26 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 02:44:26 - INFO - Ventas cargadas: 44082 registros
2026-02-03 02:44:26 - INFO - Filtrados 1987 registros de sección 'fitos' de 44082 total
2026-02-03 02:44:26 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-03 02:44:28 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:44:28 - INFO - Costes cargados: 22145 registros
2026-02-03 02:44:28 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA FITOS ===
2026-02-03 02:44:28 - INFO -   ABC: 555 registros
2026-02-03 02:44:28 - INFO -   Ventas: 1987 registros
2026-02-03 02:44:28 - INFO -   Costes: 22145 registros
2026-02-03 02:44:28 - INFO - Datos de ventas: 157 registros
2026-02-03 02:44:28 - INFO - Calculando pedido para semana 14 (157 registros)
2026-02-03 02:44:29 - INFO -   Objetivo: 1798.25€, Actual (ABC): 1585.02€
2026-02-03 02:44:29 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 02:44:29 - INFO -   Factor total: 1.3125
2026-02-03 02:44:29 - INFO -   Factor escalado: 1.4891
2026-02-03 02:44:29 - INFO -   Ventas preliminares (con ceil): 2690.29€
2026-02-03 02:44:29 - INFO -   Objetivo final: 2360.20€
2026-02-03 02:44:29 - INFO -   Delta: 330.09€
2026-02-03 02:44:29 - INFO -   Ventas finales: 2361.02€
2026-02-03 02:44:29 - INFO - 
============================================================
2026-02-03 02:44:29 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 02:44:29 - INFO - ============================================================
2026-02-03 02:44:29 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 02:44:29 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 02:44:29 - INFO - DataLoader inicializado correctamente
2026-02-03 02:44:29 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 02:44:29 - INFO - ============================================================
2026-02-03 02:44:29 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 02:44:29 - INFO - ============================================================
2026-02-03 02:44:29 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 02:44:29 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 02:44:29 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:44:29 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:44:29 - INFO - Leyendo archivo de corrección: ././data/input/Stock_actual.xlsx
2026-02-03 02:44:29 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:44:29 - INFO - Stock actual cargado: 30 registros
2026-02-03 02:44:29 - INFO -   Stock: 30 registros
2026-02-03 02:44:29 - WARNING - Archivo de corrección no encontrado: Ventas_semana.xlsx
2026-02-03 02:44:29 - WARNING - Archivo de corrección no encontrado: Ventas_semana_14.xlsx
2026-02-03 02:44:29 - WARNING - Archivo de corrección no encontrado: Ventas_Semana_14.xlsx
2026-02-03 02:44:29 - WARNING - Archivo de corrección no encontrado: Ventas-14.xlsx
2026-02-03 02:44:29 - WARNING - No se encontró archivo de ventas para semana 14
2026-02-03 02:44:29 - WARNING - Archivo de corrección no encontrado: Compras_semana.xlsx
2026-02-03 02:44:29 - WARNING - Archivo de corrección no encontrado: Compras_semana_14.xlsx
2026-02-03 02:44:29 - WARNING - Archivo de corrección no encontrado: Compras_Semana_14.xlsx
2026-02-03 02:44:29 - WARNING - Archivo de corrección no encontrado: Compras-14.xlsx
2026-02-03 02:44:29 - WARNING - No se encontró archivo de compras para semana 14
2026-02-03 02:44:29 - INFO - Datos de corrección cargados: 1/3 archivos
2026-02-03 02:44:29 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 02:44:29 - INFO - Fusión completada: 84 registros
2026-02-03 02:44:29 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 02:44:29 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 02:44:29 - INFO - Corrección completada:
2026-02-03 02:44:29 - INFO -   - Artículos corregidos: 84/84
2026-02-03 02:44:29 - INFO -   - Artículos aumentados: 84
2026-02-03 02:44:29 - INFO -   - Artículos reducidos: 0
2026-02-03 02:44:29 - WARNING - ALERTAS GENERADAS:
2026-02-03 02:44:29 - WARNING -   [ALTO] 84 artículos con stock en 0 o negativo
2026-02-03 02:44:29 - WARNING -   [MEDIO] 19 artículos con cambios superiores al 50%
2026-02-03 02:44:29 - INFO - 
RESUMEN DE CORRECCIÓN:
2026-02-03 02:44:29 - INFO -   Artículos corregidos: 84/84
2026-02-03 02:44:29 - INFO -   Porcentaje corregido: 100.0%
2026-02-03 02:44:29 - ERROR - Error al aplicar corrección: Unknown format code 'd' for object of type 'float'
2026-02-03 02:44:29 - ERROR - Traceback (most recent call last):
  File "/workspace/vivero_pedidos_v2/main.py", line 281, in aplicar_correccion_pedido
    logger.info(f"  Diferencia unidades: {metricas['diferencia_unidades']:+d}")
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ValueError: Unknown format code 'd' for object of type 'float'

2026-02-03 02:44:29 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 02:44:29 - INFO - Generando archivo: ././data/output/Pedido_Semana_14_2026-02-03_fitos.xlsx
2026-02-03 02:44:29 - INFO - Archivo guardado: ././data/output/Pedido_Semana_14_2026-02-03_fitos.xlsx
2026-02-03 02:44:29 - INFO - Archivo generado: ././data/output/Pedido_Semana_14_2026-02-03_fitos.xlsx
2026-02-03 02:44:29 - INFO -   Articulos: 84
2026-02-03 02:44:29 - INFO -   Importe: 2361.02€
2026-02-03 02:44:29 - INFO - 
==================================================
2026-02-03 02:44:29 - INFO - SECCION: VIVERO
2026-02-03 02:44:29 - INFO - ==================================================
2026-02-03 02:44:29 - INFO - === LEYENDO DATOS PARA SECCIÓN: VIVERO ===
2026-02-03 02:44:29 - WARNING - No se encontró archivo específico para 'vivero', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:44:29 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:44:29 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 02:44:29 - INFO - Clasificación ABC cargada para 'vivero': 555 registros
2026-02-03 02:44:29 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-03 02:44:35 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:44:35 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 02:44:35 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 02:44:35 - INFO - Ventas cargadas: 44082 registros
2026-02-03 02:44:35 - INFO - Filtrados 2460 registros de sección 'vivero' de 44082 total
2026-02-03 02:44:35 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-03 02:44:37 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:44:37 - INFO - Costes cargados: 22145 registros
2026-02-03 02:44:37 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA VIVERO ===
2026-02-03 02:44:37 - INFO -   ABC: 555 registros
2026-02-03 02:44:37 - INFO -   Ventas: 2460 registros
2026-02-03 02:44:37 - INFO -   Costes: 22145 registros
2026-02-03 02:44:37 - INFO - Datos de ventas: 189 registros
2026-02-03 02:44:37 - INFO - Calculando pedido para semana 14 (189 registros)
2026-02-03 02:44:38 - INFO -   Objetivo: 5297.17€, Actual (ABC): 4464.03€
2026-02-03 02:44:38 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 02:44:38 - INFO -   Factor total: 1.3125
2026-02-03 02:44:38 - INFO -   Factor escalado: 1.5575
2026-02-03 02:44:38 - INFO -   Ventas preliminares (con ceil): 8225.51€
2026-02-03 02:44:38 - INFO -   Objetivo final: 6952.54€
2026-02-03 02:44:38 - INFO -   Delta: 1272.97€
2026-02-03 02:44:38 - INFO -   Ventas finales: 6955.79€
2026-02-03 02:44:38 - INFO - 
============================================================
2026-02-03 02:44:38 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 02:44:38 - INFO - ============================================================
2026-02-03 02:44:38 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 02:44:38 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 02:44:38 - INFO - DataLoader inicializado correctamente
2026-02-03 02:44:38 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 02:44:38 - INFO - ============================================================
2026-02-03 02:44:38 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 02:44:38 - INFO - ============================================================
2026-02-03 02:44:38 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 02:44:38 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 02:44:38 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:44:38 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:44:38 - INFO - Leyendo archivo de corrección: ././data/input/Stock_actual.xlsx
2026-02-03 02:44:38 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:44:38 - INFO - Stock actual cargado: 30 registros
2026-02-03 02:44:38 - INFO -   Stock: 30 registros
2026-02-03 02:44:38 - WARNING - Archivo de corrección no encontrado: Ventas_semana.xlsx
2026-02-03 02:44:38 - WARNING - Archivo de corrección no encontrado: Ventas_semana_14.xlsx
2026-02-03 02:44:38 - WARNING - Archivo de corrección no encontrado: Ventas_Semana_14.xlsx
2026-02-03 02:44:38 - WARNING - Archivo de corrección no encontrado: Ventas-14.xlsx
2026-02-03 02:44:38 - WARNING - No se encontró archivo de ventas para semana 14
2026-02-03 02:44:38 - WARNING - Archivo de corrección no encontrado: Compras_semana.xlsx
2026-02-03 02:44:38 - WARNING - Archivo de corrección no encontrado: Compras_semana_14.xlsx
2026-02-03 02:44:38 - WARNING - Archivo de corrección no encontrado: Compras_Semana_14.xlsx
2026-02-03 02:44:38 - WARNING - Archivo de corrección no encontrado: Compras-14.xlsx
2026-02-03 02:44:38 - WARNING - No se encontró archivo de compras para semana 14
2026-02-03 02:44:38 - INFO - Datos de corrección cargados: 1/3 archivos
2026-02-03 02:44:38 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 02:44:38 - INFO - Fusión completada: 107 registros
2026-02-03 02:44:38 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 02:44:38 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 02:44:38 - INFO - Corrección completada:
2026-02-03 02:44:38 - INFO -   - Artículos corregidos: 107/107
2026-02-03 02:44:38 - INFO -   - Artículos aumentados: 107
2026-02-03 02:44:38 - INFO -   - Artículos reducidos: 0
2026-02-03 02:44:38 - WARNING - ALERTAS GENERADAS:
2026-02-03 02:44:38 - WARNING -   [ALTO] 107 artículos con stock en 0 o negativo
2026-02-03 02:44:38 - WARNING -   [MEDIO] 44 artículos con cambios superiores al 50%
2026-02-03 02:44:38 - INFO - 
RESUMEN DE CORRECCIÓN:
2026-02-03 02:44:38 - INFO -   Artículos corregidos: 107/107
2026-02-03 02:44:38 - INFO -   Porcentaje corregido: 100.0%
2026-02-03 02:44:38 - ERROR - Error al aplicar corrección: Unknown format code 'd' for object of type 'float'
2026-02-03 02:44:38 - ERROR - Traceback (most recent call last):
  File "/workspace/vivero_pedidos_v2/main.py", line 281, in aplicar_correccion_pedido
    logger.info(f"  Diferencia unidades: {metricas['diferencia_unidades']:+d}")
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ValueError: Unknown format code 'd' for object of type 'float'

2026-02-03 02:44:38 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 02:44:38 - INFO - Generando archivo: ././data/output/Pedido_Semana_14_2026-02-03_vivero.xlsx
2026-02-03 02:44:38 - INFO - Archivo guardado: ././data/output/Pedido_Semana_14_2026-02-03_vivero.xlsx
2026-02-03 02:44:38 - INFO - Archivo generado: ././data/output/Pedido_Semana_14_2026-02-03_vivero.xlsx
2026-02-03 02:44:38 - INFO -   Articulos: 107
2026-02-03 02:44:38 - INFO -   Importe: 6955.79€
2026-02-03 02:44:38 - INFO - 
==================================================
2026-02-03 02:44:38 - INFO - SECCION: UTILES_JARDIN
2026-02-03 02:44:38 - INFO - ==================================================
2026-02-03 02:44:38 - INFO - === LEYENDO DATOS PARA SECCIÓN: UTILES_JARDIN ===
2026-02-03 02:44:38 - WARNING - No se encontró archivo específico para 'utiles_jardin', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:44:38 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:44:38 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 02:44:38 - INFO - Clasificación ABC cargada para 'utiles_jardin': 555 registros
2026-02-03 02:44:38 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-03 02:44:44 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:44:44 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 02:44:44 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 02:44:44 - INFO - Ventas cargadas: 44082 registros
2026-02-03 02:44:44 - INFO - Filtrados 1009 registros de sección 'utiles_jardin' de 44082 total
2026-02-03 02:44:44 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-03 02:44:46 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:44:46 - INFO - Costes cargados: 22145 registros
2026-02-03 02:44:46 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA UTILES_JARDIN ===
2026-02-03 02:44:46 - INFO -   ABC: 555 registros
2026-02-03 02:44:46 - INFO -   Ventas: 1009 registros
2026-02-03 02:44:46 - INFO -   Costes: 22145 registros
2026-02-03 02:44:46 - INFO - Datos de ventas: 89 registros
2026-02-03 02:44:46 - INFO - Calculando pedido para semana 14 (89 registros)
2026-02-03 02:44:47 - INFO -   Objetivo: 1044.77€, Actual (ABC): 764.57€
2026-02-03 02:44:47 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 02:44:47 - INFO -   Factor total: 1.3125
2026-02-03 02:44:47 - INFO -   Factor escalado: 1.7935
2026-02-03 02:44:47 - INFO -   Ventas preliminares (con ceil): 1516.64€
2026-02-03 02:44:47 - INFO -   Objetivo final: 1371.26€
2026-02-03 02:44:47 - INFO -   Delta: 145.38€
2026-02-03 02:44:47 - INFO -   Ventas finales: 1373.85€
2026-02-03 02:44:47 - INFO - 
============================================================
2026-02-03 02:44:47 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 02:44:47 - INFO - ============================================================
2026-02-03 02:44:47 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 02:44:47 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 02:44:47 - INFO - DataLoader inicializado correctamente
2026-02-03 02:44:47 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 02:44:47 - INFO - ============================================================
2026-02-03 02:44:47 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 02:44:47 - INFO - ============================================================
2026-02-03 02:44:47 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 02:44:47 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 02:44:47 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:44:47 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:44:47 - INFO - Leyendo archivo de corrección: ././data/input/Stock_actual.xlsx
2026-02-03 02:44:47 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:44:47 - INFO - Stock actual cargado: 30 registros
2026-02-03 02:44:47 - INFO -   Stock: 30 registros
2026-02-03 02:44:47 - WARNING - Archivo de corrección no encontrado: Ventas_semana.xlsx
2026-02-03 02:44:47 - WARNING - Archivo de corrección no encontrado: Ventas_semana_14.xlsx
2026-02-03 02:44:47 - WARNING - Archivo de corrección no encontrado: Ventas_Semana_14.xlsx
2026-02-03 02:44:47 - WARNING - Archivo de corrección no encontrado: Ventas-14.xlsx
2026-02-03 02:44:47 - WARNING - No se encontró archivo de ventas para semana 14
2026-02-03 02:44:47 - WARNING - Archivo de corrección no encontrado: Compras_semana.xlsx
2026-02-03 02:44:47 - WARNING - Archivo de corrección no encontrado: Compras_semana_14.xlsx
2026-02-03 02:44:47 - WARNING - Archivo de corrección no encontrado: Compras_Semana_14.xlsx
2026-02-03 02:44:47 - WARNING - Archivo de corrección no encontrado: Compras-14.xlsx
2026-02-03 02:44:47 - WARNING - No se encontró archivo de compras para semana 14
2026-02-03 02:44:47 - INFO - Datos de corrección cargados: 1/3 archivos
2026-02-03 02:44:47 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 02:44:47 - INFO - Fusión completada: 78 registros
2026-02-03 02:44:47 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 02:44:47 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 02:44:47 - INFO - Corrección completada:
2026-02-03 02:44:47 - INFO -   - Artículos corregidos: 78/78
2026-02-03 02:44:47 - INFO -   - Artículos aumentados: 78
2026-02-03 02:44:47 - INFO -   - Artículos reducidos: 0
2026-02-03 02:44:47 - WARNING - ALERTAS GENERADAS:
2026-02-03 02:44:47 - WARNING -   [ALTO] 78 artículos con stock en 0 o negativo
2026-02-03 02:44:47 - WARNING -   [MEDIO] 24 artículos con cambios superiores al 50%
2026-02-03 02:44:47 - INFO - 
RESUMEN DE CORRECCIÓN:
2026-02-03 02:44:47 - INFO -   Artículos corregidos: 78/78
2026-02-03 02:44:47 - INFO -   Porcentaje corregido: 100.0%
2026-02-03 02:44:47 - ERROR - Error al aplicar corrección: Unknown format code 'd' for object of type 'float'
2026-02-03 02:44:47 - ERROR - Traceback (most recent call last):
  File "/workspace/vivero_pedidos_v2/main.py", line 281, in aplicar_correccion_pedido
    logger.info(f"  Diferencia unidades: {metricas['diferencia_unidades']:+d}")
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ValueError: Unknown format code 'd' for object of type 'float'

2026-02-03 02:44:47 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 02:44:47 - INFO - Generando archivo: ././data/output/Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx
2026-02-03 02:44:47 - INFO - Archivo guardado: ././data/output/Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx
2026-02-03 02:44:47 - INFO - Archivo generado: ././data/output/Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx
2026-02-03 02:44:47 - INFO -   Articulos: 78
2026-02-03 02:44:47 - INFO -   Importe: 1373.85€
2026-02-03 02:44:47 - INFO - 
==================================================
2026-02-03 02:44:47 - INFO - SECCION: TIERRAS_ARIDOS
2026-02-03 02:44:47 - INFO - ==================================================
2026-02-03 02:44:47 - INFO - === LEYENDO DATOS PARA SECCIÓN: TIERRAS_ARIDOS ===
2026-02-03 02:44:47 - WARNING - No se encontró archivo específico para 'tierras_aridos', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:44:47 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:44:47 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 02:44:47 - INFO - Clasificación ABC cargada para 'tierras_aridos': 555 registros
2026-02-03 02:44:47 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-03 02:44:53 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:44:53 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 02:44:53 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 02:44:53 - INFO - Ventas cargadas: 44082 registros
2026-02-03 02:44:53 - INFO - Filtrados 3264 registros de sección 'tierras_aridos' de 44082 total
2026-02-03 02:44:53 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-03 02:44:55 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:44:55 - INFO - Costes cargados: 22145 registros
2026-02-03 02:44:55 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA TIERRAS_ARIDOS ===
2026-02-03 02:44:55 - INFO -   ABC: 555 registros
2026-02-03 02:44:55 - INFO -   Ventas: 3264 registros
2026-02-03 02:44:55 - INFO -   Costes: 22145 registros
2026-02-03 02:44:55 - INFO - Datos de ventas: 302 registros
2026-02-03 02:44:55 - INFO - Calculando pedido para semana 14 (302 registros)
2026-02-03 02:44:56 - INFO -   Objetivo: 4097.24€, Actual (ABC): 4019.19€
2026-02-03 02:44:56 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 02:44:56 - INFO -   Factor total: 1.3125
2026-02-03 02:44:56 - INFO -   Factor escalado: 1.3380
2026-02-03 02:44:56 - INFO -   Ventas preliminares (con ceil): 5809.66€
2026-02-03 02:44:56 - INFO -   Objetivo final: 5377.63€
2026-02-03 02:44:56 - INFO -   Delta: 432.03€
2026-02-03 02:44:56 - INFO -   Ventas finales: 5387.14€
2026-02-03 02:44:56 - INFO - 
============================================================
2026-02-03 02:44:56 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 02:44:56 - INFO - ============================================================
2026-02-03 02:44:56 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 02:44:56 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 02:44:56 - INFO - DataLoader inicializado correctamente
2026-02-03 02:44:56 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 02:44:56 - INFO - ============================================================
2026-02-03 02:44:56 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 02:44:56 - INFO - ============================================================
2026-02-03 02:44:56 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 02:44:56 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 02:44:56 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:44:56 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:44:56 - INFO - Leyendo archivo de corrección: ././data/input/Stock_actual.xlsx
2026-02-03 02:44:56 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:44:56 - INFO - Stock actual cargado: 30 registros
2026-02-03 02:44:56 - INFO -   Stock: 30 registros
2026-02-03 02:44:56 - WARNING - Archivo de corrección no encontrado: Ventas_semana.xlsx
2026-02-03 02:44:56 - WARNING - Archivo de corrección no encontrado: Ventas_semana_14.xlsx
2026-02-03 02:44:56 - WARNING - Archivo de corrección no encontrado: Ventas_Semana_14.xlsx
2026-02-03 02:44:56 - WARNING - Archivo de corrección no encontrado: Ventas-14.xlsx
2026-02-03 02:44:56 - WARNING - No se encontró archivo de ventas para semana 14
2026-02-03 02:44:56 - WARNING - Archivo de corrección no encontrado: Compras_semana.xlsx
2026-02-03 02:44:56 - WARNING - Archivo de corrección no encontrado: Compras_semana_14.xlsx
2026-02-03 02:44:56 - WARNING - Archivo de corrección no encontrado: Compras_Semana_14.xlsx
2026-02-03 02:44:56 - WARNING - Archivo de corrección no encontrado: Compras-14.xlsx
2026-02-03 02:44:56 - WARNING - No se encontró archivo de compras para semana 14
2026-02-03 02:44:56 - INFO - Datos de corrección cargados: 1/3 archivos
2026-02-03 02:44:56 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 02:44:56 - INFO - Fusión completada: 72 registros
2026-02-03 02:44:56 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 02:44:56 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 02:44:56 - INFO - Corrección completada:
2026-02-03 02:44:56 - INFO -   - Artículos corregidos: 71/72
2026-02-03 02:44:56 - INFO -   - Artículos aumentados: 71
2026-02-03 02:44:56 - INFO -   - Artículos reducidos: 0
2026-02-03 02:44:56 - WARNING - ALERTAS GENERADAS:
2026-02-03 02:44:56 - WARNING -   [ALTO] 72 artículos con stock en 0 o negativo
2026-02-03 02:44:56 - WARNING -   [MEDIO] 12 artículos con cambios superiores al 50%
2026-02-03 02:44:56 - INFO - 
RESUMEN DE CORRECCIÓN:
2026-02-03 02:44:56 - INFO -   Artículos corregidos: 71/72
2026-02-03 02:44:56 - INFO -   Porcentaje corregido: 98.6%
2026-02-03 02:44:56 - ERROR - Error al aplicar corrección: Unknown format code 'd' for object of type 'float'
2026-02-03 02:44:56 - ERROR - Traceback (most recent call last):
  File "/workspace/vivero_pedidos_v2/main.py", line 281, in aplicar_correccion_pedido
    logger.info(f"  Diferencia unidades: {metricas['diferencia_unidades']:+d}")
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ValueError: Unknown format code 'd' for object of type 'float'

2026-02-03 02:44:56 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 02:44:56 - INFO - Generando archivo: ././data/output/Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx
2026-02-03 02:44:56 - INFO - Archivo guardado: ././data/output/Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx
2026-02-03 02:44:56 - INFO - Archivo generado: ././data/output/Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx
2026-02-03 02:44:56 - INFO -   Articulos: 71
2026-02-03 02:44:56 - INFO -   Importe: 5387.14€
2026-02-03 02:44:56 - INFO - 
==================================================
2026-02-03 02:44:56 - INFO - SECCION: DECO_EXTERIOR
2026-02-03 02:44:56 - INFO - ==================================================
2026-02-03 02:44:56 - INFO - === LEYENDO DATOS PARA SECCIÓN: DECO_EXTERIOR ===
2026-02-03 02:44:56 - WARNING - No se encontró archivo específico para 'deco_exterior', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:44:56 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:44:56 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 02:44:56 - INFO - Clasificación ABC cargada para 'deco_exterior': 555 registros
2026-02-03 02:44:56 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-03 02:45:02 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:45:02 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 02:45:02 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 02:45:02 - INFO - Ventas cargadas: 44082 registros
2026-02-03 02:45:02 - INFO - Filtrados 4018 registros de sección 'deco_exterior' de 44082 total
2026-02-03 02:45:02 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-03 02:45:05 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:45:05 - INFO - Costes cargados: 22145 registros
2026-02-03 02:45:05 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA DECO_EXTERIOR ===
2026-02-03 02:45:05 - INFO -   ABC: 555 registros
2026-02-03 02:45:05 - INFO -   Ventas: 4018 registros
2026-02-03 02:45:05 - INFO -   Costes: 22145 registros
2026-02-03 02:45:05 - INFO - Datos de ventas: 316 registros
2026-02-03 02:45:05 - INFO - Calculando pedido para semana 14 (316 registros)
2026-02-03 02:45:05 - INFO -   Objetivo: 3740.34€, Actual (ABC): 3720.75€
2026-02-03 02:45:05 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 02:45:05 - INFO -   Factor total: 1.3125
2026-02-03 02:45:05 - INFO -   Factor escalado: 1.3194
2026-02-03 02:45:05 - INFO -   Ventas preliminares (con ceil): 6159.28€
2026-02-03 02:45:05 - INFO -   Objetivo final: 4909.20€
2026-02-03 02:45:05 - INFO -   Delta: 1250.08€
2026-02-03 02:45:05 - INFO -   Ventas finales: 4934.68€
2026-02-03 02:45:06 - INFO - 
============================================================
2026-02-03 02:45:06 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 02:45:06 - INFO - ============================================================
2026-02-03 02:45:06 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 02:45:06 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 02:45:06 - INFO - DataLoader inicializado correctamente
2026-02-03 02:45:06 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 02:45:06 - INFO - ============================================================
2026-02-03 02:45:06 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 02:45:06 - INFO - ============================================================
2026-02-03 02:45:06 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 02:45:06 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 02:45:06 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:45:06 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:45:06 - INFO - Leyendo archivo de corrección: ././data/input/Stock_actual.xlsx
2026-02-03 02:45:06 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:45:06 - INFO - Stock actual cargado: 30 registros
2026-02-03 02:45:06 - INFO -   Stock: 30 registros
2026-02-03 02:45:06 - WARNING - Archivo de corrección no encontrado: Ventas_semana.xlsx
2026-02-03 02:45:06 - WARNING - Archivo de corrección no encontrado: Ventas_semana_14.xlsx
2026-02-03 02:45:06 - WARNING - Archivo de corrección no encontrado: Ventas_Semana_14.xlsx
2026-02-03 02:45:06 - WARNING - Archivo de corrección no encontrado: Ventas-14.xlsx
2026-02-03 02:45:06 - WARNING - No se encontró archivo de ventas para semana 14
2026-02-03 02:45:06 - WARNING - Archivo de corrección no encontrado: Compras_semana.xlsx
2026-02-03 02:45:06 - WARNING - Archivo de corrección no encontrado: Compras_semana_14.xlsx
2026-02-03 02:45:06 - WARNING - Archivo de corrección no encontrado: Compras_Semana_14.xlsx
2026-02-03 02:45:06 - WARNING - Archivo de corrección no encontrado: Compras-14.xlsx
2026-02-03 02:45:06 - WARNING - No se encontró archivo de compras para semana 14
2026-02-03 02:45:06 - INFO - Datos de corrección cargados: 1/3 archivos
2026-02-03 02:45:06 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 02:45:06 - INFO - Fusión completada: 224 registros
2026-02-03 02:45:06 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 02:45:06 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 02:45:06 - INFO - Corrección completada:
2026-02-03 02:45:06 - INFO -   - Artículos corregidos: 221/224
2026-02-03 02:45:06 - INFO -   - Artículos aumentados: 221
2026-02-03 02:45:06 - INFO -   - Artículos reducidos: 0
2026-02-03 02:45:06 - WARNING - ALERTAS GENERADAS:
2026-02-03 02:45:06 - WARNING -   [ALTO] 224 artículos con stock en 0 o negativo
2026-02-03 02:45:06 - WARNING -   [MEDIO] 99 artículos con cambios superiores al 50%
2026-02-03 02:45:06 - INFO - 
RESUMEN DE CORRECCIÓN:
2026-02-03 02:45:06 - INFO -   Artículos corregidos: 221/224
2026-02-03 02:45:06 - INFO -   Porcentaje corregido: 98.7%
2026-02-03 02:45:06 - ERROR - Error al aplicar corrección: Unknown format code 'd' for object of type 'float'
2026-02-03 02:45:06 - ERROR - Traceback (most recent call last):
  File "/workspace/vivero_pedidos_v2/main.py", line 281, in aplicar_correccion_pedido
    logger.info(f"  Diferencia unidades: {metricas['diferencia_unidades']:+d}")
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ValueError: Unknown format code 'd' for object of type 'float'

2026-02-03 02:45:06 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 02:45:06 - INFO - Generando archivo: ././data/output/Pedido_Semana_14_2026-02-03_deco_exterior.xlsx
2026-02-03 02:45:06 - INFO - Archivo guardado: ././data/output/Pedido_Semana_14_2026-02-03_deco_exterior.xlsx
2026-02-03 02:45:06 - INFO - Archivo generado: ././data/output/Pedido_Semana_14_2026-02-03_deco_exterior.xlsx
2026-02-03 02:45:06 - INFO -   Articulos: 221
2026-02-03 02:45:06 - INFO -   Importe: 4934.68€
2026-02-03 02:45:06 - INFO - Estado guardado correctamente
2026-02-03 02:45:06 - INFO - Generando resumen: ././data/output/Resumen_Pedidos_VIVERO_2026-02-03.xlsx
2026-02-03 02:45:06 - INFO - Resumen guardado: ././data/output/Resumen_Pedidos_VIVERO_2026-02-03.xlsx
2026-02-03 02:45:06 - INFO - Estado guardado correctamente
2026-02-03 02:45:06 - INFO - 
======================================================================
2026-02-03 02:45:06 - INFO - RESUMEN DE EJECUCION
2026-02-03 02:45:06 - INFO - ======================================================================
2026-02-03 02:45:06 - INFO - Semana procesada: 14
2026-02-03 02:45:06 - INFO - Archivos generados: 12
2026-02-03 02:45:06 - INFO - Total articulos: 1702
2026-02-03 02:45:06 - INFO - Total importe: 48050.69€
2026-02-03 02:45:06 - INFO - ======================================================================
2026-02-03 02:45:06 - INFO - 
¡PEDIDO GENERADO EXITOSAMENTE!
2026-02-03 02:45:06 - INFO - Archivo principal: ././data/output/Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 02:45:06 - INFO - Articulos: 1702
2026-02-03 02:45:06 - INFO - Importe: 48050.69€
2026-02-03 02:45:25 - INFO - ======================================================================
2026-02-03 02:45:25 - INFO - SISTEMA DE PEDIDOS DE COMPRA - VIVERO ARANJUEZ V2
2026-02-03 02:45:25 - INFO - Fecha de ejecucion: 2026-02-03 02:45:25
2026-02-03 02:45:25 - INFO - ======================================================================
2026-02-03 02:45:25 - INFO - Modo de ejecucion: FASE 1 + FASE 2
2026-02-03 02:45:25 - INFO - StateManager inicializado. Archivo de estado: ././data/state.json
2026-02-03 02:45:25 - INFO - Cargando estado desde: ././data/state.json
2026-02-03 02:45:25 - INFO - Estado cargado correctamente
2026-02-03 02:45:25 - INFO - SchedulerService inicializado correctamente
2026-02-03 02:45:25 - INFO - Horario configurado: sunday a las 15:00
2026-02-03 02:45:25 - INFO - Semana forzada por argumento: 14
2026-02-03 02:45:25 - INFO - ======================================================================
2026-02-03 02:45:25 - INFO - PROCESANDO PEDIDO PARA SEMANA 14
2026-02-03 02:45:25 - INFO - ======================================================================
2026-02-03 02:45:25 - INFO - MODO: FASE 1 (Forecast) + FASE 2 (Corrección)
2026-02-03 02:45:25 - INFO - DataLoader inicializado correctamente
2026-02-03 02:45:25 - INFO - ForecastEngine inicializado correctamente
2026-02-03 02:45:25 - INFO - OrderGenerator inicializado correctamente
2026-02-03 02:45:25 - INFO - SchedulerService inicializado correctamente
2026-02-03 02:45:25 - INFO - Horario configurado: sunday a las 15:00
2026-02-03 02:45:25 - INFO - Período de la semana: 2026-03-30 al 2026-04-05
2026-02-03 02:45:25 - INFO - Stock acumulado cargado: 1727 artículos
2026-02-03 02:45:25 - INFO - 
==================================================
2026-02-03 02:45:25 - INFO - SECCION: MAF
2026-02-03 02:45:25 - INFO - ==================================================
2026-02-03 02:45:25 - INFO - === LEYENDO DATOS PARA SECCIÓN: MAF ===
2026-02-03 02:45:25 - WARNING - No se encontró archivo específico para 'maf', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:45:25 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:45:26 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 02:45:26 - INFO - Clasificación ABC cargada para 'maf': 555 registros
2026-02-03 02:45:26 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-03 02:45:31 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:45:31 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 02:45:31 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 02:45:31 - INFO - Ventas cargadas: 44082 registros
2026-02-03 02:45:31 - INFO - Filtrados 10970 registros de sección 'maf' de 44082 total
2026-02-03 02:45:31 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-03 02:45:34 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:45:34 - INFO - Costes cargados: 22145 registros
2026-02-03 02:45:34 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MAF ===
2026-02-03 02:45:34 - INFO -   ABC: 555 registros
2026-02-03 02:45:34 - INFO -   Ventas: 10970 registros
2026-02-03 02:45:34 - INFO -   Costes: 22145 registros
2026-02-03 02:45:34 - INFO - Datos de ventas: 1011 registros
2026-02-03 02:45:34 - INFO - Calculando pedido para semana 14 (1011 registros)
2026-02-03 02:45:35 - INFO -   Objetivo: 7050.65€, Actual (ABC): 7177.24€
2026-02-03 02:45:35 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 02:45:35 - INFO -   Factor total: 1.3125
2026-02-03 02:45:35 - INFO -   Factor escalado: 1.2894
2026-02-03 02:45:35 - INFO -   Ventas preliminares (con ceil): 9955.95€
2026-02-03 02:45:35 - INFO -   Objetivo final: 9253.98€
2026-02-03 02:45:35 - INFO -   Delta: 701.97€
2026-02-03 02:45:35 - INFO -   Ventas finales: 9254.64€
2026-02-03 02:45:35 - INFO - 
============================================================
2026-02-03 02:45:35 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 02:45:35 - INFO - ============================================================
2026-02-03 02:45:35 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 02:45:35 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 02:45:35 - INFO - DataLoader inicializado correctamente
2026-02-03 02:45:35 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 02:45:35 - INFO - ============================================================
2026-02-03 02:45:35 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 02:45:35 - INFO - ============================================================
2026-02-03 02:45:35 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 02:45:35 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 02:45:35 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:45:35 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:45:35 - INFO - Leyendo archivo de corrección: ././data/input/Stock_actual.xlsx
2026-02-03 02:45:35 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:45:35 - INFO - Stock actual cargado: 30 registros
2026-02-03 02:45:35 - INFO -   Stock: 30 registros
2026-02-03 02:45:35 - WARNING - Archivo de corrección no encontrado: Ventas_semana.xlsx
2026-02-03 02:45:35 - WARNING - Archivo de corrección no encontrado: Ventas_semana_14.xlsx
2026-02-03 02:45:35 - WARNING - Archivo de corrección no encontrado: Ventas_Semana_14.xlsx
2026-02-03 02:45:35 - WARNING - Archivo de corrección no encontrado: Ventas-14.xlsx
2026-02-03 02:45:35 - WARNING - No se encontró archivo de ventas para semana 14
2026-02-03 02:45:35 - WARNING - Archivo de corrección no encontrado: Compras_semana.xlsx
2026-02-03 02:45:35 - WARNING - Archivo de corrección no encontrado: Compras_semana_14.xlsx
2026-02-03 02:45:35 - WARNING - Archivo de corrección no encontrado: Compras_Semana_14.xlsx
2026-02-03 02:45:35 - WARNING - Archivo de corrección no encontrado: Compras-14.xlsx
2026-02-03 02:45:35 - WARNING - No se encontró archivo de compras para semana 14
2026-02-03 02:45:35 - INFO - Datos de corrección cargados: 1/3 archivos
2026-02-03 02:45:35 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 02:45:35 - INFO - Fusión completada: 222 registros
2026-02-03 02:45:35 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 02:45:35 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 02:45:35 - INFO - Corrección completada:
2026-02-03 02:45:35 - INFO -   - Artículos corregidos: 221/222
2026-02-03 02:45:35 - INFO -   - Artículos aumentados: 221
2026-02-03 02:45:35 - INFO -   - Artículos reducidos: 0
2026-02-03 02:45:35 - WARNING - ALERTAS GENERADAS:
2026-02-03 02:45:35 - WARNING -   [ALTO] 222 artículos con stock en 0 o negativo
2026-02-03 02:45:35 - WARNING -   [MEDIO] 43 artículos con cambios superiores al 50%
2026-02-03 02:45:35 - INFO - 
RESUMEN DE CORRECCIÓN:
2026-02-03 02:45:35 - INFO -   Artículos corregidos: 221/222
2026-02-03 02:45:35 - INFO -   Porcentaje corregido: 99.5%
2026-02-03 02:45:35 - INFO -   Diferencia unidades: +746
2026-02-03 02:45:35 - INFO -   Porcentaje cambio: +34.4%
2026-02-03 02:45:35 - INFO - Archivo de pedido corregido generado: Pedido_Semana_14_2026-04-06_maf_CORREGIDO.xlsx
2026-02-03 02:45:35 - INFO - Archivo corregido: Pedido_Semana_14_2026-04-06_maf_CORREGIDO.xlsx
2026-02-03 02:45:35 - INFO - Generando archivo: ././data/output/Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 02:45:35 - INFO - Archivo guardado: ././data/output/Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 02:45:35 - INFO - Archivo generado: ././data/output/Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 02:45:35 - INFO -   Articulos: 221
2026-02-03 02:45:35 - INFO -   Importe: 9254.64€
2026-02-03 02:45:35 - INFO - 
==================================================
2026-02-03 02:45:35 - INFO - SECCION: DECO_INTERIOR
2026-02-03 02:45:35 - INFO - ==================================================
2026-02-03 02:45:35 - INFO - === LEYENDO DATOS PARA SECCIÓN: DECO_INTERIOR ===
2026-02-03 02:45:35 - WARNING - No se encontró archivo específico para 'deco_interior', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:45:35 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:45:35 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 02:45:35 - INFO - Clasificación ABC cargada para 'deco_interior': 555 registros
2026-02-03 02:45:35 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-03 02:45:41 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:45:41 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 02:45:41 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 02:45:41 - INFO - Ventas cargadas: 44082 registros
2026-02-03 02:45:41 - INFO - Filtrados 2468 registros de sección 'deco_interior' de 44082 total
2026-02-03 02:45:41 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-03 02:45:44 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:45:44 - INFO - Costes cargados: 22145 registros
2026-02-03 02:45:44 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA DECO_INTERIOR ===
2026-02-03 02:45:44 - INFO -   ABC: 555 registros
2026-02-03 02:45:44 - INFO -   Ventas: 2468 registros
2026-02-03 02:45:44 - INFO -   Costes: 22145 registros
2026-02-03 02:45:44 - INFO - Datos de ventas: 180 registros
2026-02-03 02:45:44 - INFO - Calculando pedido para semana 14 (180 registros)
2026-02-03 02:45:44 - INFO -   Objetivo: 1962.99€, Actual (ABC): 1494.40€
2026-02-03 02:45:44 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 02:45:44 - INFO -   Factor total: 1.3125
2026-02-03 02:45:44 - INFO -   Factor escalado: 1.7241
2026-02-03 02:45:44 - INFO -   Ventas preliminares (con ceil): 2961.52€
2026-02-03 02:45:44 - INFO -   Objetivo final: 2576.42€
2026-02-03 02:45:44 - INFO -   Delta: 385.10€
2026-02-03 02:45:44 - INFO -   Ventas finales: 2583.25€
2026-02-03 02:45:44 - INFO - 
============================================================
2026-02-03 02:45:44 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 02:45:44 - INFO - ============================================================
2026-02-03 02:45:44 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 02:45:44 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 02:45:44 - INFO - DataLoader inicializado correctamente
2026-02-03 02:45:44 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 02:45:44 - INFO - ============================================================
2026-02-03 02:45:44 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 02:45:44 - INFO - ============================================================
2026-02-03 02:45:44 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 02:45:44 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 02:45:44 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:45:44 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:45:44 - INFO - Leyendo archivo de corrección: ././data/input/Stock_actual.xlsx
2026-02-03 02:45:44 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:45:44 - INFO - Stock actual cargado: 30 registros
2026-02-03 02:45:44 - INFO -   Stock: 30 registros
2026-02-03 02:45:44 - WARNING - Archivo de corrección no encontrado: Ventas_semana.xlsx
2026-02-03 02:45:44 - WARNING - Archivo de corrección no encontrado: Ventas_semana_14.xlsx
2026-02-03 02:45:44 - WARNING - Archivo de corrección no encontrado: Ventas_Semana_14.xlsx
2026-02-03 02:45:44 - WARNING - Archivo de corrección no encontrado: Ventas-14.xlsx
2026-02-03 02:45:44 - WARNING - No se encontró archivo de ventas para semana 14
2026-02-03 02:45:44 - WARNING - Archivo de corrección no encontrado: Compras_semana.xlsx
2026-02-03 02:45:44 - WARNING - Archivo de corrección no encontrado: Compras_semana_14.xlsx
2026-02-03 02:45:44 - WARNING - Archivo de corrección no encontrado: Compras_Semana_14.xlsx
2026-02-03 02:45:44 - WARNING - Archivo de corrección no encontrado: Compras-14.xlsx
2026-02-03 02:45:44 - WARNING - No se encontró archivo de compras para semana 14
2026-02-03 02:45:44 - INFO - Datos de corrección cargados: 1/3 archivos
2026-02-03 02:45:44 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 02:45:44 - INFO - Fusión completada: 139 registros
2026-02-03 02:45:44 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 02:45:44 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 02:45:44 - INFO - Corrección completada:
2026-02-03 02:45:44 - INFO -   - Artículos corregidos: 138/139
2026-02-03 02:45:44 - INFO -   - Artículos aumentados: 138
2026-02-03 02:45:44 - INFO -   - Artículos reducidos: 0
2026-02-03 02:45:44 - WARNING - ALERTAS GENERADAS:
2026-02-03 02:45:44 - WARNING -   [ALTO] 139 artículos con stock en 0 o negativo
2026-02-03 02:45:44 - WARNING -   [MEDIO] 59 artículos con cambios superiores al 50%
2026-02-03 02:45:44 - INFO - 
RESUMEN DE CORRECCIÓN:
2026-02-03 02:45:44 - INFO -   Artículos corregidos: 138/139
2026-02-03 02:45:44 - INFO -   Porcentaje corregido: 99.3%
2026-02-03 02:45:44 - INFO -   Diferencia unidades: +172
2026-02-03 02:45:44 - INFO -   Porcentaje cambio: +51.3%
2026-02-03 02:45:44 - INFO - Archivo de pedido corregido generado: Pedido_Semana_14_2026-04-06_deco_interior_CORREGIDO.xlsx
2026-02-03 02:45:44 - INFO - Archivo corregido: Pedido_Semana_14_2026-04-06_deco_interior_CORREGIDO.xlsx
2026-02-03 02:45:44 - INFO - Generando archivo: ././data/output/Pedido_Semana_14_2026-02-03_deco_interior.xlsx
2026-02-03 02:45:45 - INFO - Archivo guardado: ././data/output/Pedido_Semana_14_2026-02-03_deco_interior.xlsx
2026-02-03 02:45:45 - INFO - Archivo generado: ././data/output/Pedido_Semana_14_2026-02-03_deco_interior.xlsx
2026-02-03 02:45:45 - INFO -   Articulos: 138
2026-02-03 02:45:45 - INFO -   Importe: 2583.25€
2026-02-03 02:45:45 - INFO - 
==================================================
2026-02-03 02:45:45 - INFO - SECCION: SEMILLAS
2026-02-03 02:45:45 - INFO - ==================================================
2026-02-03 02:45:45 - INFO - === LEYENDO DATOS PARA SECCIÓN: SEMILLAS ===
2026-02-03 02:45:45 - WARNING - No se encontró archivo específico para 'semillas', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:45:45 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:45:45 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 02:45:45 - INFO - Clasificación ABC cargada para 'semillas': 555 registros
2026-02-03 02:45:45 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-03 02:45:50 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:45:50 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 02:45:50 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 02:45:50 - INFO - Ventas cargadas: 44082 registros
2026-02-03 02:45:50 - INFO - Filtrados 1180 registros de sección 'semillas' de 44082 total
2026-02-03 02:45:50 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-03 02:45:53 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:45:53 - INFO - Costes cargados: 22145 registros
2026-02-03 02:45:53 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA SEMILLAS ===
2026-02-03 02:45:53 - INFO -   ABC: 555 registros
2026-02-03 02:45:53 - INFO -   Ventas: 1180 registros
2026-02-03 02:45:53 - INFO -   Costes: 22145 registros
2026-02-03 02:45:53 - INFO - Datos de ventas: 136 registros
2026-02-03 02:45:53 - INFO - Calculando pedido para semana 14 (136 registros)
2026-02-03 02:45:53 - INFO -   Objetivo: 694.34€, Actual (ABC): 566.70€
2026-02-03 02:45:53 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 02:45:53 - INFO -   Factor total: 1.3125
2026-02-03 02:45:53 - INFO -   Factor escalado: 1.6081
2026-02-03 02:45:53 - INFO -   Ventas preliminares (con ceil): 1062.05€
2026-02-03 02:45:53 - INFO -   Objetivo final: 911.32€
2026-02-03 02:45:53 - INFO -   Delta: 150.73€
2026-02-03 02:45:53 - INFO -   Ventas finales: 913.86€
2026-02-03 02:45:53 - INFO - 
============================================================
2026-02-03 02:45:53 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 02:45:53 - INFO - ============================================================
2026-02-03 02:45:53 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 02:45:53 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 02:45:53 - INFO - DataLoader inicializado correctamente
2026-02-03 02:45:53 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 02:45:53 - INFO - ============================================================
2026-02-03 02:45:53 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 02:45:53 - INFO - ============================================================
2026-02-03 02:45:53 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 02:45:53 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 02:45:53 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:45:53 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:45:53 - INFO - Leyendo archivo de corrección: ././data/input/Stock_actual.xlsx
2026-02-03 02:45:53 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:45:53 - INFO - Stock actual cargado: 30 registros
2026-02-03 02:45:53 - INFO -   Stock: 30 registros
2026-02-03 02:45:53 - WARNING - Archivo de corrección no encontrado: Ventas_semana.xlsx
2026-02-03 02:45:53 - WARNING - Archivo de corrección no encontrado: Ventas_semana_14.xlsx
2026-02-03 02:45:53 - WARNING - Archivo de corrección no encontrado: Ventas_Semana_14.xlsx
2026-02-03 02:45:53 - WARNING - Archivo de corrección no encontrado: Ventas-14.xlsx
2026-02-03 02:45:53 - WARNING - No se encontró archivo de ventas para semana 14
2026-02-03 02:45:53 - WARNING - Archivo de corrección no encontrado: Compras_semana.xlsx
2026-02-03 02:45:53 - WARNING - Archivo de corrección no encontrado: Compras_semana_14.xlsx
2026-02-03 02:45:53 - WARNING - Archivo de corrección no encontrado: Compras_Semana_14.xlsx
2026-02-03 02:45:53 - WARNING - Archivo de corrección no encontrado: Compras-14.xlsx
2026-02-03 02:45:53 - WARNING - No se encontró archivo de compras para semana 14
2026-02-03 02:45:53 - INFO - Datos de corrección cargados: 1/3 archivos
2026-02-03 02:45:53 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 02:45:53 - INFO - Fusión completada: 84 registros
2026-02-03 02:45:53 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 02:45:53 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 02:45:53 - INFO - Corrección completada:
2026-02-03 02:45:53 - INFO -   - Artículos corregidos: 84/84
2026-02-03 02:45:53 - INFO -   - Artículos aumentados: 84
2026-02-03 02:45:53 - INFO -   - Artículos reducidos: 0
2026-02-03 02:45:53 - WARNING - ALERTAS GENERADAS:
2026-02-03 02:45:53 - WARNING -   [ALTO] 84 artículos con stock en 0 o negativo
2026-02-03 02:45:53 - WARNING -   [MEDIO] 42 artículos con cambios superiores al 50%
2026-02-03 02:45:53 - INFO - 
RESUMEN DE CORRECCIÓN:
2026-02-03 02:45:53 - INFO -   Artículos corregidos: 84/84
2026-02-03 02:45:53 - INFO -   Porcentaje corregido: 100.0%
2026-02-03 02:45:53 - INFO -   Diferencia unidades: +108
2026-02-03 02:45:53 - INFO -   Porcentaje cambio: +51.9%
2026-02-03 02:45:53 - INFO - Archivo de pedido corregido generado: Pedido_Semana_14_2026-04-06_semillas_CORREGIDO.xlsx
2026-02-03 02:45:53 - INFO - Archivo corregido: Pedido_Semana_14_2026-04-06_semillas_CORREGIDO.xlsx
2026-02-03 02:45:53 - INFO - Generando archivo: ././data/output/Pedido_Semana_14_2026-02-03_semillas.xlsx
2026-02-03 02:45:53 - INFO - Archivo guardado: ././data/output/Pedido_Semana_14_2026-02-03_semillas.xlsx
2026-02-03 02:45:53 - INFO - Archivo generado: ././data/output/Pedido_Semana_14_2026-02-03_semillas.xlsx
2026-02-03 02:45:53 - INFO -   Articulos: 84
2026-02-03 02:45:53 - INFO -   Importe: 913.86€
2026-02-03 02:45:53 - INFO - 
==================================================
2026-02-03 02:45:53 - INFO - SECCION: MASCOTAS_VIVO
2026-02-03 02:45:53 - INFO - ==================================================
2026-02-03 02:45:53 - INFO - === LEYENDO DATOS PARA SECCIÓN: MASCOTAS_VIVO ===
2026-02-03 02:45:53 - WARNING - No se encontró archivo específico para 'mascotas_vivo', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:45:53 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:45:54 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 02:45:54 - INFO - Clasificación ABC cargada para 'mascotas_vivo': 555 registros
2026-02-03 02:45:54 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-03 02:45:59 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:45:59 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 02:45:59 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 02:45:59 - INFO - Ventas cargadas: 44082 registros
2026-02-03 02:45:59 - INFO - Filtrados 1124 registros de sección 'mascotas_vivo' de 44082 total
2026-02-03 02:45:59 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-03 02:46:02 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:46:02 - INFO - Costes cargados: 22145 registros
2026-02-03 02:46:02 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MASCOTAS_VIVO ===
2026-02-03 02:46:02 - INFO -   ABC: 555 registros
2026-02-03 02:46:02 - INFO -   Ventas: 1124 registros
2026-02-03 02:46:02 - INFO -   Costes: 22145 registros
2026-02-03 02:46:02 - INFO - Datos de ventas: 88 registros
2026-02-03 02:46:02 - INFO - Calculando pedido para semana 14 (88 registros)
2026-02-03 02:46:02 - INFO -   Objetivo: 1087.15€, Actual (ABC): 1144.11€
2026-02-03 02:46:02 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 02:46:02 - INFO -   Factor total: 1.3125
2026-02-03 02:46:02 - INFO -   Factor escalado: 1.2472
2026-02-03 02:46:02 - INFO -   Ventas preliminares (con ceil): 1759.51€
2026-02-03 02:46:02 - INFO -   Objetivo final: 1426.88€
2026-02-03 02:46:02 - INFO -   Delta: 332.63€
2026-02-03 02:46:02 - INFO -   Ventas finales: 1451.48€
2026-02-03 02:46:02 - INFO - 
============================================================
2026-02-03 02:46:02 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 02:46:02 - INFO - ============================================================
2026-02-03 02:46:02 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 02:46:02 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 02:46:02 - INFO - DataLoader inicializado correctamente
2026-02-03 02:46:02 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 02:46:02 - INFO - ============================================================
2026-02-03 02:46:02 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 02:46:02 - INFO - ============================================================
2026-02-03 02:46:02 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 02:46:02 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 02:46:02 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:46:02 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:46:02 - INFO - Leyendo archivo de corrección: ././data/input/Stock_actual.xlsx
2026-02-03 02:46:02 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:46:02 - INFO - Stock actual cargado: 30 registros
2026-02-03 02:46:02 - INFO -   Stock: 30 registros
2026-02-03 02:46:02 - WARNING - Archivo de corrección no encontrado: Ventas_semana.xlsx
2026-02-03 02:46:02 - WARNING - Archivo de corrección no encontrado: Ventas_semana_14.xlsx
2026-02-03 02:46:02 - WARNING - Archivo de corrección no encontrado: Ventas_Semana_14.xlsx
2026-02-03 02:46:02 - WARNING - Archivo de corrección no encontrado: Ventas-14.xlsx
2026-02-03 02:46:02 - WARNING - No se encontró archivo de ventas para semana 14
2026-02-03 02:46:02 - WARNING - Archivo de corrección no encontrado: Compras_semana.xlsx
2026-02-03 02:46:02 - WARNING - Archivo de corrección no encontrado: Compras_semana_14.xlsx
2026-02-03 02:46:02 - WARNING - Archivo de corrección no encontrado: Compras_Semana_14.xlsx
2026-02-03 02:46:02 - WARNING - Archivo de corrección no encontrado: Compras-14.xlsx
2026-02-03 02:46:02 - WARNING - No se encontró archivo de compras para semana 14
2026-02-03 02:46:02 - INFO - Datos de corrección cargados: 1/3 archivos
2026-02-03 02:46:02 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 02:46:02 - INFO - Fusión completada: 43 registros
2026-02-03 02:46:02 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 02:46:02 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 02:46:02 - INFO - Corrección completada:
2026-02-03 02:46:02 - INFO -   - Artículos corregidos: 43/43
2026-02-03 02:46:02 - INFO -   - Artículos aumentados: 43
2026-02-03 02:46:02 - INFO -   - Artículos reducidos: 0
2026-02-03 02:46:02 - WARNING - ALERTAS GENERADAS:
2026-02-03 02:46:02 - WARNING -   [ALTO] 43 artículos con stock en 0 o negativo
2026-02-03 02:46:02 - WARNING -   [MEDIO] 16 artículos con cambios superiores al 50%
2026-02-03 02:46:02 - INFO - 
RESUMEN DE CORRECCIÓN:
2026-02-03 02:46:02 - INFO -   Artículos corregidos: 43/43
2026-02-03 02:46:02 - INFO -   Porcentaje corregido: 100.0%
2026-02-03 02:46:02 - INFO -   Diferencia unidades: +84
2026-02-03 02:46:02 - INFO -   Porcentaje cambio: +43.8%
2026-02-03 02:46:02 - INFO - Archivo de pedido corregido generado: Pedido_Semana_14_2026-04-06_mascotas_vivo_CORREGIDO.xlsx
2026-02-03 02:46:02 - INFO - Archivo corregido: Pedido_Semana_14_2026-04-06_mascotas_vivo_CORREGIDO.xlsx
2026-02-03 02:46:02 - INFO - Generando archivo: ././data/output/Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx
2026-02-03 02:46:02 - INFO - Archivo guardado: ././data/output/Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx
2026-02-03 02:46:02 - INFO - Archivo generado: ././data/output/Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx
2026-02-03 02:46:02 - INFO -   Articulos: 43
2026-02-03 02:46:02 - INFO -   Importe: 1451.48€
2026-02-03 02:46:02 - INFO - 
==================================================
2026-02-03 02:46:02 - INFO - SECCION: MASCOTAS_MANUFACTURADO
2026-02-03 02:46:02 - INFO - ==================================================
2026-02-03 02:46:02 - INFO - === LEYENDO DATOS PARA SECCIÓN: MASCOTAS_MANUFACTURADO ===
2026-02-03 02:46:02 - WARNING - No se encontró archivo específico para 'mascotas_manufacturado', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:46:02 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:46:02 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 02:46:02 - INFO - Clasificación ABC cargada para 'mascotas_manufacturado': 555 registros
2026-02-03 02:46:02 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-03 02:46:07 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:46:07 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 02:46:08 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 02:46:08 - INFO - Ventas cargadas: 44082 registros
2026-02-03 02:46:08 - INFO - Filtrados 9784 registros de sección 'mascotas_manufacturado' de 44082 total
2026-02-03 02:46:08 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-03 02:46:10 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:46:10 - INFO - Costes cargados: 22145 registros
2026-02-03 02:46:10 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MASCOTAS_MANUFACTURADO ===
2026-02-03 02:46:10 - INFO -   ABC: 555 registros
2026-02-03 02:46:10 - INFO -   Ventas: 9784 registros
2026-02-03 02:46:10 - INFO -   Costes: 22145 registros
2026-02-03 02:46:10 - INFO - Datos de ventas: 822 registros
2026-02-03 02:46:10 - INFO - Calculando pedido para semana 14 (822 registros)
2026-02-03 02:46:13 - INFO -   Objetivo: 6839.82€, Actual (ABC): 8422.22€
2026-02-03 02:46:13 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 02:46:13 - INFO -   Factor total: 1.3125
2026-02-03 02:46:13 - INFO -   Factor escalado: 1.0659
2026-02-03 02:46:13 - INFO -   Ventas preliminares (con ceil): 14128.59€
2026-02-03 02:46:13 - INFO -   Objetivo final: 8977.26€
2026-02-03 02:46:13 - INFO -   Delta: 5151.33€
2026-02-03 02:46:13 - INFO -   Ventas finales: 8979.81€
2026-02-03 02:46:13 - INFO - 
============================================================
2026-02-03 02:46:13 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 02:46:13 - INFO - ============================================================
2026-02-03 02:46:13 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 02:46:13 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 02:46:13 - INFO - DataLoader inicializado correctamente
2026-02-03 02:46:13 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 02:46:13 - INFO - ============================================================
2026-02-03 02:46:13 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 02:46:13 - INFO - ============================================================
2026-02-03 02:46:13 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 02:46:13 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 02:46:13 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:46:13 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:46:13 - INFO - Leyendo archivo de corrección: ././data/input/Stock_actual.xlsx
2026-02-03 02:46:13 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:46:13 - INFO - Stock actual cargado: 30 registros
2026-02-03 02:46:13 - INFO -   Stock: 30 registros
2026-02-03 02:46:13 - WARNING - Archivo de corrección no encontrado: Ventas_semana.xlsx
2026-02-03 02:46:13 - WARNING - Archivo de corrección no encontrado: Ventas_semana_14.xlsx
2026-02-03 02:46:13 - WARNING - Archivo de corrección no encontrado: Ventas_Semana_14.xlsx
2026-02-03 02:46:13 - WARNING - Archivo de corrección no encontrado: Ventas-14.xlsx
2026-02-03 02:46:13 - WARNING - No se encontró archivo de ventas para semana 14
2026-02-03 02:46:13 - WARNING - Archivo de corrección no encontrado: Compras_semana.xlsx
2026-02-03 02:46:13 - WARNING - Archivo de corrección no encontrado: Compras_semana_14.xlsx
2026-02-03 02:46:13 - WARNING - Archivo de corrección no encontrado: Compras_Semana_14.xlsx
2026-02-03 02:46:13 - WARNING - Archivo de corrección no encontrado: Compras-14.xlsx
2026-02-03 02:46:13 - WARNING - No se encontró archivo de compras para semana 14
2026-02-03 02:46:13 - INFO - Datos de corrección cargados: 1/3 archivos
2026-02-03 02:46:13 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 02:46:13 - INFO - Fusión completada: 538 registros
2026-02-03 02:46:13 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 02:46:13 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 02:46:13 - INFO - Corrección completada:
2026-02-03 02:46:13 - INFO -   - Artículos corregidos: 534/538
2026-02-03 02:46:13 - INFO -   - Artículos aumentados: 534
2026-02-03 02:46:13 - INFO -   - Artículos reducidos: 0
2026-02-03 02:46:13 - WARNING - ALERTAS GENERADAS:
2026-02-03 02:46:13 - WARNING -   [ALTO] 538 artículos con stock en 0 o negativo
2026-02-03 02:46:13 - WARNING -   [MEDIO] 321 artículos con cambios superiores al 50%
2026-02-03 02:46:13 - INFO - 
RESUMEN DE CORRECCIÓN:
2026-02-03 02:46:13 - INFO -   Artículos corregidos: 534/538
2026-02-03 02:46:13 - INFO -   Porcentaje corregido: 99.3%
2026-02-03 02:46:13 - INFO -   Diferencia unidades: +660
2026-02-03 02:46:13 - INFO -   Porcentaje cambio: +56.0%
2026-02-03 02:46:13 - INFO - Archivo de pedido corregido generado: Pedido_Semana_14_2026-04-06_mascotas_manufacturado_CORREGIDO.xlsx
2026-02-03 02:46:13 - INFO - Archivo corregido: Pedido_Semana_14_2026-04-06_mascotas_manufacturado_CORREGIDO.xlsx
2026-02-03 02:46:13 - INFO - Generando archivo: ././data/output/Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx
2026-02-03 02:46:13 - INFO - Archivo guardado: ././data/output/Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx
2026-02-03 02:46:13 - INFO - Archivo generado: ././data/output/Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx
2026-02-03 02:46:13 - INFO -   Articulos: 534
2026-02-03 02:46:13 - INFO -   Importe: 8979.81€
2026-02-03 02:46:13 - INFO - 
==================================================
2026-02-03 02:46:13 - INFO - SECCION: INTERIOR
2026-02-03 02:46:13 - INFO - ==================================================
2026-02-03 02:46:13 - INFO - === LEYENDO DATOS PARA SECCIÓN: INTERIOR ===
2026-02-03 02:46:13 - WARNING - No se encontró archivo específico para 'interior', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:46:13 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:46:13 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 02:46:13 - INFO - Clasificación ABC cargada para 'interior': 555 registros
2026-02-03 02:46:13 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-03 02:46:19 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:46:19 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 02:46:19 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 02:46:19 - INFO - Ventas cargadas: 44082 registros
2026-02-03 02:46:19 - INFO - Filtrados 3624 registros de sección 'interior' de 44082 total
2026-02-03 02:46:19 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-03 02:46:22 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:46:22 - INFO - Costes cargados: 22145 registros
2026-02-03 02:46:22 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA INTERIOR ===
2026-02-03 02:46:22 - INFO -   ABC: 555 registros
2026-02-03 02:46:22 - INFO -   Ventas: 3624 registros
2026-02-03 02:46:22 - INFO -   Costes: 22145 registros
2026-02-03 02:46:22 - INFO - Datos de ventas: 286 registros
2026-02-03 02:46:22 - INFO - Calculando pedido para semana 14 (286 registros)
2026-02-03 02:46:22 - INFO -   Objetivo: 2930.63€, Actual (ABC): 2409.44€
2026-02-03 02:46:22 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 02:46:22 - INFO -   Factor total: 1.3125
2026-02-03 02:46:22 - INFO -   Factor escalado: 1.5964
2026-02-03 02:46:22 - INFO -   Ventas preliminares (con ceil): 4541.81€
2026-02-03 02:46:22 - INFO -   Objetivo final: 3846.45€
2026-02-03 02:46:22 - INFO -   Delta: 695.36€
2026-02-03 02:46:22 - INFO -   Ventas finales: 3855.17€
2026-02-03 02:46:22 - INFO - 
============================================================
2026-02-03 02:46:22 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 02:46:22 - INFO - ============================================================
2026-02-03 02:46:22 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 02:46:22 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 02:46:22 - INFO - DataLoader inicializado correctamente
2026-02-03 02:46:22 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 02:46:22 - INFO - ============================================================
2026-02-03 02:46:22 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 02:46:22 - INFO - ============================================================
2026-02-03 02:46:22 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 02:46:22 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 02:46:22 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:46:22 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:46:22 - INFO - Leyendo archivo de corrección: ././data/input/Stock_actual.xlsx
2026-02-03 02:46:22 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:46:22 - INFO - Stock actual cargado: 30 registros
2026-02-03 02:46:22 - INFO -   Stock: 30 registros
2026-02-03 02:46:22 - WARNING - Archivo de corrección no encontrado: Ventas_semana.xlsx
2026-02-03 02:46:22 - WARNING - Archivo de corrección no encontrado: Ventas_semana_14.xlsx
2026-02-03 02:46:22 - WARNING - Archivo de corrección no encontrado: Ventas_Semana_14.xlsx
2026-02-03 02:46:22 - WARNING - Archivo de corrección no encontrado: Ventas-14.xlsx
2026-02-03 02:46:22 - WARNING - No se encontró archivo de ventas para semana 14
2026-02-03 02:46:22 - WARNING - Archivo de corrección no encontrado: Compras_semana.xlsx
2026-02-03 02:46:22 - WARNING - Archivo de corrección no encontrado: Compras_semana_14.xlsx
2026-02-03 02:46:22 - WARNING - Archivo de corrección no encontrado: Compras_Semana_14.xlsx
2026-02-03 02:46:22 - WARNING - Archivo de corrección no encontrado: Compras-14.xlsx
2026-02-03 02:46:22 - WARNING - No se encontró archivo de compras para semana 14
2026-02-03 02:46:22 - INFO - Datos de corrección cargados: 1/3 archivos
2026-02-03 02:46:22 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 02:46:22 - INFO - Fusión completada: 138 registros
2026-02-03 02:46:22 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 02:46:22 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 02:46:22 - INFO - Corrección completada:
2026-02-03 02:46:22 - INFO -   - Artículos corregidos: 121/138
2026-02-03 02:46:22 - INFO -   - Artículos aumentados: 121
2026-02-03 02:46:22 - INFO -   - Artículos reducidos: 0
2026-02-03 02:46:22 - WARNING - ALERTAS GENERADAS:
2026-02-03 02:46:22 - WARNING -   [ALTO] 138 artículos con stock en 0 o negativo
2026-02-03 02:46:22 - WARNING -   [MEDIO] 45 artículos con cambios superiores al 50%
2026-02-03 02:46:22 - INFO - 
RESUMEN DE CORRECCIÓN:
2026-02-03 02:46:22 - INFO -   Artículos corregidos: 121/138
2026-02-03 02:46:22 - INFO -   Porcentaje corregido: 87.7%
2026-02-03 02:46:22 - INFO -   Diferencia unidades: +199
2026-02-03 02:46:22 - INFO -   Porcentaje cambio: +43.8%
2026-02-03 02:46:22 - INFO - Archivo de pedido corregido generado: Pedido_Semana_14_2026-04-06_interior_CORREGIDO.xlsx
2026-02-03 02:46:22 - INFO - Archivo corregido: Pedido_Semana_14_2026-04-06_interior_CORREGIDO.xlsx
2026-02-03 02:46:22 - INFO - Generando archivo: ././data/output/Pedido_Semana_14_2026-02-03_interior.xlsx
2026-02-03 02:46:23 - INFO - Archivo guardado: ././data/output/Pedido_Semana_14_2026-02-03_interior.xlsx
2026-02-03 02:46:23 - INFO - Archivo generado: ././data/output/Pedido_Semana_14_2026-02-03_interior.xlsx
2026-02-03 02:46:23 - INFO -   Articulos: 121
2026-02-03 02:46:23 - INFO -   Importe: 3855.17€
2026-02-03 02:46:23 - INFO - 
==================================================
2026-02-03 02:46:23 - INFO - SECCION: FITOS
2026-02-03 02:46:23 - INFO - ==================================================
2026-02-03 02:46:23 - INFO - === LEYENDO DATOS PARA SECCIÓN: FITOS ===
2026-02-03 02:46:23 - WARNING - No se encontró archivo específico para 'fitos', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:46:23 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:46:23 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 02:46:23 - INFO - Clasificación ABC cargada para 'fitos': 555 registros
2026-02-03 02:46:23 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-03 02:46:28 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:46:28 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 02:46:28 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 02:46:28 - INFO - Ventas cargadas: 44082 registros
2026-02-03 02:46:28 - INFO - Filtrados 1987 registros de sección 'fitos' de 44082 total
2026-02-03 02:46:28 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-03 02:46:31 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:46:31 - INFO - Costes cargados: 22145 registros
2026-02-03 02:46:31 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA FITOS ===
2026-02-03 02:46:31 - INFO -   ABC: 555 registros
2026-02-03 02:46:31 - INFO -   Ventas: 1987 registros
2026-02-03 02:46:31 - INFO -   Costes: 22145 registros
2026-02-03 02:46:31 - INFO - Datos de ventas: 157 registros
2026-02-03 02:46:31 - INFO - Calculando pedido para semana 14 (157 registros)
2026-02-03 02:46:31 - INFO -   Objetivo: 1798.25€, Actual (ABC): 1585.02€
2026-02-03 02:46:31 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 02:46:31 - INFO -   Factor total: 1.3125
2026-02-03 02:46:31 - INFO -   Factor escalado: 1.4891
2026-02-03 02:46:31 - INFO -   Ventas preliminares (con ceil): 2690.29€
2026-02-03 02:46:31 - INFO -   Objetivo final: 2360.20€
2026-02-03 02:46:31 - INFO -   Delta: 330.09€
2026-02-03 02:46:31 - INFO -   Ventas finales: 2361.02€
2026-02-03 02:46:31 - INFO - 
============================================================
2026-02-03 02:46:31 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 02:46:31 - INFO - ============================================================
2026-02-03 02:46:31 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 02:46:31 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 02:46:31 - INFO - DataLoader inicializado correctamente
2026-02-03 02:46:31 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 02:46:31 - INFO - ============================================================
2026-02-03 02:46:31 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 02:46:31 - INFO - ============================================================
2026-02-03 02:46:31 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 02:46:31 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 02:46:31 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:46:31 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:46:31 - INFO - Leyendo archivo de corrección: ././data/input/Stock_actual.xlsx
2026-02-03 02:46:31 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:46:31 - INFO - Stock actual cargado: 30 registros
2026-02-03 02:46:31 - INFO -   Stock: 30 registros
2026-02-03 02:46:31 - WARNING - Archivo de corrección no encontrado: Ventas_semana.xlsx
2026-02-03 02:46:31 - WARNING - Archivo de corrección no encontrado: Ventas_semana_14.xlsx
2026-02-03 02:46:31 - WARNING - Archivo de corrección no encontrado: Ventas_Semana_14.xlsx
2026-02-03 02:46:31 - WARNING - Archivo de corrección no encontrado: Ventas-14.xlsx
2026-02-03 02:46:31 - WARNING - No se encontró archivo de ventas para semana 14
2026-02-03 02:46:31 - WARNING - Archivo de corrección no encontrado: Compras_semana.xlsx
2026-02-03 02:46:31 - WARNING - Archivo de corrección no encontrado: Compras_semana_14.xlsx
2026-02-03 02:46:31 - WARNING - Archivo de corrección no encontrado: Compras_Semana_14.xlsx
2026-02-03 02:46:31 - WARNING - Archivo de corrección no encontrado: Compras-14.xlsx
2026-02-03 02:46:31 - WARNING - No se encontró archivo de compras para semana 14
2026-02-03 02:46:31 - INFO - Datos de corrección cargados: 1/3 archivos
2026-02-03 02:46:31 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 02:46:31 - INFO - Fusión completada: 84 registros
2026-02-03 02:46:31 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 02:46:31 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 02:46:31 - INFO - Corrección completada:
2026-02-03 02:46:31 - INFO -   - Artículos corregidos: 84/84
2026-02-03 02:46:31 - INFO -   - Artículos aumentados: 84
2026-02-03 02:46:31 - INFO -   - Artículos reducidos: 0
2026-02-03 02:46:31 - WARNING - ALERTAS GENERADAS:
2026-02-03 02:46:31 - WARNING -   [ALTO] 84 artículos con stock en 0 o negativo
2026-02-03 02:46:31 - WARNING -   [MEDIO] 19 artículos con cambios superiores al 50%
2026-02-03 02:46:31 - INFO - 
RESUMEN DE CORRECCIÓN:
2026-02-03 02:46:31 - INFO -   Artículos corregidos: 84/84
2026-02-03 02:46:31 - INFO -   Porcentaje corregido: 100.0%
2026-02-03 02:46:31 - INFO -   Diferencia unidades: +113
2026-02-03 02:46:31 - INFO -   Porcentaje cambio: +46.9%
2026-02-03 02:46:31 - INFO - Archivo de pedido corregido generado: Pedido_Semana_14_2026-04-06_fitos_CORREGIDO.xlsx
2026-02-03 02:46:31 - INFO - Archivo corregido: Pedido_Semana_14_2026-04-06_fitos_CORREGIDO.xlsx
2026-02-03 02:46:31 - INFO - Generando archivo: ././data/output/Pedido_Semana_14_2026-02-03_fitos.xlsx
2026-02-03 02:46:32 - INFO - Archivo guardado: ././data/output/Pedido_Semana_14_2026-02-03_fitos.xlsx
2026-02-03 02:46:32 - INFO - Archivo generado: ././data/output/Pedido_Semana_14_2026-02-03_fitos.xlsx
2026-02-03 02:46:32 - INFO -   Articulos: 84
2026-02-03 02:46:32 - INFO -   Importe: 2361.02€
2026-02-03 02:46:32 - INFO - 
==================================================
2026-02-03 02:46:32 - INFO - SECCION: VIVERO
2026-02-03 02:46:32 - INFO - ==================================================
2026-02-03 02:46:32 - INFO - === LEYENDO DATOS PARA SECCIÓN: VIVERO ===
2026-02-03 02:46:32 - WARNING - No se encontró archivo específico para 'vivero', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:46:32 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:46:32 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 02:46:32 - INFO - Clasificación ABC cargada para 'vivero': 555 registros
2026-02-03 02:46:32 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-03 02:46:37 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:46:37 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 02:46:37 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 02:46:37 - INFO - Ventas cargadas: 44082 registros
2026-02-03 02:46:37 - INFO - Filtrados 2460 registros de sección 'vivero' de 44082 total
2026-02-03 02:46:37 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-03 02:46:40 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:46:40 - INFO - Costes cargados: 22145 registros
2026-02-03 02:46:40 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA VIVERO ===
2026-02-03 02:46:40 - INFO -   ABC: 555 registros
2026-02-03 02:46:40 - INFO -   Ventas: 2460 registros
2026-02-03 02:46:40 - INFO -   Costes: 22145 registros
2026-02-03 02:46:40 - INFO - Datos de ventas: 189 registros
2026-02-03 02:46:40 - INFO - Calculando pedido para semana 14 (189 registros)
2026-02-03 02:46:40 - INFO -   Objetivo: 5297.17€, Actual (ABC): 4464.03€
2026-02-03 02:46:40 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 02:46:40 - INFO -   Factor total: 1.3125
2026-02-03 02:46:40 - INFO -   Factor escalado: 1.5575
2026-02-03 02:46:40 - INFO -   Ventas preliminares (con ceil): 8225.51€
2026-02-03 02:46:40 - INFO -   Objetivo final: 6952.54€
2026-02-03 02:46:40 - INFO -   Delta: 1272.97€
2026-02-03 02:46:40 - INFO -   Ventas finales: 6955.79€
2026-02-03 02:46:40 - INFO - 
============================================================
2026-02-03 02:46:40 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 02:46:40 - INFO - ============================================================
2026-02-03 02:46:40 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 02:46:40 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 02:46:40 - INFO - DataLoader inicializado correctamente
2026-02-03 02:46:40 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 02:46:40 - INFO - ============================================================
2026-02-03 02:46:40 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 02:46:40 - INFO - ============================================================
2026-02-03 02:46:40 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 02:46:40 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 02:46:40 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:46:40 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:46:40 - INFO - Leyendo archivo de corrección: ././data/input/Stock_actual.xlsx
2026-02-03 02:46:40 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:46:40 - INFO - Stock actual cargado: 30 registros
2026-02-03 02:46:40 - INFO -   Stock: 30 registros
2026-02-03 02:46:40 - WARNING - Archivo de corrección no encontrado: Ventas_semana.xlsx
2026-02-03 02:46:40 - WARNING - Archivo de corrección no encontrado: Ventas_semana_14.xlsx
2026-02-03 02:46:40 - WARNING - Archivo de corrección no encontrado: Ventas_Semana_14.xlsx
2026-02-03 02:46:40 - WARNING - Archivo de corrección no encontrado: Ventas-14.xlsx
2026-02-03 02:46:40 - WARNING - No se encontró archivo de ventas para semana 14
2026-02-03 02:46:40 - WARNING - Archivo de corrección no encontrado: Compras_semana.xlsx
2026-02-03 02:46:40 - WARNING - Archivo de corrección no encontrado: Compras_semana_14.xlsx
2026-02-03 02:46:40 - WARNING - Archivo de corrección no encontrado: Compras_Semana_14.xlsx
2026-02-03 02:46:40 - WARNING - Archivo de corrección no encontrado: Compras-14.xlsx
2026-02-03 02:46:40 - WARNING - No se encontró archivo de compras para semana 14
2026-02-03 02:46:40 - INFO - Datos de corrección cargados: 1/3 archivos
2026-02-03 02:46:40 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 02:46:40 - INFO - Fusión completada: 107 registros
2026-02-03 02:46:40 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 02:46:40 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 02:46:41 - INFO - Corrección completada:
2026-02-03 02:46:41 - INFO -   - Artículos corregidos: 107/107
2026-02-03 02:46:41 - INFO -   - Artículos aumentados: 107
2026-02-03 02:46:41 - INFO -   - Artículos reducidos: 0
2026-02-03 02:46:41 - WARNING - ALERTAS GENERADAS:
2026-02-03 02:46:41 - WARNING -   [ALTO] 107 artículos con stock en 0 o negativo
2026-02-03 02:46:41 - WARNING -   [MEDIO] 44 artículos con cambios superiores al 50%
2026-02-03 02:46:41 - INFO - 
RESUMEN DE CORRECCIÓN:
2026-02-03 02:46:41 - INFO -   Artículos corregidos: 107/107
2026-02-03 02:46:41 - INFO -   Porcentaje corregido: 100.0%
2026-02-03 02:46:41 - INFO -   Diferencia unidades: +172
2026-02-03 02:46:41 - INFO -   Porcentaje cambio: +44.8%
2026-02-03 02:46:41 - INFO - Archivo de pedido corregido generado: Pedido_Semana_14_2026-04-06_vivero_CORREGIDO.xlsx
2026-02-03 02:46:41 - INFO - Archivo corregido: Pedido_Semana_14_2026-04-06_vivero_CORREGIDO.xlsx
2026-02-03 02:46:41 - INFO - Generando archivo: ././data/output/Pedido_Semana_14_2026-02-03_vivero.xlsx
2026-02-03 02:46:41 - INFO - Archivo guardado: ././data/output/Pedido_Semana_14_2026-02-03_vivero.xlsx
2026-02-03 02:46:41 - INFO - Archivo generado: ././data/output/Pedido_Semana_14_2026-02-03_vivero.xlsx
2026-02-03 02:46:41 - INFO -   Articulos: 107
2026-02-03 02:46:41 - INFO -   Importe: 6955.79€
2026-02-03 02:46:41 - INFO - 
==================================================
2026-02-03 02:46:41 - INFO - SECCION: UTILES_JARDIN
2026-02-03 02:46:41 - INFO - ==================================================
2026-02-03 02:46:41 - INFO - === LEYENDO DATOS PARA SECCIÓN: UTILES_JARDIN ===
2026-02-03 02:46:41 - WARNING - No se encontró archivo específico para 'utiles_jardin', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:46:41 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:46:41 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 02:46:41 - INFO - Clasificación ABC cargada para 'utiles_jardin': 555 registros
2026-02-03 02:46:41 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-03 02:46:46 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:46:46 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 02:46:46 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 02:46:46 - INFO - Ventas cargadas: 44082 registros
2026-02-03 02:46:46 - INFO - Filtrados 1009 registros de sección 'utiles_jardin' de 44082 total
2026-02-03 02:46:46 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-03 02:46:49 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:46:49 - INFO - Costes cargados: 22145 registros
2026-02-03 02:46:49 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA UTILES_JARDIN ===
2026-02-03 02:46:49 - INFO -   ABC: 555 registros
2026-02-03 02:46:49 - INFO -   Ventas: 1009 registros
2026-02-03 02:46:49 - INFO -   Costes: 22145 registros
2026-02-03 02:46:49 - INFO - Datos de ventas: 89 registros
2026-02-03 02:46:49 - INFO - Calculando pedido para semana 14 (89 registros)
2026-02-03 02:46:49 - INFO -   Objetivo: 1044.77€, Actual (ABC): 764.57€
2026-02-03 02:46:49 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 02:46:49 - INFO -   Factor total: 1.3125
2026-02-03 02:46:49 - INFO -   Factor escalado: 1.7935
2026-02-03 02:46:49 - INFO -   Ventas preliminares (con ceil): 1516.64€
2026-02-03 02:46:49 - INFO -   Objetivo final: 1371.26€
2026-02-03 02:46:49 - INFO -   Delta: 145.38€
2026-02-03 02:46:49 - INFO -   Ventas finales: 1373.85€
2026-02-03 02:46:49 - INFO - 
============================================================
2026-02-03 02:46:49 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 02:46:49 - INFO - ============================================================
2026-02-03 02:46:49 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 02:46:49 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 02:46:49 - INFO - DataLoader inicializado correctamente
2026-02-03 02:46:49 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 02:46:49 - INFO - ============================================================
2026-02-03 02:46:49 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 02:46:49 - INFO - ============================================================
2026-02-03 02:46:49 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 02:46:49 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 02:46:49 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:46:49 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:46:49 - INFO - Leyendo archivo de corrección: ././data/input/Stock_actual.xlsx
2026-02-03 02:46:49 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:46:49 - INFO - Stock actual cargado: 30 registros
2026-02-03 02:46:49 - INFO -   Stock: 30 registros
2026-02-03 02:46:49 - WARNING - Archivo de corrección no encontrado: Ventas_semana.xlsx
2026-02-03 02:46:49 - WARNING - Archivo de corrección no encontrado: Ventas_semana_14.xlsx
2026-02-03 02:46:49 - WARNING - Archivo de corrección no encontrado: Ventas_Semana_14.xlsx
2026-02-03 02:46:49 - WARNING - Archivo de corrección no encontrado: Ventas-14.xlsx
2026-02-03 02:46:49 - WARNING - No se encontró archivo de ventas para semana 14
2026-02-03 02:46:49 - WARNING - Archivo de corrección no encontrado: Compras_semana.xlsx
2026-02-03 02:46:49 - WARNING - Archivo de corrección no encontrado: Compras_semana_14.xlsx
2026-02-03 02:46:49 - WARNING - Archivo de corrección no encontrado: Compras_Semana_14.xlsx
2026-02-03 02:46:49 - WARNING - Archivo de corrección no encontrado: Compras-14.xlsx
2026-02-03 02:46:49 - WARNING - No se encontró archivo de compras para semana 14
2026-02-03 02:46:49 - INFO - Datos de corrección cargados: 1/3 archivos
2026-02-03 02:46:49 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 02:46:49 - INFO - Fusión completada: 78 registros
2026-02-03 02:46:49 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 02:46:49 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 02:46:49 - INFO - Corrección completada:
2026-02-03 02:46:49 - INFO -   - Artículos corregidos: 78/78
2026-02-03 02:46:49 - INFO -   - Artículos aumentados: 78
2026-02-03 02:46:49 - INFO -   - Artículos reducidos: 0
2026-02-03 02:46:50 - WARNING - ALERTAS GENERADAS:
2026-02-03 02:46:50 - WARNING -   [ALTO] 78 artículos con stock en 0 o negativo
2026-02-03 02:46:50 - WARNING -   [MEDIO] 24 artículos con cambios superiores al 50%
2026-02-03 02:46:50 - INFO - 
RESUMEN DE CORRECCIÓN:
2026-02-03 02:46:50 - INFO -   Artículos corregidos: 78/78
2026-02-03 02:46:50 - INFO -   Porcentaje corregido: 100.0%
2026-02-03 02:46:50 - INFO -   Diferencia unidades: +101
2026-02-03 02:46:50 - INFO -   Porcentaje cambio: +47.2%
2026-02-03 02:46:50 - INFO - Archivo de pedido corregido generado: Pedido_Semana_14_2026-04-06_utiles_jardin_CORREGIDO.xlsx
2026-02-03 02:46:50 - INFO - Archivo corregido: Pedido_Semana_14_2026-04-06_utiles_jardin_CORREGIDO.xlsx
2026-02-03 02:46:50 - INFO - Generando archivo: ././data/output/Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx
2026-02-03 02:46:50 - INFO - Archivo guardado: ././data/output/Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx
2026-02-03 02:46:50 - INFO - Archivo generado: ././data/output/Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx
2026-02-03 02:46:50 - INFO -   Articulos: 78
2026-02-03 02:46:50 - INFO -   Importe: 1373.85€
2026-02-03 02:46:50 - INFO - 
==================================================
2026-02-03 02:46:50 - INFO - SECCION: TIERRAS_ARIDOS
2026-02-03 02:46:50 - INFO - ==================================================
2026-02-03 02:46:50 - INFO - === LEYENDO DATOS PARA SECCIÓN: TIERRAS_ARIDOS ===
2026-02-03 02:46:50 - WARNING - No se encontró archivo específico para 'tierras_aridos', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:46:50 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:46:50 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 02:46:50 - INFO - Clasificación ABC cargada para 'tierras_aridos': 555 registros
2026-02-03 02:46:50 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-03 02:46:55 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:46:55 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 02:46:55 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 02:46:55 - INFO - Ventas cargadas: 44082 registros
2026-02-03 02:46:55 - INFO - Filtrados 3264 registros de sección 'tierras_aridos' de 44082 total
2026-02-03 02:46:55 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-03 02:46:58 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:46:58 - INFO - Costes cargados: 22145 registros
2026-02-03 02:46:58 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA TIERRAS_ARIDOS ===
2026-02-03 02:46:58 - INFO -   ABC: 555 registros
2026-02-03 02:46:58 - INFO -   Ventas: 3264 registros
2026-02-03 02:46:58 - INFO -   Costes: 22145 registros
2026-02-03 02:46:58 - INFO - Datos de ventas: 302 registros
2026-02-03 02:46:58 - INFO - Calculando pedido para semana 14 (302 registros)
2026-02-03 02:46:58 - INFO -   Objetivo: 4097.24€, Actual (ABC): 4019.19€
2026-02-03 02:46:58 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 02:46:58 - INFO -   Factor total: 1.3125
2026-02-03 02:46:58 - INFO -   Factor escalado: 1.3380
2026-02-03 02:46:58 - INFO -   Ventas preliminares (con ceil): 5809.66€
2026-02-03 02:46:58 - INFO -   Objetivo final: 5377.63€
2026-02-03 02:46:58 - INFO -   Delta: 432.03€
2026-02-03 02:46:58 - INFO -   Ventas finales: 5387.14€
2026-02-03 02:46:58 - INFO - 
============================================================
2026-02-03 02:46:58 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 02:46:58 - INFO - ============================================================
2026-02-03 02:46:58 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 02:46:58 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 02:46:58 - INFO - DataLoader inicializado correctamente
2026-02-03 02:46:58 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 02:46:58 - INFO - ============================================================
2026-02-03 02:46:58 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 02:46:58 - INFO - ============================================================
2026-02-03 02:46:58 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 02:46:58 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 02:46:58 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:46:58 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:46:58 - INFO - Leyendo archivo de corrección: ././data/input/Stock_actual.xlsx
2026-02-03 02:46:59 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:46:59 - INFO - Stock actual cargado: 30 registros
2026-02-03 02:46:59 - INFO -   Stock: 30 registros
2026-02-03 02:46:59 - WARNING - Archivo de corrección no encontrado: Ventas_semana.xlsx
2026-02-03 02:46:59 - WARNING - Archivo de corrección no encontrado: Ventas_semana_14.xlsx
2026-02-03 02:46:59 - WARNING - Archivo de corrección no encontrado: Ventas_Semana_14.xlsx
2026-02-03 02:46:59 - WARNING - Archivo de corrección no encontrado: Ventas-14.xlsx
2026-02-03 02:46:59 - WARNING - No se encontró archivo de ventas para semana 14
2026-02-03 02:46:59 - WARNING - Archivo de corrección no encontrado: Compras_semana.xlsx
2026-02-03 02:46:59 - WARNING - Archivo de corrección no encontrado: Compras_semana_14.xlsx
2026-02-03 02:46:59 - WARNING - Archivo de corrección no encontrado: Compras_Semana_14.xlsx
2026-02-03 02:46:59 - WARNING - Archivo de corrección no encontrado: Compras-14.xlsx
2026-02-03 02:46:59 - WARNING - No se encontró archivo de compras para semana 14
2026-02-03 02:46:59 - INFO - Datos de corrección cargados: 1/3 archivos
2026-02-03 02:46:59 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 02:46:59 - INFO - Fusión completada: 72 registros
2026-02-03 02:46:59 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 02:46:59 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 02:46:59 - INFO - Corrección completada:
2026-02-03 02:46:59 - INFO -   - Artículos corregidos: 71/72
2026-02-03 02:46:59 - INFO -   - Artículos aumentados: 71
2026-02-03 02:46:59 - INFO -   - Artículos reducidos: 0
2026-02-03 02:46:59 - WARNING - ALERTAS GENERADAS:
2026-02-03 02:46:59 - WARNING -   [ALTO] 72 artículos con stock en 0 o negativo
2026-02-03 02:46:59 - WARNING -   [MEDIO] 12 artículos con cambios superiores al 50%
2026-02-03 02:46:59 - INFO - 
RESUMEN DE CORRECCIÓN:
2026-02-03 02:46:59 - INFO -   Artículos corregidos: 71/72
2026-02-03 02:46:59 - INFO -   Porcentaje corregido: 98.6%
2026-02-03 02:46:59 - INFO -   Diferencia unidades: +212
2026-02-03 02:46:59 - INFO -   Porcentaje cambio: +36.0%
2026-02-03 02:46:59 - INFO - Archivo de pedido corregido generado: Pedido_Semana_14_2026-04-06_tierras_aridos_CORREGIDO.xlsx
2026-02-03 02:46:59 - INFO - Archivo corregido: Pedido_Semana_14_2026-04-06_tierras_aridos_CORREGIDO.xlsx
2026-02-03 02:46:59 - INFO - Generando archivo: ././data/output/Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx
2026-02-03 02:46:59 - INFO - Archivo guardado: ././data/output/Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx
2026-02-03 02:46:59 - INFO - Archivo generado: ././data/output/Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx
2026-02-03 02:46:59 - INFO -   Articulos: 71
2026-02-03 02:46:59 - INFO -   Importe: 5387.14€
2026-02-03 02:46:59 - INFO - 
==================================================
2026-02-03 02:46:59 - INFO - SECCION: DECO_EXTERIOR
2026-02-03 02:46:59 - INFO - ==================================================
2026-02-03 02:46:59 - INFO - === LEYENDO DATOS PARA SECCIÓN: DECO_EXTERIOR ===
2026-02-03 02:46:59 - WARNING - No se encontró archivo específico para 'deco_exterior', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:46:59 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:46:59 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 02:46:59 - INFO - Clasificación ABC cargada para 'deco_exterior': 555 registros
2026-02-03 02:46:59 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-03 02:47:04 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:47:04 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 02:47:04 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 02:47:04 - INFO - Ventas cargadas: 44082 registros
2026-02-03 02:47:04 - INFO - Filtrados 4018 registros de sección 'deco_exterior' de 44082 total
2026-02-03 02:47:04 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-03 02:47:07 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:47:07 - INFO - Costes cargados: 22145 registros
2026-02-03 02:47:07 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA DECO_EXTERIOR ===
2026-02-03 02:47:07 - INFO -   ABC: 555 registros
2026-02-03 02:47:07 - INFO -   Ventas: 4018 registros
2026-02-03 02:47:07 - INFO -   Costes: 22145 registros
2026-02-03 02:47:07 - INFO - Datos de ventas: 316 registros
2026-02-03 02:47:07 - INFO - Calculando pedido para semana 14 (316 registros)
2026-02-03 02:47:08 - INFO -   Objetivo: 3740.34€, Actual (ABC): 3720.75€
2026-02-03 02:47:08 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 02:47:08 - INFO -   Factor total: 1.3125
2026-02-03 02:47:08 - INFO -   Factor escalado: 1.3194
2026-02-03 02:47:08 - INFO -   Ventas preliminares (con ceil): 6159.28€
2026-02-03 02:47:08 - INFO -   Objetivo final: 4909.20€
2026-02-03 02:47:08 - INFO -   Delta: 1250.08€
2026-02-03 02:47:08 - INFO -   Ventas finales: 4934.68€
2026-02-03 02:47:08 - INFO - 
============================================================
2026-02-03 02:47:08 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 02:47:08 - INFO - ============================================================
2026-02-03 02:47:08 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 02:47:08 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 02:47:08 - INFO - DataLoader inicializado correctamente
2026-02-03 02:47:08 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 02:47:08 - INFO - ============================================================
2026-02-03 02:47:08 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 02:47:08 - INFO - ============================================================
2026-02-03 02:47:08 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 02:47:08 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 02:47:08 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:47:08 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:47:08 - INFO - Leyendo archivo de corrección: ././data/input/Stock_actual.xlsx
2026-02-03 02:47:08 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:47:08 - INFO - Stock actual cargado: 30 registros
2026-02-03 02:47:08 - INFO -   Stock: 30 registros
2026-02-03 02:47:08 - WARNING - Archivo de corrección no encontrado: Ventas_semana.xlsx
2026-02-03 02:47:08 - WARNING - Archivo de corrección no encontrado: Ventas_semana_14.xlsx
2026-02-03 02:47:08 - WARNING - Archivo de corrección no encontrado: Ventas_Semana_14.xlsx
2026-02-03 02:47:08 - WARNING - Archivo de corrección no encontrado: Ventas-14.xlsx
2026-02-03 02:47:08 - WARNING - No se encontró archivo de ventas para semana 14
2026-02-03 02:47:08 - WARNING - Archivo de corrección no encontrado: Compras_semana.xlsx
2026-02-03 02:47:08 - WARNING - Archivo de corrección no encontrado: Compras_semana_14.xlsx
2026-02-03 02:47:08 - WARNING - Archivo de corrección no encontrado: Compras_Semana_14.xlsx
2026-02-03 02:47:08 - WARNING - Archivo de corrección no encontrado: Compras-14.xlsx
2026-02-03 02:47:08 - WARNING - No se encontró archivo de compras para semana 14
2026-02-03 02:47:08 - INFO - Datos de corrección cargados: 1/3 archivos
2026-02-03 02:47:08 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 02:47:08 - INFO - Fusión completada: 224 registros
2026-02-03 02:47:08 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 02:47:08 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 02:47:08 - INFO - Corrección completada:
2026-02-03 02:47:08 - INFO -   - Artículos corregidos: 221/224
2026-02-03 02:47:08 - INFO -   - Artículos aumentados: 221
2026-02-03 02:47:08 - INFO -   - Artículos reducidos: 0
2026-02-03 02:47:08 - WARNING - ALERTAS GENERADAS:
2026-02-03 02:47:08 - WARNING -   [ALTO] 224 artículos con stock en 0 o negativo
2026-02-03 02:47:08 - WARNING -   [MEDIO] 99 artículos con cambios superiores al 50%
2026-02-03 02:47:08 - INFO - 
RESUMEN DE CORRECCIÓN:
2026-02-03 02:47:08 - INFO -   Artículos corregidos: 221/224
2026-02-03 02:47:08 - INFO -   Porcentaje corregido: 98.7%
2026-02-03 02:47:08 - INFO -   Diferencia unidades: +298
2026-02-03 02:47:08 - INFO -   Porcentaje cambio: +47.9%
2026-02-03 02:47:08 - INFO - Archivo de pedido corregido generado: Pedido_Semana_14_2026-04-06_deco_exterior_CORREGIDO.xlsx
2026-02-03 02:47:08 - INFO - Archivo corregido: Pedido_Semana_14_2026-04-06_deco_exterior_CORREGIDO.xlsx
2026-02-03 02:47:08 - INFO - Generando archivo: ././data/output/Pedido_Semana_14_2026-02-03_deco_exterior.xlsx
2026-02-03 02:47:08 - INFO - Archivo guardado: ././data/output/Pedido_Semana_14_2026-02-03_deco_exterior.xlsx
2026-02-03 02:47:08 - INFO - Archivo generado: ././data/output/Pedido_Semana_14_2026-02-03_deco_exterior.xlsx
2026-02-03 02:47:08 - INFO -   Articulos: 221
2026-02-03 02:47:08 - INFO -   Importe: 4934.68€
2026-02-03 02:47:08 - INFO - Estado guardado correctamente
2026-02-03 02:47:08 - INFO - Generando resumen: ././data/output/Resumen_Pedidos_VIVERO_2026-02-03.xlsx
2026-02-03 02:47:08 - INFO - Resumen guardado: ././data/output/Resumen_Pedidos_VIVERO_2026-02-03.xlsx
2026-02-03 02:47:08 - INFO - Estado guardado correctamente
2026-02-03 02:47:08 - INFO - 
======================================================================
2026-02-03 02:47:08 - INFO - RESUMEN DE EJECUCION
2026-02-03 02:47:08 - INFO - ======================================================================
2026-02-03 02:47:08 - INFO - Semana procesada: 14
2026-02-03 02:47:08 - INFO - Archivos generados: 23
2026-02-03 02:47:08 - INFO - Total articulos: 1702
2026-02-03 02:47:08 - INFO - Total importe: 48050.69€
2026-02-03 02:47:08 - INFO - 
MÉTRICAS DE CORRECCIÓN (FASE 2):
2026-02-03 02:47:08 - INFO - ----------------------------------------
2026-02-03 02:47:08 - INFO -   maf: 221 artículos corregidos
2026-02-03 02:47:08 - INFO -   deco_interior: 138 artículos corregidos
2026-02-03 02:47:08 - INFO -   semillas: 84 artículos corregidos
2026-02-03 02:47:08 - INFO -   mascotas_vivo: 43 artículos corregidos
2026-02-03 02:47:08 - INFO -   mascotas_manufacturado: 534 artículos corregidos
2026-02-03 02:47:08 - INFO -   interior: 121 artículos corregidos
2026-02-03 02:47:08 - INFO -   fitos: 84 artículos corregidos
2026-02-03 02:47:08 - INFO -   vivero: 107 artículos corregidos
2026-02-03 02:47:08 - INFO -   utiles_jardin: 78 artículos corregidos
2026-02-03 02:47:08 - INFO -   tierras_aridos: 71 artículos corregidos
2026-02-03 02:47:08 - INFO -   deco_exterior: 221 artículos corregidos
2026-02-03 02:47:08 - INFO -   TOTAL: 1702 artículos corregidos
2026-02-03 02:47:28 - INFO - ======================================================================
2026-02-03 02:47:28 - INFO - SISTEMA DE PEDIDOS DE COMPRA - VIVERO ARANJUEZ V2
2026-02-03 02:47:28 - INFO - Fecha de ejecucion: 2026-02-03 02:47:28
2026-02-03 02:47:28 - INFO - ======================================================================
2026-02-03 02:47:28 - INFO - Modo de ejecucion: FASE 1 + FASE 2
2026-02-03 02:47:28 - INFO - StateManager inicializado. Archivo de estado: ././data/state.json
2026-02-03 02:47:28 - INFO - Cargando estado desde: ././data/state.json
2026-02-03 02:47:28 - INFO - Estado cargado correctamente
2026-02-03 02:47:28 - INFO - SchedulerService inicializado correctamente
2026-02-03 02:47:28 - INFO - Horario configurado: sunday a las 15:00
2026-02-03 02:47:28 - INFO - Semana forzada por argumento: 14
2026-02-03 02:47:28 - INFO - ======================================================================
2026-02-03 02:47:28 - INFO - PROCESANDO PEDIDO PARA SEMANA 14
2026-02-03 02:47:28 - INFO - ======================================================================
2026-02-03 02:47:28 - INFO - MODO: FASE 1 (Forecast) + FASE 2 (Corrección)
2026-02-03 02:47:28 - INFO - DataLoader inicializado correctamente
2026-02-03 02:47:28 - INFO - ForecastEngine inicializado correctamente
2026-02-03 02:47:28 - INFO - OrderGenerator inicializado correctamente
2026-02-03 02:47:28 - INFO - SchedulerService inicializado correctamente
2026-02-03 02:47:28 - INFO - Horario configurado: sunday a las 15:00
2026-02-03 02:47:28 - INFO - Período de la semana: 2026-03-30 al 2026-04-05
2026-02-03 02:47:28 - INFO - Stock acumulado cargado: 1727 artículos
2026-02-03 02:47:28 - INFO - 
==================================================
2026-02-03 02:47:28 - INFO - SECCION: MAF
2026-02-03 02:47:28 - INFO - ==================================================
2026-02-03 02:47:28 - INFO - === LEYENDO DATOS PARA SECCIÓN: MAF ===
2026-02-03 02:47:28 - WARNING - No se encontró archivo específico para 'maf', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:47:28 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:47:29 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 02:47:29 - INFO - Clasificación ABC cargada para 'maf': 555 registros
2026-02-03 02:47:29 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-03 02:47:34 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:47:34 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 02:47:34 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 02:47:34 - INFO - Ventas cargadas: 44082 registros
2026-02-03 02:47:34 - INFO - Filtrados 10970 registros de sección 'maf' de 44082 total
2026-02-03 02:47:34 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-03 02:47:37 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:47:37 - INFO - Costes cargados: 22145 registros
2026-02-03 02:47:37 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MAF ===
2026-02-03 02:47:37 - INFO -   ABC: 555 registros
2026-02-03 02:47:37 - INFO -   Ventas: 10970 registros
2026-02-03 02:47:37 - INFO -   Costes: 22145 registros
2026-02-03 02:47:37 - INFO - Datos de ventas: 1011 registros
2026-02-03 02:47:37 - INFO - Calculando pedido para semana 14 (1011 registros)
2026-02-03 02:47:38 - INFO -   Objetivo: 7050.65€, Actual (ABC): 7177.24€
2026-02-03 02:47:38 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 02:47:38 - INFO -   Factor total: 1.3125
2026-02-03 02:47:38 - INFO -   Factor escalado: 1.2894
2026-02-03 02:47:38 - INFO -   Ventas preliminares (con ceil): 9955.95€
2026-02-03 02:47:38 - INFO -   Objetivo final: 9253.98€
2026-02-03 02:47:38 - INFO -   Delta: 701.97€
2026-02-03 02:47:38 - INFO -   Ventas finales: 9254.64€
2026-02-03 02:47:38 - INFO - 
============================================================
2026-02-03 02:47:38 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 02:47:38 - INFO - ============================================================
2026-02-03 02:47:38 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 02:47:38 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 02:47:38 - INFO - DataLoader inicializado correctamente
2026-02-03 02:47:38 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 02:47:38 - INFO - ============================================================
2026-02-03 02:47:38 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 02:47:38 - INFO - ============================================================
2026-02-03 02:47:38 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 02:47:38 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 02:47:38 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:47:38 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:47:38 - INFO - Leyendo archivo de corrección: ././data/input/Stock_actual.xlsx
2026-02-03 02:47:38 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:47:38 - INFO - Stock actual cargado: 30 registros
2026-02-03 02:47:38 - INFO -   Stock: 30 registros
2026-02-03 02:47:38 - WARNING - Archivo de corrección no encontrado: Ventas_semana.xlsx
2026-02-03 02:47:38 - WARNING - Archivo de corrección no encontrado: Ventas_semana_14.xlsx
2026-02-03 02:47:38 - WARNING - Archivo de corrección no encontrado: Ventas_Semana_14.xlsx
2026-02-03 02:47:38 - WARNING - Archivo de corrección no encontrado: Ventas-14.xlsx
2026-02-03 02:47:38 - WARNING - No se encontró archivo de ventas para semana 14
2026-02-03 02:47:38 - WARNING - Archivo de corrección no encontrado: Compras_semana.xlsx
2026-02-03 02:47:38 - WARNING - Archivo de corrección no encontrado: Compras_semana_14.xlsx
2026-02-03 02:47:38 - WARNING - Archivo de corrección no encontrado: Compras_Semana_14.xlsx
2026-02-03 02:47:38 - WARNING - Archivo de corrección no encontrado: Compras-14.xlsx
2026-02-03 02:47:38 - WARNING - No se encontró archivo de compras para semana 14
2026-02-03 02:47:38 - INFO - Datos de corrección cargados: 1/3 archivos
2026-02-03 02:47:38 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 02:47:38 - INFO - Fusión completada: 222 registros
2026-02-03 02:47:38 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 02:47:38 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 02:47:38 - INFO - Corrección completada:
2026-02-03 02:47:38 - INFO -   - Artículos corregidos: 221/222
2026-02-03 02:47:38 - INFO -   - Artículos aumentados: 221
2026-02-03 02:47:38 - INFO -   - Artículos reducidos: 0
2026-02-03 02:47:38 - WARNING - ALERTAS GENERADAS:
2026-02-03 02:47:38 - WARNING -   [ALTO] 222 artículos con stock en 0 o negativo
2026-02-03 02:47:38 - WARNING -   [MEDIO] 43 artículos con cambios superiores al 50%
2026-02-03 02:47:38 - INFO - 
RESUMEN DE CORRECCIÓN:
2026-02-03 02:47:38 - INFO -   Artículos corregidos: 221/222
2026-02-03 02:47:38 - INFO -   Porcentaje corregido: 99.5%
2026-02-03 02:47:38 - INFO -   Diferencia unidades: +746
2026-02-03 02:47:38 - INFO -   Porcentaje cambio: +34.4%
2026-02-03 02:47:38 - INFO - Archivo de pedido corregido generado: Pedido_Semana_14_2026-04-06_maf_CORREGIDO.xlsx
2026-02-03 02:47:38 - INFO - Archivo corregido: Pedido_Semana_14_2026-04-06_maf_CORREGIDO.xlsx
2026-02-03 02:47:38 - INFO - Generando archivo: ././data/output/Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 02:47:38 - INFO - Archivo guardado: ././data/output/Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 02:47:38 - INFO - Archivo generado: ././data/output/Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 02:47:38 - INFO -   Articulos: 221
2026-02-03 02:47:38 - INFO -   Importe: 9254.64€
2026-02-03 02:47:38 - INFO - 
==================================================
2026-02-03 02:47:38 - INFO - SECCION: DECO_INTERIOR
2026-02-03 02:47:38 - INFO - ==================================================
2026-02-03 02:47:38 - INFO - === LEYENDO DATOS PARA SECCIÓN: DECO_INTERIOR ===
2026-02-03 02:47:38 - WARNING - No se encontró archivo específico para 'deco_interior', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:47:38 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:47:38 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 02:47:38 - INFO - Clasificación ABC cargada para 'deco_interior': 555 registros
2026-02-03 02:47:38 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-03 02:47:43 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:47:43 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 02:47:44 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 02:47:44 - INFO - Ventas cargadas: 44082 registros
2026-02-03 02:47:44 - INFO - Filtrados 2468 registros de sección 'deco_interior' de 44082 total
2026-02-03 02:47:44 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-03 02:47:46 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:47:46 - INFO - Costes cargados: 22145 registros
2026-02-03 02:47:46 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA DECO_INTERIOR ===
2026-02-03 02:47:46 - INFO -   ABC: 555 registros
2026-02-03 02:47:46 - INFO -   Ventas: 2468 registros
2026-02-03 02:47:46 - INFO -   Costes: 22145 registros
2026-02-03 02:47:46 - INFO - Datos de ventas: 180 registros
2026-02-03 02:47:46 - INFO - Calculando pedido para semana 14 (180 registros)
2026-02-03 02:47:47 - INFO -   Objetivo: 1962.99€, Actual (ABC): 1494.40€
2026-02-03 02:47:47 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 02:47:47 - INFO -   Factor total: 1.3125
2026-02-03 02:47:47 - INFO -   Factor escalado: 1.7241
2026-02-03 02:47:47 - INFO -   Ventas preliminares (con ceil): 2961.52€
2026-02-03 02:47:47 - INFO -   Objetivo final: 2576.42€
2026-02-03 02:47:47 - INFO -   Delta: 385.10€
2026-02-03 02:47:47 - INFO -   Ventas finales: 2583.25€
2026-02-03 02:47:47 - INFO - 
============================================================
2026-02-03 02:47:47 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 02:47:47 - INFO - ============================================================
2026-02-03 02:47:47 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 02:47:47 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 02:47:47 - INFO - DataLoader inicializado correctamente
2026-02-03 02:47:47 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 02:47:47 - INFO - ============================================================
2026-02-03 02:47:47 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 02:47:47 - INFO - ============================================================
2026-02-03 02:47:47 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 02:47:47 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 02:47:47 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:47:47 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:47:47 - INFO - Leyendo archivo de corrección: ././data/input/Stock_actual.xlsx
2026-02-03 02:47:47 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:47:47 - INFO - Stock actual cargado: 30 registros
2026-02-03 02:47:47 - INFO -   Stock: 30 registros
2026-02-03 02:47:47 - WARNING - Archivo de corrección no encontrado: Ventas_semana.xlsx
2026-02-03 02:47:47 - WARNING - Archivo de corrección no encontrado: Ventas_semana_14.xlsx
2026-02-03 02:47:47 - WARNING - Archivo de corrección no encontrado: Ventas_Semana_14.xlsx
2026-02-03 02:47:47 - WARNING - Archivo de corrección no encontrado: Ventas-14.xlsx
2026-02-03 02:47:47 - WARNING - No se encontró archivo de ventas para semana 14
2026-02-03 02:47:47 - WARNING - Archivo de corrección no encontrado: Compras_semana.xlsx
2026-02-03 02:47:47 - WARNING - Archivo de corrección no encontrado: Compras_semana_14.xlsx
2026-02-03 02:47:47 - WARNING - Archivo de corrección no encontrado: Compras_Semana_14.xlsx
2026-02-03 02:47:47 - WARNING - Archivo de corrección no encontrado: Compras-14.xlsx
2026-02-03 02:47:47 - WARNING - No se encontró archivo de compras para semana 14
2026-02-03 02:47:47 - INFO - Datos de corrección cargados: 1/3 archivos
2026-02-03 02:47:47 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 02:47:47 - INFO - Fusión completada: 139 registros
2026-02-03 02:47:47 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 02:47:47 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 02:47:47 - INFO - Corrección completada:
2026-02-03 02:47:47 - INFO -   - Artículos corregidos: 138/139
2026-02-03 02:47:47 - INFO -   - Artículos aumentados: 138
2026-02-03 02:47:47 - INFO -   - Artículos reducidos: 0
2026-02-03 02:47:47 - WARNING - ALERTAS GENERADAS:
2026-02-03 02:47:47 - WARNING -   [ALTO] 139 artículos con stock en 0 o negativo
2026-02-03 02:47:47 - WARNING -   [MEDIO] 59 artículos con cambios superiores al 50%
2026-02-03 02:47:47 - INFO - 
RESUMEN DE CORRECCIÓN:
2026-02-03 02:47:47 - INFO -   Artículos corregidos: 138/139
2026-02-03 02:47:47 - INFO -   Porcentaje corregido: 99.3%
2026-02-03 02:47:47 - INFO -   Diferencia unidades: +172
2026-02-03 02:47:47 - INFO -   Porcentaje cambio: +51.3%
2026-02-03 02:47:47 - INFO - Archivo de pedido corregido generado: Pedido_Semana_14_2026-04-06_deco_interior_CORREGIDO.xlsx
2026-02-03 02:47:47 - INFO - Archivo corregido: Pedido_Semana_14_2026-04-06_deco_interior_CORREGIDO.xlsx
2026-02-03 02:47:47 - INFO - Generando archivo: ././data/output/Pedido_Semana_14_2026-02-03_deco_interior.xlsx
2026-02-03 02:47:47 - INFO - Archivo guardado: ././data/output/Pedido_Semana_14_2026-02-03_deco_interior.xlsx
2026-02-03 02:47:47 - INFO - Archivo generado: ././data/output/Pedido_Semana_14_2026-02-03_deco_interior.xlsx
2026-02-03 02:47:47 - INFO -   Articulos: 138
2026-02-03 02:47:47 - INFO -   Importe: 2583.25€
2026-02-03 02:47:47 - INFO - 
==================================================
2026-02-03 02:47:47 - INFO - SECCION: SEMILLAS
2026-02-03 02:47:47 - INFO - ==================================================
2026-02-03 02:47:47 - INFO - === LEYENDO DATOS PARA SECCIÓN: SEMILLAS ===
2026-02-03 02:47:47 - WARNING - No se encontró archivo específico para 'semillas', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:47:47 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:47:48 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 02:47:48 - INFO - Clasificación ABC cargada para 'semillas': 555 registros
2026-02-03 02:47:48 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-03 02:47:53 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:47:53 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 02:47:53 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 02:47:53 - INFO - Ventas cargadas: 44082 registros
2026-02-03 02:47:53 - INFO - Filtrados 1180 registros de sección 'semillas' de 44082 total
2026-02-03 02:47:53 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-03 02:47:56 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:47:56 - INFO - Costes cargados: 22145 registros
2026-02-03 02:47:56 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA SEMILLAS ===
2026-02-03 02:47:56 - INFO -   ABC: 555 registros
2026-02-03 02:47:56 - INFO -   Ventas: 1180 registros
2026-02-03 02:47:56 - INFO -   Costes: 22145 registros
2026-02-03 02:47:56 - INFO - Datos de ventas: 136 registros
2026-02-03 02:47:56 - INFO - Calculando pedido para semana 14 (136 registros)
2026-02-03 02:47:56 - INFO -   Objetivo: 694.34€, Actual (ABC): 566.70€
2026-02-03 02:47:56 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 02:47:56 - INFO -   Factor total: 1.3125
2026-02-03 02:47:56 - INFO -   Factor escalado: 1.6081
2026-02-03 02:47:56 - INFO -   Ventas preliminares (con ceil): 1062.05€
2026-02-03 02:47:56 - INFO -   Objetivo final: 911.32€
2026-02-03 02:47:56 - INFO -   Delta: 150.73€
2026-02-03 02:47:56 - INFO -   Ventas finales: 913.86€
2026-02-03 02:47:56 - INFO - 
============================================================
2026-02-03 02:47:56 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 02:47:56 - INFO - ============================================================
2026-02-03 02:47:56 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 02:47:56 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 02:47:56 - INFO - DataLoader inicializado correctamente
2026-02-03 02:47:56 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 02:47:56 - INFO - ============================================================
2026-02-03 02:47:56 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 02:47:56 - INFO - ============================================================
2026-02-03 02:47:56 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 02:47:56 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 02:47:56 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:47:56 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:47:56 - INFO - Leyendo archivo de corrección: ././data/input/Stock_actual.xlsx
2026-02-03 02:47:56 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:47:56 - INFO - Stock actual cargado: 30 registros
2026-02-03 02:47:56 - INFO -   Stock: 30 registros
2026-02-03 02:47:56 - WARNING - Archivo de corrección no encontrado: Ventas_semana.xlsx
2026-02-03 02:47:56 - WARNING - Archivo de corrección no encontrado: Ventas_semana_14.xlsx
2026-02-03 02:47:56 - WARNING - Archivo de corrección no encontrado: Ventas_Semana_14.xlsx
2026-02-03 02:47:56 - WARNING - Archivo de corrección no encontrado: Ventas-14.xlsx
2026-02-03 02:47:56 - WARNING - No se encontró archivo de ventas para semana 14
2026-02-03 02:47:56 - WARNING - Archivo de corrección no encontrado: Compras_semana.xlsx
2026-02-03 02:47:56 - WARNING - Archivo de corrección no encontrado: Compras_semana_14.xlsx
2026-02-03 02:47:56 - WARNING - Archivo de corrección no encontrado: Compras_Semana_14.xlsx
2026-02-03 02:47:56 - WARNING - Archivo de corrección no encontrado: Compras-14.xlsx
2026-02-03 02:47:56 - WARNING - No se encontró archivo de compras para semana 14
2026-02-03 02:47:56 - INFO - Datos de corrección cargados: 1/3 archivos
2026-02-03 02:47:56 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 02:47:56 - INFO - Fusión completada: 84 registros
2026-02-03 02:47:56 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 02:47:56 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 02:47:56 - INFO - Corrección completada:
2026-02-03 02:47:56 - INFO -   - Artículos corregidos: 84/84
2026-02-03 02:47:56 - INFO -   - Artículos aumentados: 84
2026-02-03 02:47:56 - INFO -   - Artículos reducidos: 0
2026-02-03 02:47:56 - WARNING - ALERTAS GENERADAS:
2026-02-03 02:47:56 - WARNING -   [ALTO] 84 artículos con stock en 0 o negativo
2026-02-03 02:47:56 - WARNING -   [MEDIO] 42 artículos con cambios superiores al 50%
2026-02-03 02:47:56 - INFO - 
RESUMEN DE CORRECCIÓN:
2026-02-03 02:47:56 - INFO -   Artículos corregidos: 84/84
2026-02-03 02:47:56 - INFO -   Porcentaje corregido: 100.0%
2026-02-03 02:47:56 - INFO -   Diferencia unidades: +108
2026-02-03 02:47:56 - INFO -   Porcentaje cambio: +51.9%
2026-02-03 02:47:56 - INFO - Archivo de pedido corregido generado: Pedido_Semana_14_2026-04-06_semillas_CORREGIDO.xlsx
2026-02-03 02:47:56 - INFO - Archivo corregido: Pedido_Semana_14_2026-04-06_semillas_CORREGIDO.xlsx
2026-02-03 02:47:56 - INFO - Generando archivo: ././data/output/Pedido_Semana_14_2026-02-03_semillas.xlsx
2026-02-03 02:47:56 - INFO - Archivo guardado: ././data/output/Pedido_Semana_14_2026-02-03_semillas.xlsx
2026-02-03 02:47:56 - INFO - Archivo generado: ././data/output/Pedido_Semana_14_2026-02-03_semillas.xlsx
2026-02-03 02:47:56 - INFO -   Articulos: 84
2026-02-03 02:47:56 - INFO -   Importe: 913.86€
2026-02-03 02:47:56 - INFO - 
==================================================
2026-02-03 02:47:56 - INFO - SECCION: MASCOTAS_VIVO
2026-02-03 02:47:56 - INFO - ==================================================
2026-02-03 02:47:56 - INFO - === LEYENDO DATOS PARA SECCIÓN: MASCOTAS_VIVO ===
2026-02-03 02:47:56 - WARNING - No se encontró archivo específico para 'mascotas_vivo', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:47:56 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:47:57 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 02:47:57 - INFO - Clasificación ABC cargada para 'mascotas_vivo': 555 registros
2026-02-03 02:47:57 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-03 02:48:02 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:48:02 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 02:48:02 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 02:48:02 - INFO - Ventas cargadas: 44082 registros
2026-02-03 02:48:02 - INFO - Filtrados 1124 registros de sección 'mascotas_vivo' de 44082 total
2026-02-03 02:48:02 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-03 02:48:05 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:48:05 - INFO - Costes cargados: 22145 registros
2026-02-03 02:48:05 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MASCOTAS_VIVO ===
2026-02-03 02:48:05 - INFO -   ABC: 555 registros
2026-02-03 02:48:05 - INFO -   Ventas: 1124 registros
2026-02-03 02:48:05 - INFO -   Costes: 22145 registros
2026-02-03 02:48:05 - INFO - Datos de ventas: 88 registros
2026-02-03 02:48:05 - INFO - Calculando pedido para semana 14 (88 registros)
2026-02-03 02:48:05 - INFO -   Objetivo: 1087.15€, Actual (ABC): 1144.11€
2026-02-03 02:48:05 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 02:48:05 - INFO -   Factor total: 1.3125
2026-02-03 02:48:05 - INFO -   Factor escalado: 1.2472
2026-02-03 02:48:05 - INFO -   Ventas preliminares (con ceil): 1759.51€
2026-02-03 02:48:05 - INFO -   Objetivo final: 1426.88€
2026-02-03 02:48:05 - INFO -   Delta: 332.63€
2026-02-03 02:48:05 - INFO -   Ventas finales: 1451.48€
2026-02-03 02:48:05 - INFO - 
============================================================
2026-02-03 02:48:05 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 02:48:05 - INFO - ============================================================
2026-02-03 02:48:05 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 02:48:05 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 02:48:05 - INFO - DataLoader inicializado correctamente
2026-02-03 02:48:05 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 02:48:05 - INFO - ============================================================
2026-02-03 02:48:05 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 02:48:05 - INFO - ============================================================
2026-02-03 02:48:05 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 02:48:05 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 02:48:05 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:48:05 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:48:05 - INFO - Leyendo archivo de corrección: ././data/input/Stock_actual.xlsx
2026-02-03 02:48:05 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:48:05 - INFO - Stock actual cargado: 30 registros
2026-02-03 02:48:05 - INFO -   Stock: 30 registros
2026-02-03 02:48:05 - WARNING - Archivo de corrección no encontrado: Ventas_semana.xlsx
2026-02-03 02:48:05 - WARNING - Archivo de corrección no encontrado: Ventas_semana_14.xlsx
2026-02-03 02:48:05 - WARNING - Archivo de corrección no encontrado: Ventas_Semana_14.xlsx
2026-02-03 02:48:05 - WARNING - Archivo de corrección no encontrado: Ventas-14.xlsx
2026-02-03 02:48:05 - WARNING - No se encontró archivo de ventas para semana 14
2026-02-03 02:48:05 - WARNING - Archivo de corrección no encontrado: Compras_semana.xlsx
2026-02-03 02:48:05 - WARNING - Archivo de corrección no encontrado: Compras_semana_14.xlsx
2026-02-03 02:48:05 - WARNING - Archivo de corrección no encontrado: Compras_Semana_14.xlsx
2026-02-03 02:48:05 - WARNING - Archivo de corrección no encontrado: Compras-14.xlsx
2026-02-03 02:48:05 - WARNING - No se encontró archivo de compras para semana 14
2026-02-03 02:48:05 - INFO - Datos de corrección cargados: 1/3 archivos
2026-02-03 02:48:05 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 02:48:05 - INFO - Fusión completada: 43 registros
2026-02-03 02:48:05 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 02:48:05 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 02:48:05 - INFO - Corrección completada:
2026-02-03 02:48:05 - INFO -   - Artículos corregidos: 43/43
2026-02-03 02:48:05 - INFO -   - Artículos aumentados: 43
2026-02-03 02:48:05 - INFO -   - Artículos reducidos: 0
2026-02-03 02:48:05 - WARNING - ALERTAS GENERADAS:
2026-02-03 02:48:05 - WARNING -   [ALTO] 43 artículos con stock en 0 o negativo
2026-02-03 02:48:05 - WARNING -   [MEDIO] 16 artículos con cambios superiores al 50%
2026-02-03 02:48:05 - INFO - 
RESUMEN DE CORRECCIÓN:
2026-02-03 02:48:05 - INFO -   Artículos corregidos: 43/43
2026-02-03 02:48:05 - INFO -   Porcentaje corregido: 100.0%
2026-02-03 02:48:05 - INFO -   Diferencia unidades: +84
2026-02-03 02:48:05 - INFO -   Porcentaje cambio: +43.8%
2026-02-03 02:48:05 - INFO - Archivo de pedido corregido generado: Pedido_Semana_14_2026-04-06_mascotas_vivo_CORREGIDO.xlsx
2026-02-03 02:48:05 - INFO - Archivo corregido: Pedido_Semana_14_2026-04-06_mascotas_vivo_CORREGIDO.xlsx
2026-02-03 02:48:05 - INFO - Generando archivo: ././data/output/Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx
2026-02-03 02:48:05 - INFO - Archivo guardado: ././data/output/Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx
2026-02-03 02:48:05 - INFO - Archivo generado: ././data/output/Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx
2026-02-03 02:48:05 - INFO -   Articulos: 43
2026-02-03 02:48:05 - INFO -   Importe: 1451.48€
2026-02-03 02:48:05 - INFO - 
==================================================
2026-02-03 02:48:05 - INFO - SECCION: MASCOTAS_MANUFACTURADO
2026-02-03 02:48:05 - INFO - ==================================================
2026-02-03 02:48:05 - INFO - === LEYENDO DATOS PARA SECCIÓN: MASCOTAS_MANUFACTURADO ===
2026-02-03 02:48:05 - WARNING - No se encontró archivo específico para 'mascotas_manufacturado', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:48:05 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:48:05 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 02:48:05 - INFO - Clasificación ABC cargada para 'mascotas_manufacturado': 555 registros
2026-02-03 02:48:05 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-03 02:48:11 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:48:11 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 02:48:11 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 02:48:11 - INFO - Ventas cargadas: 44082 registros
2026-02-03 02:48:11 - INFO - Filtrados 9784 registros de sección 'mascotas_manufacturado' de 44082 total
2026-02-03 02:48:11 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-03 02:48:13 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:48:13 - INFO - Costes cargados: 22145 registros
2026-02-03 02:48:13 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MASCOTAS_MANUFACTURADO ===
2026-02-03 02:48:13 - INFO -   ABC: 555 registros
2026-02-03 02:48:13 - INFO -   Ventas: 9784 registros
2026-02-03 02:48:13 - INFO -   Costes: 22145 registros
2026-02-03 02:48:14 - INFO - Datos de ventas: 822 registros
2026-02-03 02:48:14 - INFO - Calculando pedido para semana 14 (822 registros)
2026-02-03 02:48:16 - INFO -   Objetivo: 6839.82€, Actual (ABC): 8422.22€
2026-02-03 02:48:16 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 02:48:16 - INFO -   Factor total: 1.3125
2026-02-03 02:48:16 - INFO -   Factor escalado: 1.0659
2026-02-03 02:48:16 - INFO -   Ventas preliminares (con ceil): 14128.59€
2026-02-03 02:48:16 - INFO -   Objetivo final: 8977.26€
2026-02-03 02:48:16 - INFO -   Delta: 5151.33€
2026-02-03 02:48:16 - INFO -   Ventas finales: 8979.81€
2026-02-03 02:48:16 - INFO - 
============================================================
2026-02-03 02:48:16 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 02:48:16 - INFO - ============================================================
2026-02-03 02:48:16 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 02:48:16 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 02:48:16 - INFO - DataLoader inicializado correctamente
2026-02-03 02:48:16 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 02:48:16 - INFO - ============================================================
2026-02-03 02:48:16 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 02:48:16 - INFO - ============================================================
2026-02-03 02:48:16 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 02:48:16 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 02:48:16 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:48:16 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:48:16 - INFO - Leyendo archivo de corrección: ././data/input/Stock_actual.xlsx
2026-02-03 02:48:16 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:48:16 - INFO - Stock actual cargado: 30 registros
2026-02-03 02:48:16 - INFO -   Stock: 30 registros
2026-02-03 02:48:16 - WARNING - Archivo de corrección no encontrado: Ventas_semana.xlsx
2026-02-03 02:48:16 - WARNING - Archivo de corrección no encontrado: Ventas_semana_14.xlsx
2026-02-03 02:48:16 - WARNING - Archivo de corrección no encontrado: Ventas_Semana_14.xlsx
2026-02-03 02:48:16 - WARNING - Archivo de corrección no encontrado: Ventas-14.xlsx
2026-02-03 02:48:16 - WARNING - No se encontró archivo de ventas para semana 14
2026-02-03 02:48:16 - WARNING - Archivo de corrección no encontrado: Compras_semana.xlsx
2026-02-03 02:48:16 - WARNING - Archivo de corrección no encontrado: Compras_semana_14.xlsx
2026-02-03 02:48:16 - WARNING - Archivo de corrección no encontrado: Compras_Semana_14.xlsx
2026-02-03 02:48:16 - WARNING - Archivo de corrección no encontrado: Compras-14.xlsx
2026-02-03 02:48:16 - WARNING - No se encontró archivo de compras para semana 14
2026-02-03 02:48:16 - INFO - Datos de corrección cargados: 1/3 archivos
2026-02-03 02:48:16 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 02:48:16 - INFO - Fusión completada: 538 registros
2026-02-03 02:48:16 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 02:48:16 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 02:48:16 - INFO - Corrección completada:
2026-02-03 02:48:16 - INFO -   - Artículos corregidos: 534/538
2026-02-03 02:48:16 - INFO -   - Artículos aumentados: 534
2026-02-03 02:48:16 - INFO -   - Artículos reducidos: 0
2026-02-03 02:48:16 - WARNING - ALERTAS GENERADAS:
2026-02-03 02:48:16 - WARNING -   [ALTO] 538 artículos con stock en 0 o negativo
2026-02-03 02:48:16 - WARNING -   [MEDIO] 321 artículos con cambios superiores al 50%
2026-02-03 02:48:16 - INFO - 
RESUMEN DE CORRECCIÓN:
2026-02-03 02:48:16 - INFO -   Artículos corregidos: 534/538
2026-02-03 02:48:16 - INFO -   Porcentaje corregido: 99.3%
2026-02-03 02:48:16 - INFO -   Diferencia unidades: +660
2026-02-03 02:48:16 - INFO -   Porcentaje cambio: +56.0%
2026-02-03 02:48:16 - INFO - Archivo de pedido corregido generado: Pedido_Semana_14_2026-04-06_mascotas_manufacturado_CORREGIDO.xlsx
2026-02-03 02:48:16 - INFO - Archivo corregido: Pedido_Semana_14_2026-04-06_mascotas_manufacturado_CORREGIDO.xlsx
2026-02-03 02:48:16 - INFO - Generando archivo: ././data/output/Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx
2026-02-03 02:48:16 - INFO - Archivo guardado: ././data/output/Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx
2026-02-03 02:48:16 - INFO - Archivo generado: ././data/output/Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx
2026-02-03 02:48:16 - INFO -   Articulos: 534
2026-02-03 02:48:16 - INFO -   Importe: 8979.81€
2026-02-03 02:48:16 - INFO - 
==================================================
2026-02-03 02:48:16 - INFO - SECCION: INTERIOR
2026-02-03 02:48:16 - INFO - ==================================================
2026-02-03 02:48:16 - INFO - === LEYENDO DATOS PARA SECCIÓN: INTERIOR ===
2026-02-03 02:48:16 - WARNING - No se encontró archivo específico para 'interior', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:48:16 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:48:16 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 02:48:16 - INFO - Clasificación ABC cargada para 'interior': 555 registros
2026-02-03 02:48:16 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-03 02:48:22 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:48:22 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 02:48:22 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 02:48:22 - INFO - Ventas cargadas: 44082 registros
2026-02-03 02:48:22 - INFO - Filtrados 3624 registros de sección 'interior' de 44082 total
2026-02-03 02:48:22 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-03 02:48:25 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:48:25 - INFO - Costes cargados: 22145 registros
2026-02-03 02:48:25 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA INTERIOR ===
2026-02-03 02:48:25 - INFO -   ABC: 555 registros
2026-02-03 02:48:25 - INFO -   Ventas: 3624 registros
2026-02-03 02:48:25 - INFO -   Costes: 22145 registros
2026-02-03 02:48:25 - INFO - Datos de ventas: 286 registros
2026-02-03 02:48:25 - INFO - Calculando pedido para semana 14 (286 registros)
2026-02-03 02:48:25 - INFO -   Objetivo: 2930.63€, Actual (ABC): 2409.44€
2026-02-03 02:48:25 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 02:48:25 - INFO -   Factor total: 1.3125
2026-02-03 02:48:25 - INFO -   Factor escalado: 1.5964
2026-02-03 02:48:25 - INFO -   Ventas preliminares (con ceil): 4541.81€
2026-02-03 02:48:25 - INFO -   Objetivo final: 3846.45€
2026-02-03 02:48:25 - INFO -   Delta: 695.36€
2026-02-03 02:48:25 - INFO -   Ventas finales: 3855.17€
2026-02-03 02:48:25 - INFO - 
============================================================
2026-02-03 02:48:25 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 02:48:25 - INFO - ============================================================
2026-02-03 02:48:25 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 02:48:25 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 02:48:25 - INFO - DataLoader inicializado correctamente
2026-02-03 02:48:25 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 02:48:25 - INFO - ============================================================
2026-02-03 02:48:25 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 02:48:25 - INFO - ============================================================
2026-02-03 02:48:25 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 02:48:25 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 02:48:25 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:48:25 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:48:25 - INFO - Leyendo archivo de corrección: ././data/input/Stock_actual.xlsx
2026-02-03 02:48:25 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:48:25 - INFO - Stock actual cargado: 30 registros
2026-02-03 02:48:25 - INFO -   Stock: 30 registros
2026-02-03 02:48:25 - WARNING - Archivo de corrección no encontrado: Ventas_semana.xlsx
2026-02-03 02:48:25 - WARNING - Archivo de corrección no encontrado: Ventas_semana_14.xlsx
2026-02-03 02:48:25 - WARNING - Archivo de corrección no encontrado: Ventas_Semana_14.xlsx
2026-02-03 02:48:25 - WARNING - Archivo de corrección no encontrado: Ventas-14.xlsx
2026-02-03 02:48:25 - WARNING - No se encontró archivo de ventas para semana 14
2026-02-03 02:48:25 - WARNING - Archivo de corrección no encontrado: Compras_semana.xlsx
2026-02-03 02:48:25 - WARNING - Archivo de corrección no encontrado: Compras_semana_14.xlsx
2026-02-03 02:48:25 - WARNING - Archivo de corrección no encontrado: Compras_Semana_14.xlsx
2026-02-03 02:48:25 - WARNING - Archivo de corrección no encontrado: Compras-14.xlsx
2026-02-03 02:48:25 - WARNING - No se encontró archivo de compras para semana 14
2026-02-03 02:48:25 - INFO - Datos de corrección cargados: 1/3 archivos
2026-02-03 02:48:25 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 02:48:25 - INFO - Fusión completada: 138 registros
2026-02-03 02:48:25 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 02:48:25 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 02:48:25 - INFO - Corrección completada:
2026-02-03 02:48:25 - INFO -   - Artículos corregidos: 121/138
2026-02-03 02:48:25 - INFO -   - Artículos aumentados: 121
2026-02-03 02:48:25 - INFO -   - Artículos reducidos: 0
2026-02-03 02:48:25 - WARNING - ALERTAS GENERADAS:
2026-02-03 02:48:25 - WARNING -   [ALTO] 138 artículos con stock en 0 o negativo
2026-02-03 02:48:25 - WARNING -   [MEDIO] 45 artículos con cambios superiores al 50%
2026-02-03 02:48:25 - INFO - 
RESUMEN DE CORRECCIÓN:
2026-02-03 02:48:25 - INFO -   Artículos corregidos: 121/138
2026-02-03 02:48:25 - INFO -   Porcentaje corregido: 87.7%
2026-02-03 02:48:25 - INFO -   Diferencia unidades: +199
2026-02-03 02:48:25 - INFO -   Porcentaje cambio: +43.8%
2026-02-03 02:48:25 - INFO - Archivo de pedido corregido generado: Pedido_Semana_14_2026-04-06_interior_CORREGIDO.xlsx
2026-02-03 02:48:25 - INFO - Archivo corregido: Pedido_Semana_14_2026-04-06_interior_CORREGIDO.xlsx
2026-02-03 02:48:25 - INFO - Generando archivo: ././data/output/Pedido_Semana_14_2026-02-03_interior.xlsx
2026-02-03 02:48:26 - INFO - Archivo guardado: ././data/output/Pedido_Semana_14_2026-02-03_interior.xlsx
2026-02-03 02:48:26 - INFO - Archivo generado: ././data/output/Pedido_Semana_14_2026-02-03_interior.xlsx
2026-02-03 02:48:26 - INFO -   Articulos: 121
2026-02-03 02:48:26 - INFO -   Importe: 3855.17€
2026-02-03 02:48:26 - INFO - 
==================================================
2026-02-03 02:48:26 - INFO - SECCION: FITOS
2026-02-03 02:48:26 - INFO - ==================================================
2026-02-03 02:48:26 - INFO - === LEYENDO DATOS PARA SECCIÓN: FITOS ===
2026-02-03 02:48:26 - WARNING - No se encontró archivo específico para 'fitos', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:48:26 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:48:26 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 02:48:26 - INFO - Clasificación ABC cargada para 'fitos': 555 registros
2026-02-03 02:48:26 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-03 02:48:31 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:48:31 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 02:48:31 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 02:48:31 - INFO - Ventas cargadas: 44082 registros
2026-02-03 02:48:31 - INFO - Filtrados 1987 registros de sección 'fitos' de 44082 total
2026-02-03 02:48:31 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-03 02:48:34 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:48:34 - INFO - Costes cargados: 22145 registros
2026-02-03 02:48:34 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA FITOS ===
2026-02-03 02:48:34 - INFO -   ABC: 555 registros
2026-02-03 02:48:34 - INFO -   Ventas: 1987 registros
2026-02-03 02:48:34 - INFO -   Costes: 22145 registros
2026-02-03 02:48:34 - INFO - Datos de ventas: 157 registros
2026-02-03 02:48:34 - INFO - Calculando pedido para semana 14 (157 registros)
2026-02-03 02:48:34 - INFO -   Objetivo: 1798.25€, Actual (ABC): 1585.02€
2026-02-03 02:48:34 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 02:48:34 - INFO -   Factor total: 1.3125
2026-02-03 02:48:34 - INFO -   Factor escalado: 1.4891
2026-02-03 02:48:34 - INFO -   Ventas preliminares (con ceil): 2690.29€
2026-02-03 02:48:34 - INFO -   Objetivo final: 2360.20€
2026-02-03 02:48:34 - INFO -   Delta: 330.09€
2026-02-03 02:48:34 - INFO -   Ventas finales: 2361.02€
2026-02-03 02:48:34 - INFO - 
============================================================
2026-02-03 02:48:34 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 02:48:34 - INFO - ============================================================
2026-02-03 02:48:34 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 02:48:34 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 02:48:34 - INFO - DataLoader inicializado correctamente
2026-02-03 02:48:34 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 02:48:34 - INFO - ============================================================
2026-02-03 02:48:34 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 02:48:34 - INFO - ============================================================
2026-02-03 02:48:34 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 02:48:34 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 02:48:34 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:48:34 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:48:34 - INFO - Leyendo archivo de corrección: ././data/input/Stock_actual.xlsx
2026-02-03 02:48:34 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:48:34 - INFO - Stock actual cargado: 30 registros
2026-02-03 02:48:34 - INFO -   Stock: 30 registros
2026-02-03 02:48:34 - WARNING - Archivo de corrección no encontrado: Ventas_semana.xlsx
2026-02-03 02:48:34 - WARNING - Archivo de corrección no encontrado: Ventas_semana_14.xlsx
2026-02-03 02:48:34 - WARNING - Archivo de corrección no encontrado: Ventas_Semana_14.xlsx
2026-02-03 02:48:34 - WARNING - Archivo de corrección no encontrado: Ventas-14.xlsx
2026-02-03 02:48:34 - WARNING - No se encontró archivo de ventas para semana 14
2026-02-03 02:48:34 - WARNING - Archivo de corrección no encontrado: Compras_semana.xlsx
2026-02-03 02:48:34 - WARNING - Archivo de corrección no encontrado: Compras_semana_14.xlsx
2026-02-03 02:48:34 - WARNING - Archivo de corrección no encontrado: Compras_Semana_14.xlsx
2026-02-03 02:48:34 - WARNING - Archivo de corrección no encontrado: Compras-14.xlsx
2026-02-03 02:48:34 - WARNING - No se encontró archivo de compras para semana 14
2026-02-03 02:48:34 - INFO - Datos de corrección cargados: 1/3 archivos
2026-02-03 02:48:34 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 02:48:34 - INFO - Fusión completada: 84 registros
2026-02-03 02:48:34 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 02:48:34 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 02:48:34 - INFO - Corrección completada:
2026-02-03 02:48:34 - INFO -   - Artículos corregidos: 84/84
2026-02-03 02:48:34 - INFO -   - Artículos aumentados: 84
2026-02-03 02:48:34 - INFO -   - Artículos reducidos: 0
2026-02-03 02:48:34 - WARNING - ALERTAS GENERADAS:
2026-02-03 02:48:34 - WARNING -   [ALTO] 84 artículos con stock en 0 o negativo
2026-02-03 02:48:34 - WARNING -   [MEDIO] 19 artículos con cambios superiores al 50%
2026-02-03 02:48:34 - INFO - 
RESUMEN DE CORRECCIÓN:
2026-02-03 02:48:34 - INFO -   Artículos corregidos: 84/84
2026-02-03 02:48:34 - INFO -   Porcentaje corregido: 100.0%
2026-02-03 02:48:34 - INFO -   Diferencia unidades: +113
2026-02-03 02:48:34 - INFO -   Porcentaje cambio: +46.9%
2026-02-03 02:48:35 - INFO - Archivo de pedido corregido generado: Pedido_Semana_14_2026-04-06_fitos_CORREGIDO.xlsx
2026-02-03 02:48:35 - INFO - Archivo corregido: Pedido_Semana_14_2026-04-06_fitos_CORREGIDO.xlsx
2026-02-03 02:48:35 - INFO - Generando archivo: ././data/output/Pedido_Semana_14_2026-02-03_fitos.xlsx
2026-02-03 02:48:35 - INFO - Archivo guardado: ././data/output/Pedido_Semana_14_2026-02-03_fitos.xlsx
2026-02-03 02:48:35 - INFO - Archivo generado: ././data/output/Pedido_Semana_14_2026-02-03_fitos.xlsx
2026-02-03 02:48:35 - INFO -   Articulos: 84
2026-02-03 02:48:35 - INFO -   Importe: 2361.02€
2026-02-03 02:48:35 - INFO - 
==================================================
2026-02-03 02:48:35 - INFO - SECCION: VIVERO
2026-02-03 02:48:35 - INFO - ==================================================
2026-02-03 02:48:35 - INFO - === LEYENDO DATOS PARA SECCIÓN: VIVERO ===
2026-02-03 02:48:35 - WARNING - No se encontró archivo específico para 'vivero', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:48:35 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:48:35 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 02:48:35 - INFO - Clasificación ABC cargada para 'vivero': 555 registros
2026-02-03 02:48:35 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-03 02:48:40 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:48:40 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 02:48:40 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 02:48:40 - INFO - Ventas cargadas: 44082 registros
2026-02-03 02:48:40 - INFO - Filtrados 2460 registros de sección 'vivero' de 44082 total
2026-02-03 02:48:40 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-03 02:48:43 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:48:43 - INFO - Costes cargados: 22145 registros
2026-02-03 02:48:43 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA VIVERO ===
2026-02-03 02:48:43 - INFO -   ABC: 555 registros
2026-02-03 02:48:43 - INFO -   Ventas: 2460 registros
2026-02-03 02:48:43 - INFO -   Costes: 22145 registros
2026-02-03 02:48:43 - INFO - Datos de ventas: 189 registros
2026-02-03 02:48:43 - INFO - Calculando pedido para semana 14 (189 registros)
2026-02-03 02:48:43 - INFO -   Objetivo: 5297.17€, Actual (ABC): 4464.03€
2026-02-03 02:48:43 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 02:48:43 - INFO -   Factor total: 1.3125
2026-02-03 02:48:43 - INFO -   Factor escalado: 1.5575
2026-02-03 02:48:43 - INFO -   Ventas preliminares (con ceil): 8225.51€
2026-02-03 02:48:43 - INFO -   Objetivo final: 6952.54€
2026-02-03 02:48:43 - INFO -   Delta: 1272.97€
2026-02-03 02:48:43 - INFO -   Ventas finales: 6955.79€
2026-02-03 02:48:43 - INFO - 
============================================================
2026-02-03 02:48:43 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 02:48:43 - INFO - ============================================================
2026-02-03 02:48:43 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 02:48:43 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 02:48:43 - INFO - DataLoader inicializado correctamente
2026-02-03 02:48:43 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 02:48:43 - INFO - ============================================================
2026-02-03 02:48:43 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 02:48:43 - INFO - ============================================================
2026-02-03 02:48:43 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 02:48:43 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 02:48:43 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:48:43 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:48:43 - INFO - Leyendo archivo de corrección: ././data/input/Stock_actual.xlsx
2026-02-03 02:48:43 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:48:43 - INFO - Stock actual cargado: 30 registros
2026-02-03 02:48:43 - INFO -   Stock: 30 registros
2026-02-03 02:48:43 - WARNING - Archivo de corrección no encontrado: Ventas_semana.xlsx
2026-02-03 02:48:43 - WARNING - Archivo de corrección no encontrado: Ventas_semana_14.xlsx
2026-02-03 02:48:43 - WARNING - Archivo de corrección no encontrado: Ventas_Semana_14.xlsx
2026-02-03 02:48:43 - WARNING - Archivo de corrección no encontrado: Ventas-14.xlsx
2026-02-03 02:48:43 - WARNING - No se encontró archivo de ventas para semana 14
2026-02-03 02:48:43 - WARNING - Archivo de corrección no encontrado: Compras_semana.xlsx
2026-02-03 02:48:43 - WARNING - Archivo de corrección no encontrado: Compras_semana_14.xlsx
2026-02-03 02:48:43 - WARNING - Archivo de corrección no encontrado: Compras_Semana_14.xlsx
2026-02-03 02:48:43 - WARNING - Archivo de corrección no encontrado: Compras-14.xlsx
2026-02-03 02:48:43 - WARNING - No se encontró archivo de compras para semana 14
2026-02-03 02:48:43 - INFO - Datos de corrección cargados: 1/3 archivos
2026-02-03 02:48:44 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 02:48:44 - INFO - Fusión completada: 107 registros
2026-02-03 02:48:44 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 02:48:44 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 02:48:44 - INFO - Corrección completada:
2026-02-03 02:48:44 - INFO -   - Artículos corregidos: 107/107
2026-02-03 02:48:44 - INFO -   - Artículos aumentados: 107
2026-02-03 02:48:44 - INFO -   - Artículos reducidos: 0
2026-02-03 02:48:44 - WARNING - ALERTAS GENERADAS:
2026-02-03 02:48:44 - WARNING -   [ALTO] 107 artículos con stock en 0 o negativo
2026-02-03 02:48:44 - WARNING -   [MEDIO] 44 artículos con cambios superiores al 50%
2026-02-03 02:48:44 - INFO - 
RESUMEN DE CORRECCIÓN:
2026-02-03 02:48:44 - INFO -   Artículos corregidos: 107/107
2026-02-03 02:48:44 - INFO -   Porcentaje corregido: 100.0%
2026-02-03 02:48:44 - INFO -   Diferencia unidades: +172
2026-02-03 02:48:44 - INFO -   Porcentaje cambio: +44.8%
2026-02-03 02:48:44 - INFO - Archivo de pedido corregido generado: Pedido_Semana_14_2026-04-06_vivero_CORREGIDO.xlsx
2026-02-03 02:48:44 - INFO - Archivo corregido: Pedido_Semana_14_2026-04-06_vivero_CORREGIDO.xlsx
2026-02-03 02:48:44 - INFO - Generando archivo: ././data/output/Pedido_Semana_14_2026-02-03_vivero.xlsx
2026-02-03 02:48:44 - INFO - Archivo guardado: ././data/output/Pedido_Semana_14_2026-02-03_vivero.xlsx
2026-02-03 02:48:44 - INFO - Archivo generado: ././data/output/Pedido_Semana_14_2026-02-03_vivero.xlsx
2026-02-03 02:48:44 - INFO -   Articulos: 107
2026-02-03 02:48:44 - INFO -   Importe: 6955.79€
2026-02-03 02:48:44 - INFO - 
==================================================
2026-02-03 02:48:44 - INFO - SECCION: UTILES_JARDIN
2026-02-03 02:48:44 - INFO - ==================================================
2026-02-03 02:48:44 - INFO - === LEYENDO DATOS PARA SECCIÓN: UTILES_JARDIN ===
2026-02-03 02:48:44 - WARNING - No se encontró archivo específico para 'utiles_jardin', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:48:44 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:48:44 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 02:48:44 - INFO - Clasificación ABC cargada para 'utiles_jardin': 555 registros
2026-02-03 02:48:44 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-03 02:48:49 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:48:49 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 02:48:49 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 02:48:49 - INFO - Ventas cargadas: 44082 registros
2026-02-03 02:48:49 - INFO - Filtrados 1009 registros de sección 'utiles_jardin' de 44082 total
2026-02-03 02:48:49 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-03 02:48:52 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:48:52 - INFO - Costes cargados: 22145 registros
2026-02-03 02:48:52 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA UTILES_JARDIN ===
2026-02-03 02:48:52 - INFO -   ABC: 555 registros
2026-02-03 02:48:52 - INFO -   Ventas: 1009 registros
2026-02-03 02:48:52 - INFO -   Costes: 22145 registros
2026-02-03 02:48:52 - INFO - Datos de ventas: 89 registros
2026-02-03 02:48:52 - INFO - Calculando pedido para semana 14 (89 registros)
2026-02-03 02:48:52 - INFO -   Objetivo: 1044.77€, Actual (ABC): 764.57€
2026-02-03 02:48:52 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 02:48:52 - INFO -   Factor total: 1.3125
2026-02-03 02:48:52 - INFO -   Factor escalado: 1.7935
2026-02-03 02:48:52 - INFO -   Ventas preliminares (con ceil): 1516.64€
2026-02-03 02:48:52 - INFO -   Objetivo final: 1371.26€
2026-02-03 02:48:52 - INFO -   Delta: 145.38€
2026-02-03 02:48:52 - INFO -   Ventas finales: 1373.85€
2026-02-03 02:48:52 - INFO - 
============================================================
2026-02-03 02:48:52 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 02:48:52 - INFO - ============================================================
2026-02-03 02:48:52 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 02:48:52 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 02:48:52 - INFO - DataLoader inicializado correctamente
2026-02-03 02:48:52 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 02:48:52 - INFO - ============================================================
2026-02-03 02:48:52 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 02:48:52 - INFO - ============================================================
2026-02-03 02:48:52 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 02:48:52 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 02:48:52 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:48:52 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:48:52 - INFO - Leyendo archivo de corrección: ././data/input/Stock_actual.xlsx
2026-02-03 02:48:52 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:48:52 - INFO - Stock actual cargado: 30 registros
2026-02-03 02:48:52 - INFO -   Stock: 30 registros
2026-02-03 02:48:53 - WARNING - Archivo de corrección no encontrado: Ventas_semana.xlsx
2026-02-03 02:48:53 - WARNING - Archivo de corrección no encontrado: Ventas_semana_14.xlsx
2026-02-03 02:48:53 - WARNING - Archivo de corrección no encontrado: Ventas_Semana_14.xlsx
2026-02-03 02:48:53 - WARNING - Archivo de corrección no encontrado: Ventas-14.xlsx
2026-02-03 02:48:53 - WARNING - No se encontró archivo de ventas para semana 14
2026-02-03 02:48:53 - WARNING - Archivo de corrección no encontrado: Compras_semana.xlsx
2026-02-03 02:48:53 - WARNING - Archivo de corrección no encontrado: Compras_semana_14.xlsx
2026-02-03 02:48:53 - WARNING - Archivo de corrección no encontrado: Compras_Semana_14.xlsx
2026-02-03 02:48:53 - WARNING - Archivo de corrección no encontrado: Compras-14.xlsx
2026-02-03 02:48:53 - WARNING - No se encontró archivo de compras para semana 14
2026-02-03 02:48:53 - INFO - Datos de corrección cargados: 1/3 archivos
2026-02-03 02:48:53 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 02:48:53 - INFO - Fusión completada: 78 registros
2026-02-03 02:48:53 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 02:48:53 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 02:48:53 - INFO - Corrección completada:
2026-02-03 02:48:53 - INFO -   - Artículos corregidos: 78/78
2026-02-03 02:48:53 - INFO -   - Artículos aumentados: 78
2026-02-03 02:48:53 - INFO -   - Artículos reducidos: 0
2026-02-03 02:48:53 - WARNING - ALERTAS GENERADAS:
2026-02-03 02:48:53 - WARNING -   [ALTO] 78 artículos con stock en 0 o negativo
2026-02-03 02:48:53 - WARNING -   [MEDIO] 24 artículos con cambios superiores al 50%
2026-02-03 02:48:53 - INFO - 
RESUMEN DE CORRECCIÓN:
2026-02-03 02:48:53 - INFO -   Artículos corregidos: 78/78
2026-02-03 02:48:53 - INFO -   Porcentaje corregido: 100.0%
2026-02-03 02:48:53 - INFO -   Diferencia unidades: +101
2026-02-03 02:48:53 - INFO -   Porcentaje cambio: +47.2%
2026-02-03 02:48:53 - INFO - Archivo de pedido corregido generado: Pedido_Semana_14_2026-04-06_utiles_jardin_CORREGIDO.xlsx
2026-02-03 02:48:53 - INFO - Archivo corregido: Pedido_Semana_14_2026-04-06_utiles_jardin_CORREGIDO.xlsx
2026-02-03 02:48:53 - INFO - Generando archivo: ././data/output/Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx
2026-02-03 02:48:53 - INFO - Archivo guardado: ././data/output/Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx
2026-02-03 02:48:53 - INFO - Archivo generado: ././data/output/Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx
2026-02-03 02:48:53 - INFO -   Articulos: 78
2026-02-03 02:48:53 - INFO -   Importe: 1373.85€
2026-02-03 02:48:53 - INFO - 
==================================================
2026-02-03 02:48:53 - INFO - SECCION: TIERRAS_ARIDOS
2026-02-03 02:48:53 - INFO - ==================================================
2026-02-03 02:48:53 - INFO - === LEYENDO DATOS PARA SECCIÓN: TIERRAS_ARIDOS ===
2026-02-03 02:48:53 - WARNING - No se encontró archivo específico para 'tierras_aridos', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:48:53 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:48:53 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 02:48:53 - INFO - Clasificación ABC cargada para 'tierras_aridos': 555 registros
2026-02-03 02:48:53 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-03 02:48:58 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:48:58 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 02:48:58 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 02:48:58 - INFO - Ventas cargadas: 44082 registros
2026-02-03 02:48:58 - INFO - Filtrados 3264 registros de sección 'tierras_aridos' de 44082 total
2026-02-03 02:48:58 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-03 02:49:01 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:49:01 - INFO - Costes cargados: 22145 registros
2026-02-03 02:49:01 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA TIERRAS_ARIDOS ===
2026-02-03 02:49:01 - INFO -   ABC: 555 registros
2026-02-03 02:49:01 - INFO -   Ventas: 3264 registros
2026-02-03 02:49:01 - INFO -   Costes: 22145 registros
2026-02-03 02:49:01 - INFO - Datos de ventas: 302 registros
2026-02-03 02:49:01 - INFO - Calculando pedido para semana 14 (302 registros)
2026-02-03 02:49:01 - INFO -   Objetivo: 4097.24€, Actual (ABC): 4019.19€
2026-02-03 02:49:01 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 02:49:01 - INFO -   Factor total: 1.3125
2026-02-03 02:49:01 - INFO -   Factor escalado: 1.3380
2026-02-03 02:49:01 - INFO -   Ventas preliminares (con ceil): 5809.66€
2026-02-03 02:49:01 - INFO -   Objetivo final: 5377.63€
2026-02-03 02:49:01 - INFO -   Delta: 432.03€
2026-02-03 02:49:01 - INFO -   Ventas finales: 5387.14€
2026-02-03 02:49:02 - INFO - 
============================================================
2026-02-03 02:49:02 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 02:49:02 - INFO - ============================================================
2026-02-03 02:49:02 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 02:49:02 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 02:49:02 - INFO - DataLoader inicializado correctamente
2026-02-03 02:49:02 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 02:49:02 - INFO - ============================================================
2026-02-03 02:49:02 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 02:49:02 - INFO - ============================================================
2026-02-03 02:49:02 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 02:49:02 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 02:49:02 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:49:02 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:49:02 - INFO - Leyendo archivo de corrección: ././data/input/Stock_actual.xlsx
2026-02-03 02:49:02 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:49:02 - INFO - Stock actual cargado: 30 registros
2026-02-03 02:49:02 - INFO -   Stock: 30 registros
2026-02-03 02:49:02 - WARNING - Archivo de corrección no encontrado: Ventas_semana.xlsx
2026-02-03 02:49:02 - WARNING - Archivo de corrección no encontrado: Ventas_semana_14.xlsx
2026-02-03 02:49:02 - WARNING - Archivo de corrección no encontrado: Ventas_Semana_14.xlsx
2026-02-03 02:49:02 - WARNING - Archivo de corrección no encontrado: Ventas-14.xlsx
2026-02-03 02:49:02 - WARNING - No se encontró archivo de ventas para semana 14
2026-02-03 02:49:02 - WARNING - Archivo de corrección no encontrado: Compras_semana.xlsx
2026-02-03 02:49:02 - WARNING - Archivo de corrección no encontrado: Compras_semana_14.xlsx
2026-02-03 02:49:02 - WARNING - Archivo de corrección no encontrado: Compras_Semana_14.xlsx
2026-02-03 02:49:02 - WARNING - Archivo de corrección no encontrado: Compras-14.xlsx
2026-02-03 02:49:02 - WARNING - No se encontró archivo de compras para semana 14
2026-02-03 02:49:02 - INFO - Datos de corrección cargados: 1/3 archivos
2026-02-03 02:49:02 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 02:49:02 - INFO - Fusión completada: 72 registros
2026-02-03 02:49:02 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 02:49:02 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 02:49:02 - INFO - Corrección completada:
2026-02-03 02:49:02 - INFO -   - Artículos corregidos: 71/72
2026-02-03 02:49:02 - INFO -   - Artículos aumentados: 71
2026-02-03 02:49:02 - INFO -   - Artículos reducidos: 0
2026-02-03 02:49:02 - WARNING - ALERTAS GENERADAS:
2026-02-03 02:49:02 - WARNING -   [ALTO] 72 artículos con stock en 0 o negativo
2026-02-03 02:49:02 - WARNING -   [MEDIO] 12 artículos con cambios superiores al 50%
2026-02-03 02:49:02 - INFO - 
RESUMEN DE CORRECCIÓN:
2026-02-03 02:49:02 - INFO -   Artículos corregidos: 71/72
2026-02-03 02:49:02 - INFO -   Porcentaje corregido: 98.6%
2026-02-03 02:49:02 - INFO -   Diferencia unidades: +212
2026-02-03 02:49:02 - INFO -   Porcentaje cambio: +36.0%
2026-02-03 02:49:02 - INFO - Archivo de pedido corregido generado: Pedido_Semana_14_2026-04-06_tierras_aridos_CORREGIDO.xlsx
2026-02-03 02:49:02 - INFO - Archivo corregido: Pedido_Semana_14_2026-04-06_tierras_aridos_CORREGIDO.xlsx
2026-02-03 02:49:02 - INFO - Generando archivo: ././data/output/Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx
2026-02-03 02:49:02 - INFO - Archivo guardado: ././data/output/Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx
2026-02-03 02:49:02 - INFO - Archivo generado: ././data/output/Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx
2026-02-03 02:49:02 - INFO -   Articulos: 71
2026-02-03 02:49:02 - INFO -   Importe: 5387.14€
2026-02-03 02:49:02 - INFO - 
==================================================
2026-02-03 02:49:02 - INFO - SECCION: DECO_EXTERIOR
2026-02-03 02:49:02 - INFO - ==================================================
2026-02-03 02:49:02 - INFO - === LEYENDO DATOS PARA SECCIÓN: DECO_EXTERIOR ===
2026-02-03 02:49:02 - WARNING - No se encontró archivo específico para 'deco_exterior', usando: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:49:02 - INFO - Leyendo archivo: ././data/input/CLASIFICACION_ABC+D_INTERIOR.xlsx
2026-02-03 02:49:02 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 02:49:02 - INFO - Clasificación ABC cargada para 'deco_exterior': 555 registros
2026-02-03 02:49:02 - INFO - Leyendo archivo: ././data/input/Ventas.xlsx
2026-02-03 02:49:07 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:49:07 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 02:49:07 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 02:49:07 - INFO - Ventas cargadas: 44082 registros
2026-02-03 02:49:07 - INFO - Filtrados 4018 registros de sección 'deco_exterior' de 44082 total
2026-02-03 02:49:07 - INFO - Leyendo archivo: ././data/input/Coste.xlsx
2026-02-03 02:49:10 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:49:10 - INFO - Costes cargados: 22145 registros
2026-02-03 02:49:10 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA DECO_EXTERIOR ===
2026-02-03 02:49:10 - INFO -   ABC: 555 registros
2026-02-03 02:49:10 - INFO -   Ventas: 4018 registros
2026-02-03 02:49:10 - INFO -   Costes: 22145 registros
2026-02-03 02:49:10 - INFO - Datos de ventas: 316 registros
2026-02-03 02:49:10 - INFO - Calculando pedido para semana 14 (316 registros)
2026-02-03 02:49:11 - INFO -   Objetivo: 3740.34€, Actual (ABC): 3720.75€
2026-02-03 02:49:11 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 02:49:11 - INFO -   Factor total: 1.3125
2026-02-03 02:49:11 - INFO -   Factor escalado: 1.3194
2026-02-03 02:49:11 - INFO -   Ventas preliminares (con ceil): 6159.28€
2026-02-03 02:49:11 - INFO -   Objetivo final: 4909.20€
2026-02-03 02:49:11 - INFO -   Delta: 1250.08€
2026-02-03 02:49:11 - INFO -   Ventas finales: 4934.68€
2026-02-03 02:49:11 - INFO - 
============================================================
2026-02-03 02:49:11 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 02:49:11 - INFO - ============================================================
2026-02-03 02:49:11 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 02:49:11 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 02:49:11 - INFO - DataLoader inicializado correctamente
2026-02-03 02:49:11 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 02:49:11 - INFO - ============================================================
2026-02-03 02:49:11 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 02:49:11 - INFO - ============================================================
2026-02-03 02:49:11 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 02:49:11 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 02:49:11 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:49:11 - INFO - Archivo de corrección encontrado: ././data/input/Stock_actual.xlsx
2026-02-03 02:49:11 - INFO - Leyendo archivo de corrección: ././data/input/Stock_actual.xlsx
2026-02-03 02:49:11 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 02:49:11 - INFO - Stock actual cargado: 30 registros
2026-02-03 02:49:11 - INFO -   Stock: 30 registros
2026-02-03 02:49:11 - WARNING - Archivo de corrección no encontrado: Ventas_semana.xlsx
2026-02-03 02:49:11 - WARNING - Archivo de corrección no encontrado: Ventas_semana_14.xlsx
2026-02-03 02:49:11 - WARNING - Archivo de corrección no encontrado: Ventas_Semana_14.xlsx
2026-02-03 02:49:11 - WARNING - Archivo de corrección no encontrado: Ventas-14.xlsx
2026-02-03 02:49:11 - WARNING - No se encontró archivo de ventas para semana 14
2026-02-03 02:49:11 - WARNING - Archivo de corrección no encontrado: Compras_semana.xlsx
2026-02-03 02:49:11 - WARNING - Archivo de corrección no encontrado: Compras_semana_14.xlsx
2026-02-03 02:49:11 - WARNING - Archivo de corrección no encontrado: Compras_Semana_14.xlsx
2026-02-03 02:49:11 - WARNING - Archivo de corrección no encontrado: Compras-14.xlsx
2026-02-03 02:49:11 - WARNING - No se encontró archivo de compras para semana 14
2026-02-03 02:49:11 - INFO - Datos de corrección cargados: 1/3 archivos
2026-02-03 02:49:11 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 02:49:11 - INFO - Fusión completada: 224 registros
2026-02-03 02:49:11 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 02:49:11 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 02:49:11 - INFO - Corrección completada:
2026-02-03 02:49:11 - INFO -   - Artículos corregidos: 221/224
2026-02-03 02:49:11 - INFO -   - Artículos aumentados: 221
2026-02-03 02:49:11 - INFO -   - Artículos reducidos: 0
2026-02-03 02:49:11 - WARNING - ALERTAS GENERADAS:
2026-02-03 02:49:11 - WARNING -   [ALTO] 224 artículos con stock en 0 o negativo
2026-02-03 02:49:11 - WARNING -   [MEDIO] 99 artículos con cambios superiores al 50%
2026-02-03 02:49:11 - INFO - 
RESUMEN DE CORRECCIÓN:
2026-02-03 02:49:11 - INFO -   Artículos corregidos: 221/224
2026-02-03 02:49:11 - INFO -   Porcentaje corregido: 98.7%
2026-02-03 02:49:11 - INFO -   Diferencia unidades: +298
2026-02-03 02:49:11 - INFO -   Porcentaje cambio: +47.9%
2026-02-03 02:49:11 - INFO - Archivo de pedido corregido generado: Pedido_Semana_14_2026-04-06_deco_exterior_CORREGIDO.xlsx
2026-02-03 02:49:11 - INFO - Archivo corregido: Pedido_Semana_14_2026-04-06_deco_exterior_CORREGIDO.xlsx
2026-02-03 02:49:11 - INFO - Generando archivo: ././data/output/Pedido_Semana_14_2026-02-03_deco_exterior.xlsx
2026-02-03 02:49:11 - INFO - Archivo guardado: ././data/output/Pedido_Semana_14_2026-02-03_deco_exterior.xlsx
2026-02-03 02:49:11 - INFO - Archivo generado: ././data/output/Pedido_Semana_14_2026-02-03_deco_exterior.xlsx
2026-02-03 02:49:11 - INFO -   Articulos: 221
2026-02-03 02:49:11 - INFO -   Importe: 4934.68€
2026-02-03 02:49:11 - INFO - Estado guardado correctamente
2026-02-03 02:49:11 - INFO - Generando resumen: ././data/output/Resumen_Pedidos_VIVERO_2026-02-03.xlsx
2026-02-03 02:49:12 - INFO - Resumen guardado: ././data/output/Resumen_Pedidos_VIVERO_2026-02-03.xlsx
2026-02-03 02:49:12 - INFO - Estado guardado correctamente
2026-02-03 02:49:12 - INFO - 
======================================================================
2026-02-03 02:49:12 - INFO - RESUMEN DE EJECUCION
2026-02-03 02:49:12 - INFO - ======================================================================
2026-02-03 02:49:12 - INFO - Semana procesada: 14
2026-02-03 02:49:12 - INFO - Archivos generados: 23
2026-02-03 02:49:12 - INFO - Total articulos: 1702
2026-02-03 02:49:12 - INFO - Total importe: 48050.69€
2026-02-03 02:49:12 - INFO - 
MÉTRICAS DE CORRECCIÓN (FASE 2):
2026-02-03 02:49:12 - INFO - ----------------------------------------
2026-02-03 02:49:12 - INFO -   maf: 221 artículos corregidos
2026-02-03 02:49:12 - INFO -   deco_interior: 138 artículos corregidos
2026-02-03 02:49:12 - INFO -   semillas: 84 artículos corregidos
2026-02-03 02:49:12 - INFO -   mascotas_vivo: 43 artículos corregidos
2026-02-03 02:49:12 - INFO -   mascotas_manufacturado: 534 artículos corregidos
2026-02-03 02:49:12 - INFO -   interior: 121 artículos corregidos
2026-02-03 02:49:12 - INFO -   fitos: 84 artículos corregidos
2026-02-03 02:49:12 - INFO -   vivero: 107 artículos corregidos
2026-02-03 02:49:12 - INFO -   utiles_jardin: 78 artículos corregidos
2026-02-03 02:49:12 - INFO -   tierras_aridos: 71 artículos corregidos
2026-02-03 02:49:12 - INFO -   deco_exterior: 221 artículos corregidos
2026-02-03 02:49:12 - INFO -   TOTAL: 1702 artículos corregidos
2026-02-03 02:49:12 - INFO -   Diferencia neta: +2865 unidades
2026-02-03 02:49:12 - INFO - ======================================================================
2026-02-03 02:49:12 - INFO - 
¡PEDIDO GENERADO EXITOSAMENTE!
2026-02-03 02:49:12 - INFO - Archivo principal: ./data/output/Pedido_Semana_14_2026-04-06_maf_CORREGIDO.xlsx
2026-02-03 02:49:12 - INFO - Articulos: 1702
2026-02-03 02:49:12 - INFO - Importe: 48050.69€
2026-02-03 02:49:12 - INFO - 
FASE 2 completada: 11 secciones corregidas
2026-02-02 23:15:05 - INFO - ======================================================================
2026-02-02 23:15:05 - INFO - SISTEMA DE PEDIDOS DE COMPRA - VIVERO ARANJUEZ V2
2026-02-02 23:15:05 - INFO - Fecha de ejecucion: 2026-02-02 23:15:05
2026-02-02 23:15:05 - INFO - ======================================================================
2026-02-02 23:15:05 - INFO - Modo de ejecucion: FASE 1 + FASE 2
2026-02-02 23:15:05 - INFO - StateManager inicializado. Archivo de estado: .\./data\state.json
2026-02-02 23:15:05 - INFO - Cargando estado desde: .\./data\state.json
2026-02-02 23:15:05 - INFO - Estado cargado correctamente
2026-02-02 23:15:05 - INFO - SchedulerService inicializado correctamente
2026-02-02 23:15:05 - INFO - Horario configurado: sunday a las 15:00
2026-02-02 23:15:05 - WARNING - No es el horario de ejecucion: Hoy es lunes, no es domingo
2026-02-02 23:15:05 - INFO - La próxima ejecución será el domingo 08/02/2026 a las 15:00
2026-02-02 23:15:05 - INFO - pero hay semana pendiente: Semana a procesar: 15
2026-02-02 23:15:05 - INFO - Use --continuo para esperar hasta el horario de ejecucion.
2026-02-02 23:16:02 - INFO - ======================================================================
2026-02-02 23:16:02 - INFO - SISTEMA DE PEDIDOS DE COMPRA - VIVERO ARANJUEZ V2
2026-02-02 23:16:02 - INFO - Fecha de ejecucion: 2026-02-02 23:16:02
2026-02-02 23:16:02 - INFO - ======================================================================
2026-02-02 23:16:02 - INFO - Modo de ejecucion: FASE 1 + FASE 2
2026-02-02 23:16:02 - INFO - StateManager inicializado. Archivo de estado: .\./data\state.json
2026-02-02 23:16:02 - INFO - Cargando estado desde: .\./data\state.json
2026-02-02 23:16:02 - INFO - Estado cargado correctamente
2026-02-02 23:16:02 - INFO - SchedulerService inicializado correctamente
2026-02-02 23:16:02 - INFO - Horario configurado: sunday a las 15:00
2026-02-02 23:16:02 - WARNING - No es el horario de ejecucion: Hoy es lunes, no es domingo
2026-02-02 23:16:02 - INFO - La próxima ejecución será el domingo 08/02/2026 a las 15:00
2026-02-02 23:16:02 - INFO - pero hay semana pendiente: Semana a procesar: 15
2026-02-02 23:16:02 - INFO - Use --continuo para esperar hasta el horario de ejecucion.
2026-02-02 23:18:40 - INFO - ======================================================================
2026-02-02 23:18:40 - INFO - SISTEMA DE PEDIDOS DE COMPRA - VIVERO ARANJUEZ V2
2026-02-02 23:18:40 - INFO - Fecha de ejecucion: 2026-02-02 23:18:40
2026-02-02 23:18:40 - INFO - ======================================================================
2026-02-02 23:18:40 - INFO - Modo de ejecucion: FASE 1 + FASE 2
2026-02-02 23:18:40 - INFO - StateManager inicializado. Archivo de estado: .\./data\state.json
2026-02-02 23:18:40 - INFO - Cargando estado desde: .\./data\state.json
2026-02-02 23:18:40 - INFO - Estado cargado correctamente
2026-02-02 23:18:40 - INFO - SchedulerService inicializado correctamente
2026-02-02 23:18:40 - INFO - Horario configurado: sunday a las 15:00
2026-02-02 23:18:40 - INFO - Semana forzada por argumento: 15
2026-02-02 23:18:40 - INFO - ======================================================================
2026-02-02 23:18:40 - INFO - PROCESANDO PEDIDO PARA SEMANA 15
2026-02-02 23:18:40 - INFO - ======================================================================
2026-02-02 23:18:40 - INFO - MODO: FASE 1 (Forecast) + FASE 2 (Corrección)
2026-02-02 23:18:40 - INFO - DataLoader inicializado correctamente
2026-02-02 23:18:40 - INFO - ForecastEngine inicializado correctamente
2026-02-02 23:18:40 - INFO - OrderGenerator inicializado correctamente
2026-02-02 23:18:40 - INFO - SchedulerService inicializado correctamente
2026-02-02 23:18:40 - INFO - Horario configurado: sunday a las 15:00
2026-02-02 23:18:40 - INFO - Período de la semana: 2026-04-06 al 2026-04-12
2026-02-02 23:18:40 - INFO - Stock acumulado cargado: 1727 artículos
2026-02-02 23:18:40 - INFO - 
==================================================
2026-02-02 23:18:40 - INFO - SECCION: MAF
2026-02-02 23:18:40 - INFO - ==================================================
2026-02-02 23:18:40 - INFO - === LEYENDO DATOS PARA SECCIÓN: MAF ===
2026-02-02 23:18:40 - INFO - Archivo ABC encontrado para 'maf': .\./data/input\CLASIFICACION_ABC+D_maf.xlsx
2026-02-02 23:18:40 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_maf.xlsx
2026-02-02 23:18:40 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-02 23:18:40 - INFO - Clasificación ABC cargada para 'maf': 499 registros
2026-02-02 23:18:40 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-02 23:18:44 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 23:18:44 - INFO - Usando hoja: Ventas por vendedor
2026-02-02 23:18:44 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-02 23:18:44 - INFO - Ventas cargadas: 44082 registros
2026-02-02 23:18:44 - INFO - Filtrados 10970 registros de sección 'maf' de 44082 total
2026-02-02 23:18:44 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-02 23:18:46 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 23:18:46 - INFO - Costes cargados: 22145 registros
2026-02-02 23:18:46 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MAF ===
2026-02-02 23:18:46 - INFO -   ABC: 499 registros
2026-02-02 23:18:46 - INFO -   Ventas: 10970 registros
2026-02-02 23:18:46 - INFO -   Costes: 22145 registros
2026-02-02 23:18:46 - INFO - Datos de ventas: 884 registros
2026-02-02 23:18:46 - INFO - Calculando pedido para semana 15 (884 registros)
2026-02-02 23:18:47 - INFO -   Objetivo: 6466.57€, Actual (ABC): 5077.16€
2026-02-02 23:18:47 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.0
2026-02-02 23:18:47 - INFO -   Factor total: 1.0500
2026-02-02 23:18:47 - INFO -   Factor escalado: 1.3373
2026-02-02 23:18:47 - INFO -   Ventas preliminares (con ceil): 7465.79€
2026-02-02 23:18:47 - INFO -   Objetivo final: 6789.90€
2026-02-02 23:18:47 - INFO -   Delta: 675.89€
2026-02-02 23:18:47 - INFO -   Ventas finales: 6795.72€
2026-02-02 23:18:47 - INFO - 
============================================================
2026-02-02 23:18:47 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-02 23:18:47 - INFO - ============================================================
2026-02-02 23:18:47 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-02 23:18:47 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-02 23:18:47 - INFO - DataLoader inicializado correctamente
2026-02-02 23:18:47 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-02 23:18:47 - INFO - ============================================================
2026-02-02 23:18:47 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 15
2026-02-02 23:18:47 - INFO - ============================================================
2026-02-02 23:18:47 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_15.xlsx
2026-02-02 23:18:47 - WARNING - Archivo de corrección no encontrado: Stock_semana_15.xlsx
2026-02-02 23:18:47 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-02 23:18:47 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-02 23:18:47 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-02 23:18:47 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 23:18:47 - INFO - Stock actual cargado: 30 registros
2026-02-02 23:18:47 - INFO -   Stock: 30 registros
2026-02-02 23:18:47 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-02 23:18:47 - INFO - Fusión completada: 213 registros
2026-02-02 23:18:47 - INFO - CorrectionEngine inicializado correctamente
2026-02-02 23:18:47 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-02 23:18:47 - INFO - Corrección completada:
2026-02-02 23:18:47 - INFO -   - Artículos corregidos: 199/213
2026-02-02 23:18:47 - INFO -   - Artículos aumentados: 199
2026-02-02 23:18:47 - INFO -   - Artículos reducidos: 0
2026-02-02 23:18:47 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-02 23:18:47 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 270, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-02 23:18:47 - INFO - Usando pedido teórico (sin corrección)
2026-02-02 23:18:47 - INFO - Generando archivo: .\./data/output\Pedido_Semana_15_2026-02-02_maf.xlsx
2026-02-02 23:18:47 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_15_2026-02-02_maf.xlsx
2026-02-02 23:18:47 - INFO - Archivo generado: .\./data/output\Pedido_Semana_15_2026-02-02_maf.xlsx
2026-02-02 23:18:47 - INFO -   Articulos: 157
2026-02-02 23:18:47 - INFO -   Importe: 6587.53€
2026-02-02 23:18:47 - INFO - 
==================================================
2026-02-02 23:18:47 - INFO - SECCION: DECO_INTERIOR
2026-02-02 23:18:47 - INFO - ==================================================
2026-02-02 23:18:47 - INFO - === LEYENDO DATOS PARA SECCIÓN: DECO_INTERIOR ===
2026-02-02 23:18:47 - INFO - Archivo ABC encontrado para 'deco_interior': .\./data/input\CLASIFICACION_ABC+D_deco_interior.xlsx
2026-02-02 23:18:47 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_deco_interior.xlsx
2026-02-02 23:18:47 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-02 23:18:47 - INFO - Clasificación ABC cargada para 'deco_interior': 1827 registros
2026-02-02 23:18:47 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-02 23:18:51 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 23:18:51 - INFO - Usando hoja: Ventas por vendedor
2026-02-02 23:18:51 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-02 23:18:51 - INFO - Ventas cargadas: 44082 registros
2026-02-02 23:18:51 - INFO - Filtrados 2468 registros de sección 'deco_interior' de 44082 total
2026-02-02 23:18:51 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-02 23:18:53 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 23:18:53 - INFO - Costes cargados: 22145 registros
2026-02-02 23:18:53 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA DECO_INTERIOR ===
2026-02-02 23:18:53 - INFO -   ABC: 1827 registros
2026-02-02 23:18:53 - INFO -   Ventas: 2468 registros
2026-02-02 23:18:53 - INFO -   Costes: 22145 registros
2026-02-02 23:18:53 - INFO - Datos de ventas: 200 registros
2026-02-02 23:18:53 - INFO - Calculando pedido para semana 15 (200 registros)
2026-02-02 23:18:54 - INFO -   Objetivo: 1823.97€, Actual (ABC): 2549.17€
2026-02-02 23:18:54 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.0
2026-02-02 23:18:54 - INFO -   Factor total: 1.0500
2026-02-02 23:18:54 - INFO -   Factor escalado: 0.7513
2026-02-02 23:18:54 - INFO -   Ventas preliminares (con ceil): 2274.55€
2026-02-02 23:18:54 - INFO -   Objetivo final: 1915.17€
2026-02-02 23:18:54 - INFO -   Delta: 359.38€
2026-02-02 23:18:54 - INFO -   Ventas finales: 1916.54€
2026-02-02 23:18:54 - INFO - 
============================================================
2026-02-02 23:18:54 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-02 23:18:54 - INFO - ============================================================
2026-02-02 23:18:54 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-02 23:18:54 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-02 23:18:54 - INFO - DataLoader inicializado correctamente
2026-02-02 23:18:54 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-02 23:18:54 - INFO - ============================================================
2026-02-02 23:18:54 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 15
2026-02-02 23:18:54 - INFO - ============================================================
2026-02-02 23:18:54 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_15.xlsx
2026-02-02 23:18:54 - WARNING - Archivo de corrección no encontrado: Stock_semana_15.xlsx
2026-02-02 23:18:54 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-02 23:18:54 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-02 23:18:54 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-02 23:18:54 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 23:18:54 - INFO - Stock actual cargado: 30 registros
2026-02-02 23:18:54 - INFO -   Stock: 30 registros
2026-02-02 23:18:54 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-02 23:18:54 - INFO - Fusión completada: 156 registros
2026-02-02 23:18:54 - INFO - CorrectionEngine inicializado correctamente
2026-02-02 23:18:54 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-02 23:18:54 - INFO - Corrección completada:
2026-02-02 23:18:54 - INFO -   - Artículos corregidos: 115/156
2026-02-02 23:18:54 - INFO -   - Artículos aumentados: 115
2026-02-02 23:18:54 - INFO -   - Artículos reducidos: 0
2026-02-02 23:18:54 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-02 23:18:54 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 270, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-02 23:18:54 - INFO - Usando pedido teórico (sin corrección)
2026-02-02 23:18:54 - INFO - Generando archivo: .\./data/output\Pedido_Semana_15_2026-02-02_deco_interior.xlsx
2026-02-02 23:18:54 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_15_2026-02-02_deco_interior.xlsx
2026-02-02 23:18:54 - INFO - Archivo generado: .\./data/output\Pedido_Semana_15_2026-02-02_deco_interior.xlsx
2026-02-02 23:18:54 - INFO -   Articulos: 91
2026-02-02 23:18:54 - INFO -   Importe: 1866.10€
2026-02-02 23:18:54 - INFO - 
==================================================
2026-02-02 23:18:54 - INFO - SECCION: SEMILLAS
2026-02-02 23:18:54 - INFO - ==================================================
2026-02-02 23:18:54 - INFO - === LEYENDO DATOS PARA SECCIÓN: SEMILLAS ===
2026-02-02 23:18:54 - INFO - Archivo ABC encontrado para 'semillas': .\./data/input\CLASIFICACION_ABC+D_semillas.xlsx
2026-02-02 23:18:54 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_semillas.xlsx
2026-02-02 23:18:54 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-02 23:18:54 - INFO - Clasificación ABC cargada para 'semillas': 218 registros
2026-02-02 23:18:54 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-02 23:18:58 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 23:18:58 - INFO - Usando hoja: Ventas por vendedor
2026-02-02 23:18:58 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-02 23:18:58 - INFO - Ventas cargadas: 44082 registros
2026-02-02 23:18:58 - INFO - Filtrados 1180 registros de sección 'semillas' de 44082 total
2026-02-02 23:18:58 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-02 23:19:00 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 23:19:00 - INFO - Costes cargados: 22145 registros
2026-02-02 23:19:00 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA SEMILLAS ===
2026-02-02 23:19:00 - INFO -   ABC: 218 registros
2026-02-02 23:19:00 - INFO -   Ventas: 1180 registros
2026-02-02 23:19:00 - INFO -   Costes: 22145 registros
2026-02-02 23:19:00 - INFO - Datos de ventas: 86 registros
2026-02-02 23:19:00 - INFO - Calculando pedido para semana 15 (86 registros)
2026-02-02 23:19:01 - INFO -   Objetivo: 459.43€, Actual (ABC): 450.89€
2026-02-02 23:19:01 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.0
2026-02-02 23:19:01 - INFO -   Factor total: 1.0500
2026-02-02 23:19:01 - INFO -   Factor escalado: 1.0699
2026-02-02 23:19:01 - INFO -   Ventas preliminares (con ceil): 641.24€
2026-02-02 23:19:01 - INFO -   Objetivo final: 482.40€
2026-02-02 23:19:01 - INFO -   Delta: 158.84€
2026-02-02 23:19:01 - INFO -   Ventas finales: 493.07€
2026-02-02 23:19:01 - INFO - 
============================================================
2026-02-02 23:19:01 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-02 23:19:01 - INFO - ============================================================
2026-02-02 23:19:01 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-02 23:19:01 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-02 23:19:01 - INFO - DataLoader inicializado correctamente
2026-02-02 23:19:01 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-02 23:19:01 - INFO - ============================================================
2026-02-02 23:19:01 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 15
2026-02-02 23:19:01 - INFO - ============================================================
2026-02-02 23:19:01 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_15.xlsx
2026-02-02 23:19:01 - WARNING - Archivo de corrección no encontrado: Stock_semana_15.xlsx
2026-02-02 23:19:01 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-02 23:19:01 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-02 23:19:01 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-02 23:19:01 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 23:19:01 - INFO - Stock actual cargado: 30 registros
2026-02-02 23:19:01 - INFO -   Stock: 30 registros
2026-02-02 23:19:01 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-02 23:19:01 - INFO - Fusión completada: 64 registros
2026-02-02 23:19:01 - INFO - CorrectionEngine inicializado correctamente
2026-02-02 23:19:01 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-02 23:19:01 - INFO - Corrección completada:
2026-02-02 23:19:01 - INFO -   - Artículos corregidos: 48/64
2026-02-02 23:19:01 - INFO -   - Artículos aumentados: 48
2026-02-02 23:19:01 - INFO -   - Artículos reducidos: 0
2026-02-02 23:19:01 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-02 23:19:01 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 270, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-02 23:19:01 - INFO - Usando pedido teórico (sin corrección)
2026-02-02 23:19:01 - INFO - Generando archivo: .\./data/output\Pedido_Semana_15_2026-02-02_semillas.xlsx
2026-02-02 23:19:01 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_15_2026-02-02_semillas.xlsx
2026-02-02 23:19:01 - INFO - Archivo generado: .\./data/output\Pedido_Semana_15_2026-02-02_semillas.xlsx
2026-02-02 23:19:01 - INFO -   Articulos: 32
2026-02-02 23:19:01 - INFO -   Importe: 432.91€
2026-02-02 23:19:01 - INFO - 
==================================================
2026-02-02 23:19:01 - INFO - SECCION: MASCOTAS_VIVO
2026-02-02 23:19:01 - INFO - ==================================================
2026-02-02 23:19:01 - INFO - === LEYENDO DATOS PARA SECCIÓN: MASCOTAS_VIVO ===
2026-02-02 23:19:01 - INFO - Archivo ABC encontrado para 'mascotas_vivo': .\./data/input\CLASIFICACION_ABC+D_mascotas_vivo.xlsx
2026-02-02 23:19:01 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_mascotas_vivo.xlsx
2026-02-02 23:19:01 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-02 23:19:01 - INFO - Clasificación ABC cargada para 'mascotas_vivo': 205 registros
2026-02-02 23:19:01 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-02 23:19:05 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 23:19:05 - INFO - Usando hoja: Ventas por vendedor
2026-02-02 23:19:05 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-02 23:19:05 - INFO - Ventas cargadas: 44082 registros
2026-02-02 23:19:05 - INFO - Filtrados 1124 registros de sección 'mascotas_vivo' de 44082 total
2026-02-02 23:19:05 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-02 23:19:07 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 23:19:07 - INFO - Costes cargados: 22145 registros
2026-02-02 23:19:07 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MASCOTAS_VIVO ===
2026-02-02 23:19:07 - INFO -   ABC: 205 registros
2026-02-02 23:19:07 - INFO -   Ventas: 1124 registros
2026-02-02 23:19:07 - INFO -   Costes: 22145 registros
2026-02-02 23:19:07 - INFO - Datos de ventas: 94 registros
2026-02-02 23:19:07 - INFO - Calculando pedido para semana 15 (94 registros)
2026-02-02 23:19:07 - INFO -   Objetivo: 872.45€, Actual (ABC): 872.12€
2026-02-02 23:19:07 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.0
2026-02-02 23:19:07 - INFO -   Factor total: 1.0500
2026-02-02 23:19:07 - INFO -   Factor escalado: 1.0504
2026-02-02 23:19:07 - INFO -   Ventas preliminares (con ceil): 1180.02€
2026-02-02 23:19:07 - INFO -   Objetivo final: 916.07€
2026-02-02 23:19:07 - INFO -   Delta: 263.95€
2026-02-02 23:19:07 - INFO -   Ventas finales: 916.51€
2026-02-02 23:19:07 - INFO - 
============================================================
2026-02-02 23:19:07 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-02 23:19:07 - INFO - ============================================================
2026-02-02 23:19:07 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-02 23:19:07 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-02 23:19:07 - INFO - DataLoader inicializado correctamente
2026-02-02 23:19:07 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-02 23:19:07 - INFO - ============================================================
2026-02-02 23:19:07 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 15
2026-02-02 23:19:07 - INFO - ============================================================
2026-02-02 23:19:07 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_15.xlsx
2026-02-02 23:19:07 - WARNING - Archivo de corrección no encontrado: Stock_semana_15.xlsx
2026-02-02 23:19:07 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-02 23:19:07 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-02 23:19:07 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-02 23:19:07 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 23:19:07 - INFO - Stock actual cargado: 30 registros
2026-02-02 23:19:07 - INFO -   Stock: 30 registros
2026-02-02 23:19:07 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-02 23:19:07 - INFO - Fusión completada: 55 registros
2026-02-02 23:19:07 - INFO - CorrectionEngine inicializado correctamente
2026-02-02 23:19:07 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-02 23:19:07 - INFO - Corrección completada:
2026-02-02 23:19:07 - INFO -   - Artículos corregidos: 41/55
2026-02-02 23:19:07 - INFO -   - Artículos aumentados: 41
2026-02-02 23:19:07 - INFO -   - Artículos reducidos: 0
2026-02-02 23:19:07 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-02 23:19:07 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 270, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-02 23:19:07 - INFO - Usando pedido teórico (sin corrección)
2026-02-02 23:19:07 - INFO - Generando archivo: .\./data/output\Pedido_Semana_15_2026-02-02_mascotas_vivo.xlsx
2026-02-02 23:19:07 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_15_2026-02-02_mascotas_vivo.xlsx
2026-02-02 23:19:07 - INFO - Archivo generado: .\./data/output\Pedido_Semana_15_2026-02-02_mascotas_vivo.xlsx
2026-02-02 23:19:07 - INFO -   Articulos: 29
2026-02-02 23:19:07 - INFO -   Importe: 849.59€
2026-02-02 23:19:07 - INFO - 
==================================================
2026-02-02 23:19:07 - INFO - SECCION: MASCOTAS_MANUFACTURADO
2026-02-02 23:19:07 - INFO - ==================================================
2026-02-02 23:19:07 - INFO - === LEYENDO DATOS PARA SECCIÓN: MASCOTAS_MANUFACTURADO ===
2026-02-02 23:19:07 - INFO - Archivo ABC encontrado para 'mascotas_manufacturado': .\./data/input\CLASIFICACION_ABC+D_mascotas_manufacturado.xlsx
2026-02-02 23:19:07 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_mascotas_manufacturado.xlsx
2026-02-02 23:19:08 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-02 23:19:08 - INFO - Clasificación ABC cargada para 'mascotas_manufacturado': 2749 registros
2026-02-02 23:19:08 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-02 23:19:12 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 23:19:12 - INFO - Usando hoja: Ventas por vendedor
2026-02-02 23:19:12 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-02 23:19:12 - INFO - Ventas cargadas: 44082 registros
2026-02-02 23:19:12 - INFO - Filtrados 9784 registros de sección 'mascotas_manufacturado' de 44082 total
2026-02-02 23:19:12 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-02 23:19:14 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 23:19:14 - INFO - Costes cargados: 22145 registros
2026-02-02 23:19:14 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MASCOTAS_MANUFACTURADO ===
2026-02-02 23:19:14 - INFO -   ABC: 2749 registros
2026-02-02 23:19:14 - INFO -   Ventas: 9784 registros
2026-02-02 23:19:14 - INFO -   Costes: 22145 registros
2026-02-02 23:19:14 - INFO - Datos de ventas: 759 registros
2026-02-02 23:19:14 - INFO - Calculando pedido para semana 15 (759 registros)
2026-02-02 23:19:16 - INFO -   Objetivo: 6689.54€, Actual (ABC): 8926.08€
2026-02-02 23:19:16 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.0
2026-02-02 23:19:16 - INFO -   Factor total: 1.0500
2026-02-02 23:19:16 - INFO -   Factor escalado: 0.7869
2026-02-02 23:19:16 - INFO -   Ventas preliminares (con ceil): 8871.83€
2026-02-02 23:19:16 - INFO -   Objetivo final: 7024.02€
2026-02-02 23:19:16 - INFO -   Delta: 1847.81€
2026-02-02 23:19:16 - INFO -   Ventas finales: 7031.18€
2026-02-02 23:19:16 - INFO - 
============================================================
2026-02-02 23:19:16 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-02 23:19:16 - INFO - ============================================================
2026-02-02 23:19:16 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-02 23:19:16 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-02 23:19:16 - INFO - DataLoader inicializado correctamente
2026-02-02 23:19:16 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-02 23:19:16 - INFO - ============================================================
2026-02-02 23:19:16 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 15
2026-02-02 23:19:16 - INFO - ============================================================
2026-02-02 23:19:16 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_15.xlsx
2026-02-02 23:19:16 - WARNING - Archivo de corrección no encontrado: Stock_semana_15.xlsx
2026-02-02 23:19:16 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-02 23:19:16 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-02 23:19:16 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-02 23:19:16 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 23:19:16 - INFO - Stock actual cargado: 30 registros
2026-02-02 23:19:16 - INFO -   Stock: 30 registros
2026-02-02 23:19:16 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-02 23:19:16 - INFO - Fusión completada: 531 registros
2026-02-02 23:19:16 - INFO - CorrectionEngine inicializado correctamente
2026-02-02 23:19:16 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-02 23:19:16 - INFO - Corrección completada:
2026-02-02 23:19:16 - INFO -   - Artículos corregidos: 415/531
2026-02-02 23:19:16 - INFO -   - Artículos aumentados: 415
2026-02-02 23:19:16 - INFO -   - Artículos reducidos: 0
2026-02-02 23:19:16 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-02 23:19:16 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 270, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-02 23:19:16 - INFO - Usando pedido teórico (sin corrección)
2026-02-02 23:19:16 - INFO - Generando archivo: .\./data/output\Pedido_Semana_15_2026-02-02_mascotas_manufacturado.xlsx
2026-02-02 23:19:16 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_15_2026-02-02_mascotas_manufacturado.xlsx
2026-02-02 23:19:16 - INFO - Archivo generado: .\./data/output\Pedido_Semana_15_2026-02-02_mascotas_manufacturado.xlsx
2026-02-02 23:19:16 - INFO -   Articulos: 330
2026-02-02 23:19:16 - INFO -   Importe: 6998.39€
2026-02-02 23:19:16 - INFO - 
==================================================
2026-02-02 23:19:16 - INFO - SECCION: INTERIOR
2026-02-02 23:19:16 - INFO - ==================================================
2026-02-02 23:19:16 - INFO - === LEYENDO DATOS PARA SECCIÓN: INTERIOR ===
2026-02-02 23:19:16 - INFO - Archivo ABC encontrado para 'interior': .\./data/input\CLASIFICACION_ABC+D_interior.xlsx
2026-02-02 23:19:16 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_interior.xlsx
2026-02-02 23:19:16 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-02 23:19:16 - INFO - Clasificación ABC cargada para 'interior': 555 registros
2026-02-02 23:19:16 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-02 23:19:20 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 23:19:20 - INFO - Usando hoja: Ventas por vendedor
2026-02-02 23:19:20 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-02 23:19:20 - INFO - Ventas cargadas: 44082 registros
2026-02-02 23:19:20 - INFO - Filtrados 3624 registros de sección 'interior' de 44082 total
2026-02-02 23:19:20 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-02 23:19:22 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 23:19:22 - INFO - Costes cargados: 22145 registros
2026-02-02 23:19:22 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA INTERIOR ===
2026-02-02 23:19:22 - INFO -   ABC: 555 registros
2026-02-02 23:19:22 - INFO -   Ventas: 3624 registros
2026-02-02 23:19:22 - INFO -   Costes: 22145 registros
2026-02-02 23:19:22 - INFO - Datos de ventas: 283 registros
2026-02-02 23:19:22 - INFO - Calculando pedido para semana 15 (283 registros)
2026-02-02 23:19:23 - INFO -   Objetivo: 2338.22€, Actual (ABC): 2125.82€
2026-02-02 23:19:23 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.0
2026-02-02 23:19:23 - INFO -   Factor total: 1.0500
2026-02-02 23:19:23 - INFO -   Factor escalado: 1.1549
2026-02-02 23:19:23 - INFO -   Ventas preliminares (con ceil): 3031.79€
2026-02-02 23:19:23 - INFO -   Objetivo final: 2455.13€
2026-02-02 23:19:23 - INFO -   Delta: 576.66€
2026-02-02 23:19:23 - INFO -   Ventas finales: 2456.51€
2026-02-02 23:19:23 - INFO - 
============================================================
2026-02-02 23:19:23 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-02 23:19:23 - INFO - ============================================================
2026-02-02 23:19:23 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-02 23:19:23 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-02 23:19:23 - INFO - DataLoader inicializado correctamente
2026-02-02 23:19:23 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-02 23:19:23 - INFO - ============================================================
2026-02-02 23:19:23 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 15
2026-02-02 23:19:23 - INFO - ============================================================
2026-02-02 23:19:23 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_15.xlsx
2026-02-02 23:19:23 - WARNING - Archivo de corrección no encontrado: Stock_semana_15.xlsx
2026-02-02 23:19:23 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-02 23:19:23 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-02 23:19:23 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-02 23:19:23 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 23:19:23 - INFO - Stock actual cargado: 30 registros
2026-02-02 23:19:23 - INFO -   Stock: 30 registros
2026-02-02 23:19:23 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-02 23:19:23 - INFO - Fusión completada: 135 registros
2026-02-02 23:19:23 - INFO - CorrectionEngine inicializado correctamente
2026-02-02 23:19:23 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-02 23:19:23 - INFO - Corrección completada:
2026-02-02 23:19:23 - INFO -   - Artículos corregidos: 111/135
2026-02-02 23:19:23 - INFO -   - Artículos aumentados: 111
2026-02-02 23:19:23 - INFO -   - Artículos reducidos: 0
2026-02-02 23:19:23 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-02 23:19:23 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 270, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-02 23:19:23 - INFO - Usando pedido teórico (sin corrección)
2026-02-02 23:19:23 - INFO - Generando archivo: .\./data/output\Pedido_Semana_15_2026-02-02_interior.xlsx
2026-02-02 23:19:23 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_15_2026-02-02_interior.xlsx
2026-02-02 23:19:23 - INFO - Archivo generado: .\./data/output\Pedido_Semana_15_2026-02-02_interior.xlsx
2026-02-02 23:19:23 - INFO -   Articulos: 92
2026-02-02 23:19:23 - INFO -   Importe: 2400.45€
2026-02-02 23:19:23 - INFO - 
==================================================
2026-02-02 23:19:23 - INFO - SECCION: FITOS
2026-02-02 23:19:23 - INFO - ==================================================
2026-02-02 23:19:23 - INFO - === LEYENDO DATOS PARA SECCIÓN: FITOS ===
2026-02-02 23:19:23 - INFO - Archivo ABC encontrado para 'fitos': .\./data/input\CLASIFICACION_ABC+D_fitos.xlsx
2026-02-02 23:19:23 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_fitos.xlsx
2026-02-02 23:19:23 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-02 23:19:23 - INFO - Clasificación ABC cargada para 'fitos': 247 registros
2026-02-02 23:19:23 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-02 23:19:27 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 23:19:27 - INFO - Usando hoja: Ventas por vendedor
2026-02-02 23:19:27 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-02 23:19:27 - INFO - Ventas cargadas: 44082 registros
2026-02-02 23:19:27 - INFO - Filtrados 1987 registros de sección 'fitos' de 44082 total
2026-02-02 23:19:27 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-02 23:19:29 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 23:19:29 - INFO - Costes cargados: 22145 registros
2026-02-02 23:19:29 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA FITOS ===
2026-02-02 23:19:29 - INFO -   ABC: 247 registros
2026-02-02 23:19:29 - INFO -   Ventas: 1987 registros
2026-02-02 23:19:29 - INFO -   Costes: 22145 registros
2026-02-02 23:19:29 - INFO - Datos de ventas: 140 registros
2026-02-02 23:19:29 - INFO - Calculando pedido para semana 15 (140 registros)
2026-02-02 23:19:30 - INFO -   Objetivo: 1708.82€, Actual (ABC): 1689.27€
2026-02-02 23:19:30 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.0
2026-02-02 23:19:30 - INFO -   Factor total: 1.0500
2026-02-02 23:19:30 - INFO -   Factor escalado: 1.0622
2026-02-02 23:19:30 - INFO -   Ventas preliminares (con ceil): 2318.88€
2026-02-02 23:19:30 - INFO -   Objetivo final: 1794.26€
2026-02-02 23:19:30 - INFO -   Delta: 524.62€
2026-02-02 23:19:30 - INFO -   Ventas finales: 1805.12€
2026-02-02 23:19:30 - INFO - 
============================================================
2026-02-02 23:19:30 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-02 23:19:30 - INFO - ============================================================
2026-02-02 23:19:30 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-02 23:19:30 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-02 23:19:30 - INFO - DataLoader inicializado correctamente
2026-02-02 23:19:30 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-02 23:19:30 - INFO - ============================================================
2026-02-02 23:19:30 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 15
2026-02-02 23:19:30 - INFO - ============================================================
2026-02-02 23:19:30 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_15.xlsx
2026-02-02 23:19:30 - WARNING - Archivo de corrección no encontrado: Stock_semana_15.xlsx
2026-02-02 23:19:30 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-02 23:19:30 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-02 23:19:30 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-02 23:19:30 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 23:19:30 - INFO - Stock actual cargado: 30 registros
2026-02-02 23:19:30 - INFO -   Stock: 30 registros
2026-02-02 23:19:30 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-02 23:19:30 - INFO - Fusión completada: 92 registros
2026-02-02 23:19:30 - INFO - CorrectionEngine inicializado correctamente
2026-02-02 23:19:30 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-02 23:19:30 - INFO - Corrección completada:
2026-02-02 23:19:30 - INFO -   - Artículos corregidos: 88/92
2026-02-02 23:19:30 - INFO -   - Artículos aumentados: 88
2026-02-02 23:19:30 - INFO -   - Artículos reducidos: 0
2026-02-02 23:19:30 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-02 23:19:30 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 270, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-02 23:19:30 - INFO - Usando pedido teórico (sin corrección)
2026-02-02 23:19:30 - INFO - Generando archivo: .\./data/output\Pedido_Semana_15_2026-02-02_fitos.xlsx
2026-02-02 23:19:30 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_15_2026-02-02_fitos.xlsx
2026-02-02 23:19:30 - INFO - Archivo generado: .\./data/output\Pedido_Semana_15_2026-02-02_fitos.xlsx
2026-02-02 23:19:30 - INFO -   Articulos: 77
2026-02-02 23:19:30 - INFO -   Importe: 1769.24€
2026-02-02 23:19:30 - INFO - 
==================================================
2026-02-02 23:19:30 - INFO - SECCION: VIVERO
2026-02-02 23:19:30 - INFO - ==================================================
2026-02-02 23:19:30 - INFO - === LEYENDO DATOS PARA SECCIÓN: VIVERO ===
2026-02-02 23:19:30 - INFO - Archivo ABC encontrado para 'vivero': .\./data/input\CLASIFICACION_ABC+D_vivero.xlsx
2026-02-02 23:19:30 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_vivero.xlsx
2026-02-02 23:19:30 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-02 23:19:30 - INFO - Clasificación ABC cargada para 'vivero': 565 registros
2026-02-02 23:19:30 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-02 23:19:34 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 23:19:34 - INFO - Usando hoja: Ventas por vendedor
2026-02-02 23:19:34 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-02 23:19:34 - INFO - Ventas cargadas: 44082 registros
2026-02-02 23:19:34 - INFO - Filtrados 2460 registros de sección 'vivero' de 44082 total
2026-02-02 23:19:34 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-02 23:19:36 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 23:19:36 - INFO - Costes cargados: 22145 registros
2026-02-02 23:19:36 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA VIVERO ===
2026-02-02 23:19:36 - INFO -   ABC: 565 registros
2026-02-02 23:19:36 - INFO -   Ventas: 2460 registros
2026-02-02 23:19:36 - INFO -   Costes: 22145 registros
2026-02-02 23:19:36 - INFO - Datos de ventas: 196 registros
2026-02-02 23:19:36 - INFO - Calculando pedido para semana 15 (196 registros)
2026-02-02 23:19:36 - INFO -   Objetivo: 4775.39€, Actual (ABC): 6436.04€
2026-02-02 23:19:36 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.0
2026-02-02 23:19:36 - INFO -   Factor total: 1.0500
2026-02-02 23:19:36 - INFO -   Factor escalado: 0.7791
2026-02-02 23:19:36 - INFO -   Ventas preliminares (con ceil): 5935.58€
2026-02-02 23:19:36 - INFO -   Objetivo final: 5014.16€
2026-02-02 23:19:36 - INFO -   Delta: 921.42€
2026-02-02 23:19:36 - INFO -   Ventas finales: 5014.82€
2026-02-02 23:19:36 - INFO - 
============================================================
2026-02-02 23:19:36 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-02 23:19:36 - INFO - ============================================================
2026-02-02 23:19:36 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-02 23:19:36 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-02 23:19:36 - INFO - DataLoader inicializado correctamente
2026-02-02 23:19:36 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-02 23:19:36 - INFO - ============================================================
2026-02-02 23:19:36 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 15
2026-02-02 23:19:36 - INFO - ============================================================
2026-02-02 23:19:36 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_15.xlsx
2026-02-02 23:19:36 - WARNING - Archivo de corrección no encontrado: Stock_semana_15.xlsx
2026-02-02 23:19:36 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-02 23:19:36 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-02 23:19:36 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-02 23:19:36 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 23:19:36 - INFO - Stock actual cargado: 30 registros
2026-02-02 23:19:36 - INFO -   Stock: 30 registros
2026-02-02 23:19:36 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-02 23:19:36 - INFO - Fusión completada: 115 registros
2026-02-02 23:19:36 - INFO - CorrectionEngine inicializado correctamente
2026-02-02 23:19:36 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-02 23:19:36 - INFO - Corrección completada:
2026-02-02 23:19:36 - INFO -   - Artículos corregidos: 103/115
2026-02-02 23:19:36 - INFO -   - Artículos aumentados: 103
2026-02-02 23:19:36 - INFO -   - Artículos reducidos: 0
2026-02-02 23:19:36 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-02 23:19:36 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 270, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-02 23:19:36 - INFO - Usando pedido teórico (sin corrección)
2026-02-02 23:19:36 - INFO - Generando archivo: .\./data/output\Pedido_Semana_15_2026-02-02_vivero.xlsx
2026-02-02 23:19:36 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_15_2026-02-02_vivero.xlsx
2026-02-02 23:19:36 - INFO - Archivo generado: .\./data/output\Pedido_Semana_15_2026-02-02_vivero.xlsx
2026-02-02 23:19:36 - INFO -   Articulos: 80
2026-02-02 23:19:36 - INFO -   Importe: 4836.14€
2026-02-02 23:19:36 - INFO - 
==================================================
2026-02-02 23:19:36 - INFO - SECCION: UTILES_JARDIN
2026-02-02 23:19:36 - INFO - ==================================================
2026-02-02 23:19:36 - INFO - === LEYENDO DATOS PARA SECCIÓN: UTILES_JARDIN ===
2026-02-02 23:19:36 - INFO - Archivo ABC encontrado para 'utiles_jardin': .\./data/input\CLASIFICACION_ABC+D_utiles_jardin.xlsx
2026-02-02 23:19:36 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_utiles_jardin.xlsx
2026-02-02 23:19:36 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-02 23:19:36 - INFO - Clasificación ABC cargada para 'utiles_jardin': 433 registros
2026-02-02 23:19:36 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-02 23:19:40 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 23:19:40 - INFO - Usando hoja: Ventas por vendedor
2026-02-02 23:19:40 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-02 23:19:40 - INFO - Ventas cargadas: 44082 registros
2026-02-02 23:19:41 - INFO - Filtrados 1009 registros de sección 'utiles_jardin' de 44082 total
2026-02-02 23:19:41 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-02 23:19:43 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 23:19:43 - INFO - Costes cargados: 22145 registros
2026-02-02 23:19:43 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA UTILES_JARDIN ===
2026-02-02 23:19:43 - INFO -   ABC: 433 registros
2026-02-02 23:19:43 - INFO -   Ventas: 1009 registros
2026-02-02 23:19:43 - INFO -   Costes: 22145 registros
2026-02-02 23:19:43 - INFO - Datos de ventas: 78 registros
2026-02-02 23:19:43 - INFO - Calculando pedido para semana 15 (78 registros)
2026-02-02 23:19:43 - INFO -   Objetivo: 978.93€, Actual (ABC): 772.11€
2026-02-02 23:19:43 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.0
2026-02-02 23:19:43 - INFO -   Factor total: 1.0500
2026-02-02 23:19:43 - INFO -   Factor escalado: 1.3313
2026-02-02 23:19:43 - INFO -   Ventas preliminares (con ceil): 1287.72€
2026-02-02 23:19:43 - INFO -   Objetivo final: 1027.88€
2026-02-02 23:19:43 - INFO -   Delta: 259.84€
2026-02-02 23:19:43 - INFO -   Ventas finales: 1028.35€
2026-02-02 23:19:43 - INFO - 
============================================================
2026-02-02 23:19:43 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-02 23:19:43 - INFO - ============================================================
2026-02-02 23:19:43 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-02 23:19:43 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-02 23:19:43 - INFO - DataLoader inicializado correctamente
2026-02-02 23:19:43 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-02 23:19:43 - INFO - ============================================================
2026-02-02 23:19:43 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 15
2026-02-02 23:19:43 - INFO - ============================================================
2026-02-02 23:19:43 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_15.xlsx
2026-02-02 23:19:43 - WARNING - Archivo de corrección no encontrado: Stock_semana_15.xlsx
2026-02-02 23:19:43 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-02 23:19:43 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-02 23:19:43 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-02 23:19:43 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 23:19:43 - INFO - Stock actual cargado: 30 registros
2026-02-02 23:19:43 - INFO -   Stock: 30 registros
2026-02-02 23:19:43 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-02 23:19:43 - INFO - Fusión completada: 67 registros
2026-02-02 23:19:43 - INFO - CorrectionEngine inicializado correctamente
2026-02-02 23:19:43 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-02 23:19:43 - INFO - Corrección completada:
2026-02-02 23:19:43 - INFO -   - Artículos corregidos: 65/67
2026-02-02 23:19:43 - INFO -   - Artículos aumentados: 65
2026-02-02 23:19:43 - INFO -   - Artículos reducidos: 0
2026-02-02 23:19:43 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-02 23:19:43 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 270, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-02 23:19:43 - INFO - Usando pedido teórico (sin corrección)
2026-02-02 23:19:43 - INFO - Generando archivo: .\./data/output\Pedido_Semana_15_2026-02-02_utiles_jardin.xlsx
2026-02-02 23:19:43 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_15_2026-02-02_utiles_jardin.xlsx
2026-02-02 23:19:43 - INFO - Archivo generado: .\./data/output\Pedido_Semana_15_2026-02-02_utiles_jardin.xlsx
2026-02-02 23:19:43 - INFO -   Articulos: 63
2026-02-02 23:19:43 - INFO -   Importe: 1028.35€
2026-02-02 23:19:43 - INFO - 
==================================================
2026-02-02 23:19:43 - INFO - SECCION: TIERRAS_ARIDOS
2026-02-02 23:19:43 - INFO - ==================================================
2026-02-02 23:19:43 - INFO - === LEYENDO DATOS PARA SECCIÓN: TIERRAS_ARIDOS ===
2026-02-02 23:19:43 - WARNING - No se encontró archivo específico para 'tierras_aridos', usando: .\./data/input\CLASIFICACION_ABC+D_DECO_EXTERIOR.xlsx
2026-02-02 23:19:43 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_DECO_EXTERIOR.xlsx
2026-02-02 23:19:43 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-02 23:19:43 - INFO - Clasificación ABC cargada para 'tierras_aridos': 995 registros
2026-02-02 23:19:43 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-02 23:19:47 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 23:19:47 - INFO - Usando hoja: Ventas por vendedor
2026-02-02 23:19:47 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-02 23:19:47 - INFO - Ventas cargadas: 44082 registros
2026-02-02 23:19:47 - INFO - Filtrados 3264 registros de sección 'tierras_aridos' de 44082 total
2026-02-02 23:19:47 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-02 23:19:49 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 23:19:49 - INFO - Costes cargados: 22145 registros
2026-02-02 23:19:49 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA TIERRAS_ARIDOS ===
2026-02-02 23:19:49 - INFO -   ABC: 995 registros
2026-02-02 23:19:49 - INFO -   Ventas: 3264 registros
2026-02-02 23:19:49 - INFO -   Costes: 22145 registros
2026-02-02 23:19:49 - INFO - Datos de ventas: 257 registros
2026-02-02 23:19:49 - INFO - Calculando pedido para semana 15 (257 registros)
2026-02-02 23:19:50 - INFO -   Objetivo: 3489.25€, Actual (ABC): 3157.98€
2026-02-02 23:19:50 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.0
2026-02-02 23:19:50 - INFO -   Factor total: 1.0500
2026-02-02 23:19:50 - INFO -   Factor escalado: 1.1601
2026-02-02 23:19:50 - INFO -   Ventas preliminares (con ceil): 4053.35€
2026-02-02 23:19:50 - INFO -   Objetivo final: 3663.71€
2026-02-02 23:19:50 - INFO -   Delta: 389.64€
2026-02-02 23:19:50 - INFO -   Ventas finales: 3666.91€
2026-02-02 23:19:50 - INFO - 
============================================================
2026-02-02 23:19:50 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-02 23:19:50 - INFO - ============================================================
2026-02-02 23:19:50 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-02 23:19:50 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-02 23:19:50 - INFO - DataLoader inicializado correctamente
2026-02-02 23:19:50 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-02 23:19:50 - INFO - ============================================================
2026-02-02 23:19:50 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 15
2026-02-02 23:19:50 - INFO - ============================================================
2026-02-02 23:19:50 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_15.xlsx
2026-02-02 23:19:50 - WARNING - Archivo de corrección no encontrado: Stock_semana_15.xlsx
2026-02-02 23:19:50 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-02 23:19:50 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-02 23:19:50 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-02 23:19:50 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 23:19:50 - INFO - Stock actual cargado: 30 registros
2026-02-02 23:19:50 - INFO -   Stock: 30 registros
2026-02-02 23:19:50 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-02 23:19:50 - INFO - Fusión completada: 69 registros
2026-02-02 23:19:50 - INFO - CorrectionEngine inicializado correctamente
2026-02-02 23:19:50 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-02 23:19:50 - INFO - Corrección completada:
2026-02-02 23:19:50 - INFO -   - Artículos corregidos: 69/69
2026-02-02 23:19:50 - INFO -   - Artículos aumentados: 69
2026-02-02 23:19:50 - INFO -   - Artículos reducidos: 0
2026-02-02 23:19:50 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-02 23:19:50 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 270, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-02 23:19:50 - INFO - Usando pedido teórico (sin corrección)
2026-02-02 23:19:50 - INFO - Generando archivo: .\./data/output\Pedido_Semana_15_2026-02-02_tierras_aridos.xlsx
2026-02-02 23:19:50 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_15_2026-02-02_tierras_aridos.xlsx
2026-02-02 23:19:50 - INFO - Archivo generado: .\./data/output\Pedido_Semana_15_2026-02-02_tierras_aridos.xlsx
2026-02-02 23:19:50 - INFO -   Articulos: 61
2026-02-02 23:19:50 - INFO -   Importe: 3614.01€
2026-02-02 23:19:50 - INFO - 
==================================================
2026-02-02 23:19:50 - INFO - SECCION: DECO_EXTERIOR
2026-02-02 23:19:50 - INFO - ==================================================
2026-02-02 23:19:50 - INFO - === LEYENDO DATOS PARA SECCIÓN: DECO_EXTERIOR ===
2026-02-02 23:19:50 - INFO - Archivo ABC encontrado para 'deco_exterior': .\./data/input\CLASIFICACION_ABC+D_deco_exterior.xlsx
2026-02-02 23:19:50 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_deco_exterior.xlsx
2026-02-02 23:19:50 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-02 23:19:50 - INFO - Clasificación ABC cargada para 'deco_exterior': 995 registros
2026-02-02 23:19:50 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-02 23:19:54 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 23:19:54 - INFO - Usando hoja: Ventas por vendedor
2026-02-02 23:19:54 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-02 23:19:54 - INFO - Ventas cargadas: 44082 registros
2026-02-02 23:19:54 - INFO - Filtrados 4018 registros de sección 'deco_exterior' de 44082 total
2026-02-02 23:19:54 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-02 23:19:56 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 23:19:56 - INFO - Costes cargados: 22145 registros
2026-02-02 23:19:56 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA DECO_EXTERIOR ===
2026-02-02 23:19:56 - INFO -   ABC: 995 registros
2026-02-02 23:19:56 - INFO -   Ventas: 4018 registros
2026-02-02 23:19:56 - INFO -   Costes: 22145 registros
2026-02-02 23:19:56 - INFO - Datos de ventas: 267 registros
2026-02-02 23:19:56 - INFO - Calculando pedido para semana 15 (267 registros)
2026-02-02 23:19:57 - INFO -   Objetivo: 3413.58€, Actual (ABC): 3445.57€
2026-02-02 23:19:57 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.0
2026-02-02 23:19:57 - INFO -   Factor total: 1.0500
2026-02-02 23:19:57 - INFO -   Factor escalado: 1.0403
2026-02-02 23:19:57 - INFO -   Ventas preliminares (con ceil): 4676.23€
2026-02-02 23:19:57 - INFO -   Objetivo final: 3584.26€
2026-02-02 23:19:57 - INFO -   Delta: 1091.97€
2026-02-02 23:19:57 - INFO -   Ventas finales: 3588.71€
2026-02-02 23:19:57 - INFO - 
============================================================
2026-02-02 23:19:57 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-02 23:19:57 - INFO - ============================================================
2026-02-02 23:19:57 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-02 23:19:57 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-02 23:19:57 - INFO - DataLoader inicializado correctamente
2026-02-02 23:19:57 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-02 23:19:57 - INFO - ============================================================
2026-02-02 23:19:57 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 15
2026-02-02 23:19:57 - INFO - ============================================================
2026-02-02 23:19:57 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_15.xlsx
2026-02-02 23:19:57 - WARNING - Archivo de corrección no encontrado: Stock_semana_15.xlsx
2026-02-02 23:19:57 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-02 23:19:57 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-02 23:19:57 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-02 23:19:57 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-02 23:19:57 - INFO - Stock actual cargado: 30 registros
2026-02-02 23:19:57 - INFO -   Stock: 30 registros
2026-02-02 23:19:57 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-02 23:19:57 - INFO - Fusión completada: 196 registros
2026-02-02 23:19:57 - INFO - CorrectionEngine inicializado correctamente
2026-02-02 23:19:57 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-02 23:19:57 - INFO - Corrección completada:
2026-02-02 23:19:57 - INFO -   - Artículos corregidos: 178/196
2026-02-02 23:19:57 - INFO -   - Artículos aumentados: 178
2026-02-02 23:19:57 - INFO -   - Artículos reducidos: 0
2026-02-02 23:19:57 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-02 23:19:57 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 270, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-02 23:19:57 - INFO - Usando pedido teórico (sin corrección)
2026-02-02 23:19:57 - INFO - Generando archivo: .\./data/output\Pedido_Semana_15_2026-02-02_deco_exterior.xlsx
2026-02-02 23:19:57 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_15_2026-02-02_deco_exterior.xlsx
2026-02-02 23:19:57 - INFO - Archivo generado: .\./data/output\Pedido_Semana_15_2026-02-02_deco_exterior.xlsx
2026-02-02 23:19:57 - INFO -   Articulos: 159
2026-02-02 23:19:57 - INFO -   Importe: 3557.20€
2026-02-02 23:19:57 - INFO - Estado guardado correctamente
2026-02-02 23:19:57 - INFO - Generando resumen: .\./data/output\Resumen_Pedidos_VIVERO_2026-02-02.xlsx
2026-02-02 23:19:57 - INFO - Resumen guardado: .\./data/output\Resumen_Pedidos_VIVERO_2026-02-02.xlsx
2026-02-02 23:19:57 - INFO - Estado guardado correctamente
2026-02-02 23:19:57 - INFO - 
======================================================================
2026-02-02 23:19:57 - INFO - RESUMEN DE EJECUCION
2026-02-02 23:19:57 - INFO - ======================================================================
2026-02-02 23:19:57 - INFO - Semana procesada: 15
2026-02-02 23:19:57 - INFO - Archivos generados: 12
2026-02-02 23:19:57 - INFO - Total articulos: 1171
2026-02-02 23:19:57 - INFO - Total importe: 33939.91€
2026-02-02 23:19:57 - INFO - ======================================================================
2026-02-02 23:19:57 - INFO - 
¡PEDIDO GENERADO EXITOSAMENTE!
2026-02-02 23:19:57 - INFO - Archivo principal: .\./data/output\Pedido_Semana_15_2026-02-02_maf.xlsx
2026-02-02 23:19:57 - INFO - Articulos: 1171
2026-02-02 23:19:57 - INFO - Importe: 33939.91€
2026-02-03 01:16:34 - INFO - ======================================================================
2026-02-03 01:16:34 - INFO - SISTEMA DE PEDIDOS DE COMPRA - VIVERO ARANJUEZ V2
2026-02-03 01:16:34 - INFO - Fecha de ejecución: 2026-02-03 01:16:34
2026-02-03 01:16:34 - INFO - ======================================================================
2026-02-03 01:16:34 - INFO - 
VERIFICANDO CONFIGURACIÓN DE EMAIL:
2026-02-03 01:16:34 - INFO - ----------------------------------------
2026-02-03 01:16:34 - INFO - EmailService inicializado correctamente
2026-02-03 01:16:34 - ERROR - La variable de entorno 'EMAIL_PASSWORD' no está configurada. Por favor, configúrala antes de enviar emails.
2026-02-03 01:16:34 - WARNING - Problemas de configuración detectados:
2026-02-03 01:16:34 - WARNING -   - La variable de entorno 'EMAIL_PASSWORD' no está configurada
2026-02-03 01:16:34 - INFO - ✓ Configuración de email válida
2026-02-03 01:16:34 - WARNING - ✗ Variable EMAIL_PASSWORD NO configurada
2026-02-03 01:16:34 - INFO -   Para configurarla, ejecuta:
2026-02-03 01:16:34 - INFO -   export EMAIL_PASSWORD='tu_contraseña'
2026-02-03 01:30:25 - INFO - ======================================================================
2026-02-03 01:30:25 - INFO - SISTEMA DE PEDIDOS DE COMPRA - VIVERO ARANJUEZ V2
2026-02-03 01:30:25 - INFO - Fecha de ejecución: 2026-02-03 01:30:25
2026-02-03 01:30:25 - INFO - ======================================================================
2026-02-03 01:30:25 - INFO - Modo de ejecución: FASE 1 + FASE 2
2026-02-03 01:30:25 - INFO - Envío de emails: Sí
2026-02-03 01:30:25 - INFO - StateManager inicializado. Archivo de estado: .\./data\state.json
2026-02-03 01:30:25 - INFO - Cargando estado desde: .\./data\state.json
2026-02-03 01:30:25 - INFO - Estado cargado correctamente
2026-02-03 01:30:25 - INFO - SchedulerService inicializado correctamente
2026-02-03 01:30:25 - INFO - Horario configurado: sunday a las 15:00
2026-02-03 01:30:25 - WARNING - No es el horario de ejecución: Hoy es martes, no es domingo
2026-02-03 01:30:25 - INFO - La próxima ejecución será el domingo 08/02/2026 a las 15:00
2026-02-03 01:30:25 - INFO - pero hay semana pendiente: Semana a procesar: 16
2026-02-03 01:30:25 - INFO - Use --continuo para esperar hasta el horario de ejecución.
2026-02-03 01:31:04 - INFO - ======================================================================
2026-02-03 01:31:04 - INFO - SISTEMA DE PEDIDOS DE COMPRA - VIVERO ARANJUEZ V2
2026-02-03 01:31:04 - INFO - Fecha de ejecución: 2026-02-03 01:31:04
2026-02-03 01:31:04 - INFO - ======================================================================
2026-02-03 01:31:04 - INFO - Modo de ejecución: FASE 1 + FASE 2
2026-02-03 01:31:04 - INFO - Envío de emails: Sí
2026-02-03 01:31:04 - INFO - StateManager inicializado. Archivo de estado: .\./data\state.json
2026-02-03 01:31:04 - INFO - Cargando estado desde: .\./data\state.json
2026-02-03 01:31:04 - INFO - Estado cargado correctamente
2026-02-03 01:31:04 - INFO - SchedulerService inicializado correctamente
2026-02-03 01:31:04 - INFO - Horario configurado: sunday a las 15:00
2026-02-03 01:31:04 - INFO - Semana forzada por argumento: 14
2026-02-03 01:31:04 - INFO - ======================================================================
2026-02-03 01:31:04 - INFO - PROCESANDO PEDIDO PARA SEMANA 14
2026-02-03 01:31:04 - INFO - ======================================================================
2026-02-03 01:31:04 - INFO - MODO: FASE 1 (Forecast) + FASE 2 (Corrección)
2026-02-03 01:31:04 - INFO - DataLoader inicializado correctamente
2026-02-03 01:31:04 - INFO - ForecastEngine inicializado correctamente
2026-02-03 01:31:04 - INFO - OrderGenerator inicializado correctamente
2026-02-03 01:31:04 - INFO - SchedulerService inicializado correctamente
2026-02-03 01:31:04 - INFO - Horario configurado: sunday a las 15:00
2026-02-03 01:31:04 - INFO - Período de la semana: 2026-03-30 al 2026-04-05
2026-02-03 01:31:04 - INFO - Stock acumulado cargado: 2633 artículos
2026-02-03 01:31:04 - INFO - 
==================================================
2026-02-03 01:31:04 - INFO - SECCION: MAF
2026-02-03 01:31:04 - INFO - ==================================================
2026-02-03 01:31:04 - INFO - === LEYENDO DATOS PARA SECCIÓN: MAF ===
2026-02-03 01:31:04 - INFO - Archivo ABC encontrado para 'maf': .\./data/input\CLASIFICACION_ABC+D_maf.xlsx
2026-02-03 01:31:04 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_maf.xlsx
2026-02-03 01:31:04 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 01:31:04 - INFO - Clasificación ABC cargada para 'maf': 499 registros
2026-02-03 01:31:04 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 01:31:08 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 01:31:08 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 01:31:08 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 01:31:09 - INFO - Ventas cargadas: 44082 registros
2026-02-03 01:31:09 - INFO - Filtrados 10970 registros de sección 'maf' de 44082 total
2026-02-03 01:31:09 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 01:31:11 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 01:31:11 - INFO - Costes cargados: 22145 registros
2026-02-03 01:31:11 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MAF ===
2026-02-03 01:31:11 - INFO -   ABC: 499 registros
2026-02-03 01:31:11 - INFO -   Ventas: 10970 registros
2026-02-03 01:31:11 - INFO -   Costes: 22145 registros
2026-02-03 01:31:11 - INFO - Datos de ventas: 1011 registros
2026-02-03 01:31:11 - INFO - Calculando pedido para semana 14 (1011 registros)
2026-02-03 01:31:11 - INFO -   Objetivo: 7050.65€, Actual (ABC): 5843.77€
2026-02-03 01:31:11 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 01:31:11 - INFO -   Factor total: 1.3125
2026-02-03 01:31:11 - INFO -   Factor escalado: 1.5836
2026-02-03 01:31:11 - INFO -   Ventas preliminares (con ceil): 9931.01€
2026-02-03 01:31:11 - INFO -   Objetivo final: 9253.98€
2026-02-03 01:31:11 - INFO -   Delta: 677.03€
2026-02-03 01:31:11 - INFO -   Ventas finales: 9259.59€
2026-02-03 01:31:11 - INFO - 
============================================================
2026-02-03 01:31:11 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 01:31:11 - INFO - ============================================================
2026-02-03 01:31:11 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 01:31:11 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 01:31:11 - INFO - DataLoader inicializado correctamente
2026-02-03 01:31:11 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 01:31:11 - INFO - ============================================================
2026-02-03 01:31:11 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 01:31:11 - INFO - ============================================================
2026-02-03 01:31:11 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 01:31:11 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 01:31:11 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 01:31:11 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 01:31:11 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 01:31:11 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 01:31:11 - INFO - Stock actual cargado: 30 registros
2026-02-03 01:31:11 - INFO -   Stock: 30 registros
2026-02-03 01:31:11 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 01:31:11 - INFO - Fusión completada: 222 registros
2026-02-03 01:31:11 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 01:31:11 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 01:31:11 - INFO - Corrección completada:
2026-02-03 01:31:11 - INFO -   - Artículos corregidos: 209/222
2026-02-03 01:31:11 - INFO -   - Artículos aumentados: 209
2026-02-03 01:31:11 - INFO -   - Artículos reducidos: 0
2026-02-03 01:31:11 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 01:31:11 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 01:31:11 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 01:31:11 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 01:31:12 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 01:31:12 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 01:31:12 - INFO -   Articulos: 185
2026-02-03 01:31:12 - INFO -   Importe: 9197.06€
2026-02-03 01:31:12 - INFO - 
==================================================
2026-02-03 01:31:12 - INFO - SECCION: DECO_INTERIOR
2026-02-03 01:31:12 - INFO - ==================================================
2026-02-03 01:31:12 - INFO - === LEYENDO DATOS PARA SECCIÓN: DECO_INTERIOR ===
2026-02-03 01:31:12 - INFO - Archivo ABC encontrado para 'deco_interior': .\./data/input\CLASIFICACION_ABC+D_deco_interior.xlsx
2026-02-03 01:31:12 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_deco_interior.xlsx
2026-02-03 01:31:12 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 01:31:12 - INFO - Clasificación ABC cargada para 'deco_interior': 1827 registros
2026-02-03 01:31:12 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 01:31:16 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 01:31:16 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 01:31:16 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 01:31:16 - INFO - Ventas cargadas: 44082 registros
2026-02-03 01:31:16 - INFO - Filtrados 2468 registros de sección 'deco_interior' de 44082 total
2026-02-03 01:31:16 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 01:31:18 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 01:31:18 - INFO - Costes cargados: 22145 registros
2026-02-03 01:31:18 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA DECO_INTERIOR ===
2026-02-03 01:31:18 - INFO -   ABC: 1827 registros
2026-02-03 01:31:18 - INFO -   Ventas: 2468 registros
2026-02-03 01:31:18 - INFO -   Costes: 22145 registros
2026-02-03 01:31:18 - INFO - Datos de ventas: 180 registros
2026-02-03 01:31:18 - INFO - Calculando pedido para semana 14 (180 registros)
2026-02-03 01:31:19 - INFO -   Objetivo: 1962.99€, Actual (ABC): 1636.15€
2026-02-03 01:31:19 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 01:31:19 - INFO -   Factor total: 1.3125
2026-02-03 01:31:19 - INFO -   Factor escalado: 1.5747
2026-02-03 01:31:19 - INFO -   Ventas preliminares (con ceil): 2950.01€
2026-02-03 01:31:19 - INFO -   Objetivo final: 2576.42€
2026-02-03 01:31:19 - INFO -   Delta: 373.59€
2026-02-03 01:31:19 - INFO -   Ventas finales: 2580.73€
2026-02-03 01:31:19 - INFO - 
============================================================
2026-02-03 01:31:19 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 01:31:19 - INFO - ============================================================
2026-02-03 01:31:19 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 01:31:19 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 01:31:19 - INFO - DataLoader inicializado correctamente
2026-02-03 01:31:19 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 01:31:19 - INFO - ============================================================
2026-02-03 01:31:19 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 01:31:19 - INFO - ============================================================
2026-02-03 01:31:19 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 01:31:19 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 01:31:19 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 01:31:19 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 01:31:19 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 01:31:19 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 01:31:19 - INFO - Stock actual cargado: 30 registros
2026-02-03 01:31:19 - INFO -   Stock: 30 registros
2026-02-03 01:31:19 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 01:31:19 - INFO - Fusión completada: 139 registros
2026-02-03 01:31:19 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 01:31:19 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 01:31:19 - INFO - Corrección completada:
2026-02-03 01:31:19 - INFO -   - Artículos corregidos: 138/139
2026-02-03 01:31:19 - INFO -   - Artículos aumentados: 138
2026-02-03 01:31:19 - INFO -   - Artículos reducidos: 0
2026-02-03 01:31:19 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 01:31:19 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 01:31:19 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 01:31:19 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_deco_interior.xlsx
2026-02-03 01:31:19 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_deco_interior.xlsx
2026-02-03 01:31:19 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_deco_interior.xlsx
2026-02-03 01:31:19 - INFO -   Articulos: 135
2026-02-03 01:31:19 - INFO -   Importe: 2580.73€
2026-02-03 01:31:19 - INFO - 
==================================================
2026-02-03 01:31:19 - INFO - SECCION: SEMILLAS
2026-02-03 01:31:19 - INFO - ==================================================
2026-02-03 01:31:19 - INFO - === LEYENDO DATOS PARA SECCIÓN: SEMILLAS ===
2026-02-03 01:31:19 - INFO - Archivo ABC encontrado para 'semillas': .\./data/input\CLASIFICACION_ABC+D_semillas.xlsx
2026-02-03 01:31:19 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_semillas.xlsx
2026-02-03 01:31:19 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 01:31:19 - INFO - Clasificación ABC cargada para 'semillas': 218 registros
2026-02-03 01:31:19 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 01:31:23 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 01:31:23 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 01:31:23 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 01:31:23 - INFO - Ventas cargadas: 44082 registros
2026-02-03 01:31:23 - INFO - Filtrados 1180 registros de sección 'semillas' de 44082 total
2026-02-03 01:31:23 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 01:31:25 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 01:31:25 - INFO - Costes cargados: 22145 registros
2026-02-03 01:31:25 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA SEMILLAS ===
2026-02-03 01:31:25 - INFO -   ABC: 218 registros
2026-02-03 01:31:25 - INFO -   Ventas: 1180 registros
2026-02-03 01:31:25 - INFO -   Costes: 22145 registros
2026-02-03 01:31:25 - INFO - Datos de ventas: 136 registros
2026-02-03 01:31:25 - INFO - Calculando pedido para semana 14 (136 registros)
2026-02-03 01:31:26 - INFO -   Objetivo: 694.34€, Actual (ABC): 455.14€
2026-02-03 01:31:26 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 01:31:26 - INFO -   Factor total: 1.3125
2026-02-03 01:31:26 - INFO -   Factor escalado: 2.0023
2026-02-03 01:31:26 - INFO -   Ventas preliminares (con ceil): 1129.15€
2026-02-03 01:31:26 - INFO -   Objetivo final: 911.32€
2026-02-03 01:31:26 - INFO -   Delta: 217.83€
2026-02-03 01:31:26 - INFO -   Ventas finales: 911.60€
2026-02-03 01:31:26 - INFO - 
============================================================
2026-02-03 01:31:26 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 01:31:26 - INFO - ============================================================
2026-02-03 01:31:26 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 01:31:26 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 01:31:26 - INFO - DataLoader inicializado correctamente
2026-02-03 01:31:26 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 01:31:26 - INFO - ============================================================
2026-02-03 01:31:26 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 01:31:26 - INFO - ============================================================
2026-02-03 01:31:26 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 01:31:26 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 01:31:26 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 01:31:26 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 01:31:26 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 01:31:26 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 01:31:26 - INFO - Stock actual cargado: 30 registros
2026-02-03 01:31:26 - INFO -   Stock: 30 registros
2026-02-03 01:31:26 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 01:31:26 - INFO - Fusión completada: 84 registros
2026-02-03 01:31:26 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 01:31:26 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 01:31:26 - INFO - Corrección completada:
2026-02-03 01:31:26 - INFO -   - Artículos corregidos: 84/84
2026-02-03 01:31:26 - INFO -   - Artículos aumentados: 84
2026-02-03 01:31:26 - INFO -   - Artículos reducidos: 0
2026-02-03 01:31:26 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 01:31:26 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 01:31:26 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 01:31:26 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_semillas.xlsx
2026-02-03 01:31:26 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_semillas.xlsx
2026-02-03 01:31:26 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_semillas.xlsx
2026-02-03 01:31:26 - INFO -   Articulos: 84
2026-02-03 01:31:26 - INFO -   Importe: 911.60€
2026-02-03 01:31:26 - INFO - 
==================================================
2026-02-03 01:31:26 - INFO - SECCION: MASCOTAS_VIVO
2026-02-03 01:31:26 - INFO - ==================================================
2026-02-03 01:31:26 - INFO - === LEYENDO DATOS PARA SECCIÓN: MASCOTAS_VIVO ===
2026-02-03 01:31:26 - INFO - Archivo ABC encontrado para 'mascotas_vivo': .\./data/input\CLASIFICACION_ABC+D_mascotas_vivo.xlsx
2026-02-03 01:31:26 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_mascotas_vivo.xlsx
2026-02-03 01:31:26 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 01:31:26 - INFO - Clasificación ABC cargada para 'mascotas_vivo': 205 registros
2026-02-03 01:31:26 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 01:31:30 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 01:31:30 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 01:31:30 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 01:31:30 - INFO - Ventas cargadas: 44082 registros
2026-02-03 01:31:30 - INFO - Filtrados 1124 registros de sección 'mascotas_vivo' de 44082 total
2026-02-03 01:31:30 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 01:31:33 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 01:31:33 - INFO - Costes cargados: 22145 registros
2026-02-03 01:31:33 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MASCOTAS_VIVO ===
2026-02-03 01:31:33 - INFO -   ABC: 205 registros
2026-02-03 01:31:33 - INFO -   Ventas: 1124 registros
2026-02-03 01:31:33 - INFO -   Costes: 22145 registros
2026-02-03 01:31:33 - INFO - Datos de ventas: 88 registros
2026-02-03 01:31:33 - INFO - Calculando pedido para semana 14 (88 registros)
2026-02-03 01:31:33 - INFO -   Objetivo: 1087.15€, Actual (ABC): 846.63€
2026-02-03 01:31:33 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 01:31:33 - INFO -   Factor total: 1.3125
2026-02-03 01:31:33 - INFO -   Factor escalado: 1.6854
2026-02-03 01:31:33 - INFO -   Ventas preliminares (con ceil): 1773.66€
2026-02-03 01:31:33 - INFO -   Objetivo final: 1426.88€
2026-02-03 01:31:33 - INFO -   Delta: 346.78€
2026-02-03 01:31:33 - INFO -   Ventas finales: 1455.34€
2026-02-03 01:31:33 - INFO - 
============================================================
2026-02-03 01:31:33 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 01:31:33 - INFO - ============================================================
2026-02-03 01:31:33 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 01:31:33 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 01:31:33 - INFO - DataLoader inicializado correctamente
2026-02-03 01:31:33 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 01:31:33 - INFO - ============================================================
2026-02-03 01:31:33 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 01:31:33 - INFO - ============================================================
2026-02-03 01:31:33 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 01:31:33 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 01:31:33 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 01:31:33 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 01:31:33 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 01:31:33 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 01:31:33 - INFO - Stock actual cargado: 30 registros
2026-02-03 01:31:33 - INFO -   Stock: 30 registros
2026-02-03 01:31:33 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 01:31:33 - INFO - Fusión completada: 43 registros
2026-02-03 01:31:33 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 01:31:33 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 01:31:33 - INFO - Corrección completada:
2026-02-03 01:31:33 - INFO -   - Artículos corregidos: 42/43
2026-02-03 01:31:33 - INFO -   - Artículos aumentados: 42
2026-02-03 01:31:33 - INFO -   - Artículos reducidos: 0
2026-02-03 01:31:33 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 01:31:33 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 01:31:33 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 01:31:33 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx
2026-02-03 01:31:33 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx
2026-02-03 01:31:33 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx
2026-02-03 01:31:33 - INFO -   Articulos: 36
2026-02-03 01:31:33 - INFO -   Importe: 1455.34€
2026-02-03 01:31:33 - INFO - 
==================================================
2026-02-03 01:31:33 - INFO - SECCION: MASCOTAS_MANUFACTURADO
2026-02-03 01:31:33 - INFO - ==================================================
2026-02-03 01:31:33 - INFO - === LEYENDO DATOS PARA SECCIÓN: MASCOTAS_MANUFACTURADO ===
2026-02-03 01:31:33 - INFO - Archivo ABC encontrado para 'mascotas_manufacturado': .\./data/input\CLASIFICACION_ABC+D_mascotas_manufacturado.xlsx
2026-02-03 01:31:33 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_mascotas_manufacturado.xlsx
2026-02-03 01:31:34 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 01:31:34 - INFO - Clasificación ABC cargada para 'mascotas_manufacturado': 2749 registros
2026-02-03 01:31:34 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 01:31:39 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 01:31:39 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 01:31:39 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 01:31:39 - INFO - Ventas cargadas: 44082 registros
2026-02-03 01:31:39 - INFO - Filtrados 9784 registros de sección 'mascotas_manufacturado' de 44082 total
2026-02-03 01:31:39 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 01:31:41 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 01:31:41 - INFO - Costes cargados: 22145 registros
2026-02-03 01:31:41 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MASCOTAS_MANUFACTURADO ===
2026-02-03 01:31:41 - INFO -   ABC: 2749 registros
2026-02-03 01:31:41 - INFO -   Ventas: 9784 registros
2026-02-03 01:31:41 - INFO -   Costes: 22145 registros
2026-02-03 01:31:41 - INFO - Datos de ventas: 822 registros
2026-02-03 01:31:41 - INFO - Calculando pedido para semana 14 (822 registros)
2026-02-03 01:31:43 - INFO -   Objetivo: 6839.82€, Actual (ABC): 8742.92€
2026-02-03 01:31:43 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 01:31:43 - INFO -   Factor total: 1.3125
2026-02-03 01:31:43 - INFO -   Factor escalado: 1.0268
2026-02-03 01:31:43 - INFO -   Ventas preliminares (con ceil): 12379.25€
2026-02-03 01:31:43 - INFO -   Objetivo final: 8977.26€
2026-02-03 01:31:43 - INFO -   Delta: 3401.99€
2026-02-03 01:31:43 - INFO -   Ventas finales: 8993.98€
2026-02-03 01:31:43 - INFO - 
============================================================
2026-02-03 01:31:43 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 01:31:43 - INFO - ============================================================
2026-02-03 01:31:43 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 01:31:43 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 01:31:43 - INFO - DataLoader inicializado correctamente
2026-02-03 01:31:43 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 01:31:43 - INFO - ============================================================
2026-02-03 01:31:43 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 01:31:43 - INFO - ============================================================
2026-02-03 01:31:43 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 01:31:43 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 01:31:43 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 01:31:43 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 01:31:43 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 01:31:43 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 01:31:43 - INFO - Stock actual cargado: 30 registros
2026-02-03 01:31:43 - INFO -   Stock: 30 registros
2026-02-03 01:31:43 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 01:31:43 - INFO - Fusión completada: 538 registros
2026-02-03 01:31:43 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 01:31:43 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 01:31:43 - INFO - Corrección completada:
2026-02-03 01:31:43 - INFO -   - Artículos corregidos: 512/538
2026-02-03 01:31:43 - INFO -   - Artículos aumentados: 512
2026-02-03 01:31:43 - INFO -   - Artículos reducidos: 0
2026-02-03 01:31:43 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 01:31:43 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 01:31:43 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 01:31:43 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx
2026-02-03 01:31:44 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx
2026-02-03 01:31:44 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx
2026-02-03 01:31:44 - INFO -   Articulos: 407
2026-02-03 01:31:44 - INFO -   Importe: 8966.44€
2026-02-03 01:31:44 - INFO - 
==================================================
2026-02-03 01:31:44 - INFO - SECCION: INTERIOR
2026-02-03 01:31:44 - INFO - ==================================================
2026-02-03 01:31:44 - INFO - === LEYENDO DATOS PARA SECCIÓN: INTERIOR ===
2026-02-03 01:31:44 - INFO - Archivo ABC encontrado para 'interior': .\./data/input\CLASIFICACION_ABC+D_interior.xlsx
2026-02-03 01:31:44 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_interior.xlsx
2026-02-03 01:31:44 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 01:31:44 - INFO - Clasificación ABC cargada para 'interior': 555 registros
2026-02-03 01:31:44 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 01:31:48 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 01:31:48 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 01:31:48 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 01:31:48 - INFO - Ventas cargadas: 44082 registros
2026-02-03 01:31:48 - INFO - Filtrados 3624 registros de sección 'interior' de 44082 total
2026-02-03 01:31:48 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 01:31:51 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 01:31:51 - INFO - Costes cargados: 22145 registros
2026-02-03 01:31:51 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA INTERIOR ===
2026-02-03 01:31:51 - INFO -   ABC: 555 registros
2026-02-03 01:31:51 - INFO -   Ventas: 3624 registros
2026-02-03 01:31:51 - INFO -   Costes: 22145 registros
2026-02-03 01:31:51 - INFO - Datos de ventas: 286 registros
2026-02-03 01:31:51 - INFO - Calculando pedido para semana 14 (286 registros)
2026-02-03 01:31:52 - INFO -   Objetivo: 2930.63€, Actual (ABC): 2409.44€
2026-02-03 01:31:52 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 01:31:52 - INFO -   Factor total: 1.3125
2026-02-03 01:31:52 - INFO -   Factor escalado: 1.5964
2026-02-03 01:31:52 - INFO -   Ventas preliminares (con ceil): 4541.81€
2026-02-03 01:31:52 - INFO -   Objetivo final: 3846.45€
2026-02-03 01:31:52 - INFO -   Delta: 695.36€
2026-02-03 01:31:52 - INFO -   Ventas finales: 3855.17€
2026-02-03 01:31:52 - INFO - 
============================================================
2026-02-03 01:31:52 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 01:31:52 - INFO - ============================================================
2026-02-03 01:31:52 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 01:31:52 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 01:31:52 - INFO - DataLoader inicializado correctamente
2026-02-03 01:31:52 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 01:31:52 - INFO - ============================================================
2026-02-03 01:31:52 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 01:31:52 - INFO - ============================================================
2026-02-03 01:31:52 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 01:31:52 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 01:31:52 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 01:31:52 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 01:31:52 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 01:31:52 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 01:31:52 - INFO - Stock actual cargado: 30 registros
2026-02-03 01:31:52 - INFO -   Stock: 30 registros
2026-02-03 01:31:52 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 01:31:52 - INFO - Fusión completada: 138 registros
2026-02-03 01:31:52 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 01:31:52 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 01:31:52 - INFO - Corrección completada:
2026-02-03 01:31:52 - INFO -   - Artículos corregidos: 124/138
2026-02-03 01:31:52 - INFO -   - Artículos aumentados: 124
2026-02-03 01:31:52 - INFO -   - Artículos reducidos: 0
2026-02-03 01:31:52 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 01:31:52 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 01:31:52 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 01:31:52 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_interior.xlsx
2026-02-03 01:31:52 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_interior.xlsx
2026-02-03 01:31:52 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_interior.xlsx
2026-02-03 01:31:52 - INFO -   Articulos: 118
2026-02-03 01:31:52 - INFO -   Importe: 3828.83€
2026-02-03 01:31:52 - INFO - 
==================================================
2026-02-03 01:31:52 - INFO - SECCION: FITOS
2026-02-03 01:31:52 - INFO - ==================================================
2026-02-03 01:31:52 - INFO - === LEYENDO DATOS PARA SECCIÓN: FITOS ===
2026-02-03 01:31:52 - INFO - Archivo ABC encontrado para 'fitos': .\./data/input\CLASIFICACION_ABC+D_fitos.xlsx
2026-02-03 01:31:52 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_fitos.xlsx
2026-02-03 01:31:52 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 01:31:52 - INFO - Clasificación ABC cargada para 'fitos': 247 registros
2026-02-03 01:31:52 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 01:31:57 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 01:31:57 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 01:31:57 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 01:31:57 - INFO - Ventas cargadas: 44082 registros
2026-02-03 01:31:57 - INFO - Filtrados 1987 registros de sección 'fitos' de 44082 total
2026-02-03 01:31:57 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 01:31:59 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 01:31:59 - INFO - Costes cargados: 22145 registros
2026-02-03 01:31:59 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA FITOS ===
2026-02-03 01:31:59 - INFO -   ABC: 247 registros
2026-02-03 01:31:59 - INFO -   Ventas: 1987 registros
2026-02-03 01:31:59 - INFO -   Costes: 22145 registros
2026-02-03 01:31:59 - INFO - Datos de ventas: 157 registros
2026-02-03 01:31:59 - INFO - Calculando pedido para semana 14 (157 registros)
2026-02-03 01:32:00 - INFO -   Objetivo: 1798.25€, Actual (ABC): 1679.26€
2026-02-03 01:32:00 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 01:32:00 - INFO -   Factor total: 1.3125
2026-02-03 01:32:00 - INFO -   Factor escalado: 1.4055
2026-02-03 01:32:00 - INFO -   Ventas preliminares (con ceil): 2784.94€
2026-02-03 01:32:00 - INFO -   Objetivo final: 2360.20€
2026-02-03 01:32:00 - INFO -   Delta: 424.74€
2026-02-03 01:32:00 - INFO -   Ventas finales: 2365.92€
2026-02-03 01:32:00 - INFO - 
============================================================
2026-02-03 01:32:00 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 01:32:00 - INFO - ============================================================
2026-02-03 01:32:00 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 01:32:00 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 01:32:00 - INFO - DataLoader inicializado correctamente
2026-02-03 01:32:00 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 01:32:00 - INFO - ============================================================
2026-02-03 01:32:00 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 01:32:00 - INFO - ============================================================
2026-02-03 01:32:00 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 01:32:00 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 01:32:00 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 01:32:00 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 01:32:00 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 01:32:00 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 01:32:00 - INFO - Stock actual cargado: 30 registros
2026-02-03 01:32:00 - INFO -   Stock: 30 registros
2026-02-03 01:32:00 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 01:32:00 - INFO - Fusión completada: 84 registros
2026-02-03 01:32:00 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 01:32:00 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 01:32:00 - INFO - Corrección completada:
2026-02-03 01:32:00 - INFO -   - Artículos corregidos: 83/84
2026-02-03 01:32:00 - INFO -   - Artículos aumentados: 83
2026-02-03 01:32:00 - INFO -   - Artículos reducidos: 0
2026-02-03 01:32:00 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 01:32:00 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 01:32:00 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 01:32:00 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_fitos.xlsx
2026-02-03 01:32:00 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_fitos.xlsx
2026-02-03 01:32:00 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_fitos.xlsx
2026-02-03 01:32:00 - INFO -   Articulos: 81
2026-02-03 01:32:00 - INFO -   Importe: 2357.94€
2026-02-03 01:32:00 - INFO - 
==================================================
2026-02-03 01:32:00 - INFO - SECCION: VIVERO
2026-02-03 01:32:00 - INFO - ==================================================
2026-02-03 01:32:00 - INFO - === LEYENDO DATOS PARA SECCIÓN: VIVERO ===
2026-02-03 01:32:00 - INFO - Archivo ABC encontrado para 'vivero': .\./data/input\CLASIFICACION_ABC+D_vivero.xlsx
2026-02-03 01:32:00 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_vivero.xlsx
2026-02-03 01:32:00 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 01:32:00 - INFO - Clasificación ABC cargada para 'vivero': 565 registros
2026-02-03 01:32:00 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 01:32:04 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 01:32:04 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 01:32:04 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 01:32:04 - INFO - Ventas cargadas: 44082 registros
2026-02-03 01:32:04 - INFO - Filtrados 2460 registros de sección 'vivero' de 44082 total
2026-02-03 01:32:04 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 01:32:06 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 01:32:06 - INFO - Costes cargados: 22145 registros
2026-02-03 01:32:06 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA VIVERO ===
2026-02-03 01:32:06 - INFO -   ABC: 565 registros
2026-02-03 01:32:06 - INFO -   Ventas: 2460 registros
2026-02-03 01:32:06 - INFO -   Costes: 22145 registros
2026-02-03 01:32:06 - INFO - Datos de ventas: 189 registros
2026-02-03 01:32:06 - INFO - Calculando pedido para semana 14 (189 registros)
2026-02-03 01:32:07 - INFO -   Objetivo: 5297.17€, Actual (ABC): 4113.14€
2026-02-03 01:32:07 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 01:32:07 - INFO -   Factor total: 1.3125
2026-02-03 01:32:07 - INFO -   Factor escalado: 1.6903
2026-02-03 01:32:07 - INFO -   Ventas preliminares (con ceil): 8761.94€
2026-02-03 01:32:07 - INFO -   Objetivo final: 6952.54€
2026-02-03 01:32:07 - INFO -   Delta: 1809.40€
2026-02-03 01:32:07 - INFO -   Ventas finales: 6990.51€
2026-02-03 01:32:07 - INFO - 
============================================================
2026-02-03 01:32:07 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 01:32:07 - INFO - ============================================================
2026-02-03 01:32:07 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 01:32:07 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 01:32:07 - INFO - DataLoader inicializado correctamente
2026-02-03 01:32:07 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 01:32:07 - INFO - ============================================================
2026-02-03 01:32:07 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 01:32:07 - INFO - ============================================================
2026-02-03 01:32:07 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 01:32:07 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 01:32:07 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 01:32:07 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 01:32:07 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 01:32:07 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 01:32:07 - INFO - Stock actual cargado: 30 registros
2026-02-03 01:32:07 - INFO -   Stock: 30 registros
2026-02-03 01:32:07 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 01:32:07 - INFO - Fusión completada: 107 registros
2026-02-03 01:32:07 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 01:32:07 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 01:32:07 - INFO - Corrección completada:
2026-02-03 01:32:07 - INFO -   - Artículos corregidos: 106/107
2026-02-03 01:32:07 - INFO -   - Artículos aumentados: 106
2026-02-03 01:32:07 - INFO -   - Artículos reducidos: 0
2026-02-03 01:32:07 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 01:32:07 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 01:32:07 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 01:32:07 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_vivero.xlsx
2026-02-03 01:32:07 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_vivero.xlsx
2026-02-03 01:32:07 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_vivero.xlsx
2026-02-03 01:32:07 - INFO -   Articulos: 96
2026-02-03 01:32:07 - INFO -   Importe: 6990.51€
2026-02-03 01:32:07 - INFO - 
==================================================
2026-02-03 01:32:07 - INFO - SECCION: UTILES_JARDIN
2026-02-03 01:32:07 - INFO - ==================================================
2026-02-03 01:32:07 - INFO - === LEYENDO DATOS PARA SECCIÓN: UTILES_JARDIN ===
2026-02-03 01:32:07 - INFO - Archivo ABC encontrado para 'utiles_jardin': .\./data/input\CLASIFICACION_ABC+D_utiles_jardin.xlsx
2026-02-03 01:32:07 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_utiles_jardin.xlsx
2026-02-03 01:32:07 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 01:32:07 - INFO - Clasificación ABC cargada para 'utiles_jardin': 433 registros
2026-02-03 01:32:07 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 01:32:11 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 01:32:11 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 01:32:11 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 01:32:11 - INFO - Ventas cargadas: 44082 registros
2026-02-03 01:32:11 - INFO - Filtrados 1009 registros de sección 'utiles_jardin' de 44082 total
2026-02-03 01:32:11 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 01:32:13 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 01:32:13 - INFO - Costes cargados: 22145 registros
2026-02-03 01:32:13 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA UTILES_JARDIN ===
2026-02-03 01:32:13 - INFO -   ABC: 433 registros
2026-02-03 01:32:13 - INFO -   Ventas: 1009 registros
2026-02-03 01:32:13 - INFO -   Costes: 22145 registros
2026-02-03 01:32:13 - INFO - Datos de ventas: 89 registros
2026-02-03 01:32:13 - INFO - Calculando pedido para semana 14 (89 registros)
2026-02-03 01:32:14 - INFO -   Objetivo: 1044.77€, Actual (ABC): 818.79€
2026-02-03 01:32:14 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 01:32:14 - INFO -   Factor total: 1.3125
2026-02-03 01:32:14 - INFO -   Factor escalado: 1.6747
2026-02-03 01:32:14 - INFO -   Ventas preliminares (con ceil): 1929.56€
2026-02-03 01:32:14 - INFO -   Objetivo final: 1371.26€
2026-02-03 01:32:14 - INFO -   Delta: 558.30€
2026-02-03 01:32:14 - INFO -   Ventas finales: 1390.00€
2026-02-03 01:32:14 - INFO - 
============================================================
2026-02-03 01:32:14 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 01:32:14 - INFO - ============================================================
2026-02-03 01:32:14 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 01:32:14 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 01:32:14 - INFO - DataLoader inicializado correctamente
2026-02-03 01:32:14 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 01:32:14 - INFO - ============================================================
2026-02-03 01:32:14 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 01:32:14 - INFO - ============================================================
2026-02-03 01:32:14 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 01:32:14 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 01:32:14 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 01:32:14 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 01:32:14 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 01:32:14 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 01:32:14 - INFO - Stock actual cargado: 30 registros
2026-02-03 01:32:14 - INFO -   Stock: 30 registros
2026-02-03 01:32:14 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 01:32:14 - INFO - Fusión completada: 78 registros
2026-02-03 01:32:14 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 01:32:14 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 01:32:14 - INFO - Corrección completada:
2026-02-03 01:32:14 - INFO -   - Artículos corregidos: 78/78
2026-02-03 01:32:14 - INFO -   - Artículos aumentados: 78
2026-02-03 01:32:14 - INFO -   - Artículos reducidos: 0
2026-02-03 01:32:14 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 01:32:14 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 01:32:14 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 01:32:14 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx
2026-02-03 01:32:14 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx
2026-02-03 01:32:14 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx
2026-02-03 01:32:14 - INFO -   Articulos: 78
2026-02-03 01:32:14 - INFO -   Importe: 1390.00€
2026-02-03 01:32:14 - INFO - 
==================================================
2026-02-03 01:32:14 - INFO - SECCION: TIERRAS_ARIDOS
2026-02-03 01:32:14 - INFO - ==================================================
2026-02-03 01:32:14 - INFO - === LEYENDO DATOS PARA SECCIÓN: TIERRAS_ARIDOS ===
2026-02-03 01:32:14 - WARNING - No se encontró archivo específico para 'tierras_aridos', usando: .\./data/input\CLASIFICACION_ABC+D_DECO_EXTERIOR.xlsx
2026-02-03 01:32:14 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_DECO_EXTERIOR.xlsx
2026-02-03 01:32:14 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 01:32:14 - INFO - Clasificación ABC cargada para 'tierras_aridos': 995 registros
2026-02-03 01:32:14 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 01:32:18 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 01:32:18 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 01:32:18 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 01:32:18 - INFO - Ventas cargadas: 44082 registros
2026-02-03 01:32:18 - INFO - Filtrados 3264 registros de sección 'tierras_aridos' de 44082 total
2026-02-03 01:32:18 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 01:32:20 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 01:32:20 - INFO - Costes cargados: 22145 registros
2026-02-03 01:32:20 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA TIERRAS_ARIDOS ===
2026-02-03 01:32:20 - INFO -   ABC: 995 registros
2026-02-03 01:32:20 - INFO -   Ventas: 3264 registros
2026-02-03 01:32:20 - INFO -   Costes: 22145 registros
2026-02-03 01:32:20 - INFO - Datos de ventas: 302 registros
2026-02-03 01:32:20 - INFO - Calculando pedido para semana 14 (302 registros)
2026-02-03 01:32:21 - INFO -   Objetivo: 4097.24€, Actual (ABC): 4019.19€
2026-02-03 01:32:21 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 01:32:21 - INFO -   Factor total: 1.3125
2026-02-03 01:32:21 - INFO -   Factor escalado: 1.3380
2026-02-03 01:32:21 - INFO -   Ventas preliminares (con ceil): 5809.66€
2026-02-03 01:32:21 - INFO -   Objetivo final: 5377.63€
2026-02-03 01:32:21 - INFO -   Delta: 432.03€
2026-02-03 01:32:21 - INFO -   Ventas finales: 5387.14€
2026-02-03 01:32:21 - INFO - 
============================================================
2026-02-03 01:32:21 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 01:32:21 - INFO - ============================================================
2026-02-03 01:32:21 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 01:32:21 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 01:32:21 - INFO - DataLoader inicializado correctamente
2026-02-03 01:32:21 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 01:32:21 - INFO - ============================================================
2026-02-03 01:32:21 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 01:32:21 - INFO - ============================================================
2026-02-03 01:32:21 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 01:32:21 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 01:32:21 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 01:32:21 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 01:32:21 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 01:32:21 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 01:32:21 - INFO - Stock actual cargado: 30 registros
2026-02-03 01:32:21 - INFO -   Stock: 30 registros
2026-02-03 01:32:21 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 01:32:21 - INFO - Fusión completada: 72 registros
2026-02-03 01:32:21 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 01:32:21 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 01:32:21 - INFO - Corrección completada:
2026-02-03 01:32:21 - INFO -   - Artículos corregidos: 72/72
2026-02-03 01:32:21 - INFO -   - Artículos aumentados: 72
2026-02-03 01:32:21 - INFO -   - Artículos reducidos: 0
2026-02-03 01:32:21 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 01:32:21 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 01:32:21 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 01:32:21 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx
2026-02-03 01:32:21 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx
2026-02-03 01:32:21 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx
2026-02-03 01:32:21 - INFO -   Articulos: 70
2026-02-03 01:32:21 - INFO -   Importe: 5381.35€
2026-02-03 01:32:21 - INFO - 
==================================================
2026-02-03 01:32:21 - INFO - SECCION: DECO_EXTERIOR
2026-02-03 01:32:21 - INFO - ==================================================
2026-02-03 01:32:21 - INFO - === LEYENDO DATOS PARA SECCIÓN: DECO_EXTERIOR ===
2026-02-03 01:32:21 - INFO - Archivo ABC encontrado para 'deco_exterior': .\./data/input\CLASIFICACION_ABC+D_deco_exterior.xlsx
2026-02-03 01:32:21 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_deco_exterior.xlsx
2026-02-03 01:32:21 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 01:32:21 - INFO - Clasificación ABC cargada para 'deco_exterior': 995 registros
2026-02-03 01:32:21 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 01:32:25 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 01:32:25 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 01:32:25 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 01:32:25 - INFO - Ventas cargadas: 44082 registros
2026-02-03 01:32:25 - INFO - Filtrados 4018 registros de sección 'deco_exterior' de 44082 total
2026-02-03 01:32:25 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 01:32:27 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 01:32:27 - INFO - Costes cargados: 22145 registros
2026-02-03 01:32:27 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA DECO_EXTERIOR ===
2026-02-03 01:32:27 - INFO -   ABC: 995 registros
2026-02-03 01:32:27 - INFO -   Ventas: 4018 registros
2026-02-03 01:32:27 - INFO -   Costes: 22145 registros
2026-02-03 01:32:27 - INFO - Datos de ventas: 316 registros
2026-02-03 01:32:27 - INFO - Calculando pedido para semana 14 (316 registros)
2026-02-03 01:32:28 - INFO -   Objetivo: 3740.34€, Actual (ABC): 4104.66€
2026-02-03 01:32:28 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 01:32:28 - INFO -   Factor total: 1.3125
2026-02-03 01:32:28 - INFO -   Factor escalado: 1.1960
2026-02-03 01:32:28 - INFO -   Ventas preliminares (con ceil): 6094.59€
2026-02-03 01:32:28 - INFO -   Objetivo final: 4909.20€
2026-02-03 01:32:28 - INFO -   Delta: 1185.39€
2026-02-03 01:32:28 - INFO -   Ventas finales: 4923.89€
2026-02-03 01:32:28 - INFO - 
============================================================
2026-02-03 01:32:28 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 01:32:28 - INFO - ============================================================
2026-02-03 01:32:28 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 01:32:28 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 01:32:28 - INFO - DataLoader inicializado correctamente
2026-02-03 01:32:28 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 01:32:28 - INFO - ============================================================
2026-02-03 01:32:28 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 01:32:28 - INFO - ============================================================
2026-02-03 01:32:28 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 01:32:28 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 01:32:28 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 01:32:28 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 01:32:28 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 01:32:28 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 01:32:28 - INFO - Stock actual cargado: 30 registros
2026-02-03 01:32:28 - INFO -   Stock: 30 registros
2026-02-03 01:32:28 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 01:32:28 - INFO - Fusión completada: 224 registros
2026-02-03 01:32:28 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 01:32:28 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 01:32:28 - INFO - Corrección completada:
2026-02-03 01:32:28 - INFO -   - Artículos corregidos: 220/224
2026-02-03 01:32:28 - INFO -   - Artículos aumentados: 220
2026-02-03 01:32:28 - INFO -   - Artículos reducidos: 0
2026-02-03 01:32:28 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 01:32:28 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 01:32:28 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 01:32:28 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_deco_exterior.xlsx
2026-02-03 01:32:28 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_deco_exterior.xlsx
2026-02-03 01:32:28 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_deco_exterior.xlsx
2026-02-03 01:32:28 - INFO -   Articulos: 198
2026-02-03 01:32:28 - INFO -   Importe: 4907.09€
2026-02-03 01:32:28 - INFO - Estado guardado correctamente
2026-02-03 01:32:28 - INFO - Generando resumen: .\./data/output\Resumen_Pedidos_VIVERO_2026-02-03.xlsx
2026-02-03 01:32:28 - INFO - Resumen guardado: .\./data/output\Resumen_Pedidos_VIVERO_2026-02-03.xlsx
2026-02-03 01:32:28 - INFO - Estado guardado correctamente
2026-02-03 01:32:28 - INFO - 
============================================================
2026-02-03 01:32:28 - INFO - PREPARANDO ENVÍO DE EMAILS
2026-02-03 01:32:28 - INFO - ============================================================
2026-02-03 01:32:28 - INFO - 
============================================================
2026-02-03 01:32:28 - INFO - ENVÍO DE EMAILS A RESPONSABLES
2026-02-03 01:32:28 - INFO - ============================================================
2026-02-03 01:32:28 - INFO - EmailService inicializado correctamente
2026-02-03 01:32:28 - ERROR - La variable de entorno 'EMAIL_PASSWORD' no está configurada. Por favor, configúrala antes de enviar emails.
2026-02-03 01:32:28 - WARNING - Problemas de configuración detectados:
2026-02-03 01:32:28 - WARNING -   - La variable de entorno 'EMAIL_PASSWORD' no está configurada
2026-02-03 01:32:28 - INFO - 
Enviando email para sección: maf
2026-02-03 01:32:28 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_maf.xlsx']
2026-02-03 01:32:28 - INFO - ============================================================
2026-02-03 01:32:28 - INFO - ENVIANDO EMAIL PARA SECCIÓN: MAF
2026-02-03 01:32:28 - INFO - ============================================================
2026-02-03 01:32:28 - ERROR - Error al enviar emails: name 'destinatorios_config' is not defined
2026-02-03 01:32:28 - ERROR - Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 445, in enviar_emails_pedidos
    resultado = email_service.enviar_pedido_por_seccion(
        semana=semana,
        seccion=seccion,
        archivos=archivos
    )
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\email_service.py", line 331, in enviar_pedido_por_seccion
    destinatarios_info = self.obtener_destinatarios_seccion(seccion)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\email_service.py", line 297, in obtener_destinatarios_seccion
    for dest in destinatorios_config:
                ^^^^^^^^^^^^^^^^^^^^
NameError: name 'destinatorios_config' is not defined. Did you mean: 'destinatarios_config'?

2026-02-03 01:32:28 - INFO - 
======================================================================
2026-02-03 01:32:28 - INFO - RESUMEN DE EJECUCION
2026-02-03 01:32:28 - INFO - ======================================================================
2026-02-03 01:32:28 - INFO - Semana procesada: 14
2026-02-03 01:32:28 - INFO - Archivos generados: 12
2026-02-03 01:32:28 - INFO - Total articulos: 1488
2026-02-03 01:32:28 - INFO - Total importe: 47966.89€
2026-02-03 01:32:28 - INFO - ======================================================================
2026-02-03 01:32:28 - INFO - 
¡PEDIDO GENERADO EXITOSAMENTE!
2026-02-03 01:32:28 - INFO - Archivo principal: .\./data/output\Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 01:32:28 - INFO - Artículos: 1488
2026-02-03 01:32:28 - INFO - Importe: 47966.89€
2026-02-03 01:34:49 - INFO - ======================================================================
2026-02-03 01:34:49 - INFO - SISTEMA DE PEDIDOS DE COMPRA - VIVERO ARANJUEZ V2
2026-02-03 01:34:49 - INFO - Fecha de ejecución: 2026-02-03 01:34:49
2026-02-03 01:34:49 - INFO - ======================================================================
2026-02-03 01:34:49 - INFO - Modo de ejecución: Solo FASE 1
2026-02-03 01:34:49 - INFO - Envío de emails: Sí
2026-02-03 01:34:49 - INFO - StateManager inicializado. Archivo de estado: .\./data\state.json
2026-02-03 01:34:49 - INFO - Cargando estado desde: .\./data\state.json
2026-02-03 01:34:49 - INFO - Estado cargado correctamente
2026-02-03 01:34:49 - INFO - SchedulerService inicializado correctamente
2026-02-03 01:34:49 - INFO - Horario configurado: sunday a las 15:00
2026-02-03 01:34:49 - INFO - Semana forzada por argumento: 14
2026-02-03 01:34:49 - INFO - ======================================================================
2026-02-03 01:34:49 - INFO - PROCESANDO PEDIDO PARA SEMANA 14
2026-02-03 01:34:49 - INFO - ======================================================================
2026-02-03 01:34:49 - INFO - MODO: Solo FASE 1 (Forecast) - Corrección deshabilitada
2026-02-03 01:34:49 - INFO - DataLoader inicializado correctamente
2026-02-03 01:34:49 - INFO - ForecastEngine inicializado correctamente
2026-02-03 01:34:49 - INFO - OrderGenerator inicializado correctamente
2026-02-03 01:34:49 - INFO - SchedulerService inicializado correctamente
2026-02-03 01:34:49 - INFO - Horario configurado: sunday a las 15:00
2026-02-03 01:34:49 - INFO - Período de la semana: 2026-03-30 al 2026-04-05
2026-02-03 01:34:49 - INFO - Stock acumulado cargado: 2633 artículos
2026-02-03 01:34:49 - INFO - 
==================================================
2026-02-03 01:34:49 - INFO - SECCION: MAF
2026-02-03 01:34:49 - INFO - ==================================================
2026-02-03 01:34:49 - INFO - === LEYENDO DATOS PARA SECCIÓN: MAF ===
2026-02-03 01:34:49 - INFO - Archivo ABC encontrado para 'maf': .\./data/input\CLASIFICACION_ABC+D_maf.xlsx
2026-02-03 01:34:49 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_maf.xlsx
2026-02-03 01:34:50 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 01:34:50 - INFO - Clasificación ABC cargada para 'maf': 499 registros
2026-02-03 01:34:50 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 01:34:54 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 01:34:54 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 01:34:54 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 01:34:54 - INFO - Ventas cargadas: 44082 registros
2026-02-03 01:34:54 - INFO - Filtrados 10970 registros de sección 'maf' de 44082 total
2026-02-03 01:34:54 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 01:34:56 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 01:34:56 - INFO - Costes cargados: 22145 registros
2026-02-03 01:34:56 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MAF ===
2026-02-03 01:34:56 - INFO -   ABC: 499 registros
2026-02-03 01:34:56 - INFO -   Ventas: 10970 registros
2026-02-03 01:34:56 - INFO -   Costes: 22145 registros
2026-02-03 01:34:56 - INFO - Datos de ventas: 1011 registros
2026-02-03 01:34:56 - INFO - Calculando pedido para semana 14 (1011 registros)
2026-02-03 01:34:57 - INFO -   Objetivo: 7050.65€, Actual (ABC): 5843.77€
2026-02-03 01:34:57 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 01:34:57 - INFO -   Factor total: 1.3125
2026-02-03 01:34:57 - INFO -   Factor escalado: 1.5836
2026-02-03 01:34:57 - INFO -   Ventas preliminares (con ceil): 9931.01€
2026-02-03 01:34:57 - INFO -   Objetivo final: 9253.98€
2026-02-03 01:34:57 - INFO -   Delta: 677.03€
2026-02-03 01:34:57 - INFO -   Ventas finales: 9259.59€
2026-02-03 01:34:57 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 01:34:57 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 01:34:57 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 01:34:57 - INFO -   Articulos: 191
2026-02-03 01:34:57 - INFO -   Importe: 9259.59€
2026-02-03 01:34:57 - INFO - 
==================================================
2026-02-03 01:34:57 - INFO - SECCION: DECO_INTERIOR
2026-02-03 01:34:57 - INFO - ==================================================
2026-02-03 01:34:57 - INFO - === LEYENDO DATOS PARA SECCIÓN: DECO_INTERIOR ===
2026-02-03 01:34:57 - INFO - Archivo ABC encontrado para 'deco_interior': .\./data/input\CLASIFICACION_ABC+D_deco_interior.xlsx
2026-02-03 01:34:57 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_deco_interior.xlsx
2026-02-03 01:34:57 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 01:34:57 - INFO - Clasificación ABC cargada para 'deco_interior': 1827 registros
2026-02-03 01:34:57 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 01:35:01 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 01:35:01 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 01:35:01 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 01:35:01 - INFO - Ventas cargadas: 44082 registros
2026-02-03 01:35:02 - INFO - Filtrados 2468 registros de sección 'deco_interior' de 44082 total
2026-02-03 01:35:02 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 01:35:04 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 01:35:04 - INFO - Costes cargados: 22145 registros
2026-02-03 01:35:04 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA DECO_INTERIOR ===
2026-02-03 01:35:04 - INFO -   ABC: 1827 registros
2026-02-03 01:35:04 - INFO -   Ventas: 2468 registros
2026-02-03 01:35:04 - INFO -   Costes: 22145 registros
2026-02-03 01:35:04 - INFO - Datos de ventas: 180 registros
2026-02-03 01:35:04 - INFO - Calculando pedido para semana 14 (180 registros)
2026-02-03 01:35:04 - INFO -   Objetivo: 1962.99€, Actual (ABC): 1636.15€
2026-02-03 01:35:04 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 01:35:04 - INFO -   Factor total: 1.3125
2026-02-03 01:35:04 - INFO -   Factor escalado: 1.5747
2026-02-03 01:35:04 - INFO -   Ventas preliminares (con ceil): 2950.01€
2026-02-03 01:35:04 - INFO -   Objetivo final: 2576.42€
2026-02-03 01:35:04 - INFO -   Delta: 373.59€
2026-02-03 01:35:04 - INFO -   Ventas finales: 2580.73€
2026-02-03 01:35:04 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_deco_interior.xlsx
2026-02-03 01:35:05 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_deco_interior.xlsx
2026-02-03 01:35:05 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_deco_interior.xlsx
2026-02-03 01:35:05 - INFO -   Articulos: 135
2026-02-03 01:35:05 - INFO -   Importe: 2580.73€
2026-02-03 01:35:05 - INFO - 
==================================================
2026-02-03 01:35:05 - INFO - SECCION: SEMILLAS
2026-02-03 01:35:05 - INFO - ==================================================
2026-02-03 01:35:05 - INFO - === LEYENDO DATOS PARA SECCIÓN: SEMILLAS ===
2026-02-03 01:35:05 - INFO - Archivo ABC encontrado para 'semillas': .\./data/input\CLASIFICACION_ABC+D_semillas.xlsx
2026-02-03 01:35:05 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_semillas.xlsx
2026-02-03 01:35:05 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 01:35:05 - INFO - Clasificación ABC cargada para 'semillas': 218 registros
2026-02-03 01:35:05 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 01:35:09 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 01:35:09 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 01:35:09 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 01:35:09 - INFO - Ventas cargadas: 44082 registros
2026-02-03 01:35:09 - INFO - Filtrados 1180 registros de sección 'semillas' de 44082 total
2026-02-03 01:35:09 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 01:35:12 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 01:35:12 - INFO - Costes cargados: 22145 registros
2026-02-03 01:35:12 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA SEMILLAS ===
2026-02-03 01:35:12 - INFO -   ABC: 218 registros
2026-02-03 01:35:12 - INFO -   Ventas: 1180 registros
2026-02-03 01:35:12 - INFO -   Costes: 22145 registros
2026-02-03 01:35:12 - INFO - Datos de ventas: 136 registros
2026-02-03 01:35:12 - INFO - Calculando pedido para semana 14 (136 registros)
2026-02-03 01:35:12 - INFO -   Objetivo: 694.34€, Actual (ABC): 455.14€
2026-02-03 01:35:12 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 01:35:12 - INFO -   Factor total: 1.3125
2026-02-03 01:35:12 - INFO -   Factor escalado: 2.0023
2026-02-03 01:35:12 - INFO -   Ventas preliminares (con ceil): 1129.15€
2026-02-03 01:35:12 - INFO -   Objetivo final: 911.32€
2026-02-03 01:35:12 - INFO -   Delta: 217.83€
2026-02-03 01:35:12 - INFO -   Ventas finales: 911.60€
2026-02-03 01:35:12 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_semillas.xlsx
2026-02-03 01:35:12 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_semillas.xlsx
2026-02-03 01:35:12 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_semillas.xlsx
2026-02-03 01:35:12 - INFO -   Articulos: 84
2026-02-03 01:35:12 - INFO -   Importe: 911.60€
2026-02-03 01:35:12 - INFO - 
==================================================
2026-02-03 01:35:12 - INFO - SECCION: MASCOTAS_VIVO
2026-02-03 01:35:12 - INFO - ==================================================
2026-02-03 01:35:12 - INFO - === LEYENDO DATOS PARA SECCIÓN: MASCOTAS_VIVO ===
2026-02-03 01:35:12 - INFO - Archivo ABC encontrado para 'mascotas_vivo': .\./data/input\CLASIFICACION_ABC+D_mascotas_vivo.xlsx
2026-02-03 01:35:12 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_mascotas_vivo.xlsx
2026-02-03 01:35:12 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 01:35:12 - INFO - Clasificación ABC cargada para 'mascotas_vivo': 205 registros
2026-02-03 01:35:12 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 01:35:17 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 01:35:17 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 01:35:17 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 01:35:17 - INFO - Ventas cargadas: 44082 registros
2026-02-03 01:35:17 - INFO - Filtrados 1124 registros de sección 'mascotas_vivo' de 44082 total
2026-02-03 01:35:17 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 01:35:20 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 01:35:20 - INFO - Costes cargados: 22145 registros
2026-02-03 01:35:20 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MASCOTAS_VIVO ===
2026-02-03 01:35:20 - INFO -   ABC: 205 registros
2026-02-03 01:35:20 - INFO -   Ventas: 1124 registros
2026-02-03 01:35:20 - INFO -   Costes: 22145 registros
2026-02-03 01:35:20 - INFO - Datos de ventas: 88 registros
2026-02-03 01:35:20 - INFO - Calculando pedido para semana 14 (88 registros)
2026-02-03 01:35:20 - INFO -   Objetivo: 1087.15€, Actual (ABC): 846.63€
2026-02-03 01:35:20 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 01:35:20 - INFO -   Factor total: 1.3125
2026-02-03 01:35:20 - INFO -   Factor escalado: 1.6854
2026-02-03 01:35:20 - INFO -   Ventas preliminares (con ceil): 1773.66€
2026-02-03 01:35:20 - INFO -   Objetivo final: 1426.88€
2026-02-03 01:35:20 - INFO -   Delta: 346.78€
2026-02-03 01:35:20 - INFO -   Ventas finales: 1455.34€
2026-02-03 01:35:20 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx
2026-02-03 01:35:20 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx
2026-02-03 01:35:20 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx
2026-02-03 01:35:20 - INFO -   Articulos: 36
2026-02-03 01:35:20 - INFO -   Importe: 1455.34€
2026-02-03 01:35:20 - INFO - 
==================================================
2026-02-03 01:35:20 - INFO - SECCION: MASCOTAS_MANUFACTURADO
2026-02-03 01:35:20 - INFO - ==================================================
2026-02-03 01:35:20 - INFO - === LEYENDO DATOS PARA SECCIÓN: MASCOTAS_MANUFACTURADO ===
2026-02-03 01:35:20 - INFO - Archivo ABC encontrado para 'mascotas_manufacturado': .\./data/input\CLASIFICACION_ABC+D_mascotas_manufacturado.xlsx
2026-02-03 01:35:20 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_mascotas_manufacturado.xlsx
2026-02-03 01:35:21 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 01:35:21 - INFO - Clasificación ABC cargada para 'mascotas_manufacturado': 2749 registros
2026-02-03 01:35:21 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 01:35:26 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 01:35:26 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 01:35:26 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 01:35:26 - INFO - Ventas cargadas: 44082 registros
2026-02-03 01:35:26 - INFO - Filtrados 9784 registros de sección 'mascotas_manufacturado' de 44082 total
2026-02-03 01:35:26 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 01:35:29 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 01:35:29 - INFO - Costes cargados: 22145 registros
2026-02-03 01:35:29 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MASCOTAS_MANUFACTURADO ===
2026-02-03 01:35:29 - INFO -   ABC: 2749 registros
2026-02-03 01:35:29 - INFO -   Ventas: 9784 registros
2026-02-03 01:35:29 - INFO -   Costes: 22145 registros
2026-02-03 01:35:29 - INFO - Datos de ventas: 822 registros
2026-02-03 01:35:29 - INFO - Calculando pedido para semana 14 (822 registros)
2026-02-03 01:35:32 - INFO -   Objetivo: 6839.82€, Actual (ABC): 8742.92€
2026-02-03 01:35:32 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 01:35:32 - INFO -   Factor total: 1.3125
2026-02-03 01:35:32 - INFO -   Factor escalado: 1.0268
2026-02-03 01:35:32 - INFO -   Ventas preliminares (con ceil): 12379.25€
2026-02-03 01:35:32 - INFO -   Objetivo final: 8977.26€
2026-02-03 01:35:32 - INFO -   Delta: 3401.99€
2026-02-03 01:35:32 - INFO -   Ventas finales: 8993.98€
2026-02-03 01:35:32 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx
2026-02-03 01:35:33 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx
2026-02-03 01:35:33 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx
2026-02-03 01:35:33 - INFO -   Articulos: 411
2026-02-03 01:35:33 - INFO -   Importe: 8993.98€
2026-02-03 01:35:33 - INFO - 
==================================================
2026-02-03 01:35:33 - INFO - SECCION: INTERIOR
2026-02-03 01:35:33 - INFO - ==================================================
2026-02-03 01:35:33 - INFO - === LEYENDO DATOS PARA SECCIÓN: INTERIOR ===
2026-02-03 01:35:33 - INFO - Archivo ABC encontrado para 'interior': .\./data/input\CLASIFICACION_ABC+D_interior.xlsx
2026-02-03 01:35:33 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_interior.xlsx
2026-02-03 01:35:33 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 01:35:33 - INFO - Clasificación ABC cargada para 'interior': 555 registros
2026-02-03 01:35:33 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 01:35:37 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 01:35:37 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 01:35:37 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 01:35:37 - INFO - Ventas cargadas: 44082 registros
2026-02-03 01:35:37 - INFO - Filtrados 3624 registros de sección 'interior' de 44082 total
2026-02-03 01:35:37 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 01:35:39 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 01:35:39 - INFO - Costes cargados: 22145 registros
2026-02-03 01:35:39 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA INTERIOR ===
2026-02-03 01:35:39 - INFO -   ABC: 555 registros
2026-02-03 01:35:39 - INFO -   Ventas: 3624 registros
2026-02-03 01:35:39 - INFO -   Costes: 22145 registros
2026-02-03 01:35:39 - INFO - Datos de ventas: 286 registros
2026-02-03 01:35:39 - INFO - Calculando pedido para semana 14 (286 registros)
2026-02-03 01:35:40 - INFO -   Objetivo: 2930.63€, Actual (ABC): 2409.44€
2026-02-03 01:35:40 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 01:35:40 - INFO -   Factor total: 1.3125
2026-02-03 01:35:40 - INFO -   Factor escalado: 1.5964
2026-02-03 01:35:40 - INFO -   Ventas preliminares (con ceil): 4541.81€
2026-02-03 01:35:40 - INFO -   Objetivo final: 3846.45€
2026-02-03 01:35:40 - INFO -   Delta: 695.36€
2026-02-03 01:35:40 - INFO -   Ventas finales: 3855.17€
2026-02-03 01:35:40 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_interior.xlsx
2026-02-03 01:35:40 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_interior.xlsx
2026-02-03 01:35:40 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_interior.xlsx
2026-02-03 01:35:40 - INFO -   Articulos: 121
2026-02-03 01:35:40 - INFO -   Importe: 3855.17€
2026-02-03 01:35:40 - INFO - 
==================================================
2026-02-03 01:35:40 - INFO - SECCION: FITOS
2026-02-03 01:35:40 - INFO - ==================================================
2026-02-03 01:35:40 - INFO - === LEYENDO DATOS PARA SECCIÓN: FITOS ===
2026-02-03 01:35:40 - INFO - Archivo ABC encontrado para 'fitos': .\./data/input\CLASIFICACION_ABC+D_fitos.xlsx
2026-02-03 01:35:40 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_fitos.xlsx
2026-02-03 01:35:40 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 01:35:40 - INFO - Clasificación ABC cargada para 'fitos': 247 registros
2026-02-03 01:35:40 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 01:35:45 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 01:35:45 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 01:35:45 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 01:35:45 - INFO - Ventas cargadas: 44082 registros
2026-02-03 01:35:45 - INFO - Filtrados 1987 registros de sección 'fitos' de 44082 total
2026-02-03 01:35:45 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 01:35:47 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 01:35:47 - INFO - Costes cargados: 22145 registros
2026-02-03 01:35:47 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA FITOS ===
2026-02-03 01:35:47 - INFO -   ABC: 247 registros
2026-02-03 01:35:47 - INFO -   Ventas: 1987 registros
2026-02-03 01:35:47 - INFO -   Costes: 22145 registros
2026-02-03 01:35:47 - INFO - Datos de ventas: 157 registros
2026-02-03 01:35:47 - INFO - Calculando pedido para semana 14 (157 registros)
2026-02-03 01:35:47 - INFO -   Objetivo: 1798.25€, Actual (ABC): 1679.26€
2026-02-03 01:35:47 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 01:35:47 - INFO -   Factor total: 1.3125
2026-02-03 01:35:47 - INFO -   Factor escalado: 1.4055
2026-02-03 01:35:47 - INFO -   Ventas preliminares (con ceil): 2784.94€
2026-02-03 01:35:47 - INFO -   Objetivo final: 2360.20€
2026-02-03 01:35:47 - INFO -   Delta: 424.74€
2026-02-03 01:35:47 - INFO -   Ventas finales: 2365.92€
2026-02-03 01:35:47 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_fitos.xlsx
2026-02-03 01:35:48 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_fitos.xlsx
2026-02-03 01:35:48 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_fitos.xlsx
2026-02-03 01:35:48 - INFO -   Articulos: 82
2026-02-03 01:35:48 - INFO -   Importe: 2365.92€
2026-02-03 01:35:48 - INFO - 
==================================================
2026-02-03 01:35:48 - INFO - SECCION: VIVERO
2026-02-03 01:35:48 - INFO - ==================================================
2026-02-03 01:35:48 - INFO - === LEYENDO DATOS PARA SECCIÓN: VIVERO ===
2026-02-03 01:35:48 - INFO - Archivo ABC encontrado para 'vivero': .\./data/input\CLASIFICACION_ABC+D_vivero.xlsx
2026-02-03 01:35:48 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_vivero.xlsx
2026-02-03 01:35:48 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 01:35:48 - INFO - Clasificación ABC cargada para 'vivero': 565 registros
2026-02-03 01:35:48 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 01:35:52 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 01:35:52 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 01:35:52 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 01:35:52 - INFO - Ventas cargadas: 44082 registros
2026-02-03 01:35:52 - INFO - Filtrados 2460 registros de sección 'vivero' de 44082 total
2026-02-03 01:35:52 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 01:35:54 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 01:35:54 - INFO - Costes cargados: 22145 registros
2026-02-03 01:35:54 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA VIVERO ===
2026-02-03 01:35:54 - INFO -   ABC: 565 registros
2026-02-03 01:35:54 - INFO -   Ventas: 2460 registros
2026-02-03 01:35:54 - INFO -   Costes: 22145 registros
2026-02-03 01:35:54 - INFO - Datos de ventas: 189 registros
2026-02-03 01:35:54 - INFO - Calculando pedido para semana 14 (189 registros)
2026-02-03 01:35:55 - INFO -   Objetivo: 5297.17€, Actual (ABC): 4113.14€
2026-02-03 01:35:55 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 01:35:55 - INFO -   Factor total: 1.3125
2026-02-03 01:35:55 - INFO -   Factor escalado: 1.6903
2026-02-03 01:35:55 - INFO -   Ventas preliminares (con ceil): 8761.94€
2026-02-03 01:35:55 - INFO -   Objetivo final: 6952.54€
2026-02-03 01:35:55 - INFO -   Delta: 1809.40€
2026-02-03 01:35:55 - INFO -   Ventas finales: 6990.51€
2026-02-03 01:35:55 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_vivero.xlsx
2026-02-03 01:35:55 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_vivero.xlsx
2026-02-03 01:35:55 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_vivero.xlsx
2026-02-03 01:35:55 - INFO -   Articulos: 96
2026-02-03 01:35:55 - INFO -   Importe: 6990.51€
2026-02-03 01:35:55 - INFO - 
==================================================
2026-02-03 01:35:55 - INFO - SECCION: UTILES_JARDIN
2026-02-03 01:35:55 - INFO - ==================================================
2026-02-03 01:35:55 - INFO - === LEYENDO DATOS PARA SECCIÓN: UTILES_JARDIN ===
2026-02-03 01:35:55 - INFO - Archivo ABC encontrado para 'utiles_jardin': .\./data/input\CLASIFICACION_ABC+D_utiles_jardin.xlsx
2026-02-03 01:35:55 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_utiles_jardin.xlsx
2026-02-03 01:35:55 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 01:35:55 - INFO - Clasificación ABC cargada para 'utiles_jardin': 433 registros
2026-02-03 01:35:55 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 01:35:59 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 01:35:59 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 01:35:59 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 01:35:59 - INFO - Ventas cargadas: 44082 registros
2026-02-03 01:35:59 - INFO - Filtrados 1009 registros de sección 'utiles_jardin' de 44082 total
2026-02-03 01:35:59 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 01:36:01 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 01:36:01 - INFO - Costes cargados: 22145 registros
2026-02-03 01:36:01 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA UTILES_JARDIN ===
2026-02-03 01:36:01 - INFO -   ABC: 433 registros
2026-02-03 01:36:01 - INFO -   Ventas: 1009 registros
2026-02-03 01:36:01 - INFO -   Costes: 22145 registros
2026-02-03 01:36:01 - INFO - Datos de ventas: 89 registros
2026-02-03 01:36:01 - INFO - Calculando pedido para semana 14 (89 registros)
2026-02-03 01:36:03 - INFO -   Objetivo: 1044.77€, Actual (ABC): 818.79€
2026-02-03 01:36:03 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 01:36:03 - INFO -   Factor total: 1.3125
2026-02-03 01:36:03 - INFO -   Factor escalado: 1.6747
2026-02-03 01:36:03 - INFO -   Ventas preliminares (con ceil): 1929.56€
2026-02-03 01:36:03 - INFO -   Objetivo final: 1371.26€
2026-02-03 01:36:03 - INFO -   Delta: 558.30€
2026-02-03 01:36:03 - INFO -   Ventas finales: 1390.00€
2026-02-03 01:36:03 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx
2026-02-03 01:36:03 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx
2026-02-03 01:36:03 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx
2026-02-03 01:36:03 - INFO -   Articulos: 78
2026-02-03 01:36:03 - INFO -   Importe: 1390.00€
2026-02-03 01:36:03 - INFO - 
==================================================
2026-02-03 01:36:03 - INFO - SECCION: TIERRAS_ARIDOS
2026-02-03 01:36:03 - INFO - ==================================================
2026-02-03 01:36:03 - INFO - === LEYENDO DATOS PARA SECCIÓN: TIERRAS_ARIDOS ===
2026-02-03 01:36:03 - WARNING - No se encontró archivo específico para 'tierras_aridos', usando: .\./data/input\CLASIFICACION_ABC+D_DECO_EXTERIOR.xlsx
2026-02-03 01:36:03 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_DECO_EXTERIOR.xlsx
2026-02-03 01:36:03 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 01:36:03 - INFO - Clasificación ABC cargada para 'tierras_aridos': 995 registros
2026-02-03 01:36:03 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 01:36:08 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 01:36:08 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 01:36:08 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 01:36:08 - INFO - Ventas cargadas: 44082 registros
2026-02-03 01:36:08 - INFO - Filtrados 3264 registros de sección 'tierras_aridos' de 44082 total
2026-02-03 01:36:08 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 01:36:10 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 01:36:10 - INFO - Costes cargados: 22145 registros
2026-02-03 01:36:10 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA TIERRAS_ARIDOS ===
2026-02-03 01:36:10 - INFO -   ABC: 995 registros
2026-02-03 01:36:10 - INFO -   Ventas: 3264 registros
2026-02-03 01:36:10 - INFO -   Costes: 22145 registros
2026-02-03 01:36:10 - INFO - Datos de ventas: 302 registros
2026-02-03 01:36:10 - INFO - Calculando pedido para semana 14 (302 registros)
2026-02-03 01:36:10 - INFO -   Objetivo: 4097.24€, Actual (ABC): 4019.19€
2026-02-03 01:36:10 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 01:36:10 - INFO -   Factor total: 1.3125
2026-02-03 01:36:10 - INFO -   Factor escalado: 1.3380
2026-02-03 01:36:10 - INFO -   Ventas preliminares (con ceil): 5809.66€
2026-02-03 01:36:10 - INFO -   Objetivo final: 5377.63€
2026-02-03 01:36:10 - INFO -   Delta: 432.03€
2026-02-03 01:36:10 - INFO -   Ventas finales: 5387.14€
2026-02-03 01:36:10 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx
2026-02-03 01:36:10 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx
2026-02-03 01:36:10 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx
2026-02-03 01:36:10 - INFO -   Articulos: 71
2026-02-03 01:36:10 - INFO -   Importe: 5387.14€
2026-02-03 01:36:10 - INFO - 
==================================================
2026-02-03 01:36:10 - INFO - SECCION: DECO_EXTERIOR
2026-02-03 01:36:10 - INFO - ==================================================
2026-02-03 01:36:10 - INFO - === LEYENDO DATOS PARA SECCIÓN: DECO_EXTERIOR ===
2026-02-03 01:36:10 - INFO - Archivo ABC encontrado para 'deco_exterior': .\./data/input\CLASIFICACION_ABC+D_deco_exterior.xlsx
2026-02-03 01:36:10 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_deco_exterior.xlsx
2026-02-03 01:36:11 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 01:36:11 - INFO - Clasificación ABC cargada para 'deco_exterior': 995 registros
2026-02-03 01:36:11 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 01:36:15 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 01:36:15 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 01:36:15 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 01:36:15 - INFO - Ventas cargadas: 44082 registros
2026-02-03 01:36:15 - INFO - Filtrados 4018 registros de sección 'deco_exterior' de 44082 total
2026-02-03 01:36:15 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 01:36:17 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 01:36:17 - INFO - Costes cargados: 22145 registros
2026-02-03 01:36:17 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA DECO_EXTERIOR ===
2026-02-03 01:36:17 - INFO -   ABC: 995 registros
2026-02-03 01:36:17 - INFO -   Ventas: 4018 registros
2026-02-03 01:36:17 - INFO -   Costes: 22145 registros
2026-02-03 01:36:17 - INFO - Datos de ventas: 316 registros
2026-02-03 01:36:17 - INFO - Calculando pedido para semana 14 (316 registros)
2026-02-03 01:36:18 - INFO -   Objetivo: 3740.34€, Actual (ABC): 4104.66€
2026-02-03 01:36:18 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 01:36:18 - INFO -   Factor total: 1.3125
2026-02-03 01:36:18 - INFO -   Factor escalado: 1.1960
2026-02-03 01:36:18 - INFO -   Ventas preliminares (con ceil): 6094.59€
2026-02-03 01:36:18 - INFO -   Objetivo final: 4909.20€
2026-02-03 01:36:18 - INFO -   Delta: 1185.39€
2026-02-03 01:36:18 - INFO -   Ventas finales: 4923.89€
2026-02-03 01:36:18 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_deco_exterior.xlsx
2026-02-03 01:36:18 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_deco_exterior.xlsx
2026-02-03 01:36:18 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_deco_exterior.xlsx
2026-02-03 01:36:18 - INFO -   Articulos: 205
2026-02-03 01:36:18 - INFO -   Importe: 4923.89€
2026-02-03 01:36:18 - INFO - Estado guardado correctamente
2026-02-03 01:36:18 - INFO - Generando resumen: .\./data/output\Resumen_Pedidos_VIVERO_2026-02-03.xlsx
2026-02-03 01:36:18 - INFO - Resumen guardado: .\./data/output\Resumen_Pedidos_VIVERO_2026-02-03.xlsx
2026-02-03 01:36:18 - INFO - Estado guardado correctamente
2026-02-03 01:36:18 - INFO - 
============================================================
2026-02-03 01:36:18 - INFO - PREPARANDO ENVÍO DE EMAILS
2026-02-03 01:36:18 - INFO - ============================================================
2026-02-03 01:36:18 - INFO - 
============================================================
2026-02-03 01:36:18 - INFO - ENVÍO DE EMAILS A RESPONSABLES
2026-02-03 01:36:18 - INFO - ============================================================
2026-02-03 01:36:18 - INFO - EmailService inicializado correctamente
2026-02-03 01:36:18 - ERROR - La variable de entorno 'EMAIL_PASSWORD' no está configurada. Por favor, configúrala antes de enviar emails.
2026-02-03 01:36:18 - WARNING - Problemas de configuración detectados:
2026-02-03 01:36:18 - WARNING -   - La variable de entorno 'EMAIL_PASSWORD' no está configurada
2026-02-03 01:36:18 - INFO - 
Enviando email para sección: maf
2026-02-03 01:36:18 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_maf.xlsx']
2026-02-03 01:36:18 - INFO - ============================================================
2026-02-03 01:36:18 - INFO - ENVIANDO EMAIL PARA SECCIÓN: MAF
2026-02-03 01:36:18 - INFO - ============================================================
2026-02-03 01:36:18 - ERROR - Error al enviar emails: name 'destinatorios_config' is not defined
2026-02-03 01:36:18 - ERROR - Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 445, in enviar_emails_pedidos
    resultado = email_service.enviar_pedido_por_seccion(
        semana=semana,
        seccion=seccion,
        archivos=archivos
    )
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\email_service.py", line 331, in enviar_pedido_por_seccion
    destinatarios_info = self.obtener_destinatarios_seccion(seccion)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\email_service.py", line 297, in obtener_destinatarios_seccion
    for dest in destinatorios_config:
                ^^^^^^^^^^^^^^^^^^^^
NameError: name 'destinatorios_config' is not defined. Did you mean: 'destinatarios_config'?

2026-02-03 01:36:18 - INFO - 
======================================================================
2026-02-03 01:36:18 - INFO - RESUMEN DE EJECUCION
2026-02-03 01:36:18 - INFO - ======================================================================
2026-02-03 01:36:18 - INFO - Semana procesada: 14
2026-02-03 01:36:18 - INFO - Archivos generados: 12
2026-02-03 01:36:18 - INFO - Total articulos: 1510
2026-02-03 01:36:18 - INFO - Total importe: 48113.87€
2026-02-03 01:36:18 - INFO - ======================================================================
2026-02-03 01:36:18 - INFO - 
¡PEDIDO GENERADO EXITOSAMENTE!
2026-02-03 01:36:18 - INFO - Archivo principal: .\./data/output\Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 01:36:18 - INFO - Artículos: 1510
2026-02-03 01:36:18 - INFO - Importe: 48113.87€
2026-02-03 01:37:37 - INFO - ======================================================================
2026-02-03 01:37:37 - INFO - SISTEMA DE PEDIDOS DE COMPRA - VIVERO ARANJUEZ V2
2026-02-03 01:37:37 - INFO - Fecha de ejecución: 2026-02-03 01:37:37
2026-02-03 01:37:37 - INFO - ======================================================================
2026-02-03 01:37:37 - INFO - 
VERIFICANDO CONFIGURACIÓN DE EMAIL:
2026-02-03 01:37:37 - INFO - ----------------------------------------
2026-02-03 01:37:37 - INFO - EmailService inicializado correctamente
2026-02-03 01:37:37 - ERROR - La variable de entorno 'EMAIL_PASSWORD' no está configurada. Por favor, configúrala antes de enviar emails.
2026-02-03 01:37:37 - WARNING - Problemas de configuración detectados:
2026-02-03 01:37:37 - WARNING -   - La variable de entorno 'EMAIL_PASSWORD' no está configurada
2026-02-03 01:37:37 - INFO - ✓ Configuración de email válida
2026-02-03 01:37:37 - WARNING - ✗ Variable EMAIL_PASSWORD NO configurada
2026-02-03 01:37:37 - INFO -   Para configurarla, ejecuta:
2026-02-03 01:37:37 - INFO -   export EMAIL_PASSWORD='tu_contraseña'
2026-02-03 15:25:38 - INFO - ======================================================================
2026-02-03 15:25:38 - INFO - SISTEMA DE PEDIDOS DE COMPRA - VIVERO ARANJUEZ V2
2026-02-03 15:25:38 - INFO - Fecha de ejecución: 2026-02-03 15:25:38
2026-02-03 15:25:38 - INFO - ======================================================================
2026-02-03 15:25:38 - INFO - Modo de ejecución: Solo FASE 1
2026-02-03 15:25:38 - INFO - Envío de emails: Sí
2026-02-03 15:25:38 - INFO - StateManager inicializado. Archivo de estado: .\./data\state.json
2026-02-03 15:25:38 - INFO - Cargando estado desde: .\./data\state.json
2026-02-03 15:25:38 - INFO - Estado cargado correctamente
2026-02-03 15:25:38 - INFO - SchedulerService inicializado correctamente
2026-02-03 15:25:38 - INFO - Horario configurado: sunday a las 15:00
2026-02-03 15:25:38 - INFO - Semana forzada por argumento: 14
2026-02-03 15:25:38 - INFO - ======================================================================
2026-02-03 15:25:38 - INFO - PROCESANDO PEDIDO PARA SEMANA 14
2026-02-03 15:25:38 - INFO - ======================================================================
2026-02-03 15:25:38 - INFO - MODO: Solo FASE 1 (Forecast) - Corrección deshabilitada
2026-02-03 15:25:38 - INFO - DataLoader inicializado correctamente
2026-02-03 15:25:38 - INFO - ForecastEngine inicializado correctamente
2026-02-03 15:25:38 - INFO - OrderGenerator inicializado correctamente
2026-02-03 15:25:38 - INFO - SchedulerService inicializado correctamente
2026-02-03 15:25:38 - INFO - Horario configurado: sunday a las 15:00
2026-02-03 15:25:38 - INFO - Período de la semana: 2026-03-30 al 2026-04-05
2026-02-03 15:25:38 - INFO - Stock acumulado cargado: 2633 artículos
2026-02-03 15:25:38 - INFO - 
==================================================
2026-02-03 15:25:38 - INFO - SECCION: MAF
2026-02-03 15:25:38 - INFO - ==================================================
2026-02-03 15:25:38 - INFO - === LEYENDO DATOS PARA SECCIÓN: MAF ===
2026-02-03 15:25:38 - INFO - Archivo ABC encontrado para 'maf': .\./data/input\CLASIFICACION_ABC+D_maf.xlsx
2026-02-03 15:25:38 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_maf.xlsx
2026-02-03 15:25:39 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 15:25:39 - INFO - Clasificación ABC cargada para 'maf': 499 registros
2026-02-03 15:25:39 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 15:25:42 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:25:42 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 15:25:42 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 15:25:42 - INFO - Ventas cargadas: 44082 registros
2026-02-03 15:25:43 - INFO - Filtrados 10970 registros de sección 'maf' de 44082 total
2026-02-03 15:25:43 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 15:25:44 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:25:44 - INFO - Costes cargados: 22145 registros
2026-02-03 15:25:44 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MAF ===
2026-02-03 15:25:45 - INFO -   ABC: 499 registros
2026-02-03 15:25:45 - INFO -   Ventas: 10970 registros
2026-02-03 15:25:45 - INFO -   Costes: 22145 registros
2026-02-03 15:25:45 - INFO - Datos de ventas: 1011 registros
2026-02-03 15:25:45 - INFO - Calculando pedido para semana 14 (1011 registros)
2026-02-03 15:25:45 - INFO -   Objetivo: 7050.65€, Actual (ABC): 5843.77€
2026-02-03 15:25:45 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 15:25:45 - INFO -   Factor total: 1.3125
2026-02-03 15:25:45 - INFO -   Factor escalado: 1.5836
2026-02-03 15:25:45 - INFO -   Ventas preliminares (con ceil): 9931.01€
2026-02-03 15:25:45 - INFO -   Objetivo final: 9253.98€
2026-02-03 15:25:45 - INFO -   Delta: 677.03€
2026-02-03 15:25:45 - INFO -   Ventas finales: 9259.59€
2026-02-03 15:25:45 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 15:25:45 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 15:25:45 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 15:25:45 - INFO -   Articulos: 191
2026-02-03 15:25:45 - INFO -   Importe: 9259.59€
2026-02-03 15:25:45 - INFO - 
==================================================
2026-02-03 15:25:45 - INFO - SECCION: DECO_INTERIOR
2026-02-03 15:25:45 - INFO - ==================================================
2026-02-03 15:25:45 - INFO - === LEYENDO DATOS PARA SECCIÓN: DECO_INTERIOR ===
2026-02-03 15:25:45 - INFO - Archivo ABC encontrado para 'deco_interior': .\./data/input\CLASIFICACION_ABC+D_deco_interior.xlsx
2026-02-03 15:25:45 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_deco_interior.xlsx
2026-02-03 15:25:46 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 15:25:46 - INFO - Clasificación ABC cargada para 'deco_interior': 1827 registros
2026-02-03 15:25:46 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 15:25:49 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:25:49 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 15:25:50 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 15:25:50 - INFO - Ventas cargadas: 44082 registros
2026-02-03 15:25:50 - INFO - Filtrados 2468 registros de sección 'deco_interior' de 44082 total
2026-02-03 15:25:50 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 15:25:52 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:25:52 - INFO - Costes cargados: 22145 registros
2026-02-03 15:25:52 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA DECO_INTERIOR ===
2026-02-03 15:25:52 - INFO -   ABC: 1827 registros
2026-02-03 15:25:52 - INFO -   Ventas: 2468 registros
2026-02-03 15:25:52 - INFO -   Costes: 22145 registros
2026-02-03 15:25:52 - INFO - Datos de ventas: 180 registros
2026-02-03 15:25:52 - INFO - Calculando pedido para semana 14 (180 registros)
2026-02-03 15:25:52 - INFO -   Objetivo: 1962.99€, Actual (ABC): 1636.15€
2026-02-03 15:25:52 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 15:25:52 - INFO -   Factor total: 1.3125
2026-02-03 15:25:52 - INFO -   Factor escalado: 1.5747
2026-02-03 15:25:52 - INFO -   Ventas preliminares (con ceil): 2950.01€
2026-02-03 15:25:52 - INFO -   Objetivo final: 2576.42€
2026-02-03 15:25:52 - INFO -   Delta: 373.59€
2026-02-03 15:25:52 - INFO -   Ventas finales: 2580.73€
2026-02-03 15:25:52 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_deco_interior.xlsx
2026-02-03 15:25:52 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_deco_interior.xlsx
2026-02-03 15:25:52 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_deco_interior.xlsx
2026-02-03 15:25:52 - INFO -   Articulos: 135
2026-02-03 15:25:52 - INFO -   Importe: 2580.73€
2026-02-03 15:25:52 - INFO - 
==================================================
2026-02-03 15:25:52 - INFO - SECCION: SEMILLAS
2026-02-03 15:25:52 - INFO - ==================================================
2026-02-03 15:25:52 - INFO - === LEYENDO DATOS PARA SECCIÓN: SEMILLAS ===
2026-02-03 15:25:52 - INFO - Archivo ABC encontrado para 'semillas': .\./data/input\CLASIFICACION_ABC+D_semillas.xlsx
2026-02-03 15:25:52 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_semillas.xlsx
2026-02-03 15:25:52 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 15:25:52 - INFO - Clasificación ABC cargada para 'semillas': 218 registros
2026-02-03 15:25:52 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 15:25:56 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:25:56 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 15:25:56 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 15:25:56 - INFO - Ventas cargadas: 44082 registros
2026-02-03 15:25:56 - INFO - Filtrados 1180 registros de sección 'semillas' de 44082 total
2026-02-03 15:25:56 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 15:25:58 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:25:58 - INFO - Costes cargados: 22145 registros
2026-02-03 15:25:58 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA SEMILLAS ===
2026-02-03 15:25:58 - INFO -   ABC: 218 registros
2026-02-03 15:25:58 - INFO -   Ventas: 1180 registros
2026-02-03 15:25:58 - INFO -   Costes: 22145 registros
2026-02-03 15:25:58 - INFO - Datos de ventas: 136 registros
2026-02-03 15:25:58 - INFO - Calculando pedido para semana 14 (136 registros)
2026-02-03 15:25:59 - INFO -   Objetivo: 694.34€, Actual (ABC): 455.14€
2026-02-03 15:25:59 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 15:25:59 - INFO -   Factor total: 1.3125
2026-02-03 15:25:59 - INFO -   Factor escalado: 2.0023
2026-02-03 15:25:59 - INFO -   Ventas preliminares (con ceil): 1129.15€
2026-02-03 15:25:59 - INFO -   Objetivo final: 911.32€
2026-02-03 15:25:59 - INFO -   Delta: 217.83€
2026-02-03 15:25:59 - INFO -   Ventas finales: 911.60€
2026-02-03 15:25:59 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_semillas.xlsx
2026-02-03 15:25:59 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_semillas.xlsx
2026-02-03 15:25:59 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_semillas.xlsx
2026-02-03 15:25:59 - INFO -   Articulos: 84
2026-02-03 15:25:59 - INFO -   Importe: 911.60€
2026-02-03 15:25:59 - INFO - 
==================================================
2026-02-03 15:25:59 - INFO - SECCION: MASCOTAS_VIVO
2026-02-03 15:25:59 - INFO - ==================================================
2026-02-03 15:25:59 - INFO - === LEYENDO DATOS PARA SECCIÓN: MASCOTAS_VIVO ===
2026-02-03 15:25:59 - INFO - Archivo ABC encontrado para 'mascotas_vivo': .\./data/input\CLASIFICACION_ABC+D_mascotas_vivo.xlsx
2026-02-03 15:25:59 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_mascotas_vivo.xlsx
2026-02-03 15:25:59 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 15:25:59 - INFO - Clasificación ABC cargada para 'mascotas_vivo': 205 registros
2026-02-03 15:25:59 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 15:26:03 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:26:03 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 15:26:03 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 15:26:03 - INFO - Ventas cargadas: 44082 registros
2026-02-03 15:26:03 - INFO - Filtrados 1124 registros de sección 'mascotas_vivo' de 44082 total
2026-02-03 15:26:03 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 15:26:05 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:26:05 - INFO - Costes cargados: 22145 registros
2026-02-03 15:26:05 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MASCOTAS_VIVO ===
2026-02-03 15:26:05 - INFO -   ABC: 205 registros
2026-02-03 15:26:05 - INFO -   Ventas: 1124 registros
2026-02-03 15:26:05 - INFO -   Costes: 22145 registros
2026-02-03 15:26:05 - INFO - Datos de ventas: 88 registros
2026-02-03 15:26:05 - INFO - Calculando pedido para semana 14 (88 registros)
2026-02-03 15:26:05 - INFO -   Objetivo: 1087.15€, Actual (ABC): 846.63€
2026-02-03 15:26:05 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 15:26:05 - INFO -   Factor total: 1.3125
2026-02-03 15:26:05 - INFO -   Factor escalado: 1.6854
2026-02-03 15:26:05 - INFO -   Ventas preliminares (con ceil): 1773.66€
2026-02-03 15:26:05 - INFO -   Objetivo final: 1426.88€
2026-02-03 15:26:05 - INFO -   Delta: 346.78€
2026-02-03 15:26:05 - INFO -   Ventas finales: 1455.34€
2026-02-03 15:26:05 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx
2026-02-03 15:26:05 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx
2026-02-03 15:26:05 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx
2026-02-03 15:26:05 - INFO -   Articulos: 36
2026-02-03 15:26:05 - INFO -   Importe: 1455.34€
2026-02-03 15:26:05 - INFO - 
==================================================
2026-02-03 15:26:05 - INFO - SECCION: MASCOTAS_MANUFACTURADO
2026-02-03 15:26:05 - INFO - ==================================================
2026-02-03 15:26:05 - INFO - === LEYENDO DATOS PARA SECCIÓN: MASCOTAS_MANUFACTURADO ===
2026-02-03 15:26:05 - INFO - Archivo ABC encontrado para 'mascotas_manufacturado': .\./data/input\CLASIFICACION_ABC+D_mascotas_manufacturado.xlsx
2026-02-03 15:26:05 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_mascotas_manufacturado.xlsx
2026-02-03 15:26:06 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 15:26:06 - INFO - Clasificación ABC cargada para 'mascotas_manufacturado': 2749 registros
2026-02-03 15:26:06 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 15:26:09 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:26:09 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 15:26:09 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 15:26:09 - INFO - Ventas cargadas: 44082 registros
2026-02-03 15:26:10 - INFO - Filtrados 9784 registros de sección 'mascotas_manufacturado' de 44082 total
2026-02-03 15:26:10 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 15:26:11 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:26:12 - INFO - Costes cargados: 22145 registros
2026-02-03 15:26:12 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MASCOTAS_MANUFACTURADO ===
2026-02-03 15:26:12 - INFO -   ABC: 2749 registros
2026-02-03 15:26:12 - INFO -   Ventas: 9784 registros
2026-02-03 15:26:12 - INFO -   Costes: 22145 registros
2026-02-03 15:26:12 - INFO - Datos de ventas: 822 registros
2026-02-03 15:26:12 - INFO - Calculando pedido para semana 14 (822 registros)
2026-02-03 15:26:14 - INFO -   Objetivo: 6839.82€, Actual (ABC): 8742.92€
2026-02-03 15:26:14 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 15:26:14 - INFO -   Factor total: 1.3125
2026-02-03 15:26:14 - INFO -   Factor escalado: 1.0268
2026-02-03 15:26:14 - INFO -   Ventas preliminares (con ceil): 12379.25€
2026-02-03 15:26:14 - INFO -   Objetivo final: 8977.26€
2026-02-03 15:26:14 - INFO -   Delta: 3401.99€
2026-02-03 15:26:14 - INFO -   Ventas finales: 8993.98€
2026-02-03 15:26:14 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx
2026-02-03 15:26:14 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx
2026-02-03 15:26:14 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx
2026-02-03 15:26:14 - INFO -   Articulos: 411
2026-02-03 15:26:14 - INFO -   Importe: 8993.98€
2026-02-03 15:26:14 - INFO - 
==================================================
2026-02-03 15:26:14 - INFO - SECCION: INTERIOR
2026-02-03 15:26:14 - INFO - ==================================================
2026-02-03 15:26:14 - INFO - === LEYENDO DATOS PARA SECCIÓN: INTERIOR ===
2026-02-03 15:26:14 - INFO - Archivo ABC encontrado para 'interior': .\./data/input\CLASIFICACION_ABC+D_interior.xlsx
2026-02-03 15:26:14 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_interior.xlsx
2026-02-03 15:26:14 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 15:26:14 - INFO - Clasificación ABC cargada para 'interior': 555 registros
2026-02-03 15:26:14 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 15:26:18 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:26:18 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 15:26:18 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 15:26:18 - INFO - Ventas cargadas: 44082 registros
2026-02-03 15:26:18 - INFO - Filtrados 3624 registros de sección 'interior' de 44082 total
2026-02-03 15:26:18 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 15:26:20 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:26:20 - INFO - Costes cargados: 22145 registros
2026-02-03 15:26:20 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA INTERIOR ===
2026-02-03 15:26:20 - INFO -   ABC: 555 registros
2026-02-03 15:26:20 - INFO -   Ventas: 3624 registros
2026-02-03 15:26:20 - INFO -   Costes: 22145 registros
2026-02-03 15:26:20 - INFO - Datos de ventas: 286 registros
2026-02-03 15:26:20 - INFO - Calculando pedido para semana 14 (286 registros)
2026-02-03 15:26:21 - INFO -   Objetivo: 2930.63€, Actual (ABC): 2409.44€
2026-02-03 15:26:21 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 15:26:21 - INFO -   Factor total: 1.3125
2026-02-03 15:26:21 - INFO -   Factor escalado: 1.5964
2026-02-03 15:26:21 - INFO -   Ventas preliminares (con ceil): 4541.81€
2026-02-03 15:26:21 - INFO -   Objetivo final: 3846.45€
2026-02-03 15:26:21 - INFO -   Delta: 695.36€
2026-02-03 15:26:21 - INFO -   Ventas finales: 3855.17€
2026-02-03 15:26:21 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_interior.xlsx
2026-02-03 15:26:21 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_interior.xlsx
2026-02-03 15:26:21 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_interior.xlsx
2026-02-03 15:26:21 - INFO -   Articulos: 121
2026-02-03 15:26:21 - INFO -   Importe: 3855.17€
2026-02-03 15:26:21 - INFO - 
==================================================
2026-02-03 15:26:21 - INFO - SECCION: FITOS
2026-02-03 15:26:21 - INFO - ==================================================
2026-02-03 15:26:21 - INFO - === LEYENDO DATOS PARA SECCIÓN: FITOS ===
2026-02-03 15:26:21 - INFO - Archivo ABC encontrado para 'fitos': .\./data/input\CLASIFICACION_ABC+D_fitos.xlsx
2026-02-03 15:26:21 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_fitos.xlsx
2026-02-03 15:26:21 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 15:26:21 - INFO - Clasificación ABC cargada para 'fitos': 247 registros
2026-02-03 15:26:21 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 15:26:25 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:26:25 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 15:26:25 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 15:26:25 - INFO - Ventas cargadas: 44082 registros
2026-02-03 15:26:25 - INFO - Filtrados 1987 registros de sección 'fitos' de 44082 total
2026-02-03 15:26:25 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 15:26:27 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:26:27 - INFO - Costes cargados: 22145 registros
2026-02-03 15:26:27 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA FITOS ===
2026-02-03 15:26:27 - INFO -   ABC: 247 registros
2026-02-03 15:26:27 - INFO -   Ventas: 1987 registros
2026-02-03 15:26:27 - INFO -   Costes: 22145 registros
2026-02-03 15:26:27 - INFO - Datos de ventas: 157 registros
2026-02-03 15:26:27 - INFO - Calculando pedido para semana 14 (157 registros)
2026-02-03 15:26:27 - INFO -   Objetivo: 1798.25€, Actual (ABC): 1679.26€
2026-02-03 15:26:27 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 15:26:27 - INFO -   Factor total: 1.3125
2026-02-03 15:26:27 - INFO -   Factor escalado: 1.4055
2026-02-03 15:26:27 - INFO -   Ventas preliminares (con ceil): 2784.94€
2026-02-03 15:26:27 - INFO -   Objetivo final: 2360.20€
2026-02-03 15:26:27 - INFO -   Delta: 424.74€
2026-02-03 15:26:27 - INFO -   Ventas finales: 2365.92€
2026-02-03 15:26:27 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_fitos.xlsx
2026-02-03 15:26:27 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_fitos.xlsx
2026-02-03 15:26:27 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_fitos.xlsx
2026-02-03 15:26:27 - INFO -   Articulos: 82
2026-02-03 15:26:27 - INFO -   Importe: 2365.92€
2026-02-03 15:26:27 - INFO - 
==================================================
2026-02-03 15:26:27 - INFO - SECCION: VIVERO
2026-02-03 15:26:27 - INFO - ==================================================
2026-02-03 15:26:27 - INFO - === LEYENDO DATOS PARA SECCIÓN: VIVERO ===
2026-02-03 15:26:27 - INFO - Archivo ABC encontrado para 'vivero': .\./data/input\CLASIFICACION_ABC+D_vivero.xlsx
2026-02-03 15:26:27 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_vivero.xlsx
2026-02-03 15:26:27 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 15:26:27 - INFO - Clasificación ABC cargada para 'vivero': 565 registros
2026-02-03 15:26:27 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 15:26:31 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:26:31 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 15:26:31 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 15:26:31 - INFO - Ventas cargadas: 44082 registros
2026-02-03 15:26:31 - INFO - Filtrados 2460 registros de sección 'vivero' de 44082 total
2026-02-03 15:26:31 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 15:26:33 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:26:33 - INFO - Costes cargados: 22145 registros
2026-02-03 15:26:33 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA VIVERO ===
2026-02-03 15:26:33 - INFO -   ABC: 565 registros
2026-02-03 15:26:33 - INFO -   Ventas: 2460 registros
2026-02-03 15:26:33 - INFO -   Costes: 22145 registros
2026-02-03 15:26:33 - INFO - Datos de ventas: 189 registros
2026-02-03 15:26:33 - INFO - Calculando pedido para semana 14 (189 registros)
2026-02-03 15:26:34 - INFO -   Objetivo: 5297.17€, Actual (ABC): 4113.14€
2026-02-03 15:26:34 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 15:26:34 - INFO -   Factor total: 1.3125
2026-02-03 15:26:34 - INFO -   Factor escalado: 1.6903
2026-02-03 15:26:34 - INFO -   Ventas preliminares (con ceil): 8761.94€
2026-02-03 15:26:34 - INFO -   Objetivo final: 6952.54€
2026-02-03 15:26:34 - INFO -   Delta: 1809.40€
2026-02-03 15:26:34 - INFO -   Ventas finales: 6990.51€
2026-02-03 15:26:34 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_vivero.xlsx
2026-02-03 15:26:34 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_vivero.xlsx
2026-02-03 15:26:34 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_vivero.xlsx
2026-02-03 15:26:34 - INFO -   Articulos: 96
2026-02-03 15:26:34 - INFO -   Importe: 6990.51€
2026-02-03 15:26:34 - INFO - 
==================================================
2026-02-03 15:26:34 - INFO - SECCION: UTILES_JARDIN
2026-02-03 15:26:34 - INFO - ==================================================
2026-02-03 15:26:34 - INFO - === LEYENDO DATOS PARA SECCIÓN: UTILES_JARDIN ===
2026-02-03 15:26:34 - INFO - Archivo ABC encontrado para 'utiles_jardin': .\./data/input\CLASIFICACION_ABC+D_utiles_jardin.xlsx
2026-02-03 15:26:34 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_utiles_jardin.xlsx
2026-02-03 15:26:34 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 15:26:34 - INFO - Clasificación ABC cargada para 'utiles_jardin': 433 registros
2026-02-03 15:26:34 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 15:26:38 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:26:38 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 15:26:38 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 15:26:38 - INFO - Ventas cargadas: 44082 registros
2026-02-03 15:26:38 - INFO - Filtrados 1009 registros de sección 'utiles_jardin' de 44082 total
2026-02-03 15:26:38 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 15:26:40 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:26:40 - INFO - Costes cargados: 22145 registros
2026-02-03 15:26:40 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA UTILES_JARDIN ===
2026-02-03 15:26:40 - INFO -   ABC: 433 registros
2026-02-03 15:26:40 - INFO -   Ventas: 1009 registros
2026-02-03 15:26:40 - INFO -   Costes: 22145 registros
2026-02-03 15:26:40 - INFO - Datos de ventas: 89 registros
2026-02-03 15:26:40 - INFO - Calculando pedido para semana 14 (89 registros)
2026-02-03 15:26:40 - INFO -   Objetivo: 1044.77€, Actual (ABC): 818.79€
2026-02-03 15:26:40 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 15:26:40 - INFO -   Factor total: 1.3125
2026-02-03 15:26:40 - INFO -   Factor escalado: 1.6747
2026-02-03 15:26:40 - INFO -   Ventas preliminares (con ceil): 1929.56€
2026-02-03 15:26:40 - INFO -   Objetivo final: 1371.26€
2026-02-03 15:26:40 - INFO -   Delta: 558.30€
2026-02-03 15:26:40 - INFO -   Ventas finales: 1390.00€
2026-02-03 15:26:40 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx
2026-02-03 15:26:40 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx
2026-02-03 15:26:40 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx
2026-02-03 15:26:40 - INFO -   Articulos: 78
2026-02-03 15:26:40 - INFO -   Importe: 1390.00€
2026-02-03 15:26:40 - INFO - 
==================================================
2026-02-03 15:26:40 - INFO - SECCION: TIERRAS_ARIDOS
2026-02-03 15:26:40 - INFO - ==================================================
2026-02-03 15:26:40 - INFO - === LEYENDO DATOS PARA SECCIÓN: TIERRAS_ARIDOS ===
2026-02-03 15:26:40 - WARNING - No se encontró archivo específico para 'tierras_aridos', usando: .\./data/input\CLASIFICACION_ABC+D_DECO_EXTERIOR.xlsx
2026-02-03 15:26:40 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_DECO_EXTERIOR.xlsx
2026-02-03 15:26:40 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 15:26:40 - INFO - Clasificación ABC cargada para 'tierras_aridos': 995 registros
2026-02-03 15:26:40 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 15:26:44 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:26:44 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 15:26:44 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 15:26:44 - INFO - Ventas cargadas: 44082 registros
2026-02-03 15:26:44 - INFO - Filtrados 3264 registros de sección 'tierras_aridos' de 44082 total
2026-02-03 15:26:44 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 15:26:46 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:26:46 - INFO - Costes cargados: 22145 registros
2026-02-03 15:26:46 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA TIERRAS_ARIDOS ===
2026-02-03 15:26:46 - INFO -   ABC: 995 registros
2026-02-03 15:26:46 - INFO -   Ventas: 3264 registros
2026-02-03 15:26:46 - INFO -   Costes: 22145 registros
2026-02-03 15:26:46 - INFO - Datos de ventas: 302 registros
2026-02-03 15:26:46 - INFO - Calculando pedido para semana 14 (302 registros)
2026-02-03 15:26:47 - INFO -   Objetivo: 4097.24€, Actual (ABC): 4019.19€
2026-02-03 15:26:47 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 15:26:47 - INFO -   Factor total: 1.3125
2026-02-03 15:26:47 - INFO -   Factor escalado: 1.3380
2026-02-03 15:26:47 - INFO -   Ventas preliminares (con ceil): 5809.66€
2026-02-03 15:26:47 - INFO -   Objetivo final: 5377.63€
2026-02-03 15:26:47 - INFO -   Delta: 432.03€
2026-02-03 15:26:47 - INFO -   Ventas finales: 5387.14€
2026-02-03 15:26:47 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx
2026-02-03 15:26:47 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx
2026-02-03 15:26:47 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx
2026-02-03 15:26:47 - INFO -   Articulos: 71
2026-02-03 15:26:47 - INFO -   Importe: 5387.14€
2026-02-03 15:26:47 - INFO - 
==================================================
2026-02-03 15:26:47 - INFO - SECCION: DECO_EXTERIOR
2026-02-03 15:26:47 - INFO - ==================================================
2026-02-03 15:26:47 - INFO - === LEYENDO DATOS PARA SECCIÓN: DECO_EXTERIOR ===
2026-02-03 15:26:47 - INFO - Archivo ABC encontrado para 'deco_exterior': .\./data/input\CLASIFICACION_ABC+D_deco_exterior.xlsx
2026-02-03 15:26:47 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_deco_exterior.xlsx
2026-02-03 15:26:47 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 15:26:47 - INFO - Clasificación ABC cargada para 'deco_exterior': 995 registros
2026-02-03 15:26:47 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 15:26:51 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:26:51 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 15:26:51 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 15:26:51 - INFO - Ventas cargadas: 44082 registros
2026-02-03 15:26:51 - INFO - Filtrados 4018 registros de sección 'deco_exterior' de 44082 total
2026-02-03 15:26:51 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 15:26:53 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:26:53 - INFO - Costes cargados: 22145 registros
2026-02-03 15:26:53 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA DECO_EXTERIOR ===
2026-02-03 15:26:53 - INFO -   ABC: 995 registros
2026-02-03 15:26:53 - INFO -   Ventas: 4018 registros
2026-02-03 15:26:53 - INFO -   Costes: 22145 registros
2026-02-03 15:26:53 - INFO - Datos de ventas: 316 registros
2026-02-03 15:26:53 - INFO - Calculando pedido para semana 14 (316 registros)
2026-02-03 15:26:54 - INFO -   Objetivo: 3740.34€, Actual (ABC): 4104.66€
2026-02-03 15:26:54 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 15:26:54 - INFO -   Factor total: 1.3125
2026-02-03 15:26:54 - INFO -   Factor escalado: 1.1960
2026-02-03 15:26:54 - INFO -   Ventas preliminares (con ceil): 6094.59€
2026-02-03 15:26:54 - INFO -   Objetivo final: 4909.20€
2026-02-03 15:26:54 - INFO -   Delta: 1185.39€
2026-02-03 15:26:54 - INFO -   Ventas finales: 4923.89€
2026-02-03 15:26:54 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_deco_exterior.xlsx
2026-02-03 15:26:54 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_deco_exterior.xlsx
2026-02-03 15:26:54 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_deco_exterior.xlsx
2026-02-03 15:26:54 - INFO -   Articulos: 205
2026-02-03 15:26:54 - INFO -   Importe: 4923.89€
2026-02-03 15:26:54 - INFO - Estado guardado correctamente
2026-02-03 15:26:54 - INFO - Generando resumen: .\./data/output\Resumen_Pedidos_VIVERO_2026-02-03.xlsx
2026-02-03 15:26:54 - INFO - Resumen guardado: .\./data/output\Resumen_Pedidos_VIVERO_2026-02-03.xlsx
2026-02-03 15:26:54 - INFO - Estado guardado correctamente
2026-02-03 15:26:54 - INFO - 
============================================================
2026-02-03 15:26:54 - INFO - PREPARANDO ENVÍO DE EMAILS
2026-02-03 15:26:54 - INFO - ============================================================
2026-02-03 15:26:54 - INFO - 
============================================================
2026-02-03 15:26:54 - INFO - ENVÍO DE EMAILS A RESPONSABLES
2026-02-03 15:26:54 - INFO - ============================================================
2026-02-03 15:26:54 - INFO - EmailService inicializado correctamente
2026-02-03 15:26:54 - ERROR - La variable de entorno 'EMAIL_PASSWORD' no está configurada. Por favor, configúrala antes de enviar emails.
2026-02-03 15:26:54 - WARNING - Problemas de configuración detectados:
2026-02-03 15:26:54 - WARNING -   - La variable de entorno 'EMAIL_PASSWORD' no está configurada
2026-02-03 15:26:54 - INFO - 
Enviando email para sección: maf
2026-02-03 15:26:54 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_maf.xlsx']
2026-02-03 15:26:54 - INFO - ============================================================
2026-02-03 15:26:54 - INFO - ENVIANDO EMAIL PARA SECCIÓN: MAF
2026-02-03 15:26:54 - INFO - ============================================================
2026-02-03 15:26:54 - ERROR - Error al enviar emails: name 'destinatorios_config' is not defined
2026-02-03 15:26:54 - ERROR - Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 445, in enviar_emails_pedidos
    resultado = email_service.enviar_pedido_por_seccion(
        semana=semana,
        seccion=seccion,
        archivos=archivos
    )
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\email_service.py", line 331, in enviar_pedido_por_seccion
    destinatarios_info = self.obtener_destinatarios_seccion(seccion)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\email_service.py", line 297, in obtener_destinatarios_seccion
    for dest in destinatorios_config:
                ^^^^^^^^^^^^^^^^^^^^
NameError: name 'destinatorios_config' is not defined. Did you mean: 'destinatarios_config'?

2026-02-03 15:26:54 - INFO - 
======================================================================
2026-02-03 15:26:54 - INFO - RESUMEN DE EJECUCION
2026-02-03 15:26:54 - INFO - ======================================================================
2026-02-03 15:26:54 - INFO - Semana procesada: 14
2026-02-03 15:26:54 - INFO - Archivos generados: 12
2026-02-03 15:26:54 - INFO - Total articulos: 1510
2026-02-03 15:26:54 - INFO - Total importe: 48113.87€
2026-02-03 15:26:54 - INFO - ======================================================================
2026-02-03 15:26:54 - INFO - 
¡PEDIDO GENERADO EXITOSAMENTE!
2026-02-03 15:26:54 - INFO - Archivo principal: .\./data/output\Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 15:26:54 - INFO - Artículos: 1510
2026-02-03 15:26:54 - INFO - Importe: 48113.87€
2026-02-03 15:28:23 - INFO - ======================================================================
2026-02-03 15:28:23 - INFO - SISTEMA DE PEDIDOS DE COMPRA - VIVERO ARANJUEZ V2
2026-02-03 15:28:23 - INFO - Fecha de ejecución: 2026-02-03 15:28:23
2026-02-03 15:28:23 - INFO - ======================================================================
2026-02-03 15:28:23 - INFO - Modo de ejecución: FASE 1 + FASE 2
2026-02-03 15:28:23 - INFO - Envío de emails: Sí
2026-02-03 15:28:23 - INFO - StateManager inicializado. Archivo de estado: .\./data\state.json
2026-02-03 15:28:23 - INFO - Cargando estado desde: .\./data\state.json
2026-02-03 15:28:23 - INFO - Estado cargado correctamente
2026-02-03 15:28:23 - INFO - SchedulerService inicializado correctamente
2026-02-03 15:28:23 - INFO - Horario configurado: sunday a las 15:00
2026-02-03 15:28:23 - INFO - Semana forzada por argumento: 14
2026-02-03 15:28:23 - INFO - ======================================================================
2026-02-03 15:28:23 - INFO - PROCESANDO PEDIDO PARA SEMANA 14
2026-02-03 15:28:23 - INFO - ======================================================================
2026-02-03 15:28:23 - INFO - MODO: FASE 1 (Forecast) + FASE 2 (Corrección)
2026-02-03 15:28:23 - INFO - DataLoader inicializado correctamente
2026-02-03 15:28:23 - INFO - ForecastEngine inicializado correctamente
2026-02-03 15:28:23 - INFO - OrderGenerator inicializado correctamente
2026-02-03 15:28:23 - INFO - SchedulerService inicializado correctamente
2026-02-03 15:28:23 - INFO - Horario configurado: sunday a las 15:00
2026-02-03 15:28:23 - INFO - Período de la semana: 2026-03-30 al 2026-04-05
2026-02-03 15:28:23 - INFO - Stock acumulado cargado: 2633 artículos
2026-02-03 15:28:23 - INFO - 
==================================================
2026-02-03 15:28:23 - INFO - SECCION: MAF
2026-02-03 15:28:23 - INFO - ==================================================
2026-02-03 15:28:23 - INFO - === LEYENDO DATOS PARA SECCIÓN: MAF ===
2026-02-03 15:28:23 - INFO - Archivo ABC encontrado para 'maf': .\./data/input\CLASIFICACION_ABC+D_maf.xlsx
2026-02-03 15:28:23 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_maf.xlsx
2026-02-03 15:28:23 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 15:28:23 - INFO - Clasificación ABC cargada para 'maf': 499 registros
2026-02-03 15:28:23 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 15:28:27 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:28:27 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 15:28:27 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 15:28:27 - INFO - Ventas cargadas: 44082 registros
2026-02-03 15:28:27 - INFO - Filtrados 10970 registros de sección 'maf' de 44082 total
2026-02-03 15:28:27 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 15:28:29 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:28:29 - INFO - Costes cargados: 22145 registros
2026-02-03 15:28:29 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MAF ===
2026-02-03 15:28:29 - INFO -   ABC: 499 registros
2026-02-03 15:28:29 - INFO -   Ventas: 10970 registros
2026-02-03 15:28:29 - INFO -   Costes: 22145 registros
2026-02-03 15:28:29 - INFO - Datos de ventas: 1011 registros
2026-02-03 15:28:29 - INFO - Calculando pedido para semana 14 (1011 registros)
2026-02-03 15:28:30 - INFO -   Objetivo: 7050.65€, Actual (ABC): 5843.77€
2026-02-03 15:28:30 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 15:28:30 - INFO -   Factor total: 1.3125
2026-02-03 15:28:30 - INFO -   Factor escalado: 1.5836
2026-02-03 15:28:30 - INFO -   Ventas preliminares (con ceil): 9931.01€
2026-02-03 15:28:30 - INFO -   Objetivo final: 9253.98€
2026-02-03 15:28:30 - INFO -   Delta: 677.03€
2026-02-03 15:28:30 - INFO -   Ventas finales: 9259.59€
2026-02-03 15:28:30 - INFO - 
============================================================
2026-02-03 15:28:30 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 15:28:30 - INFO - ============================================================
2026-02-03 15:28:30 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 15:28:30 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 15:28:30 - INFO - DataLoader inicializado correctamente
2026-02-03 15:28:30 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 15:28:30 - INFO - ============================================================
2026-02-03 15:28:30 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 15:28:30 - INFO - ============================================================
2026-02-03 15:28:30 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 15:28:30 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 15:28:30 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:28:30 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:28:30 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 15:28:30 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:28:30 - INFO - Stock actual cargado: 30 registros
2026-02-03 15:28:30 - INFO -   Stock: 30 registros
2026-02-03 15:28:30 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 15:28:30 - INFO - Fusión completada: 222 registros
2026-02-03 15:28:30 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 15:28:30 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 15:28:30 - INFO - Corrección completada:
2026-02-03 15:28:30 - INFO -   - Artículos corregidos: 191/222
2026-02-03 15:28:30 - INFO -   - Artículos aumentados: 191
2026-02-03 15:28:30 - INFO -   - Artículos reducidos: 0
2026-02-03 15:28:30 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 15:28:30 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 15:28:30 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 15:28:30 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 15:28:30 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 15:28:30 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 15:28:30 - INFO -   Articulos: 191
2026-02-03 15:28:30 - INFO -   Importe: 9259.59€
2026-02-03 15:28:30 - INFO - 
==================================================
2026-02-03 15:28:30 - INFO - SECCION: DECO_INTERIOR
2026-02-03 15:28:30 - INFO - ==================================================
2026-02-03 15:28:30 - INFO - === LEYENDO DATOS PARA SECCIÓN: DECO_INTERIOR ===
2026-02-03 15:28:30 - INFO - Archivo ABC encontrado para 'deco_interior': .\./data/input\CLASIFICACION_ABC+D_deco_interior.xlsx
2026-02-03 15:28:30 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_deco_interior.xlsx
2026-02-03 15:28:31 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 15:28:31 - INFO - Clasificación ABC cargada para 'deco_interior': 1827 registros
2026-02-03 15:28:31 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 15:28:34 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:28:34 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 15:28:34 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 15:28:34 - INFO - Ventas cargadas: 44082 registros
2026-02-03 15:28:34 - INFO - Filtrados 2468 registros de sección 'deco_interior' de 44082 total
2026-02-03 15:28:34 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 15:28:37 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:28:37 - INFO - Costes cargados: 22145 registros
2026-02-03 15:28:37 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA DECO_INTERIOR ===
2026-02-03 15:28:37 - INFO -   ABC: 1827 registros
2026-02-03 15:28:37 - INFO -   Ventas: 2468 registros
2026-02-03 15:28:37 - INFO -   Costes: 22145 registros
2026-02-03 15:28:37 - INFO - Datos de ventas: 180 registros
2026-02-03 15:28:37 - INFO - Calculando pedido para semana 14 (180 registros)
2026-02-03 15:28:37 - INFO -   Objetivo: 1962.99€, Actual (ABC): 1636.15€
2026-02-03 15:28:37 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 15:28:37 - INFO -   Factor total: 1.3125
2026-02-03 15:28:37 - INFO -   Factor escalado: 1.5747
2026-02-03 15:28:37 - INFO -   Ventas preliminares (con ceil): 2950.01€
2026-02-03 15:28:37 - INFO -   Objetivo final: 2576.42€
2026-02-03 15:28:37 - INFO -   Delta: 373.59€
2026-02-03 15:28:37 - INFO -   Ventas finales: 2580.73€
2026-02-03 15:28:37 - INFO - 
============================================================
2026-02-03 15:28:37 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 15:28:37 - INFO - ============================================================
2026-02-03 15:28:37 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 15:28:37 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 15:28:37 - INFO - DataLoader inicializado correctamente
2026-02-03 15:28:37 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 15:28:37 - INFO - ============================================================
2026-02-03 15:28:37 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 15:28:37 - INFO - ============================================================
2026-02-03 15:28:37 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 15:28:37 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 15:28:37 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:28:37 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:28:37 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 15:28:37 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:28:37 - INFO - Stock actual cargado: 30 registros
2026-02-03 15:28:37 - INFO -   Stock: 30 registros
2026-02-03 15:28:37 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 15:28:37 - INFO - Fusión completada: 139 registros
2026-02-03 15:28:37 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 15:28:37 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 15:28:37 - INFO - Corrección completada:
2026-02-03 15:28:37 - INFO -   - Artículos corregidos: 135/139
2026-02-03 15:28:37 - INFO -   - Artículos aumentados: 135
2026-02-03 15:28:37 - INFO -   - Artículos reducidos: 0
2026-02-03 15:28:37 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 15:28:37 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 15:28:37 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 15:28:37 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_deco_interior.xlsx
2026-02-03 15:28:37 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_deco_interior.xlsx
2026-02-03 15:28:37 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_deco_interior.xlsx
2026-02-03 15:28:37 - INFO -   Articulos: 135
2026-02-03 15:28:37 - INFO -   Importe: 2580.73€
2026-02-03 15:28:37 - INFO - 
==================================================
2026-02-03 15:28:37 - INFO - SECCION: SEMILLAS
2026-02-03 15:28:37 - INFO - ==================================================
2026-02-03 15:28:37 - INFO - === LEYENDO DATOS PARA SECCIÓN: SEMILLAS ===
2026-02-03 15:28:37 - INFO - Archivo ABC encontrado para 'semillas': .\./data/input\CLASIFICACION_ABC+D_semillas.xlsx
2026-02-03 15:28:37 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_semillas.xlsx
2026-02-03 15:28:37 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 15:28:37 - INFO - Clasificación ABC cargada para 'semillas': 218 registros
2026-02-03 15:28:37 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 15:28:41 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:28:41 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 15:28:41 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 15:28:41 - INFO - Ventas cargadas: 44082 registros
2026-02-03 15:28:41 - INFO - Filtrados 1180 registros de sección 'semillas' de 44082 total
2026-02-03 15:28:41 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 15:28:43 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:28:43 - INFO - Costes cargados: 22145 registros
2026-02-03 15:28:43 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA SEMILLAS ===
2026-02-03 15:28:43 - INFO -   ABC: 218 registros
2026-02-03 15:28:43 - INFO -   Ventas: 1180 registros
2026-02-03 15:28:43 - INFO -   Costes: 22145 registros
2026-02-03 15:28:43 - INFO - Datos de ventas: 136 registros
2026-02-03 15:28:43 - INFO - Calculando pedido para semana 14 (136 registros)
2026-02-03 15:28:44 - INFO -   Objetivo: 694.34€, Actual (ABC): 455.14€
2026-02-03 15:28:44 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 15:28:44 - INFO -   Factor total: 1.3125
2026-02-03 15:28:44 - INFO -   Factor escalado: 2.0023
2026-02-03 15:28:44 - INFO -   Ventas preliminares (con ceil): 1129.15€
2026-02-03 15:28:44 - INFO -   Objetivo final: 911.32€
2026-02-03 15:28:44 - INFO -   Delta: 217.83€
2026-02-03 15:28:44 - INFO -   Ventas finales: 911.60€
2026-02-03 15:28:44 - INFO - 
============================================================
2026-02-03 15:28:44 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 15:28:44 - INFO - ============================================================
2026-02-03 15:28:44 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 15:28:44 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 15:28:44 - INFO - DataLoader inicializado correctamente
2026-02-03 15:28:44 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 15:28:44 - INFO - ============================================================
2026-02-03 15:28:44 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 15:28:44 - INFO - ============================================================
2026-02-03 15:28:44 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 15:28:44 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 15:28:44 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:28:44 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:28:44 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 15:28:44 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:28:44 - INFO - Stock actual cargado: 30 registros
2026-02-03 15:28:44 - INFO -   Stock: 30 registros
2026-02-03 15:28:44 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 15:28:44 - INFO - Fusión completada: 84 registros
2026-02-03 15:28:44 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 15:28:44 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 15:28:44 - INFO - Corrección completada:
2026-02-03 15:28:44 - INFO -   - Artículos corregidos: 84/84
2026-02-03 15:28:44 - INFO -   - Artículos aumentados: 84
2026-02-03 15:28:44 - INFO -   - Artículos reducidos: 0
2026-02-03 15:28:44 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 15:28:44 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 15:28:44 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 15:28:44 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_semillas.xlsx
2026-02-03 15:28:44 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_semillas.xlsx
2026-02-03 15:28:44 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_semillas.xlsx
2026-02-03 15:28:44 - INFO -   Articulos: 84
2026-02-03 15:28:44 - INFO -   Importe: 911.60€
2026-02-03 15:28:44 - INFO - 
==================================================
2026-02-03 15:28:44 - INFO - SECCION: MASCOTAS_VIVO
2026-02-03 15:28:44 - INFO - ==================================================
2026-02-03 15:28:44 - INFO - === LEYENDO DATOS PARA SECCIÓN: MASCOTAS_VIVO ===
2026-02-03 15:28:44 - INFO - Archivo ABC encontrado para 'mascotas_vivo': .\./data/input\CLASIFICACION_ABC+D_mascotas_vivo.xlsx
2026-02-03 15:28:44 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_mascotas_vivo.xlsx
2026-02-03 15:28:44 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 15:28:44 - INFO - Clasificación ABC cargada para 'mascotas_vivo': 205 registros
2026-02-03 15:28:44 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 15:28:48 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:28:48 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 15:28:48 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 15:28:48 - INFO - Ventas cargadas: 44082 registros
2026-02-03 15:28:48 - INFO - Filtrados 1124 registros de sección 'mascotas_vivo' de 44082 total
2026-02-03 15:28:48 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 15:28:50 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:28:50 - INFO - Costes cargados: 22145 registros
2026-02-03 15:28:50 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MASCOTAS_VIVO ===
2026-02-03 15:28:50 - INFO -   ABC: 205 registros
2026-02-03 15:28:50 - INFO -   Ventas: 1124 registros
2026-02-03 15:28:50 - INFO -   Costes: 22145 registros
2026-02-03 15:28:50 - INFO - Datos de ventas: 88 registros
2026-02-03 15:28:50 - INFO - Calculando pedido para semana 14 (88 registros)
2026-02-03 15:28:50 - INFO -   Objetivo: 1087.15€, Actual (ABC): 846.63€
2026-02-03 15:28:50 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 15:28:50 - INFO -   Factor total: 1.3125
2026-02-03 15:28:50 - INFO -   Factor escalado: 1.6854
2026-02-03 15:28:50 - INFO -   Ventas preliminares (con ceil): 1773.66€
2026-02-03 15:28:50 - INFO -   Objetivo final: 1426.88€
2026-02-03 15:28:50 - INFO -   Delta: 346.78€
2026-02-03 15:28:50 - INFO -   Ventas finales: 1455.34€
2026-02-03 15:28:50 - INFO - 
============================================================
2026-02-03 15:28:50 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 15:28:50 - INFO - ============================================================
2026-02-03 15:28:50 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 15:28:50 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 15:28:50 - INFO - DataLoader inicializado correctamente
2026-02-03 15:28:50 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 15:28:50 - INFO - ============================================================
2026-02-03 15:28:50 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 15:28:50 - INFO - ============================================================
2026-02-03 15:28:50 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 15:28:50 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 15:28:50 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:28:50 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:28:50 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 15:28:51 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:28:51 - INFO - Stock actual cargado: 30 registros
2026-02-03 15:28:51 - INFO -   Stock: 30 registros
2026-02-03 15:28:51 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 15:28:51 - INFO - Fusión completada: 43 registros
2026-02-03 15:28:51 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 15:28:51 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 15:28:51 - INFO - Corrección completada:
2026-02-03 15:28:51 - INFO -   - Artículos corregidos: 36/43
2026-02-03 15:28:51 - INFO -   - Artículos aumentados: 36
2026-02-03 15:28:51 - INFO -   - Artículos reducidos: 0
2026-02-03 15:28:51 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 15:28:51 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 15:28:51 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 15:28:51 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx
2026-02-03 15:28:51 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx
2026-02-03 15:28:51 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx
2026-02-03 15:28:51 - INFO -   Articulos: 36
2026-02-03 15:28:51 - INFO -   Importe: 1455.34€
2026-02-03 15:28:51 - INFO - 
==================================================
2026-02-03 15:28:51 - INFO - SECCION: MASCOTAS_MANUFACTURADO
2026-02-03 15:28:51 - INFO - ==================================================
2026-02-03 15:28:51 - INFO - === LEYENDO DATOS PARA SECCIÓN: MASCOTAS_MANUFACTURADO ===
2026-02-03 15:28:51 - INFO - Archivo ABC encontrado para 'mascotas_manufacturado': .\./data/input\CLASIFICACION_ABC+D_mascotas_manufacturado.xlsx
2026-02-03 15:28:51 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_mascotas_manufacturado.xlsx
2026-02-03 15:28:51 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 15:28:51 - INFO - Clasificación ABC cargada para 'mascotas_manufacturado': 2749 registros
2026-02-03 15:28:51 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 15:28:55 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:28:55 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 15:28:55 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 15:28:55 - INFO - Ventas cargadas: 44082 registros
2026-02-03 15:28:55 - INFO - Filtrados 9784 registros de sección 'mascotas_manufacturado' de 44082 total
2026-02-03 15:28:55 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 15:28:57 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:28:57 - INFO - Costes cargados: 22145 registros
2026-02-03 15:28:57 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MASCOTAS_MANUFACTURADO ===
2026-02-03 15:28:57 - INFO -   ABC: 2749 registros
2026-02-03 15:28:57 - INFO -   Ventas: 9784 registros
2026-02-03 15:28:57 - INFO -   Costes: 22145 registros
2026-02-03 15:28:57 - INFO - Datos de ventas: 822 registros
2026-02-03 15:28:57 - INFO - Calculando pedido para semana 14 (822 registros)
2026-02-03 15:28:59 - INFO -   Objetivo: 6839.82€, Actual (ABC): 8742.92€
2026-02-03 15:28:59 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 15:28:59 - INFO -   Factor total: 1.3125
2026-02-03 15:28:59 - INFO -   Factor escalado: 1.0268
2026-02-03 15:28:59 - INFO -   Ventas preliminares (con ceil): 12379.25€
2026-02-03 15:28:59 - INFO -   Objetivo final: 8977.26€
2026-02-03 15:28:59 - INFO -   Delta: 3401.99€
2026-02-03 15:28:59 - INFO -   Ventas finales: 8993.98€
2026-02-03 15:28:59 - INFO - 
============================================================
2026-02-03 15:28:59 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 15:28:59 - INFO - ============================================================
2026-02-03 15:28:59 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 15:28:59 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 15:28:59 - INFO - DataLoader inicializado correctamente
2026-02-03 15:28:59 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 15:28:59 - INFO - ============================================================
2026-02-03 15:28:59 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 15:28:59 - INFO - ============================================================
2026-02-03 15:28:59 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 15:28:59 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 15:28:59 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:28:59 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:28:59 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 15:28:59 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:28:59 - INFO - Stock actual cargado: 30 registros
2026-02-03 15:28:59 - INFO -   Stock: 30 registros
2026-02-03 15:28:59 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 15:28:59 - INFO - Fusión completada: 538 registros
2026-02-03 15:28:59 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 15:28:59 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 15:28:59 - INFO - Corrección completada:
2026-02-03 15:28:59 - INFO -   - Artículos corregidos: 411/538
2026-02-03 15:28:59 - INFO -   - Artículos aumentados: 411
2026-02-03 15:28:59 - INFO -   - Artículos reducidos: 0
2026-02-03 15:28:59 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 15:28:59 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 15:28:59 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 15:28:59 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx
2026-02-03 15:29:00 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx
2026-02-03 15:29:00 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx
2026-02-03 15:29:00 - INFO -   Articulos: 411
2026-02-03 15:29:00 - INFO -   Importe: 8993.98€
2026-02-03 15:29:00 - INFO - 
==================================================
2026-02-03 15:29:00 - INFO - SECCION: INTERIOR
2026-02-03 15:29:00 - INFO - ==================================================
2026-02-03 15:29:00 - INFO - === LEYENDO DATOS PARA SECCIÓN: INTERIOR ===
2026-02-03 15:29:00 - INFO - Archivo ABC encontrado para 'interior': .\./data/input\CLASIFICACION_ABC+D_interior.xlsx
2026-02-03 15:29:00 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_interior.xlsx
2026-02-03 15:29:00 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 15:29:00 - INFO - Clasificación ABC cargada para 'interior': 555 registros
2026-02-03 15:29:00 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 15:29:04 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:29:04 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 15:29:04 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 15:29:04 - INFO - Ventas cargadas: 44082 registros
2026-02-03 15:29:04 - INFO - Filtrados 3624 registros de sección 'interior' de 44082 total
2026-02-03 15:29:04 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 15:29:06 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:29:06 - INFO - Costes cargados: 22145 registros
2026-02-03 15:29:06 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA INTERIOR ===
2026-02-03 15:29:06 - INFO -   ABC: 555 registros
2026-02-03 15:29:06 - INFO -   Ventas: 3624 registros
2026-02-03 15:29:06 - INFO -   Costes: 22145 registros
2026-02-03 15:29:06 - INFO - Datos de ventas: 286 registros
2026-02-03 15:29:06 - INFO - Calculando pedido para semana 14 (286 registros)
2026-02-03 15:29:06 - INFO -   Objetivo: 2930.63€, Actual (ABC): 2409.44€
2026-02-03 15:29:06 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 15:29:06 - INFO -   Factor total: 1.3125
2026-02-03 15:29:06 - INFO -   Factor escalado: 1.5964
2026-02-03 15:29:06 - INFO -   Ventas preliminares (con ceil): 4541.81€
2026-02-03 15:29:06 - INFO -   Objetivo final: 3846.45€
2026-02-03 15:29:06 - INFO -   Delta: 695.36€
2026-02-03 15:29:06 - INFO -   Ventas finales: 3855.17€
2026-02-03 15:29:06 - INFO - 
============================================================
2026-02-03 15:29:06 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 15:29:06 - INFO - ============================================================
2026-02-03 15:29:06 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 15:29:06 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 15:29:06 - INFO - DataLoader inicializado correctamente
2026-02-03 15:29:06 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 15:29:06 - INFO - ============================================================
2026-02-03 15:29:06 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 15:29:06 - INFO - ============================================================
2026-02-03 15:29:06 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 15:29:06 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 15:29:06 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:29:06 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:29:06 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 15:29:06 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:29:06 - INFO - Stock actual cargado: 30 registros
2026-02-03 15:29:06 - INFO -   Stock: 30 registros
2026-02-03 15:29:06 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 15:29:06 - INFO - Fusión completada: 138 registros
2026-02-03 15:29:06 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 15:29:06 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 15:29:06 - INFO - Corrección completada:
2026-02-03 15:29:06 - INFO -   - Artículos corregidos: 121/138
2026-02-03 15:29:06 - INFO -   - Artículos aumentados: 121
2026-02-03 15:29:06 - INFO -   - Artículos reducidos: 0
2026-02-03 15:29:06 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 15:29:06 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 15:29:06 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 15:29:06 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_interior.xlsx
2026-02-03 15:29:06 - ERROR - Error al generar archivo: [Errno 13] Permission denied: '.\\./data/output\\Pedido_Semana_14_2026-02-03_interior.xlsx'
2026-02-03 15:29:06 - WARNING - No se generó archivo para 'interior'
2026-02-03 15:29:06 - INFO - 
==================================================
2026-02-03 15:29:06 - INFO - SECCION: FITOS
2026-02-03 15:29:06 - INFO - ==================================================
2026-02-03 15:29:06 - INFO - === LEYENDO DATOS PARA SECCIÓN: FITOS ===
2026-02-03 15:29:06 - INFO - Archivo ABC encontrado para 'fitos': .\./data/input\CLASIFICACION_ABC+D_fitos.xlsx
2026-02-03 15:29:06 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_fitos.xlsx
2026-02-03 15:29:07 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 15:29:07 - INFO - Clasificación ABC cargada para 'fitos': 247 registros
2026-02-03 15:29:07 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 15:29:10 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:29:10 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 15:29:11 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 15:29:11 - INFO - Ventas cargadas: 44082 registros
2026-02-03 15:29:11 - INFO - Filtrados 1987 registros de sección 'fitos' de 44082 total
2026-02-03 15:29:11 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 15:29:13 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:29:13 - INFO - Costes cargados: 22145 registros
2026-02-03 15:29:13 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA FITOS ===
2026-02-03 15:29:13 - INFO -   ABC: 247 registros
2026-02-03 15:29:13 - INFO -   Ventas: 1987 registros
2026-02-03 15:29:13 - INFO -   Costes: 22145 registros
2026-02-03 15:29:13 - INFO - Datos de ventas: 157 registros
2026-02-03 15:29:13 - INFO - Calculando pedido para semana 14 (157 registros)
2026-02-03 15:29:13 - INFO -   Objetivo: 1798.25€, Actual (ABC): 1679.26€
2026-02-03 15:29:13 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 15:29:13 - INFO -   Factor total: 1.3125
2026-02-03 15:29:13 - INFO -   Factor escalado: 1.4055
2026-02-03 15:29:13 - INFO -   Ventas preliminares (con ceil): 2784.94€
2026-02-03 15:29:13 - INFO -   Objetivo final: 2360.20€
2026-02-03 15:29:13 - INFO -   Delta: 424.74€
2026-02-03 15:29:13 - INFO -   Ventas finales: 2365.92€
2026-02-03 15:29:13 - INFO - 
============================================================
2026-02-03 15:29:13 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 15:29:13 - INFO - ============================================================
2026-02-03 15:29:13 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 15:29:13 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 15:29:13 - INFO - DataLoader inicializado correctamente
2026-02-03 15:29:13 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 15:29:13 - INFO - ============================================================
2026-02-03 15:29:13 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 15:29:13 - INFO - ============================================================
2026-02-03 15:29:13 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 15:29:13 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 15:29:13 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:29:13 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:29:13 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 15:29:13 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:29:13 - INFO - Stock actual cargado: 30 registros
2026-02-03 15:29:13 - INFO -   Stock: 30 registros
2026-02-03 15:29:13 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 15:29:13 - INFO - Fusión completada: 84 registros
2026-02-03 15:29:13 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 15:29:13 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 15:29:13 - INFO - Corrección completada:
2026-02-03 15:29:13 - INFO -   - Artículos corregidos: 82/84
2026-02-03 15:29:13 - INFO -   - Artículos aumentados: 82
2026-02-03 15:29:13 - INFO -   - Artículos reducidos: 0
2026-02-03 15:29:13 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 15:29:13 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 15:29:13 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 15:29:13 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_fitos.xlsx
2026-02-03 15:29:13 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_fitos.xlsx
2026-02-03 15:29:13 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_fitos.xlsx
2026-02-03 15:29:13 - INFO -   Articulos: 82
2026-02-03 15:29:13 - INFO -   Importe: 2365.92€
2026-02-03 15:29:13 - INFO - 
==================================================
2026-02-03 15:29:13 - INFO - SECCION: VIVERO
2026-02-03 15:29:13 - INFO - ==================================================
2026-02-03 15:29:13 - INFO - === LEYENDO DATOS PARA SECCIÓN: VIVERO ===
2026-02-03 15:29:13 - INFO - Archivo ABC encontrado para 'vivero': .\./data/input\CLASIFICACION_ABC+D_vivero.xlsx
2026-02-03 15:29:13 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_vivero.xlsx
2026-02-03 15:29:13 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 15:29:13 - INFO - Clasificación ABC cargada para 'vivero': 565 registros
2026-02-03 15:29:13 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 15:29:17 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:29:17 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 15:29:17 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 15:29:17 - INFO - Ventas cargadas: 44082 registros
2026-02-03 15:29:17 - INFO - Filtrados 2460 registros de sección 'vivero' de 44082 total
2026-02-03 15:29:17 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 15:29:19 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:29:19 - INFO - Costes cargados: 22145 registros
2026-02-03 15:29:19 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA VIVERO ===
2026-02-03 15:29:19 - INFO -   ABC: 565 registros
2026-02-03 15:29:19 - INFO -   Ventas: 2460 registros
2026-02-03 15:29:19 - INFO -   Costes: 22145 registros
2026-02-03 15:29:19 - INFO - Datos de ventas: 189 registros
2026-02-03 15:29:19 - INFO - Calculando pedido para semana 14 (189 registros)
2026-02-03 15:29:20 - INFO -   Objetivo: 5297.17€, Actual (ABC): 4113.14€
2026-02-03 15:29:20 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 15:29:20 - INFO -   Factor total: 1.3125
2026-02-03 15:29:20 - INFO -   Factor escalado: 1.6903
2026-02-03 15:29:20 - INFO -   Ventas preliminares (con ceil): 8761.94€
2026-02-03 15:29:20 - INFO -   Objetivo final: 6952.54€
2026-02-03 15:29:20 - INFO -   Delta: 1809.40€
2026-02-03 15:29:20 - INFO -   Ventas finales: 6990.51€
2026-02-03 15:29:20 - INFO - 
============================================================
2026-02-03 15:29:20 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 15:29:20 - INFO - ============================================================
2026-02-03 15:29:20 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 15:29:20 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 15:29:20 - INFO - DataLoader inicializado correctamente
2026-02-03 15:29:20 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 15:29:20 - INFO - ============================================================
2026-02-03 15:29:20 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 15:29:20 - INFO - ============================================================
2026-02-03 15:29:20 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 15:29:20 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 15:29:20 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:29:20 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:29:20 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 15:29:20 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:29:20 - INFO - Stock actual cargado: 30 registros
2026-02-03 15:29:20 - INFO -   Stock: 30 registros
2026-02-03 15:29:20 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 15:29:20 - INFO - Fusión completada: 107 registros
2026-02-03 15:29:20 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 15:29:20 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 15:29:20 - INFO - Corrección completada:
2026-02-03 15:29:20 - INFO -   - Artículos corregidos: 96/107
2026-02-03 15:29:20 - INFO -   - Artículos aumentados: 96
2026-02-03 15:29:20 - INFO -   - Artículos reducidos: 0
2026-02-03 15:29:20 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 15:29:20 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 15:29:20 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 15:29:20 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_vivero.xlsx
2026-02-03 15:29:20 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_vivero.xlsx
2026-02-03 15:29:20 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_vivero.xlsx
2026-02-03 15:29:20 - INFO -   Articulos: 96
2026-02-03 15:29:20 - INFO -   Importe: 6990.51€
2026-02-03 15:29:20 - INFO - 
==================================================
2026-02-03 15:29:20 - INFO - SECCION: UTILES_JARDIN
2026-02-03 15:29:20 - INFO - ==================================================
2026-02-03 15:29:20 - INFO - === LEYENDO DATOS PARA SECCIÓN: UTILES_JARDIN ===
2026-02-03 15:29:20 - INFO - Archivo ABC encontrado para 'utiles_jardin': .\./data/input\CLASIFICACION_ABC+D_utiles_jardin.xlsx
2026-02-03 15:29:20 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_utiles_jardin.xlsx
2026-02-03 15:29:20 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 15:29:20 - INFO - Clasificación ABC cargada para 'utiles_jardin': 433 registros
2026-02-03 15:29:20 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 15:29:24 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:29:24 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 15:29:24 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 15:29:24 - INFO - Ventas cargadas: 44082 registros
2026-02-03 15:29:24 - INFO - Filtrados 1009 registros de sección 'utiles_jardin' de 44082 total
2026-02-03 15:29:24 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 15:29:26 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:29:26 - INFO - Costes cargados: 22145 registros
2026-02-03 15:29:26 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA UTILES_JARDIN ===
2026-02-03 15:29:26 - INFO -   ABC: 433 registros
2026-02-03 15:29:26 - INFO -   Ventas: 1009 registros
2026-02-03 15:29:26 - INFO -   Costes: 22145 registros
2026-02-03 15:29:26 - INFO - Datos de ventas: 89 registros
2026-02-03 15:29:26 - INFO - Calculando pedido para semana 14 (89 registros)
2026-02-03 15:29:26 - INFO -   Objetivo: 1044.77€, Actual (ABC): 818.79€
2026-02-03 15:29:26 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 15:29:26 - INFO -   Factor total: 1.3125
2026-02-03 15:29:26 - INFO -   Factor escalado: 1.6747
2026-02-03 15:29:26 - INFO -   Ventas preliminares (con ceil): 1929.56€
2026-02-03 15:29:26 - INFO -   Objetivo final: 1371.26€
2026-02-03 15:29:26 - INFO -   Delta: 558.30€
2026-02-03 15:29:26 - INFO -   Ventas finales: 1390.00€
2026-02-03 15:29:26 - INFO - 
============================================================
2026-02-03 15:29:26 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 15:29:26 - INFO - ============================================================
2026-02-03 15:29:26 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 15:29:26 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 15:29:26 - INFO - DataLoader inicializado correctamente
2026-02-03 15:29:26 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 15:29:26 - INFO - ============================================================
2026-02-03 15:29:26 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 15:29:26 - INFO - ============================================================
2026-02-03 15:29:26 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 15:29:26 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 15:29:26 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:29:26 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:29:26 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 15:29:26 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:29:26 - INFO - Stock actual cargado: 30 registros
2026-02-03 15:29:26 - INFO -   Stock: 30 registros
2026-02-03 15:29:26 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 15:29:26 - INFO - Fusión completada: 78 registros
2026-02-03 15:29:26 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 15:29:26 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 15:29:26 - INFO - Corrección completada:
2026-02-03 15:29:26 - INFO -   - Artículos corregidos: 78/78
2026-02-03 15:29:26 - INFO -   - Artículos aumentados: 78
2026-02-03 15:29:26 - INFO -   - Artículos reducidos: 0
2026-02-03 15:29:26 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 15:29:26 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 15:29:26 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 15:29:26 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx
2026-02-03 15:29:26 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx
2026-02-03 15:29:26 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx
2026-02-03 15:29:26 - INFO -   Articulos: 78
2026-02-03 15:29:26 - INFO -   Importe: 1390.00€
2026-02-03 15:29:26 - INFO - 
==================================================
2026-02-03 15:29:26 - INFO - SECCION: TIERRAS_ARIDOS
2026-02-03 15:29:26 - INFO - ==================================================
2026-02-03 15:29:26 - INFO - === LEYENDO DATOS PARA SECCIÓN: TIERRAS_ARIDOS ===
2026-02-03 15:29:26 - WARNING - No se encontró archivo específico para 'tierras_aridos', usando: .\./data/input\CLASIFICACION_ABC+D_DECO_EXTERIOR.xlsx
2026-02-03 15:29:26 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_DECO_EXTERIOR.xlsx
2026-02-03 15:29:27 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 15:29:27 - INFO - Clasificación ABC cargada para 'tierras_aridos': 995 registros
2026-02-03 15:29:27 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 15:29:30 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:29:30 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 15:29:31 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 15:29:31 - INFO - Ventas cargadas: 44082 registros
2026-02-03 15:29:31 - INFO - Filtrados 3264 registros de sección 'tierras_aridos' de 44082 total
2026-02-03 15:29:31 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 15:29:33 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:29:33 - INFO - Costes cargados: 22145 registros
2026-02-03 15:29:33 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA TIERRAS_ARIDOS ===
2026-02-03 15:29:33 - INFO -   ABC: 995 registros
2026-02-03 15:29:33 - INFO -   Ventas: 3264 registros
2026-02-03 15:29:33 - INFO -   Costes: 22145 registros
2026-02-03 15:29:33 - INFO - Datos de ventas: 302 registros
2026-02-03 15:29:33 - INFO - Calculando pedido para semana 14 (302 registros)
2026-02-03 15:29:33 - INFO -   Objetivo: 4097.24€, Actual (ABC): 4019.19€
2026-02-03 15:29:33 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 15:29:33 - INFO -   Factor total: 1.3125
2026-02-03 15:29:33 - INFO -   Factor escalado: 1.3380
2026-02-03 15:29:33 - INFO -   Ventas preliminares (con ceil): 5809.66€
2026-02-03 15:29:33 - INFO -   Objetivo final: 5377.63€
2026-02-03 15:29:33 - INFO -   Delta: 432.03€
2026-02-03 15:29:33 - INFO -   Ventas finales: 5387.14€
2026-02-03 15:29:33 - INFO - 
============================================================
2026-02-03 15:29:33 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 15:29:33 - INFO - ============================================================
2026-02-03 15:29:33 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 15:29:33 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 15:29:33 - INFO - DataLoader inicializado correctamente
2026-02-03 15:29:33 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 15:29:33 - INFO - ============================================================
2026-02-03 15:29:33 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 15:29:33 - INFO - ============================================================
2026-02-03 15:29:33 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 15:29:33 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 15:29:33 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:29:33 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:29:33 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 15:29:33 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:29:33 - INFO - Stock actual cargado: 30 registros
2026-02-03 15:29:33 - INFO -   Stock: 30 registros
2026-02-03 15:29:33 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 15:29:33 - INFO - Fusión completada: 72 registros
2026-02-03 15:29:33 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 15:29:33 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 15:29:33 - INFO - Corrección completada:
2026-02-03 15:29:33 - INFO -   - Artículos corregidos: 71/72
2026-02-03 15:29:33 - INFO -   - Artículos aumentados: 71
2026-02-03 15:29:33 - INFO -   - Artículos reducidos: 0
2026-02-03 15:29:33 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 15:29:33 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 15:29:33 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 15:29:33 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx
2026-02-03 15:29:33 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx
2026-02-03 15:29:33 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx
2026-02-03 15:29:33 - INFO -   Articulos: 71
2026-02-03 15:29:33 - INFO -   Importe: 5387.14€
2026-02-03 15:29:33 - INFO - 
==================================================
2026-02-03 15:29:33 - INFO - SECCION: DECO_EXTERIOR
2026-02-03 15:29:33 - INFO - ==================================================
2026-02-03 15:29:33 - INFO - === LEYENDO DATOS PARA SECCIÓN: DECO_EXTERIOR ===
2026-02-03 15:29:33 - INFO - Archivo ABC encontrado para 'deco_exterior': .\./data/input\CLASIFICACION_ABC+D_deco_exterior.xlsx
2026-02-03 15:29:33 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_deco_exterior.xlsx
2026-02-03 15:29:33 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 15:29:33 - INFO - Clasificación ABC cargada para 'deco_exterior': 995 registros
2026-02-03 15:29:33 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 15:29:37 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:29:37 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 15:29:37 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 15:29:37 - INFO - Ventas cargadas: 44082 registros
2026-02-03 15:29:37 - INFO - Filtrados 4018 registros de sección 'deco_exterior' de 44082 total
2026-02-03 15:29:37 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 15:29:39 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:29:39 - INFO - Costes cargados: 22145 registros
2026-02-03 15:29:39 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA DECO_EXTERIOR ===
2026-02-03 15:29:39 - INFO -   ABC: 995 registros
2026-02-03 15:29:39 - INFO -   Ventas: 4018 registros
2026-02-03 15:29:39 - INFO -   Costes: 22145 registros
2026-02-03 15:29:39 - INFO - Datos de ventas: 316 registros
2026-02-03 15:29:39 - INFO - Calculando pedido para semana 14 (316 registros)
2026-02-03 15:29:40 - INFO -   Objetivo: 3740.34€, Actual (ABC): 4104.66€
2026-02-03 15:29:40 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 15:29:40 - INFO -   Factor total: 1.3125
2026-02-03 15:29:40 - INFO -   Factor escalado: 1.1960
2026-02-03 15:29:40 - INFO -   Ventas preliminares (con ceil): 6094.59€
2026-02-03 15:29:40 - INFO -   Objetivo final: 4909.20€
2026-02-03 15:29:40 - INFO -   Delta: 1185.39€
2026-02-03 15:29:40 - INFO -   Ventas finales: 4923.89€
2026-02-03 15:29:40 - INFO - 
============================================================
2026-02-03 15:29:40 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 15:29:40 - INFO - ============================================================
2026-02-03 15:29:40 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 15:29:40 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 15:29:40 - INFO - DataLoader inicializado correctamente
2026-02-03 15:29:40 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 15:29:40 - INFO - ============================================================
2026-02-03 15:29:40 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 15:29:40 - INFO - ============================================================
2026-02-03 15:29:40 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 15:29:40 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 15:29:40 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:29:40 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:29:40 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 15:29:40 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:29:40 - INFO - Stock actual cargado: 30 registros
2026-02-03 15:29:40 - INFO -   Stock: 30 registros
2026-02-03 15:29:40 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 15:29:40 - INFO - Fusión completada: 224 registros
2026-02-03 15:29:40 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 15:29:40 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 15:29:40 - INFO - Corrección completada:
2026-02-03 15:29:40 - INFO -   - Artículos corregidos: 205/224
2026-02-03 15:29:40 - INFO -   - Artículos aumentados: 205
2026-02-03 15:29:40 - INFO -   - Artículos reducidos: 0
2026-02-03 15:29:40 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 15:29:40 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 15:29:40 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 15:29:40 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_deco_exterior.xlsx
2026-02-03 15:29:40 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_deco_exterior.xlsx
2026-02-03 15:29:40 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_deco_exterior.xlsx
2026-02-03 15:29:40 - INFO -   Articulos: 205
2026-02-03 15:29:40 - INFO -   Importe: 4923.89€
2026-02-03 15:29:40 - INFO - Estado guardado correctamente
2026-02-03 15:29:40 - INFO - Generando resumen: .\./data/output\Resumen_Pedidos_VIVERO_2026-02-03.xlsx
2026-02-03 15:29:40 - INFO - Resumen guardado: .\./data/output\Resumen_Pedidos_VIVERO_2026-02-03.xlsx
2026-02-03 15:29:40 - INFO - Estado guardado correctamente
2026-02-03 15:29:40 - INFO - 
============================================================
2026-02-03 15:29:40 - INFO - PREPARANDO ENVÍO DE EMAILS
2026-02-03 15:29:40 - INFO - ============================================================
2026-02-03 15:29:40 - INFO - 
============================================================
2026-02-03 15:29:40 - INFO - ENVÍO DE EMAILS A RESPONSABLES
2026-02-03 15:29:40 - INFO - ============================================================
2026-02-03 15:29:40 - INFO - EmailService inicializado correctamente
2026-02-03 15:29:40 - ERROR - La variable de entorno 'EMAIL_PASSWORD' no está configurada. Por favor, configúrala antes de enviar emails.
2026-02-03 15:29:40 - WARNING - Problemas de configuración detectados:
2026-02-03 15:29:40 - WARNING -   - La variable de entorno 'EMAIL_PASSWORD' no está configurada
2026-02-03 15:29:40 - INFO - 
Enviando email para sección: maf
2026-02-03 15:29:40 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_maf.xlsx']
2026-02-03 15:29:40 - INFO - ============================================================
2026-02-03 15:29:40 - INFO - ENVIANDO EMAIL PARA SECCIÓN: MAF
2026-02-03 15:29:40 - INFO - ============================================================
2026-02-03 15:29:40 - ERROR - Error al enviar emails: name 'destinatorios_config' is not defined
2026-02-03 15:29:40 - ERROR - Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 445, in enviar_emails_pedidos
    resultado = email_service.enviar_pedido_por_seccion(
        semana=semana,
        seccion=seccion,
        archivos=archivos
    )
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\email_service.py", line 331, in enviar_pedido_por_seccion
    destinatarios_info = self.obtener_destinatarios_seccion(seccion)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\email_service.py", line 297, in obtener_destinatarios_seccion
    for dest in destinatorios_config:
                ^^^^^^^^^^^^^^^^^^^^
NameError: name 'destinatorios_config' is not defined. Did you mean: 'destinatarios_config'?

2026-02-03 15:29:40 - INFO - 
======================================================================
2026-02-03 15:29:40 - INFO - RESUMEN DE EJECUCION
2026-02-03 15:29:40 - INFO - ======================================================================
2026-02-03 15:29:40 - INFO - Semana procesada: 14
2026-02-03 15:29:40 - INFO - Archivos generados: 11
2026-02-03 15:29:40 - INFO - Total articulos: 1389
2026-02-03 15:29:40 - INFO - Total importe: 44258.70€
2026-02-03 15:29:40 - INFO - ======================================================================
2026-02-03 15:29:40 - INFO - 
¡PEDIDO GENERADO EXITOSAMENTE!
2026-02-03 15:29:40 - INFO - Archivo principal: .\./data/output\Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 15:29:40 - INFO - Artículos: 1389
2026-02-03 15:29:40 - INFO - Importe: 44258.70€
2026-02-03 15:33:12 - INFO - ======================================================================
2026-02-03 15:33:12 - INFO - SISTEMA DE PEDIDOS DE COMPRA - VIVERO ARANJUEZ V2
2026-02-03 15:33:12 - INFO - Fecha de ejecución: 2026-02-03 15:33:12
2026-02-03 15:33:12 - INFO - ======================================================================
2026-02-03 15:33:12 - INFO - Modo de ejecución: FASE 1 + FASE 2
2026-02-03 15:33:12 - INFO - Envío de emails: Sí
2026-02-03 15:33:12 - INFO - StateManager inicializado. Archivo de estado: .\./data\state.json
2026-02-03 15:33:12 - INFO - Cargando estado desde: .\./data\state.json
2026-02-03 15:33:12 - INFO - Estado cargado correctamente
2026-02-03 15:33:12 - INFO - SchedulerService inicializado correctamente
2026-02-03 15:33:12 - INFO - Horario configurado: sunday a las 15:00
2026-02-03 15:33:12 - INFO - Semana forzada por argumento: 14
2026-02-03 15:33:12 - INFO - ======================================================================
2026-02-03 15:33:12 - INFO - PROCESANDO PEDIDO PARA SEMANA 14
2026-02-03 15:33:12 - INFO - ======================================================================
2026-02-03 15:33:12 - INFO - MODO: FASE 1 (Forecast) + FASE 2 (Corrección)
2026-02-03 15:33:12 - INFO - DataLoader inicializado correctamente
2026-02-03 15:33:12 - INFO - ForecastEngine inicializado correctamente
2026-02-03 15:33:12 - INFO - OrderGenerator inicializado correctamente
2026-02-03 15:33:12 - INFO - SchedulerService inicializado correctamente
2026-02-03 15:33:12 - INFO - Horario configurado: sunday a las 15:00
2026-02-03 15:33:12 - INFO - Período de la semana: 2026-03-30 al 2026-04-05
2026-02-03 15:33:12 - INFO - Stock acumulado cargado: 2633 artículos
2026-02-03 15:33:12 - INFO - 
==================================================
2026-02-03 15:33:12 - INFO - SECCION: MAF
2026-02-03 15:33:12 - INFO - ==================================================
2026-02-03 15:33:12 - INFO - === LEYENDO DATOS PARA SECCIÓN: MAF ===
2026-02-03 15:33:12 - INFO - Archivo ABC encontrado para 'maf': .\./data/input\CLASIFICACION_ABC+D_maf.xlsx
2026-02-03 15:33:12 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_maf.xlsx
2026-02-03 15:33:12 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 15:33:12 - INFO - Clasificación ABC cargada para 'maf': 499 registros
2026-02-03 15:33:12 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 15:33:16 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:33:16 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 15:33:16 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 15:33:16 - INFO - Ventas cargadas: 44082 registros
2026-02-03 15:33:16 - INFO - Filtrados 10970 registros de sección 'maf' de 44082 total
2026-02-03 15:33:16 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 15:33:18 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:33:18 - INFO - Costes cargados: 22145 registros
2026-02-03 15:33:18 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MAF ===
2026-02-03 15:33:18 - INFO -   ABC: 499 registros
2026-02-03 15:33:18 - INFO -   Ventas: 10970 registros
2026-02-03 15:33:18 - INFO -   Costes: 22145 registros
2026-02-03 15:33:18 - INFO - Datos de ventas: 1011 registros
2026-02-03 15:33:18 - INFO - Calculando pedido para semana 14 (1011 registros)
2026-02-03 15:33:18 - INFO -   Objetivo: 7050.65€, Actual (ABC): 5843.77€
2026-02-03 15:33:18 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 15:33:18 - INFO -   Factor total: 1.3125
2026-02-03 15:33:18 - INFO -   Factor escalado: 1.5836
2026-02-03 15:33:18 - INFO -   Ventas preliminares (con ceil): 9931.01€
2026-02-03 15:33:18 - INFO -   Objetivo final: 9253.98€
2026-02-03 15:33:18 - INFO -   Delta: 677.03€
2026-02-03 15:33:18 - INFO -   Ventas finales: 9259.59€
2026-02-03 15:33:18 - INFO - 
============================================================
2026-02-03 15:33:18 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 15:33:18 - INFO - ============================================================
2026-02-03 15:33:18 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 15:33:18 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 15:33:18 - INFO - DataLoader inicializado correctamente
2026-02-03 15:33:18 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 15:33:18 - INFO - ============================================================
2026-02-03 15:33:18 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 15:33:18 - INFO - ============================================================
2026-02-03 15:33:18 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 15:33:18 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 15:33:18 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:33:18 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:33:18 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 15:33:18 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:33:18 - INFO - Stock actual cargado: 30 registros
2026-02-03 15:33:18 - INFO -   Stock: 30 registros
2026-02-03 15:33:18 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 15:33:18 - INFO - Fusión completada: 222 registros
2026-02-03 15:33:18 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 15:33:18 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 15:33:18 - INFO - Corrección completada:
2026-02-03 15:33:18 - INFO -   - Artículos corregidos: 191/222
2026-02-03 15:33:18 - INFO -   - Artículos aumentados: 191
2026-02-03 15:33:18 - INFO -   - Artículos reducidos: 0
2026-02-03 15:33:18 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 15:33:18 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 15:33:18 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 15:33:18 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 15:33:19 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 15:33:19 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 15:33:19 - INFO -   Articulos: 191
2026-02-03 15:33:19 - INFO -   Importe: 9259.59€
2026-02-03 15:33:19 - INFO - 
==================================================
2026-02-03 15:33:19 - INFO - SECCION: DECO_INTERIOR
2026-02-03 15:33:19 - INFO - ==================================================
2026-02-03 15:33:19 - INFO - === LEYENDO DATOS PARA SECCIÓN: DECO_INTERIOR ===
2026-02-03 15:33:19 - INFO - Archivo ABC encontrado para 'deco_interior': .\./data/input\CLASIFICACION_ABC+D_deco_interior.xlsx
2026-02-03 15:33:19 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_deco_interior.xlsx
2026-02-03 15:33:19 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 15:33:19 - INFO - Clasificación ABC cargada para 'deco_interior': 1827 registros
2026-02-03 15:33:19 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 15:33:23 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:33:23 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 15:33:23 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 15:33:23 - INFO - Ventas cargadas: 44082 registros
2026-02-03 15:33:23 - INFO - Filtrados 2468 registros de sección 'deco_interior' de 44082 total
2026-02-03 15:33:23 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 15:33:25 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:33:25 - INFO - Costes cargados: 22145 registros
2026-02-03 15:33:25 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA DECO_INTERIOR ===
2026-02-03 15:33:25 - INFO -   ABC: 1827 registros
2026-02-03 15:33:25 - INFO -   Ventas: 2468 registros
2026-02-03 15:33:25 - INFO -   Costes: 22145 registros
2026-02-03 15:33:25 - INFO - Datos de ventas: 180 registros
2026-02-03 15:33:25 - INFO - Calculando pedido para semana 14 (180 registros)
2026-02-03 15:33:25 - INFO -   Objetivo: 1962.99€, Actual (ABC): 1636.15€
2026-02-03 15:33:25 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 15:33:25 - INFO -   Factor total: 1.3125
2026-02-03 15:33:25 - INFO -   Factor escalado: 1.5747
2026-02-03 15:33:25 - INFO -   Ventas preliminares (con ceil): 2950.01€
2026-02-03 15:33:25 - INFO -   Objetivo final: 2576.42€
2026-02-03 15:33:25 - INFO -   Delta: 373.59€
2026-02-03 15:33:25 - INFO -   Ventas finales: 2580.73€
2026-02-03 15:33:25 - INFO - 
============================================================
2026-02-03 15:33:25 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 15:33:25 - INFO - ============================================================
2026-02-03 15:33:25 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 15:33:25 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 15:33:25 - INFO - DataLoader inicializado correctamente
2026-02-03 15:33:25 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 15:33:25 - INFO - ============================================================
2026-02-03 15:33:25 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 15:33:25 - INFO - ============================================================
2026-02-03 15:33:25 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 15:33:25 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 15:33:25 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:33:25 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:33:25 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 15:33:25 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:33:25 - INFO - Stock actual cargado: 30 registros
2026-02-03 15:33:25 - INFO -   Stock: 30 registros
2026-02-03 15:33:25 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 15:33:25 - INFO - Fusión completada: 139 registros
2026-02-03 15:33:25 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 15:33:25 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 15:33:25 - INFO - Corrección completada:
2026-02-03 15:33:25 - INFO -   - Artículos corregidos: 135/139
2026-02-03 15:33:25 - INFO -   - Artículos aumentados: 135
2026-02-03 15:33:25 - INFO -   - Artículos reducidos: 0
2026-02-03 15:33:25 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 15:33:25 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 15:33:25 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 15:33:25 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_deco_interior.xlsx
2026-02-03 15:33:26 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_deco_interior.xlsx
2026-02-03 15:33:26 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_deco_interior.xlsx
2026-02-03 15:33:26 - INFO -   Articulos: 135
2026-02-03 15:33:26 - INFO -   Importe: 2580.73€
2026-02-03 15:33:26 - INFO - 
==================================================
2026-02-03 15:33:26 - INFO - SECCION: SEMILLAS
2026-02-03 15:33:26 - INFO - ==================================================
2026-02-03 15:33:26 - INFO - === LEYENDO DATOS PARA SECCIÓN: SEMILLAS ===
2026-02-03 15:33:26 - INFO - Archivo ABC encontrado para 'semillas': .\./data/input\CLASIFICACION_ABC+D_semillas.xlsx
2026-02-03 15:33:26 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_semillas.xlsx
2026-02-03 15:33:26 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 15:33:26 - INFO - Clasificación ABC cargada para 'semillas': 218 registros
2026-02-03 15:33:26 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 15:33:29 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:33:29 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 15:33:30 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 15:33:30 - INFO - Ventas cargadas: 44082 registros
2026-02-03 15:33:30 - INFO - Filtrados 1180 registros de sección 'semillas' de 44082 total
2026-02-03 15:33:30 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 15:33:32 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:33:32 - INFO - Costes cargados: 22145 registros
2026-02-03 15:33:32 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA SEMILLAS ===
2026-02-03 15:33:32 - INFO -   ABC: 218 registros
2026-02-03 15:33:32 - INFO -   Ventas: 1180 registros
2026-02-03 15:33:32 - INFO -   Costes: 22145 registros
2026-02-03 15:33:32 - INFO - Datos de ventas: 136 registros
2026-02-03 15:33:32 - INFO - Calculando pedido para semana 14 (136 registros)
2026-02-03 15:33:32 - INFO -   Objetivo: 694.34€, Actual (ABC): 455.14€
2026-02-03 15:33:32 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 15:33:32 - INFO -   Factor total: 1.3125
2026-02-03 15:33:32 - INFO -   Factor escalado: 2.0023
2026-02-03 15:33:32 - INFO -   Ventas preliminares (con ceil): 1129.15€
2026-02-03 15:33:32 - INFO -   Objetivo final: 911.32€
2026-02-03 15:33:32 - INFO -   Delta: 217.83€
2026-02-03 15:33:32 - INFO -   Ventas finales: 911.60€
2026-02-03 15:33:32 - INFO - 
============================================================
2026-02-03 15:33:32 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 15:33:32 - INFO - ============================================================
2026-02-03 15:33:32 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 15:33:32 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 15:33:32 - INFO - DataLoader inicializado correctamente
2026-02-03 15:33:32 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 15:33:32 - INFO - ============================================================
2026-02-03 15:33:32 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 15:33:32 - INFO - ============================================================
2026-02-03 15:33:32 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 15:33:32 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 15:33:32 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:33:32 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:33:32 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 15:33:32 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:33:32 - INFO - Stock actual cargado: 30 registros
2026-02-03 15:33:32 - INFO -   Stock: 30 registros
2026-02-03 15:33:32 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 15:33:32 - INFO - Fusión completada: 84 registros
2026-02-03 15:33:32 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 15:33:32 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 15:33:32 - INFO - Corrección completada:
2026-02-03 15:33:32 - INFO -   - Artículos corregidos: 84/84
2026-02-03 15:33:32 - INFO -   - Artículos aumentados: 84
2026-02-03 15:33:32 - INFO -   - Artículos reducidos: 0
2026-02-03 15:33:32 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 15:33:32 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 15:33:32 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 15:33:32 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_semillas.xlsx
2026-02-03 15:33:32 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_semillas.xlsx
2026-02-03 15:33:32 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_semillas.xlsx
2026-02-03 15:33:32 - INFO -   Articulos: 84
2026-02-03 15:33:32 - INFO -   Importe: 911.60€
2026-02-03 15:33:32 - INFO - 
==================================================
2026-02-03 15:33:32 - INFO - SECCION: MASCOTAS_VIVO
2026-02-03 15:33:32 - INFO - ==================================================
2026-02-03 15:33:32 - INFO - === LEYENDO DATOS PARA SECCIÓN: MASCOTAS_VIVO ===
2026-02-03 15:33:32 - INFO - Archivo ABC encontrado para 'mascotas_vivo': .\./data/input\CLASIFICACION_ABC+D_mascotas_vivo.xlsx
2026-02-03 15:33:32 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_mascotas_vivo.xlsx
2026-02-03 15:33:32 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 15:33:32 - INFO - Clasificación ABC cargada para 'mascotas_vivo': 205 registros
2026-02-03 15:33:32 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 15:33:36 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:33:36 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 15:33:36 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 15:33:36 - INFO - Ventas cargadas: 44082 registros
2026-02-03 15:33:36 - INFO - Filtrados 1124 registros de sección 'mascotas_vivo' de 44082 total
2026-02-03 15:33:36 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 15:33:38 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:33:38 - INFO - Costes cargados: 22145 registros
2026-02-03 15:33:38 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MASCOTAS_VIVO ===
2026-02-03 15:33:38 - INFO -   ABC: 205 registros
2026-02-03 15:33:38 - INFO -   Ventas: 1124 registros
2026-02-03 15:33:38 - INFO -   Costes: 22145 registros
2026-02-03 15:33:38 - INFO - Datos de ventas: 88 registros
2026-02-03 15:33:38 - INFO - Calculando pedido para semana 14 (88 registros)
2026-02-03 15:33:38 - INFO -   Objetivo: 1087.15€, Actual (ABC): 846.63€
2026-02-03 15:33:38 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 15:33:38 - INFO -   Factor total: 1.3125
2026-02-03 15:33:38 - INFO -   Factor escalado: 1.6854
2026-02-03 15:33:38 - INFO -   Ventas preliminares (con ceil): 1773.66€
2026-02-03 15:33:38 - INFO -   Objetivo final: 1426.88€
2026-02-03 15:33:38 - INFO -   Delta: 346.78€
2026-02-03 15:33:38 - INFO -   Ventas finales: 1455.34€
2026-02-03 15:33:38 - INFO - 
============================================================
2026-02-03 15:33:38 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 15:33:38 - INFO - ============================================================
2026-02-03 15:33:38 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 15:33:38 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 15:33:38 - INFO - DataLoader inicializado correctamente
2026-02-03 15:33:38 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 15:33:38 - INFO - ============================================================
2026-02-03 15:33:38 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 15:33:38 - INFO - ============================================================
2026-02-03 15:33:38 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 15:33:38 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 15:33:38 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:33:38 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:33:38 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 15:33:38 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:33:38 - INFO - Stock actual cargado: 30 registros
2026-02-03 15:33:38 - INFO -   Stock: 30 registros
2026-02-03 15:33:38 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 15:33:38 - INFO - Fusión completada: 43 registros
2026-02-03 15:33:38 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 15:33:38 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 15:33:38 - INFO - Corrección completada:
2026-02-03 15:33:38 - INFO -   - Artículos corregidos: 36/43
2026-02-03 15:33:38 - INFO -   - Artículos aumentados: 36
2026-02-03 15:33:38 - INFO -   - Artículos reducidos: 0
2026-02-03 15:33:38 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 15:33:38 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 15:33:38 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 15:33:38 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx
2026-02-03 15:33:38 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx
2026-02-03 15:33:38 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx
2026-02-03 15:33:38 - INFO -   Articulos: 36
2026-02-03 15:33:38 - INFO -   Importe: 1455.34€
2026-02-03 15:33:38 - INFO - 
==================================================
2026-02-03 15:33:38 - INFO - SECCION: MASCOTAS_MANUFACTURADO
2026-02-03 15:33:38 - INFO - ==================================================
2026-02-03 15:33:38 - INFO - === LEYENDO DATOS PARA SECCIÓN: MASCOTAS_MANUFACTURADO ===
2026-02-03 15:33:38 - INFO - Archivo ABC encontrado para 'mascotas_manufacturado': .\./data/input\CLASIFICACION_ABC+D_mascotas_manufacturado.xlsx
2026-02-03 15:33:38 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_mascotas_manufacturado.xlsx
2026-02-03 15:33:39 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 15:33:39 - INFO - Clasificación ABC cargada para 'mascotas_manufacturado': 2749 registros
2026-02-03 15:33:39 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 15:33:43 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:33:43 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 15:33:43 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 15:33:43 - INFO - Ventas cargadas: 44082 registros
2026-02-03 15:33:43 - INFO - Filtrados 9784 registros de sección 'mascotas_manufacturado' de 44082 total
2026-02-03 15:33:43 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 15:33:45 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:33:45 - INFO - Costes cargados: 22145 registros
2026-02-03 15:33:45 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MASCOTAS_MANUFACTURADO ===
2026-02-03 15:33:45 - INFO -   ABC: 2749 registros
2026-02-03 15:33:45 - INFO -   Ventas: 9784 registros
2026-02-03 15:33:45 - INFO -   Costes: 22145 registros
2026-02-03 15:33:45 - INFO - Datos de ventas: 822 registros
2026-02-03 15:33:45 - INFO - Calculando pedido para semana 14 (822 registros)
2026-02-03 15:33:47 - INFO -   Objetivo: 6839.82€, Actual (ABC): 8742.92€
2026-02-03 15:33:47 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 15:33:47 - INFO -   Factor total: 1.3125
2026-02-03 15:33:47 - INFO -   Factor escalado: 1.0268
2026-02-03 15:33:47 - INFO -   Ventas preliminares (con ceil): 12379.25€
2026-02-03 15:33:47 - INFO -   Objetivo final: 8977.26€
2026-02-03 15:33:47 - INFO -   Delta: 3401.99€
2026-02-03 15:33:47 - INFO -   Ventas finales: 8993.98€
2026-02-03 15:33:47 - INFO - 
============================================================
2026-02-03 15:33:47 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 15:33:47 - INFO - ============================================================
2026-02-03 15:33:47 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 15:33:47 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 15:33:47 - INFO - DataLoader inicializado correctamente
2026-02-03 15:33:47 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 15:33:47 - INFO - ============================================================
2026-02-03 15:33:47 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 15:33:47 - INFO - ============================================================
2026-02-03 15:33:47 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 15:33:47 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 15:33:47 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:33:47 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:33:47 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 15:33:47 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:33:47 - INFO - Stock actual cargado: 30 registros
2026-02-03 15:33:47 - INFO -   Stock: 30 registros
2026-02-03 15:33:47 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 15:33:47 - INFO - Fusión completada: 538 registros
2026-02-03 15:33:47 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 15:33:47 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 15:33:47 - INFO - Corrección completada:
2026-02-03 15:33:47 - INFO -   - Artículos corregidos: 411/538
2026-02-03 15:33:47 - INFO -   - Artículos aumentados: 411
2026-02-03 15:33:47 - INFO -   - Artículos reducidos: 0
2026-02-03 15:33:47 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 15:33:47 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 15:33:47 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 15:33:47 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx
2026-02-03 15:33:47 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx
2026-02-03 15:33:47 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx
2026-02-03 15:33:47 - INFO -   Articulos: 411
2026-02-03 15:33:47 - INFO -   Importe: 8993.98€
2026-02-03 15:33:47 - INFO - 
==================================================
2026-02-03 15:33:47 - INFO - SECCION: INTERIOR
2026-02-03 15:33:47 - INFO - ==================================================
2026-02-03 15:33:47 - INFO - === LEYENDO DATOS PARA SECCIÓN: INTERIOR ===
2026-02-03 15:33:47 - INFO - Archivo ABC encontrado para 'interior': .\./data/input\CLASIFICACION_ABC+D_interior.xlsx
2026-02-03 15:33:47 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_interior.xlsx
2026-02-03 15:33:48 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 15:33:48 - INFO - Clasificación ABC cargada para 'interior': 555 registros
2026-02-03 15:33:48 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 15:33:51 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:33:51 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 15:33:51 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 15:33:51 - INFO - Ventas cargadas: 44082 registros
2026-02-03 15:33:52 - INFO - Filtrados 3624 registros de sección 'interior' de 44082 total
2026-02-03 15:33:52 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 15:33:54 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:33:54 - INFO - Costes cargados: 22145 registros
2026-02-03 15:33:54 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA INTERIOR ===
2026-02-03 15:33:54 - INFO -   ABC: 555 registros
2026-02-03 15:33:54 - INFO -   Ventas: 3624 registros
2026-02-03 15:33:54 - INFO -   Costes: 22145 registros
2026-02-03 15:33:54 - INFO - Datos de ventas: 286 registros
2026-02-03 15:33:54 - INFO - Calculando pedido para semana 14 (286 registros)
2026-02-03 15:33:54 - INFO -   Objetivo: 2930.63€, Actual (ABC): 2409.44€
2026-02-03 15:33:54 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 15:33:54 - INFO -   Factor total: 1.3125
2026-02-03 15:33:54 - INFO -   Factor escalado: 1.5964
2026-02-03 15:33:54 - INFO -   Ventas preliminares (con ceil): 4541.81€
2026-02-03 15:33:54 - INFO -   Objetivo final: 3846.45€
2026-02-03 15:33:54 - INFO -   Delta: 695.36€
2026-02-03 15:33:54 - INFO -   Ventas finales: 3855.17€
2026-02-03 15:33:54 - INFO - 
============================================================
2026-02-03 15:33:54 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 15:33:54 - INFO - ============================================================
2026-02-03 15:33:54 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 15:33:54 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 15:33:54 - INFO - DataLoader inicializado correctamente
2026-02-03 15:33:54 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 15:33:54 - INFO - ============================================================
2026-02-03 15:33:54 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 15:33:54 - INFO - ============================================================
2026-02-03 15:33:54 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 15:33:54 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 15:33:54 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:33:54 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:33:54 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 15:33:54 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:33:54 - INFO - Stock actual cargado: 30 registros
2026-02-03 15:33:54 - INFO -   Stock: 30 registros
2026-02-03 15:33:54 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 15:33:54 - INFO - Fusión completada: 138 registros
2026-02-03 15:33:54 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 15:33:54 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 15:33:54 - INFO - Corrección completada:
2026-02-03 15:33:54 - INFO -   - Artículos corregidos: 121/138
2026-02-03 15:33:54 - INFO -   - Artículos aumentados: 121
2026-02-03 15:33:54 - INFO -   - Artículos reducidos: 0
2026-02-03 15:33:54 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 15:33:54 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 15:33:54 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 15:33:54 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_interior.xlsx
2026-02-03 15:33:54 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_interior.xlsx
2026-02-03 15:33:54 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_interior.xlsx
2026-02-03 15:33:54 - INFO -   Articulos: 121
2026-02-03 15:33:54 - INFO -   Importe: 3855.17€
2026-02-03 15:33:54 - INFO - 
==================================================
2026-02-03 15:33:54 - INFO - SECCION: FITOS
2026-02-03 15:33:54 - INFO - ==================================================
2026-02-03 15:33:54 - INFO - === LEYENDO DATOS PARA SECCIÓN: FITOS ===
2026-02-03 15:33:54 - INFO - Archivo ABC encontrado para 'fitos': .\./data/input\CLASIFICACION_ABC+D_fitos.xlsx
2026-02-03 15:33:54 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_fitos.xlsx
2026-02-03 15:33:54 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 15:33:54 - INFO - Clasificación ABC cargada para 'fitos': 247 registros
2026-02-03 15:33:54 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 15:33:58 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:33:58 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 15:33:58 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 15:33:58 - INFO - Ventas cargadas: 44082 registros
2026-02-03 15:33:58 - INFO - Filtrados 1987 registros de sección 'fitos' de 44082 total
2026-02-03 15:33:58 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 15:34:00 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:34:00 - INFO - Costes cargados: 22145 registros
2026-02-03 15:34:00 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA FITOS ===
2026-02-03 15:34:00 - INFO -   ABC: 247 registros
2026-02-03 15:34:00 - INFO -   Ventas: 1987 registros
2026-02-03 15:34:00 - INFO -   Costes: 22145 registros
2026-02-03 15:34:00 - INFO - Datos de ventas: 157 registros
2026-02-03 15:34:00 - INFO - Calculando pedido para semana 14 (157 registros)
2026-02-03 15:34:00 - INFO -   Objetivo: 1798.25€, Actual (ABC): 1679.26€
2026-02-03 15:34:00 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 15:34:00 - INFO -   Factor total: 1.3125
2026-02-03 15:34:00 - INFO -   Factor escalado: 1.4055
2026-02-03 15:34:00 - INFO -   Ventas preliminares (con ceil): 2784.94€
2026-02-03 15:34:00 - INFO -   Objetivo final: 2360.20€
2026-02-03 15:34:00 - INFO -   Delta: 424.74€
2026-02-03 15:34:00 - INFO -   Ventas finales: 2365.92€
2026-02-03 15:34:01 - INFO - 
============================================================
2026-02-03 15:34:01 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 15:34:01 - INFO - ============================================================
2026-02-03 15:34:01 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 15:34:01 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 15:34:01 - INFO - DataLoader inicializado correctamente
2026-02-03 15:34:01 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 15:34:01 - INFO - ============================================================
2026-02-03 15:34:01 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 15:34:01 - INFO - ============================================================
2026-02-03 15:34:01 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 15:34:01 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 15:34:01 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:34:01 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:34:01 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 15:34:01 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:34:01 - INFO - Stock actual cargado: 30 registros
2026-02-03 15:34:01 - INFO -   Stock: 30 registros
2026-02-03 15:34:01 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 15:34:01 - INFO - Fusión completada: 84 registros
2026-02-03 15:34:01 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 15:34:01 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 15:34:01 - INFO - Corrección completada:
2026-02-03 15:34:01 - INFO -   - Artículos corregidos: 82/84
2026-02-03 15:34:01 - INFO -   - Artículos aumentados: 82
2026-02-03 15:34:01 - INFO -   - Artículos reducidos: 0
2026-02-03 15:34:01 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 15:34:01 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 15:34:01 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 15:34:01 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_fitos.xlsx
2026-02-03 15:34:01 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_fitos.xlsx
2026-02-03 15:34:01 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_fitos.xlsx
2026-02-03 15:34:01 - INFO -   Articulos: 82
2026-02-03 15:34:01 - INFO -   Importe: 2365.92€
2026-02-03 15:34:01 - INFO - 
==================================================
2026-02-03 15:34:01 - INFO - SECCION: VIVERO
2026-02-03 15:34:01 - INFO - ==================================================
2026-02-03 15:34:01 - INFO - === LEYENDO DATOS PARA SECCIÓN: VIVERO ===
2026-02-03 15:34:01 - INFO - Archivo ABC encontrado para 'vivero': .\./data/input\CLASIFICACION_ABC+D_vivero.xlsx
2026-02-03 15:34:01 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_vivero.xlsx
2026-02-03 15:34:01 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 15:34:01 - INFO - Clasificación ABC cargada para 'vivero': 565 registros
2026-02-03 15:34:01 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 15:34:05 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:34:05 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 15:34:05 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 15:34:05 - INFO - Ventas cargadas: 44082 registros
2026-02-03 15:34:05 - INFO - Filtrados 2460 registros de sección 'vivero' de 44082 total
2026-02-03 15:34:05 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 15:34:07 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:34:07 - INFO - Costes cargados: 22145 registros
2026-02-03 15:34:07 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA VIVERO ===
2026-02-03 15:34:07 - INFO -   ABC: 565 registros
2026-02-03 15:34:07 - INFO -   Ventas: 2460 registros
2026-02-03 15:34:07 - INFO -   Costes: 22145 registros
2026-02-03 15:34:07 - INFO - Datos de ventas: 189 registros
2026-02-03 15:34:07 - INFO - Calculando pedido para semana 14 (189 registros)
2026-02-03 15:34:07 - INFO -   Objetivo: 5297.17€, Actual (ABC): 4113.14€
2026-02-03 15:34:07 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 15:34:07 - INFO -   Factor total: 1.3125
2026-02-03 15:34:07 - INFO -   Factor escalado: 1.6903
2026-02-03 15:34:07 - INFO -   Ventas preliminares (con ceil): 8761.94€
2026-02-03 15:34:07 - INFO -   Objetivo final: 6952.54€
2026-02-03 15:34:07 - INFO -   Delta: 1809.40€
2026-02-03 15:34:07 - INFO -   Ventas finales: 6990.51€
2026-02-03 15:34:07 - INFO - 
============================================================
2026-02-03 15:34:07 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 15:34:07 - INFO - ============================================================
2026-02-03 15:34:07 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 15:34:07 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 15:34:07 - INFO - DataLoader inicializado correctamente
2026-02-03 15:34:07 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 15:34:07 - INFO - ============================================================
2026-02-03 15:34:07 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 15:34:07 - INFO - ============================================================
2026-02-03 15:34:07 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 15:34:07 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 15:34:07 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:34:07 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:34:07 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 15:34:07 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:34:07 - INFO - Stock actual cargado: 30 registros
2026-02-03 15:34:07 - INFO -   Stock: 30 registros
2026-02-03 15:34:07 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 15:34:07 - INFO - Fusión completada: 107 registros
2026-02-03 15:34:07 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 15:34:07 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 15:34:07 - INFO - Corrección completada:
2026-02-03 15:34:07 - INFO -   - Artículos corregidos: 96/107
2026-02-03 15:34:07 - INFO -   - Artículos aumentados: 96
2026-02-03 15:34:07 - INFO -   - Artículos reducidos: 0
2026-02-03 15:34:07 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 15:34:07 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 15:34:07 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 15:34:07 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_vivero.xlsx
2026-02-03 15:34:07 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_vivero.xlsx
2026-02-03 15:34:07 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_vivero.xlsx
2026-02-03 15:34:07 - INFO -   Articulos: 96
2026-02-03 15:34:07 - INFO -   Importe: 6990.51€
2026-02-03 15:34:07 - INFO - 
==================================================
2026-02-03 15:34:07 - INFO - SECCION: UTILES_JARDIN
2026-02-03 15:34:07 - INFO - ==================================================
2026-02-03 15:34:07 - INFO - === LEYENDO DATOS PARA SECCIÓN: UTILES_JARDIN ===
2026-02-03 15:34:07 - INFO - Archivo ABC encontrado para 'utiles_jardin': .\./data/input\CLASIFICACION_ABC+D_utiles_jardin.xlsx
2026-02-03 15:34:07 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_utiles_jardin.xlsx
2026-02-03 15:34:07 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 15:34:07 - INFO - Clasificación ABC cargada para 'utiles_jardin': 433 registros
2026-02-03 15:34:07 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 15:34:11 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:34:11 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 15:34:11 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 15:34:11 - INFO - Ventas cargadas: 44082 registros
2026-02-03 15:34:11 - INFO - Filtrados 1009 registros de sección 'utiles_jardin' de 44082 total
2026-02-03 15:34:11 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 15:34:13 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:34:13 - INFO - Costes cargados: 22145 registros
2026-02-03 15:34:13 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA UTILES_JARDIN ===
2026-02-03 15:34:13 - INFO -   ABC: 433 registros
2026-02-03 15:34:13 - INFO -   Ventas: 1009 registros
2026-02-03 15:34:13 - INFO -   Costes: 22145 registros
2026-02-03 15:34:13 - INFO - Datos de ventas: 89 registros
2026-02-03 15:34:13 - INFO - Calculando pedido para semana 14 (89 registros)
2026-02-03 15:34:14 - INFO -   Objetivo: 1044.77€, Actual (ABC): 818.79€
2026-02-03 15:34:14 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 15:34:14 - INFO -   Factor total: 1.3125
2026-02-03 15:34:14 - INFO -   Factor escalado: 1.6747
2026-02-03 15:34:14 - INFO -   Ventas preliminares (con ceil): 1929.56€
2026-02-03 15:34:14 - INFO -   Objetivo final: 1371.26€
2026-02-03 15:34:14 - INFO -   Delta: 558.30€
2026-02-03 15:34:14 - INFO -   Ventas finales: 1390.00€
2026-02-03 15:34:14 - INFO - 
============================================================
2026-02-03 15:34:14 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 15:34:14 - INFO - ============================================================
2026-02-03 15:34:14 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 15:34:14 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 15:34:14 - INFO - DataLoader inicializado correctamente
2026-02-03 15:34:14 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 15:34:14 - INFO - ============================================================
2026-02-03 15:34:14 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 15:34:14 - INFO - ============================================================
2026-02-03 15:34:14 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 15:34:14 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 15:34:14 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:34:14 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:34:14 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 15:34:14 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:34:14 - INFO - Stock actual cargado: 30 registros
2026-02-03 15:34:14 - INFO -   Stock: 30 registros
2026-02-03 15:34:14 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 15:34:14 - INFO - Fusión completada: 78 registros
2026-02-03 15:34:14 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 15:34:14 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 15:34:14 - INFO - Corrección completada:
2026-02-03 15:34:14 - INFO -   - Artículos corregidos: 78/78
2026-02-03 15:34:14 - INFO -   - Artículos aumentados: 78
2026-02-03 15:34:14 - INFO -   - Artículos reducidos: 0
2026-02-03 15:34:14 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 15:34:14 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 15:34:14 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 15:34:14 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx
2026-02-03 15:34:14 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx
2026-02-03 15:34:14 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx
2026-02-03 15:34:14 - INFO -   Articulos: 78
2026-02-03 15:34:14 - INFO -   Importe: 1390.00€
2026-02-03 15:34:14 - INFO - 
==================================================
2026-02-03 15:34:14 - INFO - SECCION: TIERRAS_ARIDOS
2026-02-03 15:34:14 - INFO - ==================================================
2026-02-03 15:34:14 - INFO - === LEYENDO DATOS PARA SECCIÓN: TIERRAS_ARIDOS ===
2026-02-03 15:34:14 - WARNING - No se encontró archivo específico para 'tierras_aridos', usando: .\./data/input\CLASIFICACION_ABC+D_DECO_EXTERIOR.xlsx
2026-02-03 15:34:14 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_DECO_EXTERIOR.xlsx
2026-02-03 15:34:14 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 15:34:14 - INFO - Clasificación ABC cargada para 'tierras_aridos': 995 registros
2026-02-03 15:34:14 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 15:34:18 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:34:18 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 15:34:18 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 15:34:18 - INFO - Ventas cargadas: 44082 registros
2026-02-03 15:34:18 - INFO - Filtrados 3264 registros de sección 'tierras_aridos' de 44082 total
2026-02-03 15:34:18 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 15:34:20 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:34:20 - INFO - Costes cargados: 22145 registros
2026-02-03 15:34:20 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA TIERRAS_ARIDOS ===
2026-02-03 15:34:20 - INFO -   ABC: 995 registros
2026-02-03 15:34:20 - INFO -   Ventas: 3264 registros
2026-02-03 15:34:20 - INFO -   Costes: 22145 registros
2026-02-03 15:34:20 - INFO - Datos de ventas: 302 registros
2026-02-03 15:34:20 - INFO - Calculando pedido para semana 14 (302 registros)
2026-02-03 15:34:20 - INFO -   Objetivo: 4097.24€, Actual (ABC): 4019.19€
2026-02-03 15:34:20 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 15:34:20 - INFO -   Factor total: 1.3125
2026-02-03 15:34:20 - INFO -   Factor escalado: 1.3380
2026-02-03 15:34:20 - INFO -   Ventas preliminares (con ceil): 5809.66€
2026-02-03 15:34:20 - INFO -   Objetivo final: 5377.63€
2026-02-03 15:34:20 - INFO -   Delta: 432.03€
2026-02-03 15:34:20 - INFO -   Ventas finales: 5387.14€
2026-02-03 15:34:20 - INFO - 
============================================================
2026-02-03 15:34:20 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 15:34:20 - INFO - ============================================================
2026-02-03 15:34:20 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 15:34:20 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 15:34:20 - INFO - DataLoader inicializado correctamente
2026-02-03 15:34:20 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 15:34:20 - INFO - ============================================================
2026-02-03 15:34:20 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 15:34:20 - INFO - ============================================================
2026-02-03 15:34:20 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 15:34:20 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 15:34:20 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:34:20 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:34:20 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 15:34:20 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:34:20 - INFO - Stock actual cargado: 30 registros
2026-02-03 15:34:20 - INFO -   Stock: 30 registros
2026-02-03 15:34:20 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 15:34:20 - INFO - Fusión completada: 72 registros
2026-02-03 15:34:20 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 15:34:20 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 15:34:20 - INFO - Corrección completada:
2026-02-03 15:34:20 - INFO -   - Artículos corregidos: 71/72
2026-02-03 15:34:20 - INFO -   - Artículos aumentados: 71
2026-02-03 15:34:20 - INFO -   - Artículos reducidos: 0
2026-02-03 15:34:20 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 15:34:20 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 15:34:20 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 15:34:20 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx
2026-02-03 15:34:20 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx
2026-02-03 15:34:20 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx
2026-02-03 15:34:20 - INFO -   Articulos: 71
2026-02-03 15:34:20 - INFO -   Importe: 5387.14€
2026-02-03 15:34:20 - INFO - 
==================================================
2026-02-03 15:34:20 - INFO - SECCION: DECO_EXTERIOR
2026-02-03 15:34:20 - INFO - ==================================================
2026-02-03 15:34:20 - INFO - === LEYENDO DATOS PARA SECCIÓN: DECO_EXTERIOR ===
2026-02-03 15:34:20 - INFO - Archivo ABC encontrado para 'deco_exterior': .\./data/input\CLASIFICACION_ABC+D_deco_exterior.xlsx
2026-02-03 15:34:20 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_deco_exterior.xlsx
2026-02-03 15:34:21 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 15:34:21 - INFO - Clasificación ABC cargada para 'deco_exterior': 995 registros
2026-02-03 15:34:21 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 15:34:24 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:34:24 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 15:34:25 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 15:34:25 - INFO - Ventas cargadas: 44082 registros
2026-02-03 15:34:25 - INFO - Filtrados 4018 registros de sección 'deco_exterior' de 44082 total
2026-02-03 15:34:25 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 15:34:27 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:34:27 - INFO - Costes cargados: 22145 registros
2026-02-03 15:34:27 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA DECO_EXTERIOR ===
2026-02-03 15:34:27 - INFO -   ABC: 995 registros
2026-02-03 15:34:27 - INFO -   Ventas: 4018 registros
2026-02-03 15:34:27 - INFO -   Costes: 22145 registros
2026-02-03 15:34:27 - INFO - Datos de ventas: 316 registros
2026-02-03 15:34:27 - INFO - Calculando pedido para semana 14 (316 registros)
2026-02-03 15:34:27 - INFO -   Objetivo: 3740.34€, Actual (ABC): 4104.66€
2026-02-03 15:34:27 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 15:34:27 - INFO -   Factor total: 1.3125
2026-02-03 15:34:27 - INFO -   Factor escalado: 1.1960
2026-02-03 15:34:27 - INFO -   Ventas preliminares (con ceil): 6094.59€
2026-02-03 15:34:27 - INFO -   Objetivo final: 4909.20€
2026-02-03 15:34:27 - INFO -   Delta: 1185.39€
2026-02-03 15:34:27 - INFO -   Ventas finales: 4923.89€
2026-02-03 15:34:27 - INFO - 
============================================================
2026-02-03 15:34:27 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 15:34:27 - INFO - ============================================================
2026-02-03 15:34:27 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 15:34:27 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 15:34:27 - INFO - DataLoader inicializado correctamente
2026-02-03 15:34:27 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 15:34:27 - INFO - ============================================================
2026-02-03 15:34:27 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 15:34:27 - INFO - ============================================================
2026-02-03 15:34:27 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 15:34:27 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 15:34:27 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:34:27 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:34:27 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 15:34:27 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:34:27 - INFO - Stock actual cargado: 30 registros
2026-02-03 15:34:27 - INFO -   Stock: 30 registros
2026-02-03 15:34:27 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 15:34:27 - INFO - Fusión completada: 224 registros
2026-02-03 15:34:27 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 15:34:27 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 15:34:27 - INFO - Corrección completada:
2026-02-03 15:34:27 - INFO -   - Artículos corregidos: 205/224
2026-02-03 15:34:27 - INFO -   - Artículos aumentados: 205
2026-02-03 15:34:27 - INFO -   - Artículos reducidos: 0
2026-02-03 15:34:27 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 15:34:27 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 15:34:27 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 15:34:27 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_deco_exterior.xlsx
2026-02-03 15:34:27 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_deco_exterior.xlsx
2026-02-03 15:34:27 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_deco_exterior.xlsx
2026-02-03 15:34:27 - INFO -   Articulos: 205
2026-02-03 15:34:27 - INFO -   Importe: 4923.89€
2026-02-03 15:34:27 - INFO - Estado guardado correctamente
2026-02-03 15:34:28 - INFO - Generando resumen: .\./data/output\Resumen_Pedidos_VIVERO_2026-02-03.xlsx
2026-02-03 15:34:28 - INFO - Resumen guardado: .\./data/output\Resumen_Pedidos_VIVERO_2026-02-03.xlsx
2026-02-03 15:34:28 - INFO - Estado guardado correctamente
2026-02-03 15:34:28 - INFO - 
============================================================
2026-02-03 15:34:28 - INFO - PREPARANDO ENVÍO DE EMAILS
2026-02-03 15:34:28 - INFO - ============================================================
2026-02-03 15:34:28 - INFO - 
============================================================
2026-02-03 15:34:28 - INFO - ENVÍO DE EMAILS A RESPONSABLES
2026-02-03 15:34:28 - INFO - ============================================================
2026-02-03 15:34:28 - INFO - EmailService inicializado correctamente
2026-02-03 15:34:28 - ERROR - La variable de entorno 'EMAIL_PASSWORD' no está configurada. Por favor, configúrala antes de enviar emails.
2026-02-03 15:34:28 - WARNING - Problemas de configuración detectados:
2026-02-03 15:34:28 - WARNING -   - La variable de entorno 'EMAIL_PASSWORD' no está configurada
2026-02-03 15:34:28 - INFO - 
Enviando email para sección: maf
2026-02-03 15:34:28 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_maf.xlsx']
2026-02-03 15:34:28 - INFO - ============================================================
2026-02-03 15:34:28 - INFO - ENVIANDO EMAIL PARA SECCIÓN: MAF
2026-02-03 15:34:28 - INFO - ============================================================
2026-02-03 15:34:28 - ERROR - Error al enviar emails: name 'destinatorios_config' is not defined
2026-02-03 15:34:28 - ERROR - Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 445, in enviar_emails_pedidos
    resultado = email_service.enviar_pedido_por_seccion(
        semana=semana,
        seccion=seccion,
        archivos=archivos
    )
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\email_service.py", line 331, in enviar_pedido_por_seccion
    destinatarios_info = self.obtener_destinatarios_seccion(seccion)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\email_service.py", line 297, in obtener_destinatarios_seccion
    for dest in destinatorios_config:
                ^^^^^^^^^^^^^^^^^^^^
NameError: name 'destinatorios_config' is not defined. Did you mean: 'destinatarios_config'?

2026-02-03 15:34:28 - INFO - 
======================================================================
2026-02-03 15:34:28 - INFO - RESUMEN DE EJECUCION
2026-02-03 15:34:28 - INFO - ======================================================================
2026-02-03 15:34:28 - INFO - Semana procesada: 14
2026-02-03 15:34:28 - INFO - Archivos generados: 12
2026-02-03 15:34:28 - INFO - Total articulos: 1510
2026-02-03 15:34:28 - INFO - Total importe: 48113.87€
2026-02-03 15:34:28 - INFO - ======================================================================
2026-02-03 15:34:28 - INFO - 
¡PEDIDO GENERADO EXITOSAMENTE!
2026-02-03 15:34:28 - INFO - Archivo principal: .\./data/output\Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 15:34:28 - INFO - Artículos: 1510
2026-02-03 15:34:28 - INFO - Importe: 48113.87€
2026-02-03 15:36:05 - INFO - ======================================================================
2026-02-03 15:36:05 - INFO - SISTEMA DE PEDIDOS DE COMPRA - VIVERO ARANJUEZ V2
2026-02-03 15:36:05 - INFO - Fecha de ejecución: 2026-02-03 15:36:05
2026-02-03 15:36:05 - INFO - ======================================================================
2026-02-03 15:36:05 - INFO - 
VERIFICANDO CONFIGURACIÓN DE EMAIL:
2026-02-03 15:36:05 - INFO - ----------------------------------------
2026-02-03 15:36:05 - INFO - EmailService inicializado correctamente
2026-02-03 15:36:05 - ERROR - La variable de entorno 'EMAIL_PASSWORD' no está configurada. Por favor, configúrala antes de enviar emails.
2026-02-03 15:36:05 - WARNING - Problemas de configuración detectados:
2026-02-03 15:36:05 - WARNING -   - La variable de entorno 'EMAIL_PASSWORD' no está configurada
2026-02-03 15:36:05 - INFO - ✓ Configuración de email válida
2026-02-03 15:36:05 - WARNING - ✗ Variable EMAIL_PASSWORD NO configurada
2026-02-03 15:36:05 - INFO -   Para configurarla, ejecuta:
2026-02-03 15:36:05 - INFO -   export EMAIL_PASSWORD='tu_contraseña'
2026-02-03 15:44:14 - INFO - ======================================================================
2026-02-03 15:44:14 - INFO - SISTEMA DE PEDIDOS DE COMPRA - VIVERO ARANJUEZ V2
2026-02-03 15:44:14 - INFO - Fecha de ejecución: 2026-02-03 15:44:14
2026-02-03 15:44:14 - INFO - ======================================================================
2026-02-03 15:44:14 - INFO - 
VERIFICANDO CONFIGURACIÓN DE EMAIL:
2026-02-03 15:44:14 - INFO - ----------------------------------------
2026-02-03 15:44:14 - INFO - EmailService inicializado correctamente
2026-02-03 15:44:14 - INFO - ✓ Configuración de email válida
2026-02-03 15:44:14 - INFO - ✓ Variable EMAIL_PASSWORD configurada
2026-02-03 15:56:14 - INFO - ======================================================================
2026-02-03 15:56:14 - INFO - SISTEMA DE PEDIDOS DE COMPRA - VIVERO ARANJUEZ V2
2026-02-03 15:56:14 - INFO - Fecha de ejecución: 2026-02-03 15:56:14
2026-02-03 15:56:14 - INFO - ======================================================================
2026-02-03 15:56:14 - INFO - Modo de ejecución: FASE 1 + FASE 2
2026-02-03 15:56:14 - INFO - Envío de emails: Sí
2026-02-03 15:56:14 - INFO - StateManager inicializado. Archivo de estado: .\./data\state.json
2026-02-03 15:56:14 - INFO - Cargando estado desde: .\./data\state.json
2026-02-03 15:56:14 - INFO - Estado cargado correctamente
2026-02-03 15:56:14 - INFO - SchedulerService inicializado correctamente
2026-02-03 15:56:14 - INFO - Horario configurado: sunday a las 15:00
2026-02-03 15:56:14 - INFO - Semana forzada por argumento: 14
2026-02-03 15:56:14 - INFO - ======================================================================
2026-02-03 15:56:14 - INFO - PROCESANDO PEDIDO PARA SEMANA 14
2026-02-03 15:56:14 - INFO - ======================================================================
2026-02-03 15:56:14 - INFO - MODO: FASE 1 (Forecast) + FASE 2 (Corrección)
2026-02-03 15:56:14 - INFO - DataLoader inicializado correctamente
2026-02-03 15:56:14 - INFO - ForecastEngine inicializado correctamente
2026-02-03 15:56:14 - INFO - OrderGenerator inicializado correctamente
2026-02-03 15:56:14 - INFO - SchedulerService inicializado correctamente
2026-02-03 15:56:14 - INFO - Horario configurado: sunday a las 15:00
2026-02-03 15:56:14 - INFO - Período de la semana: 2026-03-30 al 2026-04-05
2026-02-03 15:56:14 - INFO - Stock acumulado cargado: 2633 artículos
2026-02-03 15:56:14 - INFO - 
==================================================
2026-02-03 15:56:14 - INFO - SECCION: MAF
2026-02-03 15:56:14 - INFO - ==================================================
2026-02-03 15:56:14 - INFO - === LEYENDO DATOS PARA SECCIÓN: MAF ===
2026-02-03 15:56:14 - INFO - Archivo ABC encontrado para 'maf': .\./data/input\CLASIFICACION_ABC+D_maf.xlsx
2026-02-03 15:56:14 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_maf.xlsx
2026-02-03 15:56:14 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 15:56:14 - INFO - Clasificación ABC cargada para 'maf': 499 registros
2026-02-03 15:56:14 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 15:56:18 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:56:18 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 15:56:18 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 15:56:18 - INFO - Ventas cargadas: 44082 registros
2026-02-03 15:56:18 - INFO - Filtrados 10970 registros de sección 'maf' de 44082 total
2026-02-03 15:56:18 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 15:56:20 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:56:20 - INFO - Costes cargados: 22145 registros
2026-02-03 15:56:20 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MAF ===
2026-02-03 15:56:20 - INFO -   ABC: 499 registros
2026-02-03 15:56:20 - INFO -   Ventas: 10970 registros
2026-02-03 15:56:20 - INFO -   Costes: 22145 registros
2026-02-03 15:56:20 - INFO - Datos de ventas: 1011 registros
2026-02-03 15:56:20 - INFO - Calculando pedido para semana 14 (1011 registros)
2026-02-03 15:56:21 - INFO -   Objetivo: 7050.65€, Actual (ABC): 5843.77€
2026-02-03 15:56:21 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 15:56:21 - INFO -   Factor total: 1.3125
2026-02-03 15:56:21 - INFO -   Factor escalado: 1.5836
2026-02-03 15:56:21 - INFO -   Ventas preliminares (con ceil): 9931.01€
2026-02-03 15:56:21 - INFO -   Objetivo final: 9253.98€
2026-02-03 15:56:21 - INFO -   Delta: 677.03€
2026-02-03 15:56:21 - INFO -   Ventas finales: 9259.59€
2026-02-03 15:56:21 - INFO - 
============================================================
2026-02-03 15:56:21 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 15:56:21 - INFO - ============================================================
2026-02-03 15:56:21 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 15:56:21 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 15:56:21 - INFO - DataLoader inicializado correctamente
2026-02-03 15:56:21 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 15:56:21 - INFO - ============================================================
2026-02-03 15:56:21 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 15:56:21 - INFO - ============================================================
2026-02-03 15:56:21 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 15:56:21 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 15:56:21 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:56:21 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:56:21 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 15:56:21 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:56:21 - INFO - Stock actual cargado: 30 registros
2026-02-03 15:56:21 - INFO -   Stock: 30 registros
2026-02-03 15:56:21 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 15:56:21 - INFO - Fusión completada: 222 registros
2026-02-03 15:56:21 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 15:56:21 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 15:56:21 - INFO - Corrección completada:
2026-02-03 15:56:21 - INFO -   - Artículos corregidos: 191/222
2026-02-03 15:56:21 - INFO -   - Artículos aumentados: 191
2026-02-03 15:56:21 - INFO -   - Artículos reducidos: 0
2026-02-03 15:56:21 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 15:56:21 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 15:56:21 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 15:56:21 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 15:56:21 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 15:56:21 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 15:56:21 - INFO -   Articulos: 191
2026-02-03 15:56:21 - INFO -   Importe: 9259.59€
2026-02-03 15:56:21 - INFO - 
==================================================
2026-02-03 15:56:21 - INFO - SECCION: DECO_INTERIOR
2026-02-03 15:56:21 - INFO - ==================================================
2026-02-03 15:56:21 - INFO - === LEYENDO DATOS PARA SECCIÓN: DECO_INTERIOR ===
2026-02-03 15:56:21 - INFO - Archivo ABC encontrado para 'deco_interior': .\./data/input\CLASIFICACION_ABC+D_deco_interior.xlsx
2026-02-03 15:56:21 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_deco_interior.xlsx
2026-02-03 15:56:21 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 15:56:21 - INFO - Clasificación ABC cargada para 'deco_interior': 1827 registros
2026-02-03 15:56:21 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 15:56:25 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:56:25 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 15:56:25 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 15:56:25 - INFO - Ventas cargadas: 44082 registros
2026-02-03 15:56:25 - INFO - Filtrados 2468 registros de sección 'deco_interior' de 44082 total
2026-02-03 15:56:25 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 15:56:27 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:56:27 - INFO - Costes cargados: 22145 registros
2026-02-03 15:56:27 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA DECO_INTERIOR ===
2026-02-03 15:56:27 - INFO -   ABC: 1827 registros
2026-02-03 15:56:27 - INFO -   Ventas: 2468 registros
2026-02-03 15:56:27 - INFO -   Costes: 22145 registros
2026-02-03 15:56:27 - INFO - Datos de ventas: 180 registros
2026-02-03 15:56:27 - INFO - Calculando pedido para semana 14 (180 registros)
2026-02-03 15:56:28 - INFO -   Objetivo: 1962.99€, Actual (ABC): 1636.15€
2026-02-03 15:56:28 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 15:56:28 - INFO -   Factor total: 1.3125
2026-02-03 15:56:28 - INFO -   Factor escalado: 1.5747
2026-02-03 15:56:28 - INFO -   Ventas preliminares (con ceil): 2950.01€
2026-02-03 15:56:28 - INFO -   Objetivo final: 2576.42€
2026-02-03 15:56:28 - INFO -   Delta: 373.59€
2026-02-03 15:56:28 - INFO -   Ventas finales: 2580.73€
2026-02-03 15:56:28 - INFO - 
============================================================
2026-02-03 15:56:28 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 15:56:28 - INFO - ============================================================
2026-02-03 15:56:28 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 15:56:28 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 15:56:28 - INFO - DataLoader inicializado correctamente
2026-02-03 15:56:28 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 15:56:28 - INFO - ============================================================
2026-02-03 15:56:28 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 15:56:28 - INFO - ============================================================
2026-02-03 15:56:28 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 15:56:28 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 15:56:28 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:56:28 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:56:28 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 15:56:28 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:56:28 - INFO - Stock actual cargado: 30 registros
2026-02-03 15:56:28 - INFO -   Stock: 30 registros
2026-02-03 15:56:28 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 15:56:28 - INFO - Fusión completada: 139 registros
2026-02-03 15:56:28 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 15:56:28 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 15:56:28 - INFO - Corrección completada:
2026-02-03 15:56:28 - INFO -   - Artículos corregidos: 135/139
2026-02-03 15:56:28 - INFO -   - Artículos aumentados: 135
2026-02-03 15:56:28 - INFO -   - Artículos reducidos: 0
2026-02-03 15:56:28 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 15:56:28 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 15:56:28 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 15:56:28 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_deco_interior.xlsx
2026-02-03 15:56:28 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_deco_interior.xlsx
2026-02-03 15:56:28 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_deco_interior.xlsx
2026-02-03 15:56:28 - INFO -   Articulos: 135
2026-02-03 15:56:28 - INFO -   Importe: 2580.73€
2026-02-03 15:56:28 - INFO - 
==================================================
2026-02-03 15:56:28 - INFO - SECCION: SEMILLAS
2026-02-03 15:56:28 - INFO - ==================================================
2026-02-03 15:56:28 - INFO - === LEYENDO DATOS PARA SECCIÓN: SEMILLAS ===
2026-02-03 15:56:28 - INFO - Archivo ABC encontrado para 'semillas': .\./data/input\CLASIFICACION_ABC+D_semillas.xlsx
2026-02-03 15:56:28 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_semillas.xlsx
2026-02-03 15:56:28 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 15:56:28 - INFO - Clasificación ABC cargada para 'semillas': 218 registros
2026-02-03 15:56:28 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 15:56:32 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:56:32 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 15:56:32 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 15:56:32 - INFO - Ventas cargadas: 44082 registros
2026-02-03 15:56:32 - INFO - Filtrados 1180 registros de sección 'semillas' de 44082 total
2026-02-03 15:56:32 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 15:56:34 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:56:34 - INFO - Costes cargados: 22145 registros
2026-02-03 15:56:34 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA SEMILLAS ===
2026-02-03 15:56:34 - INFO -   ABC: 218 registros
2026-02-03 15:56:34 - INFO -   Ventas: 1180 registros
2026-02-03 15:56:34 - INFO -   Costes: 22145 registros
2026-02-03 15:56:34 - INFO - Datos de ventas: 136 registros
2026-02-03 15:56:34 - INFO - Calculando pedido para semana 14 (136 registros)
2026-02-03 15:56:34 - INFO -   Objetivo: 694.34€, Actual (ABC): 455.14€
2026-02-03 15:56:34 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 15:56:34 - INFO -   Factor total: 1.3125
2026-02-03 15:56:34 - INFO -   Factor escalado: 2.0023
2026-02-03 15:56:34 - INFO -   Ventas preliminares (con ceil): 1129.15€
2026-02-03 15:56:34 - INFO -   Objetivo final: 911.32€
2026-02-03 15:56:34 - INFO -   Delta: 217.83€
2026-02-03 15:56:34 - INFO -   Ventas finales: 911.60€
2026-02-03 15:56:34 - INFO - 
============================================================
2026-02-03 15:56:34 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 15:56:34 - INFO - ============================================================
2026-02-03 15:56:34 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 15:56:34 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 15:56:34 - INFO - DataLoader inicializado correctamente
2026-02-03 15:56:34 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 15:56:34 - INFO - ============================================================
2026-02-03 15:56:34 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 15:56:34 - INFO - ============================================================
2026-02-03 15:56:34 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 15:56:34 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 15:56:34 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:56:34 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:56:34 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 15:56:34 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:56:34 - INFO - Stock actual cargado: 30 registros
2026-02-03 15:56:34 - INFO -   Stock: 30 registros
2026-02-03 15:56:34 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 15:56:34 - INFO - Fusión completada: 84 registros
2026-02-03 15:56:34 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 15:56:34 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 15:56:34 - INFO - Corrección completada:
2026-02-03 15:56:34 - INFO -   - Artículos corregidos: 84/84
2026-02-03 15:56:34 - INFO -   - Artículos aumentados: 84
2026-02-03 15:56:34 - INFO -   - Artículos reducidos: 0
2026-02-03 15:56:34 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 15:56:34 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 15:56:34 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 15:56:34 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_semillas.xlsx
2026-02-03 15:56:34 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_semillas.xlsx
2026-02-03 15:56:34 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_semillas.xlsx
2026-02-03 15:56:34 - INFO -   Articulos: 84
2026-02-03 15:56:34 - INFO -   Importe: 911.60€
2026-02-03 15:56:34 - INFO - 
==================================================
2026-02-03 15:56:34 - INFO - SECCION: MASCOTAS_VIVO
2026-02-03 15:56:34 - INFO - ==================================================
2026-02-03 15:56:34 - INFO - === LEYENDO DATOS PARA SECCIÓN: MASCOTAS_VIVO ===
2026-02-03 15:56:34 - INFO - Archivo ABC encontrado para 'mascotas_vivo': .\./data/input\CLASIFICACION_ABC+D_mascotas_vivo.xlsx
2026-02-03 15:56:34 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_mascotas_vivo.xlsx
2026-02-03 15:56:34 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 15:56:34 - INFO - Clasificación ABC cargada para 'mascotas_vivo': 205 registros
2026-02-03 15:56:34 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 15:56:38 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:56:38 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 15:56:38 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 15:56:38 - INFO - Ventas cargadas: 44082 registros
2026-02-03 15:56:38 - INFO - Filtrados 1124 registros de sección 'mascotas_vivo' de 44082 total
2026-02-03 15:56:38 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 15:56:40 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:56:40 - INFO - Costes cargados: 22145 registros
2026-02-03 15:56:40 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MASCOTAS_VIVO ===
2026-02-03 15:56:40 - INFO -   ABC: 205 registros
2026-02-03 15:56:40 - INFO -   Ventas: 1124 registros
2026-02-03 15:56:40 - INFO -   Costes: 22145 registros
2026-02-03 15:56:40 - INFO - Datos de ventas: 88 registros
2026-02-03 15:56:40 - INFO - Calculando pedido para semana 14 (88 registros)
2026-02-03 15:56:41 - INFO -   Objetivo: 1087.15€, Actual (ABC): 846.63€
2026-02-03 15:56:41 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 15:56:41 - INFO -   Factor total: 1.3125
2026-02-03 15:56:41 - INFO -   Factor escalado: 1.6854
2026-02-03 15:56:41 - INFO -   Ventas preliminares (con ceil): 1773.66€
2026-02-03 15:56:41 - INFO -   Objetivo final: 1426.88€
2026-02-03 15:56:41 - INFO -   Delta: 346.78€
2026-02-03 15:56:41 - INFO -   Ventas finales: 1455.34€
2026-02-03 15:56:41 - INFO - 
============================================================
2026-02-03 15:56:41 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 15:56:41 - INFO - ============================================================
2026-02-03 15:56:41 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 15:56:41 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 15:56:41 - INFO - DataLoader inicializado correctamente
2026-02-03 15:56:41 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 15:56:41 - INFO - ============================================================
2026-02-03 15:56:41 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 15:56:41 - INFO - ============================================================
2026-02-03 15:56:41 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 15:56:41 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 15:56:41 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:56:41 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:56:41 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 15:56:41 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:56:41 - INFO - Stock actual cargado: 30 registros
2026-02-03 15:56:41 - INFO -   Stock: 30 registros
2026-02-03 15:56:41 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 15:56:41 - INFO - Fusión completada: 43 registros
2026-02-03 15:56:41 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 15:56:41 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 15:56:41 - INFO - Corrección completada:
2026-02-03 15:56:41 - INFO -   - Artículos corregidos: 36/43
2026-02-03 15:56:41 - INFO -   - Artículos aumentados: 36
2026-02-03 15:56:41 - INFO -   - Artículos reducidos: 0
2026-02-03 15:56:41 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 15:56:41 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 15:56:41 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 15:56:41 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx
2026-02-03 15:56:41 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx
2026-02-03 15:56:41 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx
2026-02-03 15:56:41 - INFO -   Articulos: 36
2026-02-03 15:56:41 - INFO -   Importe: 1455.34€
2026-02-03 15:56:41 - INFO - 
==================================================
2026-02-03 15:56:41 - INFO - SECCION: MASCOTAS_MANUFACTURADO
2026-02-03 15:56:41 - INFO - ==================================================
2026-02-03 15:56:41 - INFO - === LEYENDO DATOS PARA SECCIÓN: MASCOTAS_MANUFACTURADO ===
2026-02-03 15:56:41 - INFO - Archivo ABC encontrado para 'mascotas_manufacturado': .\./data/input\CLASIFICACION_ABC+D_mascotas_manufacturado.xlsx
2026-02-03 15:56:41 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_mascotas_manufacturado.xlsx
2026-02-03 15:56:41 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 15:56:41 - INFO - Clasificación ABC cargada para 'mascotas_manufacturado': 2749 registros
2026-02-03 15:56:41 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 15:56:45 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:56:45 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 15:56:45 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 15:56:45 - INFO - Ventas cargadas: 44082 registros
2026-02-03 15:56:45 - INFO - Filtrados 9784 registros de sección 'mascotas_manufacturado' de 44082 total
2026-02-03 15:56:45 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 15:56:47 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:56:47 - INFO - Costes cargados: 22145 registros
2026-02-03 15:56:47 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MASCOTAS_MANUFACTURADO ===
2026-02-03 15:56:47 - INFO -   ABC: 2749 registros
2026-02-03 15:56:47 - INFO -   Ventas: 9784 registros
2026-02-03 15:56:47 - INFO -   Costes: 22145 registros
2026-02-03 15:56:47 - INFO - Datos de ventas: 822 registros
2026-02-03 15:56:47 - INFO - Calculando pedido para semana 14 (822 registros)
2026-02-03 15:56:49 - INFO -   Objetivo: 6839.82€, Actual (ABC): 8742.92€
2026-02-03 15:56:49 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 15:56:49 - INFO -   Factor total: 1.3125
2026-02-03 15:56:49 - INFO -   Factor escalado: 1.0268
2026-02-03 15:56:49 - INFO -   Ventas preliminares (con ceil): 12379.25€
2026-02-03 15:56:49 - INFO -   Objetivo final: 8977.26€
2026-02-03 15:56:49 - INFO -   Delta: 3401.99€
2026-02-03 15:56:49 - INFO -   Ventas finales: 8993.98€
2026-02-03 15:56:49 - INFO - 
============================================================
2026-02-03 15:56:49 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 15:56:49 - INFO - ============================================================
2026-02-03 15:56:49 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 15:56:49 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 15:56:49 - INFO - DataLoader inicializado correctamente
2026-02-03 15:56:49 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 15:56:49 - INFO - ============================================================
2026-02-03 15:56:49 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 15:56:49 - INFO - ============================================================
2026-02-03 15:56:49 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 15:56:49 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 15:56:49 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:56:49 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:56:49 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 15:56:49 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:56:49 - INFO - Stock actual cargado: 30 registros
2026-02-03 15:56:49 - INFO -   Stock: 30 registros
2026-02-03 15:56:49 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 15:56:49 - INFO - Fusión completada: 538 registros
2026-02-03 15:56:49 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 15:56:49 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 15:56:49 - INFO - Corrección completada:
2026-02-03 15:56:49 - INFO -   - Artículos corregidos: 411/538
2026-02-03 15:56:49 - INFO -   - Artículos aumentados: 411
2026-02-03 15:56:49 - INFO -   - Artículos reducidos: 0
2026-02-03 15:56:49 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 15:56:49 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 15:56:49 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 15:56:49 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx
2026-02-03 15:56:50 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx
2026-02-03 15:56:50 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx
2026-02-03 15:56:50 - INFO -   Articulos: 411
2026-02-03 15:56:50 - INFO -   Importe: 8993.98€
2026-02-03 15:56:50 - INFO - 
==================================================
2026-02-03 15:56:50 - INFO - SECCION: INTERIOR
2026-02-03 15:56:50 - INFO - ==================================================
2026-02-03 15:56:50 - INFO - === LEYENDO DATOS PARA SECCIÓN: INTERIOR ===
2026-02-03 15:56:50 - INFO - Archivo ABC encontrado para 'interior': .\./data/input\CLASIFICACION_ABC+D_interior.xlsx
2026-02-03 15:56:50 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_interior.xlsx
2026-02-03 15:56:50 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 15:56:50 - INFO - Clasificación ABC cargada para 'interior': 555 registros
2026-02-03 15:56:50 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 15:56:53 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:56:53 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 15:56:54 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 15:56:54 - INFO - Ventas cargadas: 44082 registros
2026-02-03 15:56:54 - INFO - Filtrados 3624 registros de sección 'interior' de 44082 total
2026-02-03 15:56:54 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 15:56:56 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:56:56 - INFO - Costes cargados: 22145 registros
2026-02-03 15:56:56 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA INTERIOR ===
2026-02-03 15:56:56 - INFO -   ABC: 555 registros
2026-02-03 15:56:56 - INFO -   Ventas: 3624 registros
2026-02-03 15:56:56 - INFO -   Costes: 22145 registros
2026-02-03 15:56:56 - INFO - Datos de ventas: 286 registros
2026-02-03 15:56:56 - INFO - Calculando pedido para semana 14 (286 registros)
2026-02-03 15:56:56 - INFO -   Objetivo: 2930.63€, Actual (ABC): 2409.44€
2026-02-03 15:56:56 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 15:56:56 - INFO -   Factor total: 1.3125
2026-02-03 15:56:56 - INFO -   Factor escalado: 1.5964
2026-02-03 15:56:56 - INFO -   Ventas preliminares (con ceil): 4541.81€
2026-02-03 15:56:56 - INFO -   Objetivo final: 3846.45€
2026-02-03 15:56:56 - INFO -   Delta: 695.36€
2026-02-03 15:56:56 - INFO -   Ventas finales: 3855.17€
2026-02-03 15:56:56 - INFO - 
============================================================
2026-02-03 15:56:56 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 15:56:56 - INFO - ============================================================
2026-02-03 15:56:56 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 15:56:56 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 15:56:56 - INFO - DataLoader inicializado correctamente
2026-02-03 15:56:56 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 15:56:56 - INFO - ============================================================
2026-02-03 15:56:56 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 15:56:56 - INFO - ============================================================
2026-02-03 15:56:56 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 15:56:56 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 15:56:56 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:56:56 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:56:56 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 15:56:56 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:56:56 - INFO - Stock actual cargado: 30 registros
2026-02-03 15:56:56 - INFO -   Stock: 30 registros
2026-02-03 15:56:56 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 15:56:56 - INFO - Fusión completada: 138 registros
2026-02-03 15:56:56 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 15:56:56 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 15:56:56 - INFO - Corrección completada:
2026-02-03 15:56:56 - INFO -   - Artículos corregidos: 121/138
2026-02-03 15:56:56 - INFO -   - Artículos aumentados: 121
2026-02-03 15:56:56 - INFO -   - Artículos reducidos: 0
2026-02-03 15:56:56 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 15:56:56 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 15:56:56 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 15:56:56 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_interior.xlsx
2026-02-03 15:56:56 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_interior.xlsx
2026-02-03 15:56:56 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_interior.xlsx
2026-02-03 15:56:56 - INFO -   Articulos: 121
2026-02-03 15:56:56 - INFO -   Importe: 3855.17€
2026-02-03 15:56:56 - INFO - 
==================================================
2026-02-03 15:56:56 - INFO - SECCION: FITOS
2026-02-03 15:56:56 - INFO - ==================================================
2026-02-03 15:56:56 - INFO - === LEYENDO DATOS PARA SECCIÓN: FITOS ===
2026-02-03 15:56:56 - INFO - Archivo ABC encontrado para 'fitos': .\./data/input\CLASIFICACION_ABC+D_fitos.xlsx
2026-02-03 15:56:56 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_fitos.xlsx
2026-02-03 15:56:56 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 15:56:56 - INFO - Clasificación ABC cargada para 'fitos': 247 registros
2026-02-03 15:56:56 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 15:57:00 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:57:00 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 15:57:00 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 15:57:00 - INFO - Ventas cargadas: 44082 registros
2026-02-03 15:57:00 - INFO - Filtrados 1987 registros de sección 'fitos' de 44082 total
2026-02-03 15:57:00 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 15:57:02 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:57:02 - INFO - Costes cargados: 22145 registros
2026-02-03 15:57:02 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA FITOS ===
2026-02-03 15:57:02 - INFO -   ABC: 247 registros
2026-02-03 15:57:02 - INFO -   Ventas: 1987 registros
2026-02-03 15:57:02 - INFO -   Costes: 22145 registros
2026-02-03 15:57:02 - INFO - Datos de ventas: 157 registros
2026-02-03 15:57:02 - INFO - Calculando pedido para semana 14 (157 registros)
2026-02-03 15:57:02 - INFO -   Objetivo: 1798.25€, Actual (ABC): 1679.26€
2026-02-03 15:57:02 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 15:57:02 - INFO -   Factor total: 1.3125
2026-02-03 15:57:02 - INFO -   Factor escalado: 1.4055
2026-02-03 15:57:02 - INFO -   Ventas preliminares (con ceil): 2784.94€
2026-02-03 15:57:02 - INFO -   Objetivo final: 2360.20€
2026-02-03 15:57:02 - INFO -   Delta: 424.74€
2026-02-03 15:57:02 - INFO -   Ventas finales: 2365.92€
2026-02-03 15:57:02 - INFO - 
============================================================
2026-02-03 15:57:02 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 15:57:02 - INFO - ============================================================
2026-02-03 15:57:02 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 15:57:02 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 15:57:02 - INFO - DataLoader inicializado correctamente
2026-02-03 15:57:02 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 15:57:02 - INFO - ============================================================
2026-02-03 15:57:02 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 15:57:02 - INFO - ============================================================
2026-02-03 15:57:02 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 15:57:02 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 15:57:02 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:57:02 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:57:02 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 15:57:02 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:57:02 - INFO - Stock actual cargado: 30 registros
2026-02-03 15:57:02 - INFO -   Stock: 30 registros
2026-02-03 15:57:02 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 15:57:02 - INFO - Fusión completada: 84 registros
2026-02-03 15:57:02 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 15:57:02 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 15:57:03 - INFO - Corrección completada:
2026-02-03 15:57:03 - INFO -   - Artículos corregidos: 82/84
2026-02-03 15:57:03 - INFO -   - Artículos aumentados: 82
2026-02-03 15:57:03 - INFO -   - Artículos reducidos: 0
2026-02-03 15:57:03 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 15:57:03 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 15:57:03 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 15:57:03 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_fitos.xlsx
2026-02-03 15:57:03 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_fitos.xlsx
2026-02-03 15:57:03 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_fitos.xlsx
2026-02-03 15:57:03 - INFO -   Articulos: 82
2026-02-03 15:57:03 - INFO -   Importe: 2365.92€
2026-02-03 15:57:03 - INFO - 
==================================================
2026-02-03 15:57:03 - INFO - SECCION: VIVERO
2026-02-03 15:57:03 - INFO - ==================================================
2026-02-03 15:57:03 - INFO - === LEYENDO DATOS PARA SECCIÓN: VIVERO ===
2026-02-03 15:57:03 - INFO - Archivo ABC encontrado para 'vivero': .\./data/input\CLASIFICACION_ABC+D_vivero.xlsx
2026-02-03 15:57:03 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_vivero.xlsx
2026-02-03 15:57:03 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 15:57:03 - INFO - Clasificación ABC cargada para 'vivero': 565 registros
2026-02-03 15:57:03 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 15:57:06 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:57:06 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 15:57:07 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 15:57:07 - INFO - Ventas cargadas: 44082 registros
2026-02-03 15:57:07 - INFO - Filtrados 2460 registros de sección 'vivero' de 44082 total
2026-02-03 15:57:07 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 15:57:09 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:57:09 - INFO - Costes cargados: 22145 registros
2026-02-03 15:57:09 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA VIVERO ===
2026-02-03 15:57:09 - INFO -   ABC: 565 registros
2026-02-03 15:57:09 - INFO -   Ventas: 2460 registros
2026-02-03 15:57:09 - INFO -   Costes: 22145 registros
2026-02-03 15:57:09 - INFO - Datos de ventas: 189 registros
2026-02-03 15:57:09 - INFO - Calculando pedido para semana 14 (189 registros)
2026-02-03 15:57:09 - INFO -   Objetivo: 5297.17€, Actual (ABC): 4113.14€
2026-02-03 15:57:09 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 15:57:09 - INFO -   Factor total: 1.3125
2026-02-03 15:57:09 - INFO -   Factor escalado: 1.6903
2026-02-03 15:57:09 - INFO -   Ventas preliminares (con ceil): 8761.94€
2026-02-03 15:57:09 - INFO -   Objetivo final: 6952.54€
2026-02-03 15:57:09 - INFO -   Delta: 1809.40€
2026-02-03 15:57:09 - INFO -   Ventas finales: 6990.51€
2026-02-03 15:57:09 - INFO - 
============================================================
2026-02-03 15:57:09 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 15:57:09 - INFO - ============================================================
2026-02-03 15:57:09 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 15:57:09 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 15:57:09 - INFO - DataLoader inicializado correctamente
2026-02-03 15:57:09 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 15:57:09 - INFO - ============================================================
2026-02-03 15:57:09 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 15:57:09 - INFO - ============================================================
2026-02-03 15:57:09 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 15:57:09 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 15:57:09 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:57:09 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:57:09 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 15:57:09 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:57:09 - INFO - Stock actual cargado: 30 registros
2026-02-03 15:57:09 - INFO -   Stock: 30 registros
2026-02-03 15:57:09 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 15:57:09 - INFO - Fusión completada: 107 registros
2026-02-03 15:57:09 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 15:57:09 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 15:57:09 - INFO - Corrección completada:
2026-02-03 15:57:09 - INFO -   - Artículos corregidos: 96/107
2026-02-03 15:57:09 - INFO -   - Artículos aumentados: 96
2026-02-03 15:57:09 - INFO -   - Artículos reducidos: 0
2026-02-03 15:57:09 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 15:57:09 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 15:57:09 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 15:57:09 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_vivero.xlsx
2026-02-03 15:57:09 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_vivero.xlsx
2026-02-03 15:57:09 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_vivero.xlsx
2026-02-03 15:57:09 - INFO -   Articulos: 96
2026-02-03 15:57:09 - INFO -   Importe: 6990.51€
2026-02-03 15:57:09 - INFO - 
==================================================
2026-02-03 15:57:09 - INFO - SECCION: UTILES_JARDIN
2026-02-03 15:57:09 - INFO - ==================================================
2026-02-03 15:57:09 - INFO - === LEYENDO DATOS PARA SECCIÓN: UTILES_JARDIN ===
2026-02-03 15:57:09 - INFO - Archivo ABC encontrado para 'utiles_jardin': .\./data/input\CLASIFICACION_ABC+D_utiles_jardin.xlsx
2026-02-03 15:57:09 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_utiles_jardin.xlsx
2026-02-03 15:57:09 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 15:57:09 - INFO - Clasificación ABC cargada para 'utiles_jardin': 433 registros
2026-02-03 15:57:09 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 15:57:13 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:57:13 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 15:57:13 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 15:57:13 - INFO - Ventas cargadas: 44082 registros
2026-02-03 15:57:13 - INFO - Filtrados 1009 registros de sección 'utiles_jardin' de 44082 total
2026-02-03 15:57:13 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 15:57:15 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:57:15 - INFO - Costes cargados: 22145 registros
2026-02-03 15:57:15 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA UTILES_JARDIN ===
2026-02-03 15:57:15 - INFO -   ABC: 433 registros
2026-02-03 15:57:15 - INFO -   Ventas: 1009 registros
2026-02-03 15:57:15 - INFO -   Costes: 22145 registros
2026-02-03 15:57:15 - INFO - Datos de ventas: 89 registros
2026-02-03 15:57:15 - INFO - Calculando pedido para semana 14 (89 registros)
2026-02-03 15:57:15 - INFO -   Objetivo: 1044.77€, Actual (ABC): 818.79€
2026-02-03 15:57:15 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 15:57:15 - INFO -   Factor total: 1.3125
2026-02-03 15:57:15 - INFO -   Factor escalado: 1.6747
2026-02-03 15:57:15 - INFO -   Ventas preliminares (con ceil): 1929.56€
2026-02-03 15:57:15 - INFO -   Objetivo final: 1371.26€
2026-02-03 15:57:15 - INFO -   Delta: 558.30€
2026-02-03 15:57:16 - INFO -   Ventas finales: 1390.00€
2026-02-03 15:57:16 - INFO - 
============================================================
2026-02-03 15:57:16 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 15:57:16 - INFO - ============================================================
2026-02-03 15:57:16 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 15:57:16 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 15:57:16 - INFO - DataLoader inicializado correctamente
2026-02-03 15:57:16 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 15:57:16 - INFO - ============================================================
2026-02-03 15:57:16 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 15:57:16 - INFO - ============================================================
2026-02-03 15:57:16 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 15:57:16 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 15:57:16 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:57:16 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:57:16 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 15:57:16 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:57:16 - INFO - Stock actual cargado: 30 registros
2026-02-03 15:57:16 - INFO -   Stock: 30 registros
2026-02-03 15:57:16 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 15:57:16 - INFO - Fusión completada: 78 registros
2026-02-03 15:57:16 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 15:57:16 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 15:57:16 - INFO - Corrección completada:
2026-02-03 15:57:16 - INFO -   - Artículos corregidos: 78/78
2026-02-03 15:57:16 - INFO -   - Artículos aumentados: 78
2026-02-03 15:57:16 - INFO -   - Artículos reducidos: 0
2026-02-03 15:57:16 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 15:57:16 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 15:57:16 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 15:57:16 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx
2026-02-03 15:57:16 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx
2026-02-03 15:57:16 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx
2026-02-03 15:57:16 - INFO -   Articulos: 78
2026-02-03 15:57:16 - INFO -   Importe: 1390.00€
2026-02-03 15:57:16 - INFO - 
==================================================
2026-02-03 15:57:16 - INFO - SECCION: TIERRAS_ARIDOS
2026-02-03 15:57:16 - INFO - ==================================================
2026-02-03 15:57:16 - INFO - === LEYENDO DATOS PARA SECCIÓN: TIERRAS_ARIDOS ===
2026-02-03 15:57:16 - WARNING - No se encontró archivo específico para 'tierras_aridos', usando: .\./data/input\CLASIFICACION_ABC+D_DECO_EXTERIOR.xlsx
2026-02-03 15:57:16 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_DECO_EXTERIOR.xlsx
2026-02-03 15:57:16 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 15:57:16 - INFO - Clasificación ABC cargada para 'tierras_aridos': 995 registros
2026-02-03 15:57:16 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 15:57:20 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:57:20 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 15:57:20 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 15:57:20 - INFO - Ventas cargadas: 44082 registros
2026-02-03 15:57:20 - INFO - Filtrados 3264 registros de sección 'tierras_aridos' de 44082 total
2026-02-03 15:57:20 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 15:57:22 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:57:22 - INFO - Costes cargados: 22145 registros
2026-02-03 15:57:22 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA TIERRAS_ARIDOS ===
2026-02-03 15:57:22 - INFO -   ABC: 995 registros
2026-02-03 15:57:22 - INFO -   Ventas: 3264 registros
2026-02-03 15:57:22 - INFO -   Costes: 22145 registros
2026-02-03 15:57:22 - INFO - Datos de ventas: 302 registros
2026-02-03 15:57:22 - INFO - Calculando pedido para semana 14 (302 registros)
2026-02-03 15:57:22 - INFO -   Objetivo: 4097.24€, Actual (ABC): 4019.19€
2026-02-03 15:57:22 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 15:57:22 - INFO -   Factor total: 1.3125
2026-02-03 15:57:22 - INFO -   Factor escalado: 1.3380
2026-02-03 15:57:22 - INFO -   Ventas preliminares (con ceil): 5809.66€
2026-02-03 15:57:22 - INFO -   Objetivo final: 5377.63€
2026-02-03 15:57:22 - INFO -   Delta: 432.03€
2026-02-03 15:57:22 - INFO -   Ventas finales: 5387.14€
2026-02-03 15:57:22 - INFO - 
============================================================
2026-02-03 15:57:22 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 15:57:22 - INFO - ============================================================
2026-02-03 15:57:22 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 15:57:22 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 15:57:22 - INFO - DataLoader inicializado correctamente
2026-02-03 15:57:22 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 15:57:22 - INFO - ============================================================
2026-02-03 15:57:22 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 15:57:22 - INFO - ============================================================
2026-02-03 15:57:22 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 15:57:22 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 15:57:22 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:57:22 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:57:22 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 15:57:22 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:57:22 - INFO - Stock actual cargado: 30 registros
2026-02-03 15:57:22 - INFO -   Stock: 30 registros
2026-02-03 15:57:22 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 15:57:22 - INFO - Fusión completada: 72 registros
2026-02-03 15:57:22 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 15:57:22 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 15:57:22 - INFO - Corrección completada:
2026-02-03 15:57:22 - INFO -   - Artículos corregidos: 71/72
2026-02-03 15:57:22 - INFO -   - Artículos aumentados: 71
2026-02-03 15:57:22 - INFO -   - Artículos reducidos: 0
2026-02-03 15:57:22 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 15:57:22 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 15:57:22 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 15:57:22 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx
2026-02-03 15:57:22 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx
2026-02-03 15:57:22 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx
2026-02-03 15:57:22 - INFO -   Articulos: 71
2026-02-03 15:57:22 - INFO -   Importe: 5387.14€
2026-02-03 15:57:22 - INFO - 
==================================================
2026-02-03 15:57:22 - INFO - SECCION: DECO_EXTERIOR
2026-02-03 15:57:22 - INFO - ==================================================
2026-02-03 15:57:22 - INFO - === LEYENDO DATOS PARA SECCIÓN: DECO_EXTERIOR ===
2026-02-03 15:57:22 - INFO - Archivo ABC encontrado para 'deco_exterior': .\./data/input\CLASIFICACION_ABC+D_deco_exterior.xlsx
2026-02-03 15:57:22 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_deco_exterior.xlsx
2026-02-03 15:57:22 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 15:57:23 - INFO - Clasificación ABC cargada para 'deco_exterior': 995 registros
2026-02-03 15:57:23 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 15:57:26 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:57:26 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 15:57:26 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 15:57:26 - INFO - Ventas cargadas: 44082 registros
2026-02-03 15:57:27 - INFO - Filtrados 4018 registros de sección 'deco_exterior' de 44082 total
2026-02-03 15:57:27 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 15:57:28 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:57:29 - INFO - Costes cargados: 22145 registros
2026-02-03 15:57:29 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA DECO_EXTERIOR ===
2026-02-03 15:57:29 - INFO -   ABC: 995 registros
2026-02-03 15:57:29 - INFO -   Ventas: 4018 registros
2026-02-03 15:57:29 - INFO -   Costes: 22145 registros
2026-02-03 15:57:29 - INFO - Datos de ventas: 316 registros
2026-02-03 15:57:29 - INFO - Calculando pedido para semana 14 (316 registros)
2026-02-03 15:57:29 - INFO -   Objetivo: 3740.34€, Actual (ABC): 4104.66€
2026-02-03 15:57:29 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 15:57:29 - INFO -   Factor total: 1.3125
2026-02-03 15:57:29 - INFO -   Factor escalado: 1.1960
2026-02-03 15:57:29 - INFO -   Ventas preliminares (con ceil): 6094.59€
2026-02-03 15:57:29 - INFO -   Objetivo final: 4909.20€
2026-02-03 15:57:29 - INFO -   Delta: 1185.39€
2026-02-03 15:57:29 - INFO -   Ventas finales: 4923.89€
2026-02-03 15:57:29 - INFO - 
============================================================
2026-02-03 15:57:29 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 15:57:29 - INFO - ============================================================
2026-02-03 15:57:29 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 15:57:29 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 15:57:29 - INFO - DataLoader inicializado correctamente
2026-02-03 15:57:29 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 15:57:29 - INFO - ============================================================
2026-02-03 15:57:29 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 15:57:29 - INFO - ============================================================
2026-02-03 15:57:29 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 15:57:29 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 15:57:29 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:57:29 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:57:29 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 15:57:29 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:57:29 - INFO - Stock actual cargado: 30 registros
2026-02-03 15:57:29 - INFO -   Stock: 30 registros
2026-02-03 15:57:29 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 15:57:29 - INFO - Fusión completada: 224 registros
2026-02-03 15:57:29 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 15:57:29 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 15:57:29 - INFO - Corrección completada:
2026-02-03 15:57:29 - INFO -   - Artículos corregidos: 205/224
2026-02-03 15:57:29 - INFO -   - Artículos aumentados: 205
2026-02-03 15:57:29 - INFO -   - Artículos reducidos: 0
2026-02-03 15:57:29 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 15:57:29 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 15:57:29 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 15:57:29 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_deco_exterior.xlsx
2026-02-03 15:57:29 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_deco_exterior.xlsx
2026-02-03 15:57:29 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_deco_exterior.xlsx
2026-02-03 15:57:29 - INFO -   Articulos: 205
2026-02-03 15:57:29 - INFO -   Importe: 4923.89€
2026-02-03 15:57:29 - INFO - Estado guardado correctamente
2026-02-03 15:57:29 - INFO - Generando resumen: .\./data/output\Resumen_Pedidos_VIVERO_2026-02-03.xlsx
2026-02-03 15:57:29 - INFO - Resumen guardado: .\./data/output\Resumen_Pedidos_VIVERO_2026-02-03.xlsx
2026-02-03 15:57:29 - INFO - Estado guardado correctamente
2026-02-03 15:57:29 - INFO - 
============================================================
2026-02-03 15:57:29 - INFO - PREPARANDO ENVÍO DE EMAILS
2026-02-03 15:57:29 - INFO - ============================================================
2026-02-03 15:57:29 - INFO - 
============================================================
2026-02-03 15:57:29 - INFO - ENVÍO DE EMAILS A RESPONSABLES
2026-02-03 15:57:29 - INFO - ============================================================
2026-02-03 15:57:29 - INFO - EmailService inicializado correctamente
2026-02-03 15:57:29 - INFO - 
Enviando email para sección: maf
2026-02-03 15:57:29 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_maf.xlsx']
2026-02-03 15:57:29 - INFO - ============================================================
2026-02-03 15:57:29 - INFO - ENVIANDO EMAIL PARA SECCIÓN: MAF
2026-02-03 15:57:29 - INFO - ============================================================
2026-02-03 15:57:29 - ERROR - Error al enviar emails: name 'destinatorios_config' is not defined
2026-02-03 15:57:29 - ERROR - Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 445, in enviar_emails_pedidos
    resultado = email_service.enviar_pedido_por_seccion(
        semana=semana,
        seccion=seccion,
        archivos=archivos
    )
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\email_service.py", line 331, in enviar_pedido_por_seccion
    destinatarios_info = self.obtener_destinatarios_seccion(seccion)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\email_service.py", line 297, in obtener_destinatarios_seccion
    for dest in destinatorios_config:
                ^^^^^^^^^^^^^^^^^^^^
NameError: name 'destinatorios_config' is not defined. Did you mean: 'destinatarios_config'?

2026-02-03 15:57:29 - INFO - 
======================================================================
2026-02-03 15:57:29 - INFO - RESUMEN DE EJECUCION
2026-02-03 15:57:29 - INFO - ======================================================================
2026-02-03 15:57:29 - INFO - Semana procesada: 14
2026-02-03 15:57:29 - INFO - Archivos generados: 12
2026-02-03 15:57:29 - INFO - Total articulos: 1510
2026-02-03 15:57:29 - INFO - Total importe: 48113.87€
2026-02-03 15:57:29 - INFO - ======================================================================
2026-02-03 15:57:29 - INFO - 
¡PEDIDO GENERADO EXITOSAMENTE!
2026-02-03 15:57:29 - INFO - Archivo principal: .\./data/output\Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 15:57:29 - INFO - Artículos: 1510
2026-02-03 15:57:29 - INFO - Importe: 48113.87€
2026-02-03 15:59:22 - INFO - ======================================================================
2026-02-03 15:59:22 - INFO - SISTEMA DE PEDIDOS DE COMPRA - VIVERO ARANJUEZ V2
2026-02-03 15:59:22 - INFO - Fecha de ejecución: 2026-02-03 15:59:22
2026-02-03 15:59:22 - INFO - ======================================================================
2026-02-03 15:59:22 - INFO - Modo de ejecución: FASE 1 + FASE 2
2026-02-03 15:59:22 - INFO - Envío de emails: Sí
2026-02-03 15:59:22 - INFO - StateManager inicializado. Archivo de estado: .\./data\state.json
2026-02-03 15:59:22 - INFO - Cargando estado desde: .\./data\state.json
2026-02-03 15:59:22 - INFO - Estado cargado correctamente
2026-02-03 15:59:22 - INFO - SchedulerService inicializado correctamente
2026-02-03 15:59:22 - INFO - Horario configurado: sunday a las 15:00
2026-02-03 15:59:22 - INFO - Semana forzada por argumento: 14
2026-02-03 15:59:22 - INFO - ======================================================================
2026-02-03 15:59:22 - INFO - PROCESANDO PEDIDO PARA SEMANA 14
2026-02-03 15:59:22 - INFO - ======================================================================
2026-02-03 15:59:22 - INFO - MODO: FASE 1 (Forecast) + FASE 2 (Corrección)
2026-02-03 15:59:22 - INFO - DataLoader inicializado correctamente
2026-02-03 15:59:22 - INFO - ForecastEngine inicializado correctamente
2026-02-03 15:59:22 - INFO - OrderGenerator inicializado correctamente
2026-02-03 15:59:22 - INFO - SchedulerService inicializado correctamente
2026-02-03 15:59:22 - INFO - Horario configurado: sunday a las 15:00
2026-02-03 15:59:22 - INFO - Período de la semana: 2026-03-30 al 2026-04-05
2026-02-03 15:59:22 - INFO - Stock acumulado cargado: 2633 artículos
2026-02-03 15:59:22 - INFO - 
==================================================
2026-02-03 15:59:22 - INFO - SECCION: MAF
2026-02-03 15:59:22 - INFO - ==================================================
2026-02-03 15:59:22 - INFO - === LEYENDO DATOS PARA SECCIÓN: MAF ===
2026-02-03 15:59:22 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 15:59:22 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: maf
2026-02-03 15:59:22 - INFO - Archivo ABC encontrado para 'maf': .\./data/input\CLASIFICACION_ABC+D_maf.xlsx
2026-02-03 15:59:22 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_maf.xlsx
2026-02-03 15:59:22 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 15:59:22 - INFO - Clasificación ABC cargada para 'maf': 499 registros
2026-02-03 15:59:22 - DEBUG - [DEBUG] ABC leído: 499 registros
2026-02-03 15:59:22 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 15:59:22 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 15:59:22 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 15:59:25 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:59:25 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 15:59:25 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 15:59:25 - INFO - Ventas cargadas: 44082 registros
2026-02-03 15:59:25 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 15:59:25 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 15:59:25 - DEBUG - [DEBUG] Filtrando ventas por sección: maf
2026-02-03 15:59:26 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 15:59:26 - DEBUG -   maf: 10970 registros
2026-02-03 15:59:26 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 15:59:26 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 15:59:26 - DEBUG -   interior: 3624 registros
2026-02-03 15:59:26 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 15:59:26 - DEBUG -   deco_interior: 2468 registros
2026-02-03 15:59:26 - DEBUG -   vivero: 2460 registros
2026-02-03 15:59:26 - DEBUG -   fitos: 1987 registros
2026-02-03 15:59:26 - DEBUG -   semillas: 1180 registros
2026-02-03 15:59:26 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 15:59:26 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 15:59:26 - DEBUG - [DEBUG] Tras filtrar por 'maf': 10970 registros
2026-02-03 15:59:26 - INFO - Filtrados 10970 registros de sección 'maf' de 44082 total
2026-02-03 15:59:26 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 15:59:26 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 15:59:27 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:59:27 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 15:59:27 - INFO - Costes cargados: 22145 registros
2026-02-03 15:59:27 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 15:59:27 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 15:59:27 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MAF ===
2026-02-03 15:59:27 - INFO -   ABC: 499 registros
2026-02-03 15:59:27 - INFO -   Ventas: 10970 registros
2026-02-03 15:59:27 - INFO -   Costes: 22145 registros
2026-02-03 15:59:27 - DEBUG - [DEBUG] abc_df: 499 registros
2026-02-03 15:59:27 - DEBUG - [DEBUG] ventas_df: 10970 registros
2026-02-03 15:59:27 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 15:59:28 - INFO - Datos de ventas: 1011 registros
2026-02-03 15:59:28 - INFO - Calculando pedido para semana 14 (1011 registros)
2026-02-03 15:59:28 - INFO -   Objetivo: 7050.65€, Actual (ABC): 5843.77€
2026-02-03 15:59:28 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 15:59:28 - INFO -   Factor total: 1.3125
2026-02-03 15:59:28 - INFO -   Factor escalado: 1.5836
2026-02-03 15:59:28 - INFO -   Ventas preliminares (con ceil): 9931.01€
2026-02-03 15:59:28 - INFO -   Objetivo final: 9253.98€
2026-02-03 15:59:28 - INFO -   Delta: 677.03€
2026-02-03 15:59:28 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 15:59:28 - DEBUG -   Total registros: 222
2026-02-03 15:59:28 - DEBUG -   Registros con Unidades_Finales > 0: 191
2026-02-03 15:59:28 - DEBUG -   Ventas finales: 9259.59€
2026-02-03 15:59:28 - INFO -   Ventas finales: 9259.59€
2026-02-03 15:59:28 - INFO - 
============================================================
2026-02-03 15:59:28 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 15:59:28 - INFO - ============================================================
2026-02-03 15:59:28 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 15:59:28 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 15:59:28 - INFO - DataLoader inicializado correctamente
2026-02-03 15:59:28 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 15:59:28 - INFO - ============================================================
2026-02-03 15:59:28 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 15:59:28 - INFO - ============================================================
2026-02-03 15:59:28 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 15:59:28 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 15:59:28 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:59:28 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:59:28 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 15:59:28 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:59:28 - DEBUG - Usando hoja: Stock
2026-02-03 15:59:28 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 15:59:28 - INFO - Stock actual cargado: 30 registros
2026-02-03 15:59:28 - INFO -   Stock: 30 registros
2026-02-03 15:59:28 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 15:59:28 - INFO - Fusión completada: 222 registros
2026-02-03 15:59:28 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 15:59:28 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 15:59:28 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 15:59:28 - INFO - Corrección completada:
2026-02-03 15:59:28 - INFO -   - Artículos corregidos: 191/222
2026-02-03 15:59:28 - INFO -   - Artículos aumentados: 191
2026-02-03 15:59:28 - INFO -   - Artículos reducidos: 0
2026-02-03 15:59:28 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 15:59:28 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 15:59:28 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 15:59:28 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 222 registros
2026-02-03 15:59:28 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 15:59:28 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 15:59:28 - DEBUG -   Con valor 0: 31
2026-02-03 15:59:28 - DEBUG -   Con valor > 0: 191
2026-02-03 15:59:28 - DEBUG -   Suma Ventas_Objetivo: 9259.59€
2026-02-03 15:59:28 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 191 registros
2026-02-03 15:59:28 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 15:59:28 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 15:59:28 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 15:59:28 - INFO -   Articulos: 191
2026-02-03 15:59:28 - INFO -   Importe: 9259.59€
2026-02-03 15:59:28 - INFO - 
==================================================
2026-02-03 15:59:28 - INFO - SECCION: DECO_INTERIOR
2026-02-03 15:59:28 - INFO - ==================================================
2026-02-03 15:59:28 - INFO - === LEYENDO DATOS PARA SECCIÓN: DECO_INTERIOR ===
2026-02-03 15:59:28 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 15:59:28 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: deco_interior
2026-02-03 15:59:28 - INFO - Archivo ABC encontrado para 'deco_interior': .\./data/input\CLASIFICACION_ABC+D_deco_interior.xlsx
2026-02-03 15:59:28 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_deco_interior.xlsx
2026-02-03 15:59:29 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 15:59:29 - INFO - Clasificación ABC cargada para 'deco_interior': 1827 registros
2026-02-03 15:59:29 - DEBUG - [DEBUG] ABC leído: 1827 registros
2026-02-03 15:59:29 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 15:59:29 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 15:59:29 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 15:59:32 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:59:32 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 15:59:32 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 15:59:32 - INFO - Ventas cargadas: 44082 registros
2026-02-03 15:59:32 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 15:59:32 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 15:59:32 - DEBUG - [DEBUG] Filtrando ventas por sección: deco_interior
2026-02-03 15:59:32 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 15:59:32 - DEBUG -   maf: 10970 registros
2026-02-03 15:59:32 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 15:59:32 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 15:59:32 - DEBUG -   interior: 3624 registros
2026-02-03 15:59:32 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 15:59:32 - DEBUG -   deco_interior: 2468 registros
2026-02-03 15:59:32 - DEBUG -   vivero: 2460 registros
2026-02-03 15:59:32 - DEBUG -   fitos: 1987 registros
2026-02-03 15:59:32 - DEBUG -   semillas: 1180 registros
2026-02-03 15:59:32 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 15:59:32 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 15:59:33 - DEBUG - [DEBUG] Tras filtrar por 'deco_interior': 2468 registros
2026-02-03 15:59:33 - INFO - Filtrados 2468 registros de sección 'deco_interior' de 44082 total
2026-02-03 15:59:33 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 15:59:33 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 15:59:34 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:59:34 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 15:59:34 - INFO - Costes cargados: 22145 registros
2026-02-03 15:59:34 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 15:59:34 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 15:59:34 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA DECO_INTERIOR ===
2026-02-03 15:59:34 - INFO -   ABC: 1827 registros
2026-02-03 15:59:34 - INFO -   Ventas: 2468 registros
2026-02-03 15:59:34 - INFO -   Costes: 22145 registros
2026-02-03 15:59:34 - DEBUG - [DEBUG] abc_df: 1827 registros
2026-02-03 15:59:34 - DEBUG - [DEBUG] ventas_df: 2468 registros
2026-02-03 15:59:34 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 15:59:35 - INFO - Datos de ventas: 180 registros
2026-02-03 15:59:35 - INFO - Calculando pedido para semana 14 (180 registros)
2026-02-03 15:59:35 - INFO -   Objetivo: 1962.99€, Actual (ABC): 1636.15€
2026-02-03 15:59:35 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 15:59:35 - INFO -   Factor total: 1.3125
2026-02-03 15:59:35 - INFO -   Factor escalado: 1.5747
2026-02-03 15:59:35 - INFO -   Ventas preliminares (con ceil): 2950.01€
2026-02-03 15:59:35 - INFO -   Objetivo final: 2576.42€
2026-02-03 15:59:35 - INFO -   Delta: 373.59€
2026-02-03 15:59:35 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 15:59:35 - DEBUG -   Total registros: 139
2026-02-03 15:59:35 - DEBUG -   Registros con Unidades_Finales > 0: 135
2026-02-03 15:59:35 - DEBUG -   Ventas finales: 2580.73€
2026-02-03 15:59:35 - INFO -   Ventas finales: 2580.73€
2026-02-03 15:59:35 - INFO - 
============================================================
2026-02-03 15:59:35 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 15:59:35 - INFO - ============================================================
2026-02-03 15:59:35 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 15:59:35 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 15:59:35 - INFO - DataLoader inicializado correctamente
2026-02-03 15:59:35 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 15:59:35 - INFO - ============================================================
2026-02-03 15:59:35 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 15:59:35 - INFO - ============================================================
2026-02-03 15:59:35 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 15:59:35 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 15:59:35 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:59:35 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:59:35 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 15:59:35 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:59:35 - DEBUG - Usando hoja: Stock
2026-02-03 15:59:35 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 15:59:35 - INFO - Stock actual cargado: 30 registros
2026-02-03 15:59:35 - INFO -   Stock: 30 registros
2026-02-03 15:59:35 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 15:59:35 - INFO - Fusión completada: 139 registros
2026-02-03 15:59:35 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 15:59:35 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 15:59:35 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 15:59:35 - INFO - Corrección completada:
2026-02-03 15:59:35 - INFO -   - Artículos corregidos: 135/139
2026-02-03 15:59:35 - INFO -   - Artículos aumentados: 135
2026-02-03 15:59:35 - INFO -   - Artículos reducidos: 0
2026-02-03 15:59:35 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 15:59:35 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 15:59:35 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 15:59:35 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 139 registros
2026-02-03 15:59:35 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 15:59:35 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 15:59:35 - DEBUG -   Con valor 0: 4
2026-02-03 15:59:35 - DEBUG -   Con valor > 0: 135
2026-02-03 15:59:35 - DEBUG -   Suma Ventas_Objetivo: 2580.73€
2026-02-03 15:59:35 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 135 registros
2026-02-03 15:59:35 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_deco_interior.xlsx
2026-02-03 15:59:35 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_deco_interior.xlsx
2026-02-03 15:59:35 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_deco_interior.xlsx
2026-02-03 15:59:35 - INFO -   Articulos: 135
2026-02-03 15:59:35 - INFO -   Importe: 2580.73€
2026-02-03 15:59:35 - INFO - 
==================================================
2026-02-03 15:59:35 - INFO - SECCION: SEMILLAS
2026-02-03 15:59:35 - INFO - ==================================================
2026-02-03 15:59:35 - INFO - === LEYENDO DATOS PARA SECCIÓN: SEMILLAS ===
2026-02-03 15:59:35 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 15:59:35 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: semillas
2026-02-03 15:59:35 - INFO - Archivo ABC encontrado para 'semillas': .\./data/input\CLASIFICACION_ABC+D_semillas.xlsx
2026-02-03 15:59:35 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_semillas.xlsx
2026-02-03 15:59:35 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 15:59:35 - INFO - Clasificación ABC cargada para 'semillas': 218 registros
2026-02-03 15:59:35 - DEBUG - [DEBUG] ABC leído: 218 registros
2026-02-03 15:59:35 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 15:59:35 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 15:59:35 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 15:59:39 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:59:39 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 15:59:39 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 15:59:39 - INFO - Ventas cargadas: 44082 registros
2026-02-03 15:59:39 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 15:59:39 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 15:59:39 - DEBUG - [DEBUG] Filtrando ventas por sección: semillas
2026-02-03 15:59:39 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 15:59:39 - DEBUG -   maf: 10970 registros
2026-02-03 15:59:39 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 15:59:39 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 15:59:39 - DEBUG -   interior: 3624 registros
2026-02-03 15:59:39 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 15:59:39 - DEBUG -   deco_interior: 2468 registros
2026-02-03 15:59:39 - DEBUG -   vivero: 2460 registros
2026-02-03 15:59:39 - DEBUG -   fitos: 1987 registros
2026-02-03 15:59:39 - DEBUG -   semillas: 1180 registros
2026-02-03 15:59:39 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 15:59:39 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 15:59:39 - DEBUG - [DEBUG] Tras filtrar por 'semillas': 1180 registros
2026-02-03 15:59:39 - INFO - Filtrados 1180 registros de sección 'semillas' de 44082 total
2026-02-03 15:59:39 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 15:59:39 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 15:59:41 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:59:41 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 15:59:41 - INFO - Costes cargados: 22145 registros
2026-02-03 15:59:41 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 15:59:41 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 15:59:41 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA SEMILLAS ===
2026-02-03 15:59:41 - INFO -   ABC: 218 registros
2026-02-03 15:59:41 - INFO -   Ventas: 1180 registros
2026-02-03 15:59:41 - INFO -   Costes: 22145 registros
2026-02-03 15:59:41 - DEBUG - [DEBUG] abc_df: 218 registros
2026-02-03 15:59:41 - DEBUG - [DEBUG] ventas_df: 1180 registros
2026-02-03 15:59:41 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 15:59:41 - INFO - Datos de ventas: 136 registros
2026-02-03 15:59:41 - INFO - Calculando pedido para semana 14 (136 registros)
2026-02-03 15:59:41 - INFO -   Objetivo: 694.34€, Actual (ABC): 455.14€
2026-02-03 15:59:41 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 15:59:41 - INFO -   Factor total: 1.3125
2026-02-03 15:59:41 - INFO -   Factor escalado: 2.0023
2026-02-03 15:59:41 - INFO -   Ventas preliminares (con ceil): 1129.15€
2026-02-03 15:59:41 - INFO -   Objetivo final: 911.32€
2026-02-03 15:59:41 - INFO -   Delta: 217.83€
2026-02-03 15:59:41 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 15:59:41 - DEBUG -   Total registros: 84
2026-02-03 15:59:41 - DEBUG -   Registros con Unidades_Finales > 0: 84
2026-02-03 15:59:41 - DEBUG -   Ventas finales: 911.60€
2026-02-03 15:59:41 - INFO -   Ventas finales: 911.60€
2026-02-03 15:59:41 - INFO - 
============================================================
2026-02-03 15:59:41 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 15:59:41 - INFO - ============================================================
2026-02-03 15:59:41 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 15:59:41 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 15:59:41 - INFO - DataLoader inicializado correctamente
2026-02-03 15:59:41 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 15:59:41 - INFO - ============================================================
2026-02-03 15:59:41 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 15:59:41 - INFO - ============================================================
2026-02-03 15:59:41 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 15:59:41 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 15:59:41 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:59:41 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:59:41 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 15:59:41 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:59:41 - DEBUG - Usando hoja: Stock
2026-02-03 15:59:41 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 15:59:41 - INFO - Stock actual cargado: 30 registros
2026-02-03 15:59:41 - INFO -   Stock: 30 registros
2026-02-03 15:59:41 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 15:59:41 - INFO - Fusión completada: 84 registros
2026-02-03 15:59:41 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 15:59:41 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 15:59:41 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 15:59:41 - INFO - Corrección completada:
2026-02-03 15:59:41 - INFO -   - Artículos corregidos: 84/84
2026-02-03 15:59:41 - INFO -   - Artículos aumentados: 84
2026-02-03 15:59:41 - INFO -   - Artículos reducidos: 0
2026-02-03 15:59:41 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 15:59:41 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 15:59:41 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 15:59:41 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 84 registros
2026-02-03 15:59:41 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 15:59:41 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 15:59:41 - DEBUG -   Con valor 0: 0
2026-02-03 15:59:41 - DEBUG -   Con valor > 0: 84
2026-02-03 15:59:41 - DEBUG -   Suma Ventas_Objetivo: 911.60€
2026-02-03 15:59:41 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 84 registros
2026-02-03 15:59:41 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_semillas.xlsx
2026-02-03 15:59:42 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_semillas.xlsx
2026-02-03 15:59:42 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_semillas.xlsx
2026-02-03 15:59:42 - INFO -   Articulos: 84
2026-02-03 15:59:42 - INFO -   Importe: 911.60€
2026-02-03 15:59:42 - INFO - 
==================================================
2026-02-03 15:59:42 - INFO - SECCION: MASCOTAS_VIVO
2026-02-03 15:59:42 - INFO - ==================================================
2026-02-03 15:59:42 - INFO - === LEYENDO DATOS PARA SECCIÓN: MASCOTAS_VIVO ===
2026-02-03 15:59:42 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 15:59:42 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: mascotas_vivo
2026-02-03 15:59:42 - INFO - Archivo ABC encontrado para 'mascotas_vivo': .\./data/input\CLASIFICACION_ABC+D_mascotas_vivo.xlsx
2026-02-03 15:59:42 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_mascotas_vivo.xlsx
2026-02-03 15:59:42 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 15:59:42 - INFO - Clasificación ABC cargada para 'mascotas_vivo': 205 registros
2026-02-03 15:59:42 - DEBUG - [DEBUG] ABC leído: 205 registros
2026-02-03 15:59:42 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 15:59:42 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 15:59:42 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 15:59:45 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:59:45 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 15:59:45 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 15:59:45 - INFO - Ventas cargadas: 44082 registros
2026-02-03 15:59:45 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 15:59:45 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 15:59:45 - DEBUG - [DEBUG] Filtrando ventas por sección: mascotas_vivo
2026-02-03 15:59:45 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 15:59:45 - DEBUG -   maf: 10970 registros
2026-02-03 15:59:45 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 15:59:45 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 15:59:45 - DEBUG -   interior: 3624 registros
2026-02-03 15:59:45 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 15:59:45 - DEBUG -   deco_interior: 2468 registros
2026-02-03 15:59:45 - DEBUG -   vivero: 2460 registros
2026-02-03 15:59:45 - DEBUG -   fitos: 1987 registros
2026-02-03 15:59:45 - DEBUG -   semillas: 1180 registros
2026-02-03 15:59:45 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 15:59:45 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 15:59:46 - DEBUG - [DEBUG] Tras filtrar por 'mascotas_vivo': 1124 registros
2026-02-03 15:59:46 - INFO - Filtrados 1124 registros de sección 'mascotas_vivo' de 44082 total
2026-02-03 15:59:46 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 15:59:46 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 15:59:47 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:59:47 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 15:59:48 - INFO - Costes cargados: 22145 registros
2026-02-03 15:59:48 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 15:59:48 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 15:59:48 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MASCOTAS_VIVO ===
2026-02-03 15:59:48 - INFO -   ABC: 205 registros
2026-02-03 15:59:48 - INFO -   Ventas: 1124 registros
2026-02-03 15:59:48 - INFO -   Costes: 22145 registros
2026-02-03 15:59:48 - DEBUG - [DEBUG] abc_df: 205 registros
2026-02-03 15:59:48 - DEBUG - [DEBUG] ventas_df: 1124 registros
2026-02-03 15:59:48 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 15:59:48 - INFO - Datos de ventas: 88 registros
2026-02-03 15:59:48 - INFO - Calculando pedido para semana 14 (88 registros)
2026-02-03 15:59:48 - INFO -   Objetivo: 1087.15€, Actual (ABC): 846.63€
2026-02-03 15:59:48 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 15:59:48 - INFO -   Factor total: 1.3125
2026-02-03 15:59:48 - INFO -   Factor escalado: 1.6854
2026-02-03 15:59:48 - INFO -   Ventas preliminares (con ceil): 1773.66€
2026-02-03 15:59:48 - INFO -   Objetivo final: 1426.88€
2026-02-03 15:59:48 - INFO -   Delta: 346.78€
2026-02-03 15:59:48 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 15:59:48 - DEBUG -   Total registros: 43
2026-02-03 15:59:48 - DEBUG -   Registros con Unidades_Finales > 0: 36
2026-02-03 15:59:48 - DEBUG -   Ventas finales: 1455.34€
2026-02-03 15:59:48 - INFO -   Ventas finales: 1455.34€
2026-02-03 15:59:48 - INFO - 
============================================================
2026-02-03 15:59:48 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 15:59:48 - INFO - ============================================================
2026-02-03 15:59:48 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 15:59:48 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 15:59:48 - INFO - DataLoader inicializado correctamente
2026-02-03 15:59:48 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 15:59:48 - INFO - ============================================================
2026-02-03 15:59:48 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 15:59:48 - INFO - ============================================================
2026-02-03 15:59:48 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 15:59:48 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 15:59:48 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:59:48 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:59:48 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 15:59:48 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:59:48 - DEBUG - Usando hoja: Stock
2026-02-03 15:59:48 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 15:59:48 - INFO - Stock actual cargado: 30 registros
2026-02-03 15:59:48 - INFO -   Stock: 30 registros
2026-02-03 15:59:48 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 15:59:48 - INFO - Fusión completada: 43 registros
2026-02-03 15:59:48 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 15:59:48 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 15:59:48 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 15:59:48 - INFO - Corrección completada:
2026-02-03 15:59:48 - INFO -   - Artículos corregidos: 36/43
2026-02-03 15:59:48 - INFO -   - Artículos aumentados: 36
2026-02-03 15:59:48 - INFO -   - Artículos reducidos: 0
2026-02-03 15:59:48 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 15:59:48 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 15:59:48 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 15:59:48 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 43 registros
2026-02-03 15:59:48 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 15:59:48 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 15:59:48 - DEBUG -   Con valor 0: 7
2026-02-03 15:59:48 - DEBUG -   Con valor > 0: 36
2026-02-03 15:59:48 - DEBUG -   Suma Ventas_Objetivo: 1455.34€
2026-02-03 15:59:48 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 36 registros
2026-02-03 15:59:48 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx
2026-02-03 15:59:48 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx
2026-02-03 15:59:48 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx
2026-02-03 15:59:48 - INFO -   Articulos: 36
2026-02-03 15:59:48 - INFO -   Importe: 1455.34€
2026-02-03 15:59:48 - INFO - 
==================================================
2026-02-03 15:59:48 - INFO - SECCION: MASCOTAS_MANUFACTURADO
2026-02-03 15:59:48 - INFO - ==================================================
2026-02-03 15:59:48 - INFO - === LEYENDO DATOS PARA SECCIÓN: MASCOTAS_MANUFACTURADO ===
2026-02-03 15:59:48 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 15:59:48 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: mascotas_manufacturado
2026-02-03 15:59:48 - INFO - Archivo ABC encontrado para 'mascotas_manufacturado': .\./data/input\CLASIFICACION_ABC+D_mascotas_manufacturado.xlsx
2026-02-03 15:59:48 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_mascotas_manufacturado.xlsx
2026-02-03 15:59:48 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 15:59:48 - INFO - Clasificación ABC cargada para 'mascotas_manufacturado': 2749 registros
2026-02-03 15:59:48 - DEBUG - [DEBUG] ABC leído: 2749 registros
2026-02-03 15:59:48 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 15:59:48 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 15:59:48 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 15:59:52 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:59:52 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 15:59:52 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 15:59:52 - INFO - Ventas cargadas: 44082 registros
2026-02-03 15:59:52 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 15:59:52 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 15:59:52 - DEBUG - [DEBUG] Filtrando ventas por sección: mascotas_manufacturado
2026-02-03 15:59:52 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 15:59:52 - DEBUG -   maf: 10970 registros
2026-02-03 15:59:52 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 15:59:52 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 15:59:52 - DEBUG -   interior: 3624 registros
2026-02-03 15:59:52 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 15:59:52 - DEBUG -   deco_interior: 2468 registros
2026-02-03 15:59:52 - DEBUG -   vivero: 2460 registros
2026-02-03 15:59:52 - DEBUG -   fitos: 1987 registros
2026-02-03 15:59:52 - DEBUG -   semillas: 1180 registros
2026-02-03 15:59:52 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 15:59:52 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 15:59:52 - DEBUG - [DEBUG] Tras filtrar por 'mascotas_manufacturado': 9784 registros
2026-02-03 15:59:52 - INFO - Filtrados 9784 registros de sección 'mascotas_manufacturado' de 44082 total
2026-02-03 15:59:52 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 15:59:52 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 15:59:54 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:59:54 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 15:59:54 - INFO - Costes cargados: 22145 registros
2026-02-03 15:59:54 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 15:59:54 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 15:59:54 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MASCOTAS_MANUFACTURADO ===
2026-02-03 15:59:54 - INFO -   ABC: 2749 registros
2026-02-03 15:59:54 - INFO -   Ventas: 9784 registros
2026-02-03 15:59:54 - INFO -   Costes: 22145 registros
2026-02-03 15:59:54 - DEBUG - [DEBUG] abc_df: 2749 registros
2026-02-03 15:59:54 - DEBUG - [DEBUG] ventas_df: 9784 registros
2026-02-03 15:59:54 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 15:59:54 - INFO - Datos de ventas: 822 registros
2026-02-03 15:59:54 - INFO - Calculando pedido para semana 14 (822 registros)
2026-02-03 15:59:56 - INFO -   Objetivo: 6839.82€, Actual (ABC): 8742.92€
2026-02-03 15:59:56 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 15:59:56 - INFO -   Factor total: 1.3125
2026-02-03 15:59:56 - INFO -   Factor escalado: 1.0268
2026-02-03 15:59:56 - INFO -   Ventas preliminares (con ceil): 12379.25€
2026-02-03 15:59:56 - INFO -   Objetivo final: 8977.26€
2026-02-03 15:59:56 - INFO -   Delta: 3401.99€
2026-02-03 15:59:56 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 15:59:56 - DEBUG -   Total registros: 538
2026-02-03 15:59:56 - DEBUG -   Registros con Unidades_Finales > 0: 411
2026-02-03 15:59:56 - DEBUG -   Ventas finales: 8993.98€
2026-02-03 15:59:56 - INFO -   Ventas finales: 8993.98€
2026-02-03 15:59:56 - INFO - 
============================================================
2026-02-03 15:59:56 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 15:59:56 - INFO - ============================================================
2026-02-03 15:59:56 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 15:59:56 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 15:59:56 - INFO - DataLoader inicializado correctamente
2026-02-03 15:59:56 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 15:59:56 - INFO - ============================================================
2026-02-03 15:59:56 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 15:59:56 - INFO - ============================================================
2026-02-03 15:59:56 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 15:59:56 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 15:59:56 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:59:56 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 15:59:56 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 15:59:56 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 15:59:56 - DEBUG - Usando hoja: Stock
2026-02-03 15:59:56 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 15:59:56 - INFO - Stock actual cargado: 30 registros
2026-02-03 15:59:56 - INFO -   Stock: 30 registros
2026-02-03 15:59:56 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 15:59:56 - INFO - Fusión completada: 538 registros
2026-02-03 15:59:56 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 15:59:56 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 15:59:56 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 15:59:56 - INFO - Corrección completada:
2026-02-03 15:59:56 - INFO -   - Artículos corregidos: 411/538
2026-02-03 15:59:56 - INFO -   - Artículos aumentados: 411
2026-02-03 15:59:56 - INFO -   - Artículos reducidos: 0
2026-02-03 15:59:56 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 15:59:56 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 15:59:56 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 15:59:56 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 538 registros
2026-02-03 15:59:56 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 15:59:56 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 15:59:56 - DEBUG -   Con valor 0: 127
2026-02-03 15:59:56 - DEBUG -   Con valor > 0: 411
2026-02-03 15:59:56 - DEBUG -   Suma Ventas_Objetivo: 8993.98€
2026-02-03 15:59:56 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 411 registros
2026-02-03 15:59:56 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx
2026-02-03 15:59:57 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx
2026-02-03 15:59:57 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx
2026-02-03 15:59:57 - INFO -   Articulos: 411
2026-02-03 15:59:57 - INFO -   Importe: 8993.98€
2026-02-03 15:59:57 - INFO - 
==================================================
2026-02-03 15:59:57 - INFO - SECCION: INTERIOR
2026-02-03 15:59:57 - INFO - ==================================================
2026-02-03 15:59:57 - INFO - === LEYENDO DATOS PARA SECCIÓN: INTERIOR ===
2026-02-03 15:59:57 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 15:59:57 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: interior
2026-02-03 15:59:57 - INFO - Archivo ABC encontrado para 'interior': .\./data/input\CLASIFICACION_ABC+D_interior.xlsx
2026-02-03 15:59:57 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_interior.xlsx
2026-02-03 15:59:57 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 15:59:57 - INFO - Clasificación ABC cargada para 'interior': 555 registros
2026-02-03 15:59:57 - DEBUG - [DEBUG] ABC leído: 555 registros
2026-02-03 15:59:57 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 15:59:57 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 15:59:57 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 16:00:00 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:00:00 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 16:00:01 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 16:00:01 - INFO - Ventas cargadas: 44082 registros
2026-02-03 16:00:01 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 16:00:01 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 16:00:01 - DEBUG - [DEBUG] Filtrando ventas por sección: interior
2026-02-03 16:00:01 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 16:00:01 - DEBUG -   maf: 10970 registros
2026-02-03 16:00:01 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 16:00:01 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 16:00:01 - DEBUG -   interior: 3624 registros
2026-02-03 16:00:01 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 16:00:01 - DEBUG -   deco_interior: 2468 registros
2026-02-03 16:00:01 - DEBUG -   vivero: 2460 registros
2026-02-03 16:00:01 - DEBUG -   fitos: 1987 registros
2026-02-03 16:00:01 - DEBUG -   semillas: 1180 registros
2026-02-03 16:00:01 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 16:00:01 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 16:00:01 - DEBUG - [DEBUG] Tras filtrar por 'interior': 3624 registros
2026-02-03 16:00:01 - INFO - Filtrados 3624 registros de sección 'interior' de 44082 total
2026-02-03 16:00:01 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 16:00:01 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 16:00:03 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:00:03 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 16:00:03 - INFO - Costes cargados: 22145 registros
2026-02-03 16:00:03 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 16:00:03 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 16:00:03 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA INTERIOR ===
2026-02-03 16:00:03 - INFO -   ABC: 555 registros
2026-02-03 16:00:03 - INFO -   Ventas: 3624 registros
2026-02-03 16:00:03 - INFO -   Costes: 22145 registros
2026-02-03 16:00:03 - DEBUG - [DEBUG] abc_df: 555 registros
2026-02-03 16:00:03 - DEBUG - [DEBUG] ventas_df: 3624 registros
2026-02-03 16:00:03 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 16:00:03 - INFO - Datos de ventas: 286 registros
2026-02-03 16:00:03 - INFO - Calculando pedido para semana 14 (286 registros)
2026-02-03 16:00:03 - INFO -   Objetivo: 2930.63€, Actual (ABC): 2409.44€
2026-02-03 16:00:03 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 16:00:03 - INFO -   Factor total: 1.3125
2026-02-03 16:00:03 - INFO -   Factor escalado: 1.5964
2026-02-03 16:00:03 - INFO -   Ventas preliminares (con ceil): 4541.81€
2026-02-03 16:00:03 - INFO -   Objetivo final: 3846.45€
2026-02-03 16:00:03 - INFO -   Delta: 695.36€
2026-02-03 16:00:03 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 16:00:03 - DEBUG -   Total registros: 138
2026-02-03 16:00:03 - DEBUG -   Registros con Unidades_Finales > 0: 121
2026-02-03 16:00:03 - DEBUG -   Ventas finales: 3855.17€
2026-02-03 16:00:03 - INFO -   Ventas finales: 3855.17€
2026-02-03 16:00:03 - INFO - 
============================================================
2026-02-03 16:00:03 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 16:00:03 - INFO - ============================================================
2026-02-03 16:00:03 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 16:00:03 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 16:00:03 - INFO - DataLoader inicializado correctamente
2026-02-03 16:00:03 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 16:00:03 - INFO - ============================================================
2026-02-03 16:00:03 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 16:00:03 - INFO - ============================================================
2026-02-03 16:00:03 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 16:00:03 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 16:00:03 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 16:00:03 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 16:00:03 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 16:00:03 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:00:03 - DEBUG - Usando hoja: Stock
2026-02-03 16:00:03 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 16:00:03 - INFO - Stock actual cargado: 30 registros
2026-02-03 16:00:03 - INFO -   Stock: 30 registros
2026-02-03 16:00:03 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 16:00:03 - INFO - Fusión completada: 138 registros
2026-02-03 16:00:03 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 16:00:03 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 16:00:03 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 16:00:03 - INFO - Corrección completada:
2026-02-03 16:00:03 - INFO -   - Artículos corregidos: 121/138
2026-02-03 16:00:03 - INFO -   - Artículos aumentados: 121
2026-02-03 16:00:03 - INFO -   - Artículos reducidos: 0
2026-02-03 16:00:03 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 16:00:03 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 16:00:03 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 16:00:03 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 138 registros
2026-02-03 16:00:03 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 16:00:03 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 16:00:03 - DEBUG -   Con valor 0: 17
2026-02-03 16:00:03 - DEBUG -   Con valor > 0: 121
2026-02-03 16:00:03 - DEBUG -   Suma Ventas_Objetivo: 3855.17€
2026-02-03 16:00:03 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 121 registros
2026-02-03 16:00:03 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_interior.xlsx
2026-02-03 16:00:03 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_interior.xlsx
2026-02-03 16:00:03 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_interior.xlsx
2026-02-03 16:00:03 - INFO -   Articulos: 121
2026-02-03 16:00:03 - INFO -   Importe: 3855.17€
2026-02-03 16:00:03 - INFO - 
==================================================
2026-02-03 16:00:03 - INFO - SECCION: FITOS
2026-02-03 16:00:03 - INFO - ==================================================
2026-02-03 16:00:03 - INFO - === LEYENDO DATOS PARA SECCIÓN: FITOS ===
2026-02-03 16:00:03 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 16:00:03 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: fitos
2026-02-03 16:00:03 - INFO - Archivo ABC encontrado para 'fitos': .\./data/input\CLASIFICACION_ABC+D_fitos.xlsx
2026-02-03 16:00:03 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_fitos.xlsx
2026-02-03 16:00:03 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 16:00:03 - INFO - Clasificación ABC cargada para 'fitos': 247 registros
2026-02-03 16:00:03 - DEBUG - [DEBUG] ABC leído: 247 registros
2026-02-03 16:00:03 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 16:00:03 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 16:00:03 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 16:00:07 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:00:07 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 16:00:07 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 16:00:07 - INFO - Ventas cargadas: 44082 registros
2026-02-03 16:00:07 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 16:00:07 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 16:00:07 - DEBUG - [DEBUG] Filtrando ventas por sección: fitos
2026-02-03 16:00:07 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 16:00:07 - DEBUG -   maf: 10970 registros
2026-02-03 16:00:07 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 16:00:07 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 16:00:07 - DEBUG -   interior: 3624 registros
2026-02-03 16:00:07 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 16:00:07 - DEBUG -   deco_interior: 2468 registros
2026-02-03 16:00:07 - DEBUG -   vivero: 2460 registros
2026-02-03 16:00:07 - DEBUG -   fitos: 1987 registros
2026-02-03 16:00:07 - DEBUG -   semillas: 1180 registros
2026-02-03 16:00:07 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 16:00:07 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 16:00:07 - DEBUG - [DEBUG] Tras filtrar por 'fitos': 1987 registros
2026-02-03 16:00:07 - INFO - Filtrados 1987 registros de sección 'fitos' de 44082 total
2026-02-03 16:00:07 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 16:00:07 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 16:00:09 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:00:09 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 16:00:09 - INFO - Costes cargados: 22145 registros
2026-02-03 16:00:09 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 16:00:09 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 16:00:09 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA FITOS ===
2026-02-03 16:00:09 - INFO -   ABC: 247 registros
2026-02-03 16:00:09 - INFO -   Ventas: 1987 registros
2026-02-03 16:00:09 - INFO -   Costes: 22145 registros
2026-02-03 16:00:09 - DEBUG - [DEBUG] abc_df: 247 registros
2026-02-03 16:00:09 - DEBUG - [DEBUG] ventas_df: 1987 registros
2026-02-03 16:00:09 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 16:00:09 - INFO - Datos de ventas: 157 registros
2026-02-03 16:00:09 - INFO - Calculando pedido para semana 14 (157 registros)
2026-02-03 16:00:09 - INFO -   Objetivo: 1798.25€, Actual (ABC): 1679.26€
2026-02-03 16:00:09 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 16:00:09 - INFO -   Factor total: 1.3125
2026-02-03 16:00:09 - INFO -   Factor escalado: 1.4055
2026-02-03 16:00:09 - INFO -   Ventas preliminares (con ceil): 2784.94€
2026-02-03 16:00:09 - INFO -   Objetivo final: 2360.20€
2026-02-03 16:00:09 - INFO -   Delta: 424.74€
2026-02-03 16:00:09 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 16:00:09 - DEBUG -   Total registros: 84
2026-02-03 16:00:09 - DEBUG -   Registros con Unidades_Finales > 0: 82
2026-02-03 16:00:09 - DEBUG -   Ventas finales: 2365.92€
2026-02-03 16:00:09 - INFO -   Ventas finales: 2365.92€
2026-02-03 16:00:09 - INFO - 
============================================================
2026-02-03 16:00:09 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 16:00:09 - INFO - ============================================================
2026-02-03 16:00:09 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 16:00:09 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 16:00:09 - INFO - DataLoader inicializado correctamente
2026-02-03 16:00:09 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 16:00:09 - INFO - ============================================================
2026-02-03 16:00:09 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 16:00:09 - INFO - ============================================================
2026-02-03 16:00:09 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 16:00:09 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 16:00:09 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 16:00:09 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 16:00:09 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 16:00:09 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:00:09 - DEBUG - Usando hoja: Stock
2026-02-03 16:00:09 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 16:00:09 - INFO - Stock actual cargado: 30 registros
2026-02-03 16:00:09 - INFO -   Stock: 30 registros
2026-02-03 16:00:09 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 16:00:09 - INFO - Fusión completada: 84 registros
2026-02-03 16:00:09 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 16:00:09 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 16:00:09 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 16:00:09 - INFO - Corrección completada:
2026-02-03 16:00:09 - INFO -   - Artículos corregidos: 82/84
2026-02-03 16:00:09 - INFO -   - Artículos aumentados: 82
2026-02-03 16:00:09 - INFO -   - Artículos reducidos: 0
2026-02-03 16:00:09 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 16:00:09 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 16:00:09 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 16:00:09 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 84 registros
2026-02-03 16:00:09 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 16:00:09 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 16:00:09 - DEBUG -   Con valor 0: 2
2026-02-03 16:00:09 - DEBUG -   Con valor > 0: 82
2026-02-03 16:00:09 - DEBUG -   Suma Ventas_Objetivo: 2365.92€
2026-02-03 16:00:09 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 82 registros
2026-02-03 16:00:09 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_fitos.xlsx
2026-02-03 16:00:10 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_fitos.xlsx
2026-02-03 16:00:10 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_fitos.xlsx
2026-02-03 16:00:10 - INFO -   Articulos: 82
2026-02-03 16:00:10 - INFO -   Importe: 2365.92€
2026-02-03 16:00:10 - INFO - 
==================================================
2026-02-03 16:00:10 - INFO - SECCION: VIVERO
2026-02-03 16:00:10 - INFO - ==================================================
2026-02-03 16:00:10 - INFO - === LEYENDO DATOS PARA SECCIÓN: VIVERO ===
2026-02-03 16:00:10 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 16:00:10 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: vivero
2026-02-03 16:00:10 - INFO - Archivo ABC encontrado para 'vivero': .\./data/input\CLASIFICACION_ABC+D_vivero.xlsx
2026-02-03 16:00:10 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_vivero.xlsx
2026-02-03 16:00:10 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 16:00:10 - INFO - Clasificación ABC cargada para 'vivero': 565 registros
2026-02-03 16:00:10 - DEBUG - [DEBUG] ABC leído: 565 registros
2026-02-03 16:00:10 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 16:00:10 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 16:00:10 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 16:00:13 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:00:13 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 16:00:14 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 16:00:14 - INFO - Ventas cargadas: 44082 registros
2026-02-03 16:00:14 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 16:00:14 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 16:00:14 - DEBUG - [DEBUG] Filtrando ventas por sección: vivero
2026-02-03 16:00:14 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 16:00:14 - DEBUG -   maf: 10970 registros
2026-02-03 16:00:14 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 16:00:14 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 16:00:14 - DEBUG -   interior: 3624 registros
2026-02-03 16:00:14 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 16:00:14 - DEBUG -   deco_interior: 2468 registros
2026-02-03 16:00:14 - DEBUG -   vivero: 2460 registros
2026-02-03 16:00:14 - DEBUG -   fitos: 1987 registros
2026-02-03 16:00:14 - DEBUG -   semillas: 1180 registros
2026-02-03 16:00:14 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 16:00:14 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 16:00:14 - DEBUG - [DEBUG] Tras filtrar por 'vivero': 2460 registros
2026-02-03 16:00:14 - INFO - Filtrados 2460 registros de sección 'vivero' de 44082 total
2026-02-03 16:00:14 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 16:00:14 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 16:00:16 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:00:16 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 16:00:16 - INFO - Costes cargados: 22145 registros
2026-02-03 16:00:16 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 16:00:16 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 16:00:16 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA VIVERO ===
2026-02-03 16:00:16 - INFO -   ABC: 565 registros
2026-02-03 16:00:16 - INFO -   Ventas: 2460 registros
2026-02-03 16:00:16 - INFO -   Costes: 22145 registros
2026-02-03 16:00:16 - DEBUG - [DEBUG] abc_df: 565 registros
2026-02-03 16:00:16 - DEBUG - [DEBUG] ventas_df: 2460 registros
2026-02-03 16:00:16 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 16:00:16 - INFO - Datos de ventas: 189 registros
2026-02-03 16:00:16 - INFO - Calculando pedido para semana 14 (189 registros)
2026-02-03 16:00:16 - INFO -   Objetivo: 5297.17€, Actual (ABC): 4113.14€
2026-02-03 16:00:16 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 16:00:16 - INFO -   Factor total: 1.3125
2026-02-03 16:00:16 - INFO -   Factor escalado: 1.6903
2026-02-03 16:00:16 - INFO -   Ventas preliminares (con ceil): 8761.94€
2026-02-03 16:00:16 - INFO -   Objetivo final: 6952.54€
2026-02-03 16:00:16 - INFO -   Delta: 1809.40€
2026-02-03 16:00:16 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 16:00:16 - DEBUG -   Total registros: 107
2026-02-03 16:00:16 - DEBUG -   Registros con Unidades_Finales > 0: 96
2026-02-03 16:00:16 - DEBUG -   Ventas finales: 6990.51€
2026-02-03 16:00:16 - INFO -   Ventas finales: 6990.51€
2026-02-03 16:00:16 - INFO - 
============================================================
2026-02-03 16:00:16 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 16:00:16 - INFO - ============================================================
2026-02-03 16:00:16 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 16:00:16 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 16:00:16 - INFO - DataLoader inicializado correctamente
2026-02-03 16:00:16 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 16:00:16 - INFO - ============================================================
2026-02-03 16:00:16 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 16:00:16 - INFO - ============================================================
2026-02-03 16:00:16 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 16:00:16 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 16:00:16 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 16:00:16 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 16:00:16 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 16:00:16 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:00:16 - DEBUG - Usando hoja: Stock
2026-02-03 16:00:16 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 16:00:16 - INFO - Stock actual cargado: 30 registros
2026-02-03 16:00:16 - INFO -   Stock: 30 registros
2026-02-03 16:00:16 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 16:00:16 - INFO - Fusión completada: 107 registros
2026-02-03 16:00:16 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 16:00:16 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 16:00:16 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 16:00:16 - INFO - Corrección completada:
2026-02-03 16:00:16 - INFO -   - Artículos corregidos: 96/107
2026-02-03 16:00:16 - INFO -   - Artículos aumentados: 96
2026-02-03 16:00:16 - INFO -   - Artículos reducidos: 0
2026-02-03 16:00:16 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 16:00:16 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 16:00:16 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 16:00:16 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 107 registros
2026-02-03 16:00:16 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 16:00:16 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 16:00:16 - DEBUG -   Con valor 0: 11
2026-02-03 16:00:16 - DEBUG -   Con valor > 0: 96
2026-02-03 16:00:16 - DEBUG -   Suma Ventas_Objetivo: 6990.51€
2026-02-03 16:00:16 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 96 registros
2026-02-03 16:00:16 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_vivero.xlsx
2026-02-03 16:00:16 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_vivero.xlsx
2026-02-03 16:00:16 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_vivero.xlsx
2026-02-03 16:00:16 - INFO -   Articulos: 96
2026-02-03 16:00:16 - INFO -   Importe: 6990.51€
2026-02-03 16:00:16 - INFO - 
==================================================
2026-02-03 16:00:16 - INFO - SECCION: UTILES_JARDIN
2026-02-03 16:00:16 - INFO - ==================================================
2026-02-03 16:00:16 - INFO - === LEYENDO DATOS PARA SECCIÓN: UTILES_JARDIN ===
2026-02-03 16:00:16 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 16:00:16 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: utiles_jardin
2026-02-03 16:00:16 - INFO - Archivo ABC encontrado para 'utiles_jardin': .\./data/input\CLASIFICACION_ABC+D_utiles_jardin.xlsx
2026-02-03 16:00:16 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_utiles_jardin.xlsx
2026-02-03 16:00:16 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 16:00:16 - INFO - Clasificación ABC cargada para 'utiles_jardin': 433 registros
2026-02-03 16:00:16 - DEBUG - [DEBUG] ABC leído: 433 registros
2026-02-03 16:00:16 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 16:00:16 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 16:00:16 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 16:00:20 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:00:20 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 16:00:20 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 16:00:20 - INFO - Ventas cargadas: 44082 registros
2026-02-03 16:00:20 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 16:00:20 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 16:00:20 - DEBUG - [DEBUG] Filtrando ventas por sección: utiles_jardin
2026-02-03 16:00:20 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 16:00:20 - DEBUG -   maf: 10970 registros
2026-02-03 16:00:20 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 16:00:20 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 16:00:20 - DEBUG -   interior: 3624 registros
2026-02-03 16:00:20 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 16:00:20 - DEBUG -   deco_interior: 2468 registros
2026-02-03 16:00:20 - DEBUG -   vivero: 2460 registros
2026-02-03 16:00:20 - DEBUG -   fitos: 1987 registros
2026-02-03 16:00:20 - DEBUG -   semillas: 1180 registros
2026-02-03 16:00:20 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 16:00:20 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 16:00:20 - DEBUG - [DEBUG] Tras filtrar por 'utiles_jardin': 1009 registros
2026-02-03 16:00:20 - INFO - Filtrados 1009 registros de sección 'utiles_jardin' de 44082 total
2026-02-03 16:00:20 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 16:00:20 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 16:00:22 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:00:22 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 16:00:22 - INFO - Costes cargados: 22145 registros
2026-02-03 16:00:22 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 16:00:22 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 16:00:22 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA UTILES_JARDIN ===
2026-02-03 16:00:22 - INFO -   ABC: 433 registros
2026-02-03 16:00:22 - INFO -   Ventas: 1009 registros
2026-02-03 16:00:22 - INFO -   Costes: 22145 registros
2026-02-03 16:00:22 - DEBUG - [DEBUG] abc_df: 433 registros
2026-02-03 16:00:22 - DEBUG - [DEBUG] ventas_df: 1009 registros
2026-02-03 16:00:22 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 16:00:22 - INFO - Datos de ventas: 89 registros
2026-02-03 16:00:22 - INFO - Calculando pedido para semana 14 (89 registros)
2026-02-03 16:00:22 - INFO -   Objetivo: 1044.77€, Actual (ABC): 818.79€
2026-02-03 16:00:22 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 16:00:22 - INFO -   Factor total: 1.3125
2026-02-03 16:00:22 - INFO -   Factor escalado: 1.6747
2026-02-03 16:00:22 - INFO -   Ventas preliminares (con ceil): 1929.56€
2026-02-03 16:00:22 - INFO -   Objetivo final: 1371.26€
2026-02-03 16:00:22 - INFO -   Delta: 558.30€
2026-02-03 16:00:22 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 16:00:22 - DEBUG -   Total registros: 78
2026-02-03 16:00:22 - DEBUG -   Registros con Unidades_Finales > 0: 78
2026-02-03 16:00:22 - DEBUG -   Ventas finales: 1390.00€
2026-02-03 16:00:22 - INFO -   Ventas finales: 1390.00€
2026-02-03 16:00:22 - INFO - 
============================================================
2026-02-03 16:00:22 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 16:00:22 - INFO - ============================================================
2026-02-03 16:00:22 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 16:00:22 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 16:00:22 - INFO - DataLoader inicializado correctamente
2026-02-03 16:00:22 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 16:00:22 - INFO - ============================================================
2026-02-03 16:00:22 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 16:00:22 - INFO - ============================================================
2026-02-03 16:00:22 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 16:00:22 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 16:00:22 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 16:00:22 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 16:00:22 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 16:00:22 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:00:22 - DEBUG - Usando hoja: Stock
2026-02-03 16:00:22 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 16:00:22 - INFO - Stock actual cargado: 30 registros
2026-02-03 16:00:22 - INFO -   Stock: 30 registros
2026-02-03 16:00:22 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 16:00:22 - INFO - Fusión completada: 78 registros
2026-02-03 16:00:22 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 16:00:22 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 16:00:22 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 16:00:22 - INFO - Corrección completada:
2026-02-03 16:00:22 - INFO -   - Artículos corregidos: 78/78
2026-02-03 16:00:22 - INFO -   - Artículos aumentados: 78
2026-02-03 16:00:22 - INFO -   - Artículos reducidos: 0
2026-02-03 16:00:22 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 16:00:22 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 16:00:22 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 16:00:22 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 78 registros
2026-02-03 16:00:22 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 16:00:22 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 16:00:22 - DEBUG -   Con valor 0: 0
2026-02-03 16:00:22 - DEBUG -   Con valor > 0: 78
2026-02-03 16:00:22 - DEBUG -   Suma Ventas_Objetivo: 1390.00€
2026-02-03 16:00:22 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 78 registros
2026-02-03 16:00:22 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx
2026-02-03 16:00:22 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx
2026-02-03 16:00:22 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx
2026-02-03 16:00:22 - INFO -   Articulos: 78
2026-02-03 16:00:22 - INFO -   Importe: 1390.00€
2026-02-03 16:00:22 - INFO - 
==================================================
2026-02-03 16:00:22 - INFO - SECCION: TIERRAS_ARIDOS
2026-02-03 16:00:22 - INFO - ==================================================
2026-02-03 16:00:22 - INFO - === LEYENDO DATOS PARA SECCIÓN: TIERRAS_ARIDOS ===
2026-02-03 16:00:22 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 16:00:22 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: tierras_aridos
2026-02-03 16:00:22 - WARNING - No se encontró archivo específico para 'tierras_aridos', usando: .\./data/input\CLASIFICACION_ABC+D_DECO_EXTERIOR.xlsx
2026-02-03 16:00:22 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_DECO_EXTERIOR.xlsx
2026-02-03 16:00:23 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 16:00:23 - INFO - Clasificación ABC cargada para 'tierras_aridos': 995 registros
2026-02-03 16:00:23 - DEBUG - [DEBUG] ABC leído: 995 registros
2026-02-03 16:00:23 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 16:00:23 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 16:00:23 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 16:00:26 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:00:26 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 16:00:27 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 16:00:27 - INFO - Ventas cargadas: 44082 registros
2026-02-03 16:00:27 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 16:00:27 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 16:00:27 - DEBUG - [DEBUG] Filtrando ventas por sección: tierras_aridos
2026-02-03 16:00:27 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 16:00:27 - DEBUG -   maf: 10970 registros
2026-02-03 16:00:27 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 16:00:27 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 16:00:27 - DEBUG -   interior: 3624 registros
2026-02-03 16:00:27 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 16:00:27 - DEBUG -   deco_interior: 2468 registros
2026-02-03 16:00:27 - DEBUG -   vivero: 2460 registros
2026-02-03 16:00:27 - DEBUG -   fitos: 1987 registros
2026-02-03 16:00:27 - DEBUG -   semillas: 1180 registros
2026-02-03 16:00:27 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 16:00:27 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 16:00:27 - DEBUG - [DEBUG] Tras filtrar por 'tierras_aridos': 3264 registros
2026-02-03 16:00:27 - INFO - Filtrados 3264 registros de sección 'tierras_aridos' de 44082 total
2026-02-03 16:00:27 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 16:00:27 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 16:00:29 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:00:29 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 16:00:29 - INFO - Costes cargados: 22145 registros
2026-02-03 16:00:29 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 16:00:29 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 16:00:29 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA TIERRAS_ARIDOS ===
2026-02-03 16:00:29 - INFO -   ABC: 995 registros
2026-02-03 16:00:29 - INFO -   Ventas: 3264 registros
2026-02-03 16:00:29 - INFO -   Costes: 22145 registros
2026-02-03 16:00:29 - DEBUG - [DEBUG] abc_df: 995 registros
2026-02-03 16:00:29 - DEBUG - [DEBUG] ventas_df: 3264 registros
2026-02-03 16:00:29 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 16:00:29 - INFO - Datos de ventas: 302 registros
2026-02-03 16:00:29 - INFO - Calculando pedido para semana 14 (302 registros)
2026-02-03 16:00:29 - INFO -   Objetivo: 4097.24€, Actual (ABC): 4019.19€
2026-02-03 16:00:29 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 16:00:29 - INFO -   Factor total: 1.3125
2026-02-03 16:00:29 - INFO -   Factor escalado: 1.3380
2026-02-03 16:00:29 - INFO -   Ventas preliminares (con ceil): 5809.66€
2026-02-03 16:00:29 - INFO -   Objetivo final: 5377.63€
2026-02-03 16:00:29 - INFO -   Delta: 432.03€
2026-02-03 16:00:29 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 16:00:29 - DEBUG -   Total registros: 72
2026-02-03 16:00:29 - DEBUG -   Registros con Unidades_Finales > 0: 71
2026-02-03 16:00:29 - DEBUG -   Ventas finales: 5387.14€
2026-02-03 16:00:29 - INFO -   Ventas finales: 5387.14€
2026-02-03 16:00:29 - INFO - 
============================================================
2026-02-03 16:00:29 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 16:00:29 - INFO - ============================================================
2026-02-03 16:00:29 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 16:00:29 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 16:00:29 - INFO - DataLoader inicializado correctamente
2026-02-03 16:00:29 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 16:00:29 - INFO - ============================================================
2026-02-03 16:00:29 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 16:00:29 - INFO - ============================================================
2026-02-03 16:00:29 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 16:00:29 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 16:00:29 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 16:00:29 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 16:00:29 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 16:00:29 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:00:29 - DEBUG - Usando hoja: Stock
2026-02-03 16:00:29 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 16:00:29 - INFO - Stock actual cargado: 30 registros
2026-02-03 16:00:29 - INFO -   Stock: 30 registros
2026-02-03 16:00:29 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 16:00:29 - INFO - Fusión completada: 72 registros
2026-02-03 16:00:29 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 16:00:29 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 16:00:29 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 16:00:29 - INFO - Corrección completada:
2026-02-03 16:00:29 - INFO -   - Artículos corregidos: 71/72
2026-02-03 16:00:29 - INFO -   - Artículos aumentados: 71
2026-02-03 16:00:29 - INFO -   - Artículos reducidos: 0
2026-02-03 16:00:29 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 16:00:29 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 16:00:29 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 16:00:29 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 72 registros
2026-02-03 16:00:29 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 16:00:29 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 16:00:29 - DEBUG -   Con valor 0: 1
2026-02-03 16:00:29 - DEBUG -   Con valor > 0: 71
2026-02-03 16:00:29 - DEBUG -   Suma Ventas_Objetivo: 5387.14€
2026-02-03 16:00:29 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 71 registros
2026-02-03 16:00:29 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx
2026-02-03 16:00:29 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx
2026-02-03 16:00:29 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx
2026-02-03 16:00:29 - INFO -   Articulos: 71
2026-02-03 16:00:29 - INFO -   Importe: 5387.14€
2026-02-03 16:00:29 - INFO - 
==================================================
2026-02-03 16:00:29 - INFO - SECCION: DECO_EXTERIOR
2026-02-03 16:00:29 - INFO - ==================================================
2026-02-03 16:00:29 - INFO - === LEYENDO DATOS PARA SECCIÓN: DECO_EXTERIOR ===
2026-02-03 16:00:29 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 16:00:29 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: deco_exterior
2026-02-03 16:00:29 - INFO - Archivo ABC encontrado para 'deco_exterior': .\./data/input\CLASIFICACION_ABC+D_deco_exterior.xlsx
2026-02-03 16:00:29 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_deco_exterior.xlsx
2026-02-03 16:00:29 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 16:00:29 - INFO - Clasificación ABC cargada para 'deco_exterior': 995 registros
2026-02-03 16:00:29 - DEBUG - [DEBUG] ABC leído: 995 registros
2026-02-03 16:00:29 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 16:00:29 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 16:00:29 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 16:00:33 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:00:33 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 16:00:33 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 16:00:33 - INFO - Ventas cargadas: 44082 registros
2026-02-03 16:00:33 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 16:00:33 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 16:00:33 - DEBUG - [DEBUG] Filtrando ventas por sección: deco_exterior
2026-02-03 16:00:33 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 16:00:33 - DEBUG -   maf: 10970 registros
2026-02-03 16:00:33 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 16:00:33 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 16:00:33 - DEBUG -   interior: 3624 registros
2026-02-03 16:00:33 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 16:00:33 - DEBUG -   deco_interior: 2468 registros
2026-02-03 16:00:33 - DEBUG -   vivero: 2460 registros
2026-02-03 16:00:33 - DEBUG -   fitos: 1987 registros
2026-02-03 16:00:33 - DEBUG -   semillas: 1180 registros
2026-02-03 16:00:33 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 16:00:33 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 16:00:33 - DEBUG - [DEBUG] Tras filtrar por 'deco_exterior': 4018 registros
2026-02-03 16:00:33 - INFO - Filtrados 4018 registros de sección 'deco_exterior' de 44082 total
2026-02-03 16:00:33 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 16:00:33 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 16:00:35 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:00:35 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 16:00:35 - INFO - Costes cargados: 22145 registros
2026-02-03 16:00:35 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 16:00:35 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 16:00:35 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA DECO_EXTERIOR ===
2026-02-03 16:00:35 - INFO -   ABC: 995 registros
2026-02-03 16:00:35 - INFO -   Ventas: 4018 registros
2026-02-03 16:00:35 - INFO -   Costes: 22145 registros
2026-02-03 16:00:35 - DEBUG - [DEBUG] abc_df: 995 registros
2026-02-03 16:00:35 - DEBUG - [DEBUG] ventas_df: 4018 registros
2026-02-03 16:00:35 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 16:00:35 - INFO - Datos de ventas: 316 registros
2026-02-03 16:00:35 - INFO - Calculando pedido para semana 14 (316 registros)
2026-02-03 16:00:36 - INFO -   Objetivo: 3740.34€, Actual (ABC): 4104.66€
2026-02-03 16:00:36 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 16:00:36 - INFO -   Factor total: 1.3125
2026-02-03 16:00:36 - INFO -   Factor escalado: 1.1960
2026-02-03 16:00:36 - INFO -   Ventas preliminares (con ceil): 6094.59€
2026-02-03 16:00:36 - INFO -   Objetivo final: 4909.20€
2026-02-03 16:00:36 - INFO -   Delta: 1185.39€
2026-02-03 16:00:36 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 16:00:36 - DEBUG -   Total registros: 224
2026-02-03 16:00:36 - DEBUG -   Registros con Unidades_Finales > 0: 205
2026-02-03 16:00:36 - DEBUG -   Ventas finales: 4923.89€
2026-02-03 16:00:36 - INFO -   Ventas finales: 4923.89€
2026-02-03 16:00:36 - INFO - 
============================================================
2026-02-03 16:00:36 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 16:00:36 - INFO - ============================================================
2026-02-03 16:00:36 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 16:00:36 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 16:00:36 - INFO - DataLoader inicializado correctamente
2026-02-03 16:00:36 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 16:00:36 - INFO - ============================================================
2026-02-03 16:00:36 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 16:00:36 - INFO - ============================================================
2026-02-03 16:00:36 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 16:00:36 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 16:00:36 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 16:00:36 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 16:00:36 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 16:00:36 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:00:36 - DEBUG - Usando hoja: Stock
2026-02-03 16:00:36 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 16:00:36 - INFO - Stock actual cargado: 30 registros
2026-02-03 16:00:36 - INFO -   Stock: 30 registros
2026-02-03 16:00:36 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 16:00:36 - INFO - Fusión completada: 224 registros
2026-02-03 16:00:36 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 16:00:36 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 16:00:36 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 16:00:36 - INFO - Corrección completada:
2026-02-03 16:00:36 - INFO -   - Artículos corregidos: 205/224
2026-02-03 16:00:36 - INFO -   - Artículos aumentados: 205
2026-02-03 16:00:36 - INFO -   - Artículos reducidos: 0
2026-02-03 16:00:36 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 16:00:36 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 16:00:36 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 16:00:36 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 224 registros
2026-02-03 16:00:36 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 16:00:36 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 16:00:36 - DEBUG -   Con valor 0: 19
2026-02-03 16:00:36 - DEBUG -   Con valor > 0: 205
2026-02-03 16:00:36 - DEBUG -   Suma Ventas_Objetivo: 4923.89€
2026-02-03 16:00:36 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 205 registros
2026-02-03 16:00:36 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_deco_exterior.xlsx
2026-02-03 16:00:36 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_deco_exterior.xlsx
2026-02-03 16:00:36 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_deco_exterior.xlsx
2026-02-03 16:00:36 - INFO -   Articulos: 205
2026-02-03 16:00:36 - INFO -   Importe: 4923.89€
2026-02-03 16:00:36 - INFO - Estado guardado correctamente
2026-02-03 16:00:36 - INFO - Generando resumen: .\./data/output\Resumen_Pedidos_VIVERO_2026-02-03.xlsx
2026-02-03 16:00:36 - INFO - Resumen guardado: .\./data/output\Resumen_Pedidos_VIVERO_2026-02-03.xlsx
2026-02-03 16:00:36 - INFO - Estado guardado correctamente
2026-02-03 16:00:36 - INFO - 
============================================================
2026-02-03 16:00:36 - INFO - PREPARANDO ENVÍO DE EMAILS
2026-02-03 16:00:36 - INFO - ============================================================
2026-02-03 16:00:36 - DEBUG - [DEBUG] Archivos agrupados por sección: {'maf': ['.\\./data/output\\Pedido_Semana_14_2026-02-03_maf.xlsx'], 'interior': ['.\\./data/output\\Pedido_Semana_14_2026-02-03_deco_interior.xlsx', '.\\./data/output\\Pedido_Semana_14_2026-02-03_interior.xlsx'], 'semillas': ['.\\./data/output\\Pedido_Semana_14_2026-02-03_semillas.xlsx'], 'vivo': ['.\\./data/output\\Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx'], 'manufacturado': ['.\\./data/output\\Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx'], 'fitos': ['.\\./data/output\\Pedido_Semana_14_2026-02-03_fitos.xlsx'], 'vivero': ['.\\./data/output\\Pedido_Semana_14_2026-02-03_vivero.xlsx'], 'jardin': ['.\\./data/output\\Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx'], 'aridos': ['.\\./data/output\\Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx'], 'exterior': ['.\\./data/output\\Pedido_Semana_14_2026-02-03_deco_exterior.xlsx']}
2026-02-03 16:00:36 - INFO - 
============================================================
2026-02-03 16:00:36 - INFO - ENVÍO DE EMAILS A RESPONSABLES
2026-02-03 16:00:36 - INFO - ============================================================
2026-02-03 16:00:36 - DEBUG - [DEBUG] SMTP configurado: {'servidor': 'smtp.serviciodecorreo.es', 'puerto': 465, 'usar_ssl': True, 'usar_tls': False}
2026-02-03 16:00:36 - DEBUG - [DEBUG] Remitente: {'email': 'ivan.delgado@viveverde.es', 'nombre': 'Sistema de Pedidos VIVEVERDE'}
2026-02-03 16:00:36 - DEBUG - [DEBUG] Destinatarios: {'maf': 'exterior@viveverde.es', 'interior': 'interior@viveverde.es', 'mascotas_vivo': 'mascotas@gmail.com', 'mascotas_manufacturado': 'mascotas@gmail.com', 'deco_interior': ['decoracion@viveverde.es', 'sandra.delgado@viveverde.es'], 'deco_exterior': 'deco.exterior@viveverde.es', 'tierras_aridos': 'deco.exterior@viveverde.es', 'fitos': 'ivan.delgado@viveverde.es', 'semillas': 'ivan.delgado@viveverde.es', 'utiles_jardin': 'ivan.delgado@viveverde.es', 'vivero': 'exterior@viveverde.es'}
2026-02-03 16:00:36 - INFO - EmailService inicializado correctamente
2026-02-03 16:00:36 - INFO - 
Enviando email para sección: maf
2026-02-03 16:00:36 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_maf.xlsx']
2026-02-03 16:00:36 - INFO - ============================================================
2026-02-03 16:00:36 - INFO - ENVIANDO EMAIL PARA SECCIÓN: MAF
2026-02-03 16:00:36 - INFO - ============================================================
2026-02-03 16:00:36 - ERROR - Error al enviar emails: name 'destinatorios_config' is not defined
2026-02-03 16:00:36 - ERROR - Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 445, in enviar_emails_pedidos
    resultado = email_service.enviar_pedido_por_seccion(
        semana=semana,
        seccion=seccion,
        archivos=archivos
    )
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\email_service.py", line 331, in enviar_pedido_por_seccion
    destinatarios_info = self.obtener_destinatarios_seccion(seccion)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\email_service.py", line 297, in obtener_destinatarios_seccion
    for dest in destinatorios_config:
                ^^^^^^^^^^^^^^^^^^^^
NameError: name 'destinatorios_config' is not defined. Did you mean: 'destinatarios_config'?

2026-02-03 16:00:36 - INFO - 
======================================================================
2026-02-03 16:00:36 - INFO - RESUMEN DE EJECUCION
2026-02-03 16:00:36 - INFO - ======================================================================
2026-02-03 16:00:36 - INFO - Semana procesada: 14
2026-02-03 16:00:36 - INFO - Archivos generados: 12
2026-02-03 16:00:36 - INFO - Total articulos: 1510
2026-02-03 16:00:36 - INFO - Total importe: 48113.87€
2026-02-03 16:00:36 - INFO - ======================================================================
2026-02-03 16:00:36 - INFO - 
¡PEDIDO GENERADO EXITOSAMENTE!
2026-02-03 16:00:36 - INFO - Archivo principal: .\./data/output\Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 16:00:36 - INFO - Artículos: 1510
2026-02-03 16:00:36 - INFO - Importe: 48113.87€
2026-02-03 16:09:26 - INFO - ======================================================================
2026-02-03 16:09:26 - INFO - SISTEMA DE PEDIDOS DE COMPRA - VIVERO ARANJUEZ V2
2026-02-03 16:09:26 - INFO - Fecha de ejecución: 2026-02-03 16:09:26
2026-02-03 16:09:26 - INFO - ======================================================================
2026-02-03 16:09:26 - INFO - Modo de ejecución: FASE 1 + FASE 2
2026-02-03 16:09:26 - INFO - Envío de emails: Sí
2026-02-03 16:09:26 - INFO - StateManager inicializado. Archivo de estado: .\./data\state.json
2026-02-03 16:09:26 - INFO - Cargando estado desde: .\./data\state.json
2026-02-03 16:09:26 - INFO - Estado cargado correctamente
2026-02-03 16:09:26 - INFO - SchedulerService inicializado correctamente
2026-02-03 16:09:26 - INFO - Horario configurado: sunday a las 15:00
2026-02-03 16:09:26 - INFO - Semana forzada por argumento: 14
2026-02-03 16:09:26 - INFO - ======================================================================
2026-02-03 16:09:26 - INFO - PROCESANDO PEDIDO PARA SEMANA 14
2026-02-03 16:09:26 - INFO - ======================================================================
2026-02-03 16:09:26 - INFO - MODO: FASE 1 (Forecast) + FASE 2 (Corrección)
2026-02-03 16:09:26 - INFO - DataLoader inicializado correctamente
2026-02-03 16:09:26 - INFO - ForecastEngine inicializado correctamente
2026-02-03 16:09:26 - INFO - OrderGenerator inicializado correctamente
2026-02-03 16:09:26 - INFO - SchedulerService inicializado correctamente
2026-02-03 16:09:26 - INFO - Horario configurado: sunday a las 15:00
2026-02-03 16:09:26 - INFO - Período de la semana: 2026-03-30 al 2026-04-05
2026-02-03 16:09:26 - INFO - Stock acumulado cargado: 2633 artículos
2026-02-03 16:09:26 - INFO - 
==================================================
2026-02-03 16:09:26 - INFO - SECCION: MAF
2026-02-03 16:09:26 - INFO - ==================================================
2026-02-03 16:09:26 - INFO - === LEYENDO DATOS PARA SECCIÓN: MAF ===
2026-02-03 16:09:26 - INFO - Archivo ABC encontrado para 'maf': .\./data/input\CLASIFICACION_ABC+D_maf.xlsx
2026-02-03 16:09:26 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_maf.xlsx
2026-02-03 16:09:26 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 16:09:26 - INFO - Clasificación ABC cargada para 'maf': 499 registros
2026-02-03 16:09:26 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 16:09:30 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:09:30 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 16:09:30 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 16:09:30 - INFO - Ventas cargadas: 44082 registros
2026-02-03 16:09:30 - INFO - Filtrados 10970 registros de sección 'maf' de 44082 total
2026-02-03 16:09:30 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 16:09:32 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:09:32 - INFO - Costes cargados: 22145 registros
2026-02-03 16:09:32 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MAF ===
2026-02-03 16:09:32 - INFO -   ABC: 499 registros
2026-02-03 16:09:32 - INFO -   Ventas: 10970 registros
2026-02-03 16:09:32 - INFO -   Costes: 22145 registros
2026-02-03 16:09:32 - INFO - Datos de ventas: 1011 registros
2026-02-03 16:09:32 - INFO - Calculando pedido para semana 14 (1011 registros)
2026-02-03 16:09:32 - INFO -   Objetivo: 7050.65€, Actual (ABC): 5843.77€
2026-02-03 16:09:32 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 16:09:32 - INFO -   Factor total: 1.3125
2026-02-03 16:09:32 - INFO -   Factor escalado: 1.5836
2026-02-03 16:09:32 - INFO -   Ventas preliminares (con ceil): 9931.01€
2026-02-03 16:09:32 - INFO -   Objetivo final: 9253.98€
2026-02-03 16:09:32 - INFO -   Delta: 677.03€
2026-02-03 16:09:32 - INFO -   Ventas finales: 9259.59€
2026-02-03 16:09:32 - INFO - 
============================================================
2026-02-03 16:09:32 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 16:09:32 - INFO - ============================================================
2026-02-03 16:09:32 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 16:09:32 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 16:09:32 - INFO - DataLoader inicializado correctamente
2026-02-03 16:09:32 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 16:09:32 - INFO - ============================================================
2026-02-03 16:09:32 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 16:09:32 - INFO - ============================================================
2026-02-03 16:09:32 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 16:09:32 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 16:09:32 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 16:09:32 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 16:09:32 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 16:09:32 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:09:32 - INFO - Stock actual cargado: 30 registros
2026-02-03 16:09:32 - INFO -   Stock: 30 registros
2026-02-03 16:09:32 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 16:09:32 - INFO - Fusión completada: 222 registros
2026-02-03 16:09:32 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 16:09:32 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 16:09:32 - INFO - Corrección completada:
2026-02-03 16:09:32 - INFO -   - Artículos corregidos: 191/222
2026-02-03 16:09:32 - INFO -   - Artículos aumentados: 191
2026-02-03 16:09:32 - INFO -   - Artículos reducidos: 0
2026-02-03 16:09:32 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 16:09:32 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 16:09:32 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 16:09:32 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 16:09:32 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 16:09:32 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 16:09:32 - INFO -   Articulos: 191
2026-02-03 16:09:32 - INFO -   Importe: 9259.59€
2026-02-03 16:09:32 - INFO - 
==================================================
2026-02-03 16:09:32 - INFO - SECCION: DECO_INTERIOR
2026-02-03 16:09:32 - INFO - ==================================================
2026-02-03 16:09:32 - INFO - === LEYENDO DATOS PARA SECCIÓN: DECO_INTERIOR ===
2026-02-03 16:09:32 - INFO - Archivo ABC encontrado para 'deco_interior': .\./data/input\CLASIFICACION_ABC+D_deco_interior.xlsx
2026-02-03 16:09:32 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_deco_interior.xlsx
2026-02-03 16:09:33 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 16:09:33 - INFO - Clasificación ABC cargada para 'deco_interior': 1827 registros
2026-02-03 16:09:33 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 16:09:37 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:09:37 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 16:09:37 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 16:09:37 - INFO - Ventas cargadas: 44082 registros
2026-02-03 16:09:37 - INFO - Filtrados 2468 registros de sección 'deco_interior' de 44082 total
2026-02-03 16:09:37 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 16:09:39 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:09:39 - INFO - Costes cargados: 22145 registros
2026-02-03 16:09:39 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA DECO_INTERIOR ===
2026-02-03 16:09:39 - INFO -   ABC: 1827 registros
2026-02-03 16:09:39 - INFO -   Ventas: 2468 registros
2026-02-03 16:09:39 - INFO -   Costes: 22145 registros
2026-02-03 16:09:39 - INFO - Datos de ventas: 180 registros
2026-02-03 16:09:39 - INFO - Calculando pedido para semana 14 (180 registros)
2026-02-03 16:09:39 - INFO -   Objetivo: 1962.99€, Actual (ABC): 1636.15€
2026-02-03 16:09:39 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 16:09:39 - INFO -   Factor total: 1.3125
2026-02-03 16:09:39 - INFO -   Factor escalado: 1.5747
2026-02-03 16:09:39 - INFO -   Ventas preliminares (con ceil): 2950.01€
2026-02-03 16:09:39 - INFO -   Objetivo final: 2576.42€
2026-02-03 16:09:39 - INFO -   Delta: 373.59€
2026-02-03 16:09:40 - INFO -   Ventas finales: 2580.73€
2026-02-03 16:09:40 - INFO - 
============================================================
2026-02-03 16:09:40 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 16:09:40 - INFO - ============================================================
2026-02-03 16:09:40 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 16:09:40 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 16:09:40 - INFO - DataLoader inicializado correctamente
2026-02-03 16:09:40 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 16:09:40 - INFO - ============================================================
2026-02-03 16:09:40 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 16:09:40 - INFO - ============================================================
2026-02-03 16:09:40 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 16:09:40 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 16:09:40 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 16:09:40 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 16:09:40 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 16:09:40 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:09:40 - INFO - Stock actual cargado: 30 registros
2026-02-03 16:09:40 - INFO -   Stock: 30 registros
2026-02-03 16:09:40 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 16:09:40 - INFO - Fusión completada: 139 registros
2026-02-03 16:09:40 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 16:09:40 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 16:09:40 - INFO - Corrección completada:
2026-02-03 16:09:40 - INFO -   - Artículos corregidos: 135/139
2026-02-03 16:09:40 - INFO -   - Artículos aumentados: 135
2026-02-03 16:09:40 - INFO -   - Artículos reducidos: 0
2026-02-03 16:09:40 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 16:09:40 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 16:09:40 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 16:09:40 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_deco_interior.xlsx
2026-02-03 16:09:40 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_deco_interior.xlsx
2026-02-03 16:09:40 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_deco_interior.xlsx
2026-02-03 16:09:40 - INFO -   Articulos: 135
2026-02-03 16:09:40 - INFO -   Importe: 2580.73€
2026-02-03 16:09:40 - INFO - 
==================================================
2026-02-03 16:09:40 - INFO - SECCION: SEMILLAS
2026-02-03 16:09:40 - INFO - ==================================================
2026-02-03 16:09:40 - INFO - === LEYENDO DATOS PARA SECCIÓN: SEMILLAS ===
2026-02-03 16:09:40 - INFO - Archivo ABC encontrado para 'semillas': .\./data/input\CLASIFICACION_ABC+D_semillas.xlsx
2026-02-03 16:09:40 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_semillas.xlsx
2026-02-03 16:09:40 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 16:09:40 - INFO - Clasificación ABC cargada para 'semillas': 218 registros
2026-02-03 16:09:40 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 16:09:44 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:09:44 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 16:09:44 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 16:09:44 - INFO - Ventas cargadas: 44082 registros
2026-02-03 16:09:44 - INFO - Filtrados 1180 registros de sección 'semillas' de 44082 total
2026-02-03 16:09:44 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 16:09:46 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:09:46 - INFO - Costes cargados: 22145 registros
2026-02-03 16:09:46 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA SEMILLAS ===
2026-02-03 16:09:46 - INFO -   ABC: 218 registros
2026-02-03 16:09:46 - INFO -   Ventas: 1180 registros
2026-02-03 16:09:46 - INFO -   Costes: 22145 registros
2026-02-03 16:09:46 - INFO - Datos de ventas: 136 registros
2026-02-03 16:09:46 - INFO - Calculando pedido para semana 14 (136 registros)
2026-02-03 16:09:46 - INFO -   Objetivo: 694.34€, Actual (ABC): 455.14€
2026-02-03 16:09:46 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 16:09:46 - INFO -   Factor total: 1.3125
2026-02-03 16:09:46 - INFO -   Factor escalado: 2.0023
2026-02-03 16:09:46 - INFO -   Ventas preliminares (con ceil): 1129.15€
2026-02-03 16:09:46 - INFO -   Objetivo final: 911.32€
2026-02-03 16:09:46 - INFO -   Delta: 217.83€
2026-02-03 16:09:46 - INFO -   Ventas finales: 911.60€
2026-02-03 16:09:46 - INFO - 
============================================================
2026-02-03 16:09:46 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 16:09:46 - INFO - ============================================================
2026-02-03 16:09:46 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 16:09:46 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 16:09:46 - INFO - DataLoader inicializado correctamente
2026-02-03 16:09:46 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 16:09:46 - INFO - ============================================================
2026-02-03 16:09:46 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 16:09:46 - INFO - ============================================================
2026-02-03 16:09:46 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 16:09:46 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 16:09:46 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 16:09:46 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 16:09:46 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 16:09:46 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:09:46 - INFO - Stock actual cargado: 30 registros
2026-02-03 16:09:46 - INFO -   Stock: 30 registros
2026-02-03 16:09:46 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 16:09:46 - INFO - Fusión completada: 84 registros
2026-02-03 16:09:46 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 16:09:46 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 16:09:46 - INFO - Corrección completada:
2026-02-03 16:09:46 - INFO -   - Artículos corregidos: 84/84
2026-02-03 16:09:46 - INFO -   - Artículos aumentados: 84
2026-02-03 16:09:46 - INFO -   - Artículos reducidos: 0
2026-02-03 16:09:46 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 16:09:46 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 16:09:46 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 16:09:46 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_semillas.xlsx
2026-02-03 16:09:46 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_semillas.xlsx
2026-02-03 16:09:46 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_semillas.xlsx
2026-02-03 16:09:46 - INFO -   Articulos: 84
2026-02-03 16:09:46 - INFO -   Importe: 911.60€
2026-02-03 16:09:46 - INFO - 
==================================================
2026-02-03 16:09:46 - INFO - SECCION: MASCOTAS_VIVO
2026-02-03 16:09:46 - INFO - ==================================================
2026-02-03 16:09:46 - INFO - === LEYENDO DATOS PARA SECCIÓN: MASCOTAS_VIVO ===
2026-02-03 16:09:46 - INFO - Archivo ABC encontrado para 'mascotas_vivo': .\./data/input\CLASIFICACION_ABC+D_mascotas_vivo.xlsx
2026-02-03 16:09:46 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_mascotas_vivo.xlsx
2026-02-03 16:09:46 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 16:09:46 - INFO - Clasificación ABC cargada para 'mascotas_vivo': 205 registros
2026-02-03 16:09:46 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 16:09:50 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:09:50 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 16:09:50 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 16:09:50 - INFO - Ventas cargadas: 44082 registros
2026-02-03 16:09:50 - INFO - Filtrados 1124 registros de sección 'mascotas_vivo' de 44082 total
2026-02-03 16:09:50 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 16:09:52 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:09:52 - INFO - Costes cargados: 22145 registros
2026-02-03 16:09:52 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MASCOTAS_VIVO ===
2026-02-03 16:09:52 - INFO -   ABC: 205 registros
2026-02-03 16:09:52 - INFO -   Ventas: 1124 registros
2026-02-03 16:09:52 - INFO -   Costes: 22145 registros
2026-02-03 16:09:52 - INFO - Datos de ventas: 88 registros
2026-02-03 16:09:52 - INFO - Calculando pedido para semana 14 (88 registros)
2026-02-03 16:09:53 - INFO -   Objetivo: 1087.15€, Actual (ABC): 846.63€
2026-02-03 16:09:53 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 16:09:53 - INFO -   Factor total: 1.3125
2026-02-03 16:09:53 - INFO -   Factor escalado: 1.6854
2026-02-03 16:09:53 - INFO -   Ventas preliminares (con ceil): 1773.66€
2026-02-03 16:09:53 - INFO -   Objetivo final: 1426.88€
2026-02-03 16:09:53 - INFO -   Delta: 346.78€
2026-02-03 16:09:53 - INFO -   Ventas finales: 1455.34€
2026-02-03 16:09:53 - INFO - 
============================================================
2026-02-03 16:09:53 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 16:09:53 - INFO - ============================================================
2026-02-03 16:09:53 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 16:09:53 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 16:09:53 - INFO - DataLoader inicializado correctamente
2026-02-03 16:09:53 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 16:09:53 - INFO - ============================================================
2026-02-03 16:09:53 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 16:09:53 - INFO - ============================================================
2026-02-03 16:09:53 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 16:09:53 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 16:09:53 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 16:09:53 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 16:09:53 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 16:09:53 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:09:53 - INFO - Stock actual cargado: 30 registros
2026-02-03 16:09:53 - INFO -   Stock: 30 registros
2026-02-03 16:09:53 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 16:09:53 - INFO - Fusión completada: 43 registros
2026-02-03 16:09:53 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 16:09:53 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 16:09:53 - INFO - Corrección completada:
2026-02-03 16:09:53 - INFO -   - Artículos corregidos: 36/43
2026-02-03 16:09:53 - INFO -   - Artículos aumentados: 36
2026-02-03 16:09:53 - INFO -   - Artículos reducidos: 0
2026-02-03 16:09:53 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 16:09:53 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 16:09:53 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 16:09:53 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx
2026-02-03 16:09:53 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx
2026-02-03 16:09:53 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx
2026-02-03 16:09:53 - INFO -   Articulos: 36
2026-02-03 16:09:53 - INFO -   Importe: 1455.34€
2026-02-03 16:09:53 - INFO - 
==================================================
2026-02-03 16:09:53 - INFO - SECCION: MASCOTAS_MANUFACTURADO
2026-02-03 16:09:53 - INFO - ==================================================
2026-02-03 16:09:53 - INFO - === LEYENDO DATOS PARA SECCIÓN: MASCOTAS_MANUFACTURADO ===
2026-02-03 16:09:53 - INFO - Archivo ABC encontrado para 'mascotas_manufacturado': .\./data/input\CLASIFICACION_ABC+D_mascotas_manufacturado.xlsx
2026-02-03 16:09:53 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_mascotas_manufacturado.xlsx
2026-02-03 16:09:53 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 16:09:53 - INFO - Clasificación ABC cargada para 'mascotas_manufacturado': 2749 registros
2026-02-03 16:09:53 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 16:09:57 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:09:57 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 16:09:57 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 16:09:57 - INFO - Ventas cargadas: 44082 registros
2026-02-03 16:09:57 - INFO - Filtrados 9784 registros de sección 'mascotas_manufacturado' de 44082 total
2026-02-03 16:09:57 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 16:09:59 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:09:59 - INFO - Costes cargados: 22145 registros
2026-02-03 16:09:59 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MASCOTAS_MANUFACTURADO ===
2026-02-03 16:09:59 - INFO -   ABC: 2749 registros
2026-02-03 16:09:59 - INFO -   Ventas: 9784 registros
2026-02-03 16:09:59 - INFO -   Costes: 22145 registros
2026-02-03 16:09:59 - INFO - Datos de ventas: 822 registros
2026-02-03 16:09:59 - INFO - Calculando pedido para semana 14 (822 registros)
2026-02-03 16:10:02 - INFO -   Objetivo: 6839.82€, Actual (ABC): 8742.92€
2026-02-03 16:10:02 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 16:10:02 - INFO -   Factor total: 1.3125
2026-02-03 16:10:02 - INFO -   Factor escalado: 1.0268
2026-02-03 16:10:02 - INFO -   Ventas preliminares (con ceil): 12379.25€
2026-02-03 16:10:02 - INFO -   Objetivo final: 8977.26€
2026-02-03 16:10:02 - INFO -   Delta: 3401.99€
2026-02-03 16:10:02 - INFO -   Ventas finales: 8993.98€
2026-02-03 16:10:02 - INFO - 
============================================================
2026-02-03 16:10:02 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 16:10:02 - INFO - ============================================================
2026-02-03 16:10:02 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 16:10:02 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 16:10:02 - INFO - DataLoader inicializado correctamente
2026-02-03 16:10:02 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 16:10:02 - INFO - ============================================================
2026-02-03 16:10:02 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 16:10:02 - INFO - ============================================================
2026-02-03 16:10:02 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 16:10:02 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 16:10:02 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 16:10:02 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 16:10:02 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 16:10:02 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:10:02 - INFO - Stock actual cargado: 30 registros
2026-02-03 16:10:02 - INFO -   Stock: 30 registros
2026-02-03 16:10:02 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 16:10:02 - INFO - Fusión completada: 538 registros
2026-02-03 16:10:02 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 16:10:02 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 16:10:02 - INFO - Corrección completada:
2026-02-03 16:10:02 - INFO -   - Artículos corregidos: 411/538
2026-02-03 16:10:02 - INFO -   - Artículos aumentados: 411
2026-02-03 16:10:02 - INFO -   - Artículos reducidos: 0
2026-02-03 16:10:02 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 16:10:02 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 16:10:02 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 16:10:02 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx
2026-02-03 16:10:02 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx
2026-02-03 16:10:02 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx
2026-02-03 16:10:02 - INFO -   Articulos: 411
2026-02-03 16:10:02 - INFO -   Importe: 8993.98€
2026-02-03 16:10:02 - INFO - 
==================================================
2026-02-03 16:10:02 - INFO - SECCION: INTERIOR
2026-02-03 16:10:02 - INFO - ==================================================
2026-02-03 16:10:02 - INFO - === LEYENDO DATOS PARA SECCIÓN: INTERIOR ===
2026-02-03 16:10:02 - INFO - Archivo ABC encontrado para 'interior': .\./data/input\CLASIFICACION_ABC+D_interior.xlsx
2026-02-03 16:10:02 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_interior.xlsx
2026-02-03 16:10:02 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 16:10:02 - INFO - Clasificación ABC cargada para 'interior': 555 registros
2026-02-03 16:10:02 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 16:10:06 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:10:06 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 16:10:06 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 16:10:06 - INFO - Ventas cargadas: 44082 registros
2026-02-03 16:10:06 - INFO - Filtrados 3624 registros de sección 'interior' de 44082 total
2026-02-03 16:10:06 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 16:10:08 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:10:08 - INFO - Costes cargados: 22145 registros
2026-02-03 16:10:08 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA INTERIOR ===
2026-02-03 16:10:08 - INFO -   ABC: 555 registros
2026-02-03 16:10:08 - INFO -   Ventas: 3624 registros
2026-02-03 16:10:08 - INFO -   Costes: 22145 registros
2026-02-03 16:10:08 - INFO - Datos de ventas: 286 registros
2026-02-03 16:10:08 - INFO - Calculando pedido para semana 14 (286 registros)
2026-02-03 16:10:09 - INFO -   Objetivo: 2930.63€, Actual (ABC): 2409.44€
2026-02-03 16:10:09 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 16:10:09 - INFO -   Factor total: 1.3125
2026-02-03 16:10:09 - INFO -   Factor escalado: 1.5964
2026-02-03 16:10:09 - INFO -   Ventas preliminares (con ceil): 4541.81€
2026-02-03 16:10:09 - INFO -   Objetivo final: 3846.45€
2026-02-03 16:10:09 - INFO -   Delta: 695.36€
2026-02-03 16:10:09 - INFO -   Ventas finales: 3855.17€
2026-02-03 16:10:09 - INFO - 
============================================================
2026-02-03 16:10:09 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 16:10:09 - INFO - ============================================================
2026-02-03 16:10:09 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 16:10:09 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 16:10:09 - INFO - DataLoader inicializado correctamente
2026-02-03 16:10:09 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 16:10:09 - INFO - ============================================================
2026-02-03 16:10:09 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 16:10:09 - INFO - ============================================================
2026-02-03 16:10:09 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 16:10:09 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 16:10:09 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 16:10:09 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 16:10:09 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 16:10:09 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:10:09 - INFO - Stock actual cargado: 30 registros
2026-02-03 16:10:09 - INFO -   Stock: 30 registros
2026-02-03 16:10:09 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 16:10:09 - INFO - Fusión completada: 138 registros
2026-02-03 16:10:09 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 16:10:09 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 16:10:09 - INFO - Corrección completada:
2026-02-03 16:10:09 - INFO -   - Artículos corregidos: 121/138
2026-02-03 16:10:09 - INFO -   - Artículos aumentados: 121
2026-02-03 16:10:09 - INFO -   - Artículos reducidos: 0
2026-02-03 16:10:09 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 16:10:09 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 16:10:09 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 16:10:09 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_interior.xlsx
2026-02-03 16:10:09 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_interior.xlsx
2026-02-03 16:10:09 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_interior.xlsx
2026-02-03 16:10:09 - INFO -   Articulos: 121
2026-02-03 16:10:09 - INFO -   Importe: 3855.17€
2026-02-03 16:10:09 - INFO - 
==================================================
2026-02-03 16:10:09 - INFO - SECCION: FITOS
2026-02-03 16:10:09 - INFO - ==================================================
2026-02-03 16:10:09 - INFO - === LEYENDO DATOS PARA SECCIÓN: FITOS ===
2026-02-03 16:10:09 - INFO - Archivo ABC encontrado para 'fitos': .\./data/input\CLASIFICACION_ABC+D_fitos.xlsx
2026-02-03 16:10:09 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_fitos.xlsx
2026-02-03 16:10:09 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 16:10:09 - INFO - Clasificación ABC cargada para 'fitos': 247 registros
2026-02-03 16:10:09 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 16:10:13 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:10:13 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 16:10:13 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 16:10:13 - INFO - Ventas cargadas: 44082 registros
2026-02-03 16:10:13 - INFO - Filtrados 1987 registros de sección 'fitos' de 44082 total
2026-02-03 16:10:13 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 16:10:15 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:10:15 - INFO - Costes cargados: 22145 registros
2026-02-03 16:10:15 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA FITOS ===
2026-02-03 16:10:15 - INFO -   ABC: 247 registros
2026-02-03 16:10:15 - INFO -   Ventas: 1987 registros
2026-02-03 16:10:15 - INFO -   Costes: 22145 registros
2026-02-03 16:10:15 - INFO - Datos de ventas: 157 registros
2026-02-03 16:10:15 - INFO - Calculando pedido para semana 14 (157 registros)
2026-02-03 16:10:15 - INFO -   Objetivo: 1798.25€, Actual (ABC): 1679.26€
2026-02-03 16:10:15 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 16:10:15 - INFO -   Factor total: 1.3125
2026-02-03 16:10:15 - INFO -   Factor escalado: 1.4055
2026-02-03 16:10:15 - INFO -   Ventas preliminares (con ceil): 2784.94€
2026-02-03 16:10:15 - INFO -   Objetivo final: 2360.20€
2026-02-03 16:10:15 - INFO -   Delta: 424.74€
2026-02-03 16:10:15 - INFO -   Ventas finales: 2365.92€
2026-02-03 16:10:15 - INFO - 
============================================================
2026-02-03 16:10:15 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 16:10:15 - INFO - ============================================================
2026-02-03 16:10:15 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 16:10:15 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 16:10:15 - INFO - DataLoader inicializado correctamente
2026-02-03 16:10:15 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 16:10:15 - INFO - ============================================================
2026-02-03 16:10:15 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 16:10:15 - INFO - ============================================================
2026-02-03 16:10:15 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 16:10:15 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 16:10:15 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 16:10:15 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 16:10:15 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 16:10:15 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:10:15 - INFO - Stock actual cargado: 30 registros
2026-02-03 16:10:15 - INFO -   Stock: 30 registros
2026-02-03 16:10:15 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 16:10:15 - INFO - Fusión completada: 84 registros
2026-02-03 16:10:15 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 16:10:15 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 16:10:15 - INFO - Corrección completada:
2026-02-03 16:10:15 - INFO -   - Artículos corregidos: 82/84
2026-02-03 16:10:15 - INFO -   - Artículos aumentados: 82
2026-02-03 16:10:15 - INFO -   - Artículos reducidos: 0
2026-02-03 16:10:15 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 16:10:15 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 16:10:15 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 16:10:15 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_fitos.xlsx
2026-02-03 16:10:15 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_fitos.xlsx
2026-02-03 16:10:15 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_fitos.xlsx
2026-02-03 16:10:15 - INFO -   Articulos: 82
2026-02-03 16:10:15 - INFO -   Importe: 2365.92€
2026-02-03 16:10:15 - INFO - 
==================================================
2026-02-03 16:10:15 - INFO - SECCION: VIVERO
2026-02-03 16:10:15 - INFO - ==================================================
2026-02-03 16:10:15 - INFO - === LEYENDO DATOS PARA SECCIÓN: VIVERO ===
2026-02-03 16:10:15 - INFO - Archivo ABC encontrado para 'vivero': .\./data/input\CLASIFICACION_ABC+D_vivero.xlsx
2026-02-03 16:10:15 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_vivero.xlsx
2026-02-03 16:10:16 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 16:10:16 - INFO - Clasificación ABC cargada para 'vivero': 565 registros
2026-02-03 16:10:16 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 16:10:20 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:10:20 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 16:10:20 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 16:10:20 - INFO - Ventas cargadas: 44082 registros
2026-02-03 16:10:20 - INFO - Filtrados 2460 registros de sección 'vivero' de 44082 total
2026-02-03 16:10:20 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 16:10:22 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:10:22 - INFO - Costes cargados: 22145 registros
2026-02-03 16:10:22 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA VIVERO ===
2026-02-03 16:10:22 - INFO -   ABC: 565 registros
2026-02-03 16:10:22 - INFO -   Ventas: 2460 registros
2026-02-03 16:10:22 - INFO -   Costes: 22145 registros
2026-02-03 16:10:22 - INFO - Datos de ventas: 189 registros
2026-02-03 16:10:22 - INFO - Calculando pedido para semana 14 (189 registros)
2026-02-03 16:10:22 - INFO -   Objetivo: 5297.17€, Actual (ABC): 4113.14€
2026-02-03 16:10:22 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 16:10:22 - INFO -   Factor total: 1.3125
2026-02-03 16:10:22 - INFO -   Factor escalado: 1.6903
2026-02-03 16:10:22 - INFO -   Ventas preliminares (con ceil): 8761.94€
2026-02-03 16:10:22 - INFO -   Objetivo final: 6952.54€
2026-02-03 16:10:22 - INFO -   Delta: 1809.40€
2026-02-03 16:10:22 - INFO -   Ventas finales: 6990.51€
2026-02-03 16:10:22 - INFO - 
============================================================
2026-02-03 16:10:22 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 16:10:22 - INFO - ============================================================
2026-02-03 16:10:22 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 16:10:22 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 16:10:22 - INFO - DataLoader inicializado correctamente
2026-02-03 16:10:22 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 16:10:22 - INFO - ============================================================
2026-02-03 16:10:22 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 16:10:22 - INFO - ============================================================
2026-02-03 16:10:22 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 16:10:22 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 16:10:22 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 16:10:22 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 16:10:22 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 16:10:22 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:10:22 - INFO - Stock actual cargado: 30 registros
2026-02-03 16:10:22 - INFO -   Stock: 30 registros
2026-02-03 16:10:22 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 16:10:22 - INFO - Fusión completada: 107 registros
2026-02-03 16:10:22 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 16:10:22 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 16:10:22 - INFO - Corrección completada:
2026-02-03 16:10:22 - INFO -   - Artículos corregidos: 96/107
2026-02-03 16:10:22 - INFO -   - Artículos aumentados: 96
2026-02-03 16:10:22 - INFO -   - Artículos reducidos: 0
2026-02-03 16:10:22 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 16:10:22 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 16:10:22 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 16:10:22 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_vivero.xlsx
2026-02-03 16:10:22 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_vivero.xlsx
2026-02-03 16:10:22 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_vivero.xlsx
2026-02-03 16:10:22 - INFO -   Articulos: 96
2026-02-03 16:10:22 - INFO -   Importe: 6990.51€
2026-02-03 16:10:22 - INFO - 
==================================================
2026-02-03 16:10:22 - INFO - SECCION: UTILES_JARDIN
2026-02-03 16:10:22 - INFO - ==================================================
2026-02-03 16:10:22 - INFO - === LEYENDO DATOS PARA SECCIÓN: UTILES_JARDIN ===
2026-02-03 16:10:22 - INFO - Archivo ABC encontrado para 'utiles_jardin': .\./data/input\CLASIFICACION_ABC+D_utiles_jardin.xlsx
2026-02-03 16:10:22 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_utiles_jardin.xlsx
2026-02-03 16:10:22 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 16:10:22 - INFO - Clasificación ABC cargada para 'utiles_jardin': 433 registros
2026-02-03 16:10:22 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 16:10:26 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:10:26 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 16:10:26 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 16:10:26 - INFO - Ventas cargadas: 44082 registros
2026-02-03 16:10:26 - INFO - Filtrados 1009 registros de sección 'utiles_jardin' de 44082 total
2026-02-03 16:10:26 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 16:10:29 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:10:29 - INFO - Costes cargados: 22145 registros
2026-02-03 16:10:29 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA UTILES_JARDIN ===
2026-02-03 16:10:29 - INFO -   ABC: 433 registros
2026-02-03 16:10:29 - INFO -   Ventas: 1009 registros
2026-02-03 16:10:29 - INFO -   Costes: 22145 registros
2026-02-03 16:10:29 - INFO - Datos de ventas: 89 registros
2026-02-03 16:10:29 - INFO - Calculando pedido para semana 14 (89 registros)
2026-02-03 16:10:29 - INFO -   Objetivo: 1044.77€, Actual (ABC): 818.79€
2026-02-03 16:10:29 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 16:10:29 - INFO -   Factor total: 1.3125
2026-02-03 16:10:29 - INFO -   Factor escalado: 1.6747
2026-02-03 16:10:29 - INFO -   Ventas preliminares (con ceil): 1929.56€
2026-02-03 16:10:29 - INFO -   Objetivo final: 1371.26€
2026-02-03 16:10:29 - INFO -   Delta: 558.30€
2026-02-03 16:10:29 - INFO -   Ventas finales: 1390.00€
2026-02-03 16:10:29 - INFO - 
============================================================
2026-02-03 16:10:29 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 16:10:29 - INFO - ============================================================
2026-02-03 16:10:29 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 16:10:29 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 16:10:29 - INFO - DataLoader inicializado correctamente
2026-02-03 16:10:29 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 16:10:29 - INFO - ============================================================
2026-02-03 16:10:29 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 16:10:29 - INFO - ============================================================
2026-02-03 16:10:29 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 16:10:29 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 16:10:29 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 16:10:29 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 16:10:29 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 16:10:29 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:10:29 - INFO - Stock actual cargado: 30 registros
2026-02-03 16:10:29 - INFO -   Stock: 30 registros
2026-02-03 16:10:29 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 16:10:29 - INFO - Fusión completada: 78 registros
2026-02-03 16:10:29 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 16:10:29 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 16:10:29 - INFO - Corrección completada:
2026-02-03 16:10:29 - INFO -   - Artículos corregidos: 78/78
2026-02-03 16:10:29 - INFO -   - Artículos aumentados: 78
2026-02-03 16:10:29 - INFO -   - Artículos reducidos: 0
2026-02-03 16:10:29 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 16:10:29 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 16:10:29 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 16:10:29 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx
2026-02-03 16:10:29 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx
2026-02-03 16:10:29 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx
2026-02-03 16:10:29 - INFO -   Articulos: 78
2026-02-03 16:10:29 - INFO -   Importe: 1390.00€
2026-02-03 16:10:29 - INFO - 
==================================================
2026-02-03 16:10:29 - INFO - SECCION: TIERRAS_ARIDOS
2026-02-03 16:10:29 - INFO - ==================================================
2026-02-03 16:10:29 - INFO - === LEYENDO DATOS PARA SECCIÓN: TIERRAS_ARIDOS ===
2026-02-03 16:10:29 - WARNING - No se encontró archivo específico para 'tierras_aridos', usando: .\./data/input\CLASIFICACION_ABC+D_DECO_EXTERIOR.xlsx
2026-02-03 16:10:29 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_DECO_EXTERIOR.xlsx
2026-02-03 16:10:29 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 16:10:29 - INFO - Clasificación ABC cargada para 'tierras_aridos': 995 registros
2026-02-03 16:10:29 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 16:10:33 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:10:33 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 16:10:33 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 16:10:33 - INFO - Ventas cargadas: 44082 registros
2026-02-03 16:10:33 - INFO - Filtrados 3264 registros de sección 'tierras_aridos' de 44082 total
2026-02-03 16:10:33 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 16:10:35 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:10:35 - INFO - Costes cargados: 22145 registros
2026-02-03 16:10:35 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA TIERRAS_ARIDOS ===
2026-02-03 16:10:35 - INFO -   ABC: 995 registros
2026-02-03 16:10:35 - INFO -   Ventas: 3264 registros
2026-02-03 16:10:35 - INFO -   Costes: 22145 registros
2026-02-03 16:10:35 - INFO - Datos de ventas: 302 registros
2026-02-03 16:10:35 - INFO - Calculando pedido para semana 14 (302 registros)
2026-02-03 16:10:36 - INFO -   Objetivo: 4097.24€, Actual (ABC): 4019.19€
2026-02-03 16:10:36 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 16:10:36 - INFO -   Factor total: 1.3125
2026-02-03 16:10:36 - INFO -   Factor escalado: 1.3380
2026-02-03 16:10:36 - INFO -   Ventas preliminares (con ceil): 5809.66€
2026-02-03 16:10:36 - INFO -   Objetivo final: 5377.63€
2026-02-03 16:10:36 - INFO -   Delta: 432.03€
2026-02-03 16:10:36 - INFO -   Ventas finales: 5387.14€
2026-02-03 16:10:36 - INFO - 
============================================================
2026-02-03 16:10:36 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 16:10:36 - INFO - ============================================================
2026-02-03 16:10:36 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 16:10:36 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 16:10:36 - INFO - DataLoader inicializado correctamente
2026-02-03 16:10:36 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 16:10:36 - INFO - ============================================================
2026-02-03 16:10:36 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 16:10:36 - INFO - ============================================================
2026-02-03 16:10:36 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 16:10:36 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 16:10:36 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 16:10:36 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 16:10:36 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 16:10:36 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:10:36 - INFO - Stock actual cargado: 30 registros
2026-02-03 16:10:36 - INFO -   Stock: 30 registros
2026-02-03 16:10:36 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 16:10:36 - INFO - Fusión completada: 72 registros
2026-02-03 16:10:36 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 16:10:36 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 16:10:36 - INFO - Corrección completada:
2026-02-03 16:10:36 - INFO -   - Artículos corregidos: 71/72
2026-02-03 16:10:36 - INFO -   - Artículos aumentados: 71
2026-02-03 16:10:36 - INFO -   - Artículos reducidos: 0
2026-02-03 16:10:36 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 16:10:36 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 16:10:36 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 16:10:36 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx
2026-02-03 16:10:36 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx
2026-02-03 16:10:36 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx
2026-02-03 16:10:36 - INFO -   Articulos: 71
2026-02-03 16:10:36 - INFO -   Importe: 5387.14€
2026-02-03 16:10:36 - INFO - 
==================================================
2026-02-03 16:10:36 - INFO - SECCION: DECO_EXTERIOR
2026-02-03 16:10:36 - INFO - ==================================================
2026-02-03 16:10:36 - INFO - === LEYENDO DATOS PARA SECCIÓN: DECO_EXTERIOR ===
2026-02-03 16:10:36 - INFO - Archivo ABC encontrado para 'deco_exterior': .\./data/input\CLASIFICACION_ABC+D_deco_exterior.xlsx
2026-02-03 16:10:36 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_deco_exterior.xlsx
2026-02-03 16:10:36 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 16:10:36 - INFO - Clasificación ABC cargada para 'deco_exterior': 995 registros
2026-02-03 16:10:36 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 16:10:40 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:10:40 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 16:10:40 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 16:10:40 - INFO - Ventas cargadas: 44082 registros
2026-02-03 16:10:40 - INFO - Filtrados 4018 registros de sección 'deco_exterior' de 44082 total
2026-02-03 16:10:40 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 16:10:42 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:10:42 - INFO - Costes cargados: 22145 registros
2026-02-03 16:10:42 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA DECO_EXTERIOR ===
2026-02-03 16:10:42 - INFO -   ABC: 995 registros
2026-02-03 16:10:42 - INFO -   Ventas: 4018 registros
2026-02-03 16:10:42 - INFO -   Costes: 22145 registros
2026-02-03 16:10:42 - INFO - Datos de ventas: 316 registros
2026-02-03 16:10:42 - INFO - Calculando pedido para semana 14 (316 registros)
2026-02-03 16:10:43 - INFO -   Objetivo: 3740.34€, Actual (ABC): 4104.66€
2026-02-03 16:10:43 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 16:10:43 - INFO -   Factor total: 1.3125
2026-02-03 16:10:43 - INFO -   Factor escalado: 1.1960
2026-02-03 16:10:43 - INFO -   Ventas preliminares (con ceil): 6094.59€
2026-02-03 16:10:43 - INFO -   Objetivo final: 4909.20€
2026-02-03 16:10:43 - INFO -   Delta: 1185.39€
2026-02-03 16:10:43 - INFO -   Ventas finales: 4923.89€
2026-02-03 16:10:43 - INFO - 
============================================================
2026-02-03 16:10:43 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 16:10:43 - INFO - ============================================================
2026-02-03 16:10:43 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 16:10:43 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 16:10:43 - INFO - DataLoader inicializado correctamente
2026-02-03 16:10:43 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 16:10:43 - INFO - ============================================================
2026-02-03 16:10:43 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 16:10:43 - INFO - ============================================================
2026-02-03 16:10:43 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 16:10:43 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 16:10:43 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 16:10:43 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 16:10:43 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 16:10:43 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:10:43 - INFO - Stock actual cargado: 30 registros
2026-02-03 16:10:43 - INFO -   Stock: 30 registros
2026-02-03 16:10:43 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 16:10:43 - INFO - Fusión completada: 224 registros
2026-02-03 16:10:43 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 16:10:43 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 16:10:43 - INFO - Corrección completada:
2026-02-03 16:10:43 - INFO -   - Artículos corregidos: 205/224
2026-02-03 16:10:43 - INFO -   - Artículos aumentados: 205
2026-02-03 16:10:43 - INFO -   - Artículos reducidos: 0
2026-02-03 16:10:43 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 16:10:43 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 16:10:43 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 16:10:43 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_deco_exterior.xlsx
2026-02-03 16:10:43 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_deco_exterior.xlsx
2026-02-03 16:10:43 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_deco_exterior.xlsx
2026-02-03 16:10:43 - INFO -   Articulos: 205
2026-02-03 16:10:43 - INFO -   Importe: 4923.89€
2026-02-03 16:10:43 - INFO - Estado guardado correctamente
2026-02-03 16:10:43 - INFO - Generando resumen: .\./data/output\Resumen_Pedidos_VIVERO_2026-02-03.xlsx
2026-02-03 16:10:43 - INFO - Resumen guardado: .\./data/output\Resumen_Pedidos_VIVERO_2026-02-03.xlsx
2026-02-03 16:10:43 - INFO - Estado guardado correctamente
2026-02-03 16:10:43 - INFO - 
============================================================
2026-02-03 16:10:43 - INFO - PREPARANDO ENVÍO DE EMAILS
2026-02-03 16:10:43 - INFO - ============================================================
2026-02-03 16:10:43 - INFO - 
============================================================
2026-02-03 16:10:43 - INFO - ENVÍO DE EMAILS A RESPONSABLES
2026-02-03 16:10:43 - INFO - ============================================================
2026-02-03 16:10:43 - INFO - EmailService inicializado correctamente
2026-02-03 16:10:43 - INFO - 
Enviando email para sección: maf
2026-02-03 16:10:43 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_maf.xlsx']
2026-02-03 16:10:43 - INFO - ============================================================
2026-02-03 16:10:43 - INFO - ENVIANDO EMAIL PARA SECCIÓN: MAF
2026-02-03 16:10:43 - INFO - ============================================================
2026-02-03 16:10:43 - INFO - Destinatarios: ['exterior@viveverde.es']
2026-02-03 16:10:43 - INFO - Archivos a enviar: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_maf.xlsx']
2026-02-03 16:10:43 - INFO - Archivo adjuntado: Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 16:10:49 - ERROR - Error SMTP al enviar email: (535, b'5.7.0 Invalid username or password')
2026-02-03 16:10:49 - ERROR - ✗ Error al enviar email para maf
2026-02-03 16:10:49 - ERROR - ✗ Error al enviar email a maf: error_envio
2026-02-03 16:10:49 - INFO - 
Enviando email para sección: interior
2026-02-03 16:10:49 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_deco_interior.xlsx', '.\\./data/output\\Pedido_Semana_14_2026-02-03_interior.xlsx']
2026-02-03 16:10:49 - INFO - ============================================================
2026-02-03 16:10:49 - INFO - ENVIANDO EMAIL PARA SECCIÓN: INTERIOR
2026-02-03 16:10:49 - INFO - ============================================================
2026-02-03 16:10:49 - INFO - Destinatarios: ['interior@viveverde.es']
2026-02-03 16:10:49 - INFO - Archivos a enviar: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_deco_interior.xlsx', '.\\./data/output\\Pedido_Semana_14_2026-02-03_interior.xlsx']
2026-02-03 16:10:49 - INFO - Archivo adjuntado: Pedido_Semana_14_2026-02-03_deco_interior.xlsx
2026-02-03 16:10:49 - INFO - Archivo adjuntado: Pedido_Semana_14_2026-02-03_interior.xlsx
2026-02-03 16:10:56 - ERROR - Error SMTP al enviar email: (535, b'5.7.0 Invalid username or password')
2026-02-03 16:10:56 - ERROR - ✗ Error al enviar email para interior
2026-02-03 16:10:56 - ERROR - ✗ Error al enviar email a interior: error_envio
2026-02-03 16:10:56 - INFO - 
Enviando email para sección: semillas
2026-02-03 16:10:56 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_semillas.xlsx']
2026-02-03 16:10:56 - INFO - ============================================================
2026-02-03 16:10:56 - INFO - ENVIANDO EMAIL PARA SECCIÓN: SEMILLAS
2026-02-03 16:10:56 - INFO - ============================================================
2026-02-03 16:10:56 - INFO - Destinatarios: ['ivan.delgado@viveverde.es']
2026-02-03 16:10:56 - INFO - Archivos a enviar: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_semillas.xlsx']
2026-02-03 16:10:56 - INFO - Archivo adjuntado: Pedido_Semana_14_2026-02-03_semillas.xlsx
2026-02-03 16:11:02 - ERROR - Error SMTP al enviar email: (535, b'5.7.0 Invalid username or password')
2026-02-03 16:11:02 - ERROR - ✗ Error al enviar email para semillas
2026-02-03 16:11:02 - ERROR - ✗ Error al enviar email a semillas: error_envio
2026-02-03 16:11:02 - INFO - 
Enviando email para sección: vivo
2026-02-03 16:11:02 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx']
2026-02-03 16:11:02 - INFO - ============================================================
2026-02-03 16:11:02 - INFO - ENVIANDO EMAIL PARA SECCIÓN: VIVO
2026-02-03 16:11:02 - INFO - ============================================================
2026-02-03 16:11:02 - WARNING - No hay destinatarios configurados para la sección: vivo
2026-02-03 16:11:02 - ERROR - ✗ Error al enviar email a vivo: sin_destinatarios
2026-02-03 16:11:02 - INFO - 
Enviando email para sección: manufacturado
2026-02-03 16:11:02 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx']
2026-02-03 16:11:02 - INFO - ============================================================
2026-02-03 16:11:02 - INFO - ENVIANDO EMAIL PARA SECCIÓN: MANUFACTURADO
2026-02-03 16:11:02 - INFO - ============================================================
2026-02-03 16:11:02 - WARNING - No hay destinatarios configurados para la sección: manufacturado
2026-02-03 16:11:02 - ERROR - ✗ Error al enviar email a manufacturado: sin_destinatarios
2026-02-03 16:11:02 - INFO - 
Enviando email para sección: fitos
2026-02-03 16:11:02 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_fitos.xlsx']
2026-02-03 16:11:02 - INFO - ============================================================
2026-02-03 16:11:02 - INFO - ENVIANDO EMAIL PARA SECCIÓN: FITOS
2026-02-03 16:11:02 - INFO - ============================================================
2026-02-03 16:11:02 - INFO - Destinatarios: ['ivan.delgado@viveverde.es']
2026-02-03 16:11:02 - INFO - Archivos a enviar: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_fitos.xlsx']
2026-02-03 16:11:02 - INFO - Archivo adjuntado: Pedido_Semana_14_2026-02-03_fitos.xlsx
2026-02-03 16:11:08 - ERROR - Error SMTP al enviar email: (535, b'5.7.0 Invalid username or password')
2026-02-03 16:11:08 - ERROR - ✗ Error al enviar email para fitos
2026-02-03 16:11:08 - ERROR - ✗ Error al enviar email a fitos: error_envio
2026-02-03 16:11:08 - INFO - 
Enviando email para sección: vivero
2026-02-03 16:11:08 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_vivero.xlsx']
2026-02-03 16:11:08 - INFO - ============================================================
2026-02-03 16:11:08 - INFO - ENVIANDO EMAIL PARA SECCIÓN: VIVERO
2026-02-03 16:11:08 - INFO - ============================================================
2026-02-03 16:11:08 - INFO - Destinatarios: ['exterior@viveverde.es']
2026-02-03 16:11:08 - INFO - Archivos a enviar: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_vivero.xlsx']
2026-02-03 16:11:08 - INFO - Archivo adjuntado: Pedido_Semana_14_2026-02-03_vivero.xlsx
2026-02-03 16:11:14 - ERROR - Error SMTP al enviar email: (535, b'5.7.0 Invalid username or password')
2026-02-03 16:11:14 - ERROR - ✗ Error al enviar email para vivero
2026-02-03 16:11:14 - ERROR - ✗ Error al enviar email a vivero: error_envio
2026-02-03 16:11:14 - INFO - 
Enviando email para sección: jardin
2026-02-03 16:11:14 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx']
2026-02-03 16:11:14 - INFO - ============================================================
2026-02-03 16:11:14 - INFO - ENVIANDO EMAIL PARA SECCIÓN: JARDIN
2026-02-03 16:11:14 - INFO - ============================================================
2026-02-03 16:11:14 - WARNING - No hay destinatarios configurados para la sección: jardin
2026-02-03 16:11:14 - ERROR - ✗ Error al enviar email a jardin: sin_destinatarios
2026-02-03 16:11:14 - INFO - 
Enviando email para sección: aridos
2026-02-03 16:11:14 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx']
2026-02-03 16:11:14 - INFO - ============================================================
2026-02-03 16:11:14 - INFO - ENVIANDO EMAIL PARA SECCIÓN: ARIDOS
2026-02-03 16:11:14 - INFO - ============================================================
2026-02-03 16:11:14 - WARNING - No hay destinatarios configurados para la sección: aridos
2026-02-03 16:11:14 - ERROR - ✗ Error al enviar email a aridos: sin_destinatarios
2026-02-03 16:11:14 - INFO - 
Enviando email para sección: exterior
2026-02-03 16:11:14 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_deco_exterior.xlsx']
2026-02-03 16:11:14 - INFO - ============================================================
2026-02-03 16:11:14 - INFO - ENVIANDO EMAIL PARA SECCIÓN: EXTERIOR
2026-02-03 16:11:14 - INFO - ============================================================
2026-02-03 16:11:14 - WARNING - No hay destinatarios configurados para la sección: exterior
2026-02-03 16:11:14 - ERROR - ✗ Error al enviar email a exterior: sin_destinatarios
2026-02-03 16:11:14 - INFO - 
============================================================
2026-02-03 16:11:14 - INFO - RESUMEN DE ENVÍO DE EMAILS
2026-02-03 16:11:14 - INFO - ============================================================
2026-02-03 16:11:14 - INFO - Emails enviados exitosamente: 0
2026-02-03 16:11:14 - INFO - Emails fallidos: 10
2026-02-03 16:11:14 - INFO - Secciones procesadas: 10
2026-02-03 16:11:14 - INFO - 
======================================================================
2026-02-03 16:11:14 - INFO - RESUMEN DE EJECUCION
2026-02-03 16:11:14 - INFO - ======================================================================
2026-02-03 16:11:14 - INFO - Semana procesada: 14
2026-02-03 16:11:14 - INFO - Archivos generados: 12
2026-02-03 16:11:14 - INFO - Total articulos: 1510
2026-02-03 16:11:14 - INFO - Total importe: 48113.87€
2026-02-03 16:11:14 - WARNING - 
✗ EMAILS FALLIDOS: 10
2026-02-03 16:11:14 - INFO - ======================================================================
2026-02-03 16:11:14 - INFO - 
¡PEDIDO GENERADO EXITOSAMENTE!
2026-02-03 16:11:14 - INFO - Archivo principal: .\./data/output\Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 16:11:14 - INFO - Artículos: 1510
2026-02-03 16:11:14 - INFO - Importe: 48113.87€
2026-02-03 16:16:50 - INFO - ======================================================================
2026-02-03 16:16:50 - INFO - SISTEMA DE PEDIDOS DE COMPRA - VIVERO ARANJUEZ V2
2026-02-03 16:16:50 - INFO - Fecha de ejecución: 2026-02-03 16:16:50
2026-02-03 16:16:50 - INFO - ======================================================================
2026-02-03 16:16:50 - INFO - Modo de ejecución: FASE 1 + FASE 2
2026-02-03 16:16:50 - INFO - Envío de emails: Sí
2026-02-03 16:16:50 - INFO - StateManager inicializado. Archivo de estado: .\./data\state.json
2026-02-03 16:16:50 - INFO - Cargando estado desde: .\./data\state.json
2026-02-03 16:16:50 - INFO - Estado cargado correctamente
2026-02-03 16:16:50 - INFO - SchedulerService inicializado correctamente
2026-02-03 16:16:50 - INFO - Horario configurado: sunday a las 15:00
2026-02-03 16:16:50 - INFO - Semana forzada por argumento: 14
2026-02-03 16:16:50 - INFO - ======================================================================
2026-02-03 16:16:50 - INFO - PROCESANDO PEDIDO PARA SEMANA 14
2026-02-03 16:16:50 - INFO - ======================================================================
2026-02-03 16:16:50 - INFO - MODO: FASE 1 (Forecast) + FASE 2 (Corrección)
2026-02-03 16:16:50 - INFO - DataLoader inicializado correctamente
2026-02-03 16:16:50 - INFO - ForecastEngine inicializado correctamente
2026-02-03 16:16:50 - INFO - OrderGenerator inicializado correctamente
2026-02-03 16:16:50 - INFO - SchedulerService inicializado correctamente
2026-02-03 16:16:50 - INFO - Horario configurado: sunday a las 15:00
2026-02-03 16:16:50 - INFO - Período de la semana: 2026-03-30 al 2026-04-05
2026-02-03 16:16:50 - INFO - Stock acumulado cargado: 2633 artículos
2026-02-03 16:16:50 - INFO - 
==================================================
2026-02-03 16:16:50 - INFO - SECCION: MAF
2026-02-03 16:16:50 - INFO - ==================================================
2026-02-03 16:16:50 - INFO - === LEYENDO DATOS PARA SECCIÓN: MAF ===
2026-02-03 16:16:50 - INFO - Archivo ABC encontrado para 'maf': .\./data/input\CLASIFICACION_ABC+D_maf.xlsx
2026-02-03 16:16:50 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_maf.xlsx
2026-02-03 16:16:50 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 16:16:50 - INFO - Clasificación ABC cargada para 'maf': 499 registros
2026-02-03 16:16:50 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 16:16:54 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:16:54 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 16:16:54 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 16:16:54 - INFO - Ventas cargadas: 44082 registros
2026-02-03 16:16:54 - INFO - Filtrados 10970 registros de sección 'maf' de 44082 total
2026-02-03 16:16:54 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 16:16:56 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:16:56 - INFO - Costes cargados: 22145 registros
2026-02-03 16:16:56 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MAF ===
2026-02-03 16:16:56 - INFO -   ABC: 499 registros
2026-02-03 16:16:56 - INFO -   Ventas: 10970 registros
2026-02-03 16:16:56 - INFO -   Costes: 22145 registros
2026-02-03 16:16:56 - INFO - Datos de ventas: 1011 registros
2026-02-03 16:16:56 - INFO - Calculando pedido para semana 14 (1011 registros)
2026-02-03 16:16:56 - INFO -   Objetivo: 7050.65€, Actual (ABC): 5843.77€
2026-02-03 16:16:56 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 16:16:56 - INFO -   Factor total: 1.3125
2026-02-03 16:16:56 - INFO -   Factor escalado: 1.5836
2026-02-03 16:16:56 - INFO -   Ventas preliminares (con ceil): 9931.01€
2026-02-03 16:16:56 - INFO -   Objetivo final: 9253.98€
2026-02-03 16:16:56 - INFO -   Delta: 677.03€
2026-02-03 16:16:56 - INFO -   Ventas finales: 9259.59€
2026-02-03 16:16:56 - INFO - 
============================================================
2026-02-03 16:16:56 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 16:16:56 - INFO - ============================================================
2026-02-03 16:16:56 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 16:16:56 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 16:16:56 - INFO - DataLoader inicializado correctamente
2026-02-03 16:16:56 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 16:16:56 - INFO - ============================================================
2026-02-03 16:16:56 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 16:16:56 - INFO - ============================================================
2026-02-03 16:16:56 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 16:16:56 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 16:16:56 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 16:16:56 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 16:16:56 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 16:16:56 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:16:56 - INFO - Stock actual cargado: 30 registros
2026-02-03 16:16:56 - INFO -   Stock: 30 registros
2026-02-03 16:16:56 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 16:16:57 - INFO - Fusión completada: 222 registros
2026-02-03 16:16:57 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 16:16:57 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 16:16:57 - INFO - Corrección completada:
2026-02-03 16:16:57 - INFO -   - Artículos corregidos: 191/222
2026-02-03 16:16:57 - INFO -   - Artículos aumentados: 191
2026-02-03 16:16:57 - INFO -   - Artículos reducidos: 0
2026-02-03 16:16:57 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 16:16:57 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 16:16:57 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 16:16:57 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 16:16:57 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 16:16:57 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 16:16:57 - INFO -   Articulos: 191
2026-02-03 16:16:57 - INFO -   Importe: 9259.59€
2026-02-03 16:16:57 - INFO - 
==================================================
2026-02-03 16:16:57 - INFO - SECCION: DECO_INTERIOR
2026-02-03 16:16:57 - INFO - ==================================================
2026-02-03 16:16:57 - INFO - === LEYENDO DATOS PARA SECCIÓN: DECO_INTERIOR ===
2026-02-03 16:16:57 - INFO - Archivo ABC encontrado para 'deco_interior': .\./data/input\CLASIFICACION_ABC+D_deco_interior.xlsx
2026-02-03 16:16:57 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_deco_interior.xlsx
2026-02-03 16:16:57 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 16:16:57 - INFO - Clasificación ABC cargada para 'deco_interior': 1827 registros
2026-02-03 16:16:57 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 16:17:01 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:17:01 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 16:17:01 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 16:17:01 - INFO - Ventas cargadas: 44082 registros
2026-02-03 16:17:01 - INFO - Filtrados 2468 registros de sección 'deco_interior' de 44082 total
2026-02-03 16:17:01 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 16:17:03 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:17:03 - INFO - Costes cargados: 22145 registros
2026-02-03 16:17:03 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA DECO_INTERIOR ===
2026-02-03 16:17:03 - INFO -   ABC: 1827 registros
2026-02-03 16:17:03 - INFO -   Ventas: 2468 registros
2026-02-03 16:17:03 - INFO -   Costes: 22145 registros
2026-02-03 16:17:03 - INFO - Datos de ventas: 180 registros
2026-02-03 16:17:03 - INFO - Calculando pedido para semana 14 (180 registros)
2026-02-03 16:17:03 - INFO -   Objetivo: 1962.99€, Actual (ABC): 1636.15€
2026-02-03 16:17:03 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 16:17:03 - INFO -   Factor total: 1.3125
2026-02-03 16:17:03 - INFO -   Factor escalado: 1.5747
2026-02-03 16:17:03 - INFO -   Ventas preliminares (con ceil): 2950.01€
2026-02-03 16:17:03 - INFO -   Objetivo final: 2576.42€
2026-02-03 16:17:03 - INFO -   Delta: 373.59€
2026-02-03 16:17:03 - INFO -   Ventas finales: 2580.73€
2026-02-03 16:17:03 - INFO - 
============================================================
2026-02-03 16:17:03 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 16:17:03 - INFO - ============================================================
2026-02-03 16:17:03 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 16:17:03 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 16:17:03 - INFO - DataLoader inicializado correctamente
2026-02-03 16:17:03 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 16:17:03 - INFO - ============================================================
2026-02-03 16:17:03 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 16:17:03 - INFO - ============================================================
2026-02-03 16:17:03 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 16:17:03 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 16:17:03 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 16:17:03 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 16:17:03 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 16:17:03 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:17:03 - INFO - Stock actual cargado: 30 registros
2026-02-03 16:17:03 - INFO -   Stock: 30 registros
2026-02-03 16:17:03 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 16:17:03 - INFO - Fusión completada: 139 registros
2026-02-03 16:17:03 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 16:17:03 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 16:17:03 - INFO - Corrección completada:
2026-02-03 16:17:03 - INFO -   - Artículos corregidos: 135/139
2026-02-03 16:17:03 - INFO -   - Artículos aumentados: 135
2026-02-03 16:17:03 - INFO -   - Artículos reducidos: 0
2026-02-03 16:17:03 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 16:17:03 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 16:17:03 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 16:17:03 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_deco_interior.xlsx
2026-02-03 16:17:03 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_deco_interior.xlsx
2026-02-03 16:17:03 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_deco_interior.xlsx
2026-02-03 16:17:03 - INFO -   Articulos: 135
2026-02-03 16:17:03 - INFO -   Importe: 2580.73€
2026-02-03 16:17:03 - INFO - 
==================================================
2026-02-03 16:17:03 - INFO - SECCION: SEMILLAS
2026-02-03 16:17:03 - INFO - ==================================================
2026-02-03 16:17:03 - INFO - === LEYENDO DATOS PARA SECCIÓN: SEMILLAS ===
2026-02-03 16:17:03 - INFO - Archivo ABC encontrado para 'semillas': .\./data/input\CLASIFICACION_ABC+D_semillas.xlsx
2026-02-03 16:17:03 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_semillas.xlsx
2026-02-03 16:17:03 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 16:17:04 - INFO - Clasificación ABC cargada para 'semillas': 218 registros
2026-02-03 16:17:04 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 16:17:07 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:17:07 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 16:17:07 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 16:17:07 - INFO - Ventas cargadas: 44082 registros
2026-02-03 16:17:07 - INFO - Filtrados 1180 registros de sección 'semillas' de 44082 total
2026-02-03 16:17:07 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 16:17:09 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:17:09 - INFO - Costes cargados: 22145 registros
2026-02-03 16:17:09 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA SEMILLAS ===
2026-02-03 16:17:09 - INFO -   ABC: 218 registros
2026-02-03 16:17:09 - INFO -   Ventas: 1180 registros
2026-02-03 16:17:09 - INFO -   Costes: 22145 registros
2026-02-03 16:17:09 - INFO - Datos de ventas: 136 registros
2026-02-03 16:17:09 - INFO - Calculando pedido para semana 14 (136 registros)
2026-02-03 16:17:10 - INFO -   Objetivo: 694.34€, Actual (ABC): 455.14€
2026-02-03 16:17:10 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 16:17:10 - INFO -   Factor total: 1.3125
2026-02-03 16:17:10 - INFO -   Factor escalado: 2.0023
2026-02-03 16:17:10 - INFO -   Ventas preliminares (con ceil): 1129.15€
2026-02-03 16:17:10 - INFO -   Objetivo final: 911.32€
2026-02-03 16:17:10 - INFO -   Delta: 217.83€
2026-02-03 16:17:10 - INFO -   Ventas finales: 911.60€
2026-02-03 16:17:10 - INFO - 
============================================================
2026-02-03 16:17:10 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 16:17:10 - INFO - ============================================================
2026-02-03 16:17:10 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 16:17:10 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 16:17:10 - INFO - DataLoader inicializado correctamente
2026-02-03 16:17:10 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 16:17:10 - INFO - ============================================================
2026-02-03 16:17:10 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 16:17:10 - INFO - ============================================================
2026-02-03 16:17:10 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 16:17:10 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 16:17:10 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 16:17:10 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 16:17:10 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 16:17:10 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:17:10 - INFO - Stock actual cargado: 30 registros
2026-02-03 16:17:10 - INFO -   Stock: 30 registros
2026-02-03 16:17:10 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 16:17:10 - INFO - Fusión completada: 84 registros
2026-02-03 16:17:10 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 16:17:10 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 16:17:10 - INFO - Corrección completada:
2026-02-03 16:17:10 - INFO -   - Artículos corregidos: 84/84
2026-02-03 16:17:10 - INFO -   - Artículos aumentados: 84
2026-02-03 16:17:10 - INFO -   - Artículos reducidos: 0
2026-02-03 16:17:10 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 16:17:10 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 16:17:10 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 16:17:10 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_semillas.xlsx
2026-02-03 16:17:10 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_semillas.xlsx
2026-02-03 16:17:10 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_semillas.xlsx
2026-02-03 16:17:10 - INFO -   Articulos: 84
2026-02-03 16:17:10 - INFO -   Importe: 911.60€
2026-02-03 16:17:10 - INFO - 
==================================================
2026-02-03 16:17:10 - INFO - SECCION: MASCOTAS_VIVO
2026-02-03 16:17:10 - INFO - ==================================================
2026-02-03 16:17:10 - INFO - === LEYENDO DATOS PARA SECCIÓN: MASCOTAS_VIVO ===
2026-02-03 16:17:10 - INFO - Archivo ABC encontrado para 'mascotas_vivo': .\./data/input\CLASIFICACION_ABC+D_mascotas_vivo.xlsx
2026-02-03 16:17:10 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_mascotas_vivo.xlsx
2026-02-03 16:17:10 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 16:17:10 - INFO - Clasificación ABC cargada para 'mascotas_vivo': 205 registros
2026-02-03 16:17:10 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 16:17:13 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:17:13 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 16:17:14 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 16:17:14 - INFO - Ventas cargadas: 44082 registros
2026-02-03 16:17:14 - INFO - Filtrados 1124 registros de sección 'mascotas_vivo' de 44082 total
2026-02-03 16:17:14 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 16:56:18 - INFO - ======================================================================
2026-02-03 16:56:18 - INFO - SISTEMA DE PEDIDOS DE COMPRA - VIVERO ARANJUEZ V2
2026-02-03 16:56:18 - INFO - Fecha de ejecución: 2026-02-03 16:56:18
2026-02-03 16:56:18 - INFO - ======================================================================
2026-02-03 16:56:18 - INFO - Modo de ejecución: FASE 1 + FASE 2
2026-02-03 16:56:18 - INFO - Envío de emails: Sí
2026-02-03 16:56:18 - INFO - StateManager inicializado. Archivo de estado: .\./data\state.json
2026-02-03 16:56:18 - INFO - Cargando estado desde: .\./data\state.json
2026-02-03 16:56:18 - INFO - Estado cargado correctamente
2026-02-03 16:56:18 - INFO - SchedulerService inicializado correctamente
2026-02-03 16:56:18 - INFO - Horario configurado: sunday a las 15:00
2026-02-03 16:56:18 - INFO - Semana forzada por argumento: 14
2026-02-03 16:56:18 - INFO - ======================================================================
2026-02-03 16:56:18 - INFO - PROCESANDO PEDIDO PARA SEMANA 14
2026-02-03 16:56:18 - INFO - ======================================================================
2026-02-03 16:56:18 - INFO - MODO: FASE 1 (Forecast) + FASE 2 (Corrección)
2026-02-03 16:56:18 - INFO - DataLoader inicializado correctamente
2026-02-03 16:56:18 - INFO - ForecastEngine inicializado correctamente
2026-02-03 16:56:18 - INFO - OrderGenerator inicializado correctamente
2026-02-03 16:56:18 - INFO - SchedulerService inicializado correctamente
2026-02-03 16:56:18 - INFO - Horario configurado: sunday a las 15:00
2026-02-03 16:56:18 - INFO - Período de la semana: 2026-03-30 al 2026-04-05
2026-02-03 16:56:18 - INFO - Stock acumulado cargado: 2633 artículos
2026-02-03 16:56:18 - INFO - 
==================================================
2026-02-03 16:56:18 - INFO - SECCION: MAF
2026-02-03 16:56:18 - INFO - ==================================================
2026-02-03 16:56:18 - INFO - === LEYENDO DATOS PARA SECCIÓN: MAF ===
2026-02-03 16:56:18 - INFO - Archivo ABC encontrado para 'maf': .\./data/input\CLASIFICACION_ABC+D_maf.xlsx
2026-02-03 16:56:18 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_maf.xlsx
2026-02-03 16:56:18 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 16:56:18 - INFO - Clasificación ABC cargada para 'maf': 499 registros
2026-02-03 16:56:18 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 16:56:22 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:56:22 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 16:56:22 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 16:56:22 - INFO - Ventas cargadas: 44082 registros
2026-02-03 16:56:22 - INFO - Filtrados 10970 registros de sección 'maf' de 44082 total
2026-02-03 16:56:22 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 16:56:24 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:56:24 - INFO - Costes cargados: 22145 registros
2026-02-03 16:56:24 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MAF ===
2026-02-03 16:56:24 - INFO -   ABC: 499 registros
2026-02-03 16:56:24 - INFO -   Ventas: 10970 registros
2026-02-03 16:56:24 - INFO -   Costes: 22145 registros
2026-02-03 16:56:24 - INFO - Datos de ventas: 1011 registros
2026-02-03 16:56:24 - INFO - Calculando pedido para semana 14 (1011 registros)
2026-02-03 16:56:24 - INFO -   Objetivo: 7050.65€, Actual (ABC): 5843.77€
2026-02-03 16:56:24 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 16:56:24 - INFO -   Factor total: 1.3125
2026-02-03 16:56:24 - INFO -   Factor escalado: 1.5836
2026-02-03 16:56:24 - INFO -   Ventas preliminares (con ceil): 9931.01€
2026-02-03 16:56:24 - INFO -   Objetivo final: 9253.98€
2026-02-03 16:56:24 - INFO -   Delta: 677.03€
2026-02-03 16:56:24 - INFO -   Ventas finales: 9259.59€
2026-02-03 16:56:24 - INFO - 
============================================================
2026-02-03 16:56:24 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 16:56:24 - INFO - ============================================================
2026-02-03 16:56:24 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 16:56:24 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 16:56:24 - INFO - DataLoader inicializado correctamente
2026-02-03 16:56:24 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 16:56:24 - INFO - ============================================================
2026-02-03 16:56:24 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 16:56:24 - INFO - ============================================================
2026-02-03 16:56:24 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 16:56:24 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 16:56:24 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 16:56:24 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 16:56:24 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 16:56:24 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:56:24 - INFO - Stock actual cargado: 30 registros
2026-02-03 16:56:24 - INFO -   Stock: 30 registros
2026-02-03 16:56:24 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 16:56:24 - INFO - Fusión completada: 222 registros
2026-02-03 16:56:24 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 16:56:24 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 16:56:24 - INFO - Corrección completada:
2026-02-03 16:56:24 - INFO -   - Artículos corregidos: 191/222
2026-02-03 16:56:24 - INFO -   - Artículos aumentados: 191
2026-02-03 16:56:24 - INFO -   - Artículos reducidos: 0
2026-02-03 16:56:24 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 16:56:25 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 16:56:25 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 16:56:25 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 16:56:25 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 16:56:25 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 16:56:25 - INFO -   Articulos: 191
2026-02-03 16:56:25 - INFO -   Importe: 9259.59€
2026-02-03 16:56:25 - INFO - 
==================================================
2026-02-03 16:56:25 - INFO - SECCION: DECO_INTERIOR
2026-02-03 16:56:25 - INFO - ==================================================
2026-02-03 16:56:25 - INFO - === LEYENDO DATOS PARA SECCIÓN: DECO_INTERIOR ===
2026-02-03 16:56:25 - INFO - Archivo ABC encontrado para 'deco_interior': .\./data/input\CLASIFICACION_ABC+D_deco_interior.xlsx
2026-02-03 16:56:25 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_deco_interior.xlsx
2026-02-03 16:56:25 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 16:56:25 - INFO - Clasificación ABC cargada para 'deco_interior': 1827 registros
2026-02-03 16:56:25 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 16:56:29 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:56:29 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 16:56:29 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 16:56:29 - INFO - Ventas cargadas: 44082 registros
2026-02-03 16:56:29 - INFO - Filtrados 2468 registros de sección 'deco_interior' de 44082 total
2026-02-03 16:56:29 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 16:56:31 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:56:31 - INFO - Costes cargados: 22145 registros
2026-02-03 16:56:31 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA DECO_INTERIOR ===
2026-02-03 16:56:31 - INFO -   ABC: 1827 registros
2026-02-03 16:56:31 - INFO -   Ventas: 2468 registros
2026-02-03 16:56:31 - INFO -   Costes: 22145 registros
2026-02-03 16:56:31 - INFO - Datos de ventas: 180 registros
2026-02-03 16:56:31 - INFO - Calculando pedido para semana 14 (180 registros)
2026-02-03 16:56:31 - INFO -   Objetivo: 1962.99€, Actual (ABC): 1636.15€
2026-02-03 16:56:31 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 16:56:31 - INFO -   Factor total: 1.3125
2026-02-03 16:56:31 - INFO -   Factor escalado: 1.5747
2026-02-03 16:56:31 - INFO -   Ventas preliminares (con ceil): 2950.01€
2026-02-03 16:56:31 - INFO -   Objetivo final: 2576.42€
2026-02-03 16:56:31 - INFO -   Delta: 373.59€
2026-02-03 16:56:31 - INFO -   Ventas finales: 2580.73€
2026-02-03 16:56:31 - INFO - 
============================================================
2026-02-03 16:56:31 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 16:56:31 - INFO - ============================================================
2026-02-03 16:56:31 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 16:56:31 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 16:56:31 - INFO - DataLoader inicializado correctamente
2026-02-03 16:56:31 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 16:56:31 - INFO - ============================================================
2026-02-03 16:56:31 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 16:56:31 - INFO - ============================================================
2026-02-03 16:56:31 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 16:56:31 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 16:56:31 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 16:56:31 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 16:56:31 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 16:56:31 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:56:31 - INFO - Stock actual cargado: 30 registros
2026-02-03 16:56:31 - INFO -   Stock: 30 registros
2026-02-03 16:56:31 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 16:56:31 - INFO - Fusión completada: 139 registros
2026-02-03 16:56:31 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 16:56:31 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 16:56:31 - INFO - Corrección completada:
2026-02-03 16:56:31 - INFO -   - Artículos corregidos: 135/139
2026-02-03 16:56:31 - INFO -   - Artículos aumentados: 135
2026-02-03 16:56:31 - INFO -   - Artículos reducidos: 0
2026-02-03 16:56:31 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 16:56:31 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 16:56:31 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 16:56:31 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_deco_interior.xlsx
2026-02-03 16:56:31 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_deco_interior.xlsx
2026-02-03 16:56:31 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_deco_interior.xlsx
2026-02-03 16:56:31 - INFO -   Articulos: 135
2026-02-03 16:56:31 - INFO -   Importe: 2580.73€
2026-02-03 16:56:31 - INFO - 
==================================================
2026-02-03 16:56:31 - INFO - SECCION: SEMILLAS
2026-02-03 16:56:31 - INFO - ==================================================
2026-02-03 16:56:31 - INFO - === LEYENDO DATOS PARA SECCIÓN: SEMILLAS ===
2026-02-03 16:56:31 - INFO - Archivo ABC encontrado para 'semillas': .\./data/input\CLASIFICACION_ABC+D_semillas.xlsx
2026-02-03 16:56:31 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_semillas.xlsx
2026-02-03 16:56:31 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 16:56:31 - INFO - Clasificación ABC cargada para 'semillas': 218 registros
2026-02-03 16:56:31 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 16:56:35 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:56:35 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 16:56:35 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 16:56:35 - INFO - Ventas cargadas: 44082 registros
2026-02-03 16:56:35 - INFO - Filtrados 1180 registros de sección 'semillas' de 44082 total
2026-02-03 16:56:35 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 16:56:37 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:56:37 - INFO - Costes cargados: 22145 registros
2026-02-03 16:56:37 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA SEMILLAS ===
2026-02-03 16:56:37 - INFO -   ABC: 218 registros
2026-02-03 16:56:37 - INFO -   Ventas: 1180 registros
2026-02-03 16:56:37 - INFO -   Costes: 22145 registros
2026-02-03 16:56:37 - INFO - Datos de ventas: 136 registros
2026-02-03 16:56:37 - INFO - Calculando pedido para semana 14 (136 registros)
2026-02-03 16:56:38 - INFO -   Objetivo: 694.34€, Actual (ABC): 455.14€
2026-02-03 16:56:38 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 16:56:38 - INFO -   Factor total: 1.3125
2026-02-03 16:56:38 - INFO -   Factor escalado: 2.0023
2026-02-03 16:56:38 - INFO -   Ventas preliminares (con ceil): 1129.15€
2026-02-03 16:56:38 - INFO -   Objetivo final: 911.32€
2026-02-03 16:56:38 - INFO -   Delta: 217.83€
2026-02-03 16:56:38 - INFO -   Ventas finales: 911.60€
2026-02-03 16:56:38 - INFO - 
============================================================
2026-02-03 16:56:38 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 16:56:38 - INFO - ============================================================
2026-02-03 16:56:38 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 16:56:38 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 16:56:38 - INFO - DataLoader inicializado correctamente
2026-02-03 16:56:38 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 16:56:38 - INFO - ============================================================
2026-02-03 16:56:38 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 16:56:38 - INFO - ============================================================
2026-02-03 16:56:38 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 16:56:38 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 16:56:38 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 16:56:38 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 16:56:38 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 16:56:38 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:56:38 - INFO - Stock actual cargado: 30 registros
2026-02-03 16:56:38 - INFO -   Stock: 30 registros
2026-02-03 16:56:38 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 16:56:38 - INFO - Fusión completada: 84 registros
2026-02-03 16:56:38 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 16:56:38 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 16:56:38 - INFO - Corrección completada:
2026-02-03 16:56:38 - INFO -   - Artículos corregidos: 84/84
2026-02-03 16:56:38 - INFO -   - Artículos aumentados: 84
2026-02-03 16:56:38 - INFO -   - Artículos reducidos: 0
2026-02-03 16:56:38 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 16:56:38 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 16:56:38 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 16:56:38 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_semillas.xlsx
2026-02-03 16:56:38 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_semillas.xlsx
2026-02-03 16:56:38 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_semillas.xlsx
2026-02-03 16:56:38 - INFO -   Articulos: 84
2026-02-03 16:56:38 - INFO -   Importe: 911.60€
2026-02-03 16:56:38 - INFO - 
==================================================
2026-02-03 16:56:38 - INFO - SECCION: MASCOTAS_VIVO
2026-02-03 16:56:38 - INFO - ==================================================
2026-02-03 16:56:38 - INFO - === LEYENDO DATOS PARA SECCIÓN: MASCOTAS_VIVO ===
2026-02-03 16:56:38 - INFO - Archivo ABC encontrado para 'mascotas_vivo': .\./data/input\CLASIFICACION_ABC+D_mascotas_vivo.xlsx
2026-02-03 16:56:38 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_mascotas_vivo.xlsx
2026-02-03 16:56:38 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 16:56:38 - INFO - Clasificación ABC cargada para 'mascotas_vivo': 205 registros
2026-02-03 16:56:38 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 16:56:41 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:56:41 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 16:56:41 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 16:56:42 - INFO - Ventas cargadas: 44082 registros
2026-02-03 16:56:42 - INFO - Filtrados 1124 registros de sección 'mascotas_vivo' de 44082 total
2026-02-03 16:56:42 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 16:56:43 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:56:44 - INFO - Costes cargados: 22145 registros
2026-02-03 16:56:44 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MASCOTAS_VIVO ===
2026-02-03 16:56:44 - INFO -   ABC: 205 registros
2026-02-03 16:56:44 - INFO -   Ventas: 1124 registros
2026-02-03 16:56:44 - INFO -   Costes: 22145 registros
2026-02-03 16:56:44 - INFO - Datos de ventas: 88 registros
2026-02-03 16:56:44 - INFO - Calculando pedido para semana 14 (88 registros)
2026-02-03 16:56:44 - INFO -   Objetivo: 1087.15€, Actual (ABC): 846.63€
2026-02-03 16:56:44 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 16:56:44 - INFO -   Factor total: 1.3125
2026-02-03 16:56:44 - INFO -   Factor escalado: 1.6854
2026-02-03 16:56:44 - INFO -   Ventas preliminares (con ceil): 1773.66€
2026-02-03 16:56:44 - INFO -   Objetivo final: 1426.88€
2026-02-03 16:56:44 - INFO -   Delta: 346.78€
2026-02-03 16:56:44 - INFO -   Ventas finales: 1455.34€
2026-02-03 16:56:44 - INFO - 
============================================================
2026-02-03 16:56:44 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 16:56:44 - INFO - ============================================================
2026-02-03 16:56:44 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 16:56:44 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 16:56:44 - INFO - DataLoader inicializado correctamente
2026-02-03 16:56:44 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 16:56:44 - INFO - ============================================================
2026-02-03 16:56:44 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 16:56:44 - INFO - ============================================================
2026-02-03 16:56:44 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 16:56:44 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 16:56:44 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 16:56:44 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 16:56:44 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 16:56:44 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:56:44 - INFO - Stock actual cargado: 30 registros
2026-02-03 16:56:44 - INFO -   Stock: 30 registros
2026-02-03 16:56:44 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 16:56:44 - INFO - Fusión completada: 43 registros
2026-02-03 16:56:44 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 16:56:44 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 16:56:44 - INFO - Corrección completada:
2026-02-03 16:56:44 - INFO -   - Artículos corregidos: 36/43
2026-02-03 16:56:44 - INFO -   - Artículos aumentados: 36
2026-02-03 16:56:44 - INFO -   - Artículos reducidos: 0
2026-02-03 16:56:44 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 16:56:44 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 16:56:44 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 16:56:44 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx
2026-02-03 16:56:44 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx
2026-02-03 16:56:44 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx
2026-02-03 16:56:44 - INFO -   Articulos: 36
2026-02-03 16:56:44 - INFO -   Importe: 1455.34€
2026-02-03 16:56:44 - INFO - 
==================================================
2026-02-03 16:56:44 - INFO - SECCION: MASCOTAS_MANUFACTURADO
2026-02-03 16:56:44 - INFO - ==================================================
2026-02-03 16:56:44 - INFO - === LEYENDO DATOS PARA SECCIÓN: MASCOTAS_MANUFACTURADO ===
2026-02-03 16:56:44 - INFO - Archivo ABC encontrado para 'mascotas_manufacturado': .\./data/input\CLASIFICACION_ABC+D_mascotas_manufacturado.xlsx
2026-02-03 16:56:44 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_mascotas_manufacturado.xlsx
2026-02-03 16:56:44 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 16:56:44 - INFO - Clasificación ABC cargada para 'mascotas_manufacturado': 2749 registros
2026-02-03 16:56:44 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 16:56:48 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:56:48 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 16:56:48 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 16:56:48 - INFO - Ventas cargadas: 44082 registros
2026-02-03 16:56:48 - INFO - Filtrados 9784 registros de sección 'mascotas_manufacturado' de 44082 total
2026-02-03 16:56:48 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 16:56:50 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:56:50 - INFO - Costes cargados: 22145 registros
2026-02-03 16:56:50 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MASCOTAS_MANUFACTURADO ===
2026-02-03 16:56:50 - INFO -   ABC: 2749 registros
2026-02-03 16:56:50 - INFO -   Ventas: 9784 registros
2026-02-03 16:56:50 - INFO -   Costes: 22145 registros
2026-02-03 16:56:50 - INFO - Datos de ventas: 822 registros
2026-02-03 16:56:50 - INFO - Calculando pedido para semana 14 (822 registros)
2026-02-03 16:56:52 - INFO -   Objetivo: 6839.82€, Actual (ABC): 8742.92€
2026-02-03 16:56:52 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 16:56:52 - INFO -   Factor total: 1.3125
2026-02-03 16:56:52 - INFO -   Factor escalado: 1.0268
2026-02-03 16:56:52 - INFO -   Ventas preliminares (con ceil): 12379.25€
2026-02-03 16:56:52 - INFO -   Objetivo final: 8977.26€
2026-02-03 16:56:52 - INFO -   Delta: 3401.99€
2026-02-03 16:56:52 - INFO -   Ventas finales: 8993.98€
2026-02-03 16:56:52 - INFO - 
============================================================
2026-02-03 16:56:52 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 16:56:52 - INFO - ============================================================
2026-02-03 16:56:52 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 16:56:52 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 16:56:52 - INFO - DataLoader inicializado correctamente
2026-02-03 16:56:52 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 16:56:52 - INFO - ============================================================
2026-02-03 16:56:52 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 16:56:52 - INFO - ============================================================
2026-02-03 16:56:52 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 16:56:52 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 16:56:52 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 16:56:52 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 16:56:52 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 16:56:52 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:56:52 - INFO - Stock actual cargado: 30 registros
2026-02-03 16:56:52 - INFO -   Stock: 30 registros
2026-02-03 16:56:52 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 16:56:52 - INFO - Fusión completada: 538 registros
2026-02-03 16:56:52 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 16:56:52 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 16:56:52 - INFO - Corrección completada:
2026-02-03 16:56:52 - INFO -   - Artículos corregidos: 411/538
2026-02-03 16:56:52 - INFO -   - Artículos aumentados: 411
2026-02-03 16:56:52 - INFO -   - Artículos reducidos: 0
2026-02-03 16:56:52 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 16:56:52 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 16:56:52 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 16:56:52 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx
2026-02-03 16:56:52 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx
2026-02-03 16:56:52 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx
2026-02-03 16:56:52 - INFO -   Articulos: 411
2026-02-03 16:56:52 - INFO -   Importe: 8993.98€
2026-02-03 16:56:52 - INFO - 
==================================================
2026-02-03 16:56:52 - INFO - SECCION: INTERIOR
2026-02-03 16:56:52 - INFO - ==================================================
2026-02-03 16:56:52 - INFO - === LEYENDO DATOS PARA SECCIÓN: INTERIOR ===
2026-02-03 16:56:52 - INFO - Archivo ABC encontrado para 'interior': .\./data/input\CLASIFICACION_ABC+D_interior.xlsx
2026-02-03 16:56:52 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_interior.xlsx
2026-02-03 16:56:53 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 16:56:53 - INFO - Clasificación ABC cargada para 'interior': 555 registros
2026-02-03 16:56:53 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 16:56:56 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:56:56 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 16:56:56 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 16:56:56 - INFO - Ventas cargadas: 44082 registros
2026-02-03 16:56:56 - INFO - Filtrados 3624 registros de sección 'interior' de 44082 total
2026-02-03 16:56:56 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 16:56:58 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:56:58 - INFO - Costes cargados: 22145 registros
2026-02-03 16:56:58 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA INTERIOR ===
2026-02-03 16:56:58 - INFO -   ABC: 555 registros
2026-02-03 16:56:58 - INFO -   Ventas: 3624 registros
2026-02-03 16:56:58 - INFO -   Costes: 22145 registros
2026-02-03 16:56:58 - INFO - Datos de ventas: 286 registros
2026-02-03 16:56:58 - INFO - Calculando pedido para semana 14 (286 registros)
2026-02-03 16:56:59 - INFO -   Objetivo: 2930.63€, Actual (ABC): 2409.44€
2026-02-03 16:56:59 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 16:56:59 - INFO -   Factor total: 1.3125
2026-02-03 16:56:59 - INFO -   Factor escalado: 1.5964
2026-02-03 16:56:59 - INFO -   Ventas preliminares (con ceil): 4541.81€
2026-02-03 16:56:59 - INFO -   Objetivo final: 3846.45€
2026-02-03 16:56:59 - INFO -   Delta: 695.36€
2026-02-03 16:56:59 - INFO -   Ventas finales: 3855.17€
2026-02-03 16:56:59 - INFO - 
============================================================
2026-02-03 16:56:59 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 16:56:59 - INFO - ============================================================
2026-02-03 16:56:59 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 16:56:59 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 16:56:59 - INFO - DataLoader inicializado correctamente
2026-02-03 16:56:59 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 16:56:59 - INFO - ============================================================
2026-02-03 16:56:59 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 16:56:59 - INFO - ============================================================
2026-02-03 16:56:59 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 16:56:59 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 16:56:59 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 16:56:59 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 16:56:59 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 16:56:59 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:56:59 - INFO - Stock actual cargado: 30 registros
2026-02-03 16:56:59 - INFO -   Stock: 30 registros
2026-02-03 16:56:59 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 16:56:59 - INFO - Fusión completada: 138 registros
2026-02-03 16:56:59 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 16:56:59 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 16:56:59 - INFO - Corrección completada:
2026-02-03 16:56:59 - INFO -   - Artículos corregidos: 121/138
2026-02-03 16:56:59 - INFO -   - Artículos aumentados: 121
2026-02-03 16:56:59 - INFO -   - Artículos reducidos: 0
2026-02-03 16:56:59 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 16:56:59 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 16:56:59 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 16:56:59 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_interior.xlsx
2026-02-03 16:56:59 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_interior.xlsx
2026-02-03 16:56:59 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_interior.xlsx
2026-02-03 16:56:59 - INFO -   Articulos: 121
2026-02-03 16:56:59 - INFO -   Importe: 3855.17€
2026-02-03 16:56:59 - INFO - 
==================================================
2026-02-03 16:56:59 - INFO - SECCION: FITOS
2026-02-03 16:56:59 - INFO - ==================================================
2026-02-03 16:56:59 - INFO - === LEYENDO DATOS PARA SECCIÓN: FITOS ===
2026-02-03 16:56:59 - INFO - Archivo ABC encontrado para 'fitos': .\./data/input\CLASIFICACION_ABC+D_fitos.xlsx
2026-02-03 16:56:59 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_fitos.xlsx
2026-02-03 16:56:59 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 16:56:59 - INFO - Clasificación ABC cargada para 'fitos': 247 registros
2026-02-03 16:56:59 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 16:57:03 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:57:03 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 16:57:03 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 16:57:03 - INFO - Ventas cargadas: 44082 registros
2026-02-03 16:57:03 - INFO - Filtrados 1987 registros de sección 'fitos' de 44082 total
2026-02-03 16:57:03 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 16:57:05 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:57:05 - INFO - Costes cargados: 22145 registros
2026-02-03 16:57:05 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA FITOS ===
2026-02-03 16:57:05 - INFO -   ABC: 247 registros
2026-02-03 16:57:05 - INFO -   Ventas: 1987 registros
2026-02-03 16:57:05 - INFO -   Costes: 22145 registros
2026-02-03 16:57:05 - INFO - Datos de ventas: 157 registros
2026-02-03 16:57:05 - INFO - Calculando pedido para semana 14 (157 registros)
2026-02-03 16:57:05 - INFO -   Objetivo: 1798.25€, Actual (ABC): 1679.26€
2026-02-03 16:57:05 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 16:57:05 - INFO -   Factor total: 1.3125
2026-02-03 16:57:05 - INFO -   Factor escalado: 1.4055
2026-02-03 16:57:05 - INFO -   Ventas preliminares (con ceil): 2784.94€
2026-02-03 16:57:05 - INFO -   Objetivo final: 2360.20€
2026-02-03 16:57:05 - INFO -   Delta: 424.74€
2026-02-03 16:57:05 - INFO -   Ventas finales: 2365.92€
2026-02-03 16:57:05 - INFO - 
============================================================
2026-02-03 16:57:05 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 16:57:05 - INFO - ============================================================
2026-02-03 16:57:05 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 16:57:05 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 16:57:05 - INFO - DataLoader inicializado correctamente
2026-02-03 16:57:05 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 16:57:05 - INFO - ============================================================
2026-02-03 16:57:05 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 16:57:05 - INFO - ============================================================
2026-02-03 16:57:05 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 16:57:05 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 16:57:05 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 16:57:05 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 16:57:05 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 16:57:05 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:57:05 - INFO - Stock actual cargado: 30 registros
2026-02-03 16:57:05 - INFO -   Stock: 30 registros
2026-02-03 16:57:05 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 16:57:05 - INFO - Fusión completada: 84 registros
2026-02-03 16:57:05 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 16:57:05 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 16:57:05 - INFO - Corrección completada:
2026-02-03 16:57:05 - INFO -   - Artículos corregidos: 82/84
2026-02-03 16:57:05 - INFO -   - Artículos aumentados: 82
2026-02-03 16:57:05 - INFO -   - Artículos reducidos: 0
2026-02-03 16:57:05 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 16:57:05 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 16:57:05 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 16:57:05 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_fitos.xlsx
2026-02-03 16:57:05 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_fitos.xlsx
2026-02-03 16:57:05 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_fitos.xlsx
2026-02-03 16:57:05 - INFO -   Articulos: 82
2026-02-03 16:57:05 - INFO -   Importe: 2365.92€
2026-02-03 16:57:05 - INFO - 
==================================================
2026-02-03 16:57:05 - INFO - SECCION: VIVERO
2026-02-03 16:57:05 - INFO - ==================================================
2026-02-03 16:57:05 - INFO - === LEYENDO DATOS PARA SECCIÓN: VIVERO ===
2026-02-03 16:57:05 - INFO - Archivo ABC encontrado para 'vivero': .\./data/input\CLASIFICACION_ABC+D_vivero.xlsx
2026-02-03 16:57:05 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_vivero.xlsx
2026-02-03 16:57:05 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 16:57:05 - INFO - Clasificación ABC cargada para 'vivero': 565 registros
2026-02-03 16:57:05 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 16:57:09 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:57:09 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 16:57:09 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 16:57:09 - INFO - Ventas cargadas: 44082 registros
2026-02-03 16:57:09 - INFO - Filtrados 2460 registros de sección 'vivero' de 44082 total
2026-02-03 16:57:09 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 16:57:11 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:57:11 - INFO - Costes cargados: 22145 registros
2026-02-03 16:57:11 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA VIVERO ===
2026-02-03 16:57:11 - INFO -   ABC: 565 registros
2026-02-03 16:57:11 - INFO -   Ventas: 2460 registros
2026-02-03 16:57:11 - INFO -   Costes: 22145 registros
2026-02-03 16:57:11 - INFO - Datos de ventas: 189 registros
2026-02-03 16:57:11 - INFO - Calculando pedido para semana 14 (189 registros)
2026-02-03 16:57:11 - INFO -   Objetivo: 5297.17€, Actual (ABC): 4113.14€
2026-02-03 16:57:11 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 16:57:11 - INFO -   Factor total: 1.3125
2026-02-03 16:57:11 - INFO -   Factor escalado: 1.6903
2026-02-03 16:57:11 - INFO -   Ventas preliminares (con ceil): 8761.94€
2026-02-03 16:57:11 - INFO -   Objetivo final: 6952.54€
2026-02-03 16:57:11 - INFO -   Delta: 1809.40€
2026-02-03 16:57:11 - INFO -   Ventas finales: 6990.51€
2026-02-03 16:57:11 - INFO - 
============================================================
2026-02-03 16:57:11 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 16:57:11 - INFO - ============================================================
2026-02-03 16:57:11 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 16:57:11 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 16:57:11 - INFO - DataLoader inicializado correctamente
2026-02-03 16:57:11 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 16:57:11 - INFO - ============================================================
2026-02-03 16:57:11 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 16:57:11 - INFO - ============================================================
2026-02-03 16:57:11 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 16:57:11 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 16:57:11 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 16:57:11 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 16:57:11 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 16:57:11 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:57:11 - INFO - Stock actual cargado: 30 registros
2026-02-03 16:57:11 - INFO -   Stock: 30 registros
2026-02-03 16:57:11 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 16:57:11 - INFO - Fusión completada: 107 registros
2026-02-03 16:57:11 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 16:57:11 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 16:57:11 - INFO - Corrección completada:
2026-02-03 16:57:11 - INFO -   - Artículos corregidos: 96/107
2026-02-03 16:57:11 - INFO -   - Artículos aumentados: 96
2026-02-03 16:57:11 - INFO -   - Artículos reducidos: 0
2026-02-03 16:57:11 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 16:57:11 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 16:57:11 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 16:57:11 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_vivero.xlsx
2026-02-03 16:57:12 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_vivero.xlsx
2026-02-03 16:57:12 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_vivero.xlsx
2026-02-03 16:57:12 - INFO -   Articulos: 96
2026-02-03 16:57:12 - INFO -   Importe: 6990.51€
2026-02-03 16:57:12 - INFO - 
==================================================
2026-02-03 16:57:12 - INFO - SECCION: UTILES_JARDIN
2026-02-03 16:57:12 - INFO - ==================================================
2026-02-03 16:57:12 - INFO - === LEYENDO DATOS PARA SECCIÓN: UTILES_JARDIN ===
2026-02-03 16:57:12 - INFO - Archivo ABC encontrado para 'utiles_jardin': .\./data/input\CLASIFICACION_ABC+D_utiles_jardin.xlsx
2026-02-03 16:57:12 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_utiles_jardin.xlsx
2026-02-03 16:57:12 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 16:57:12 - INFO - Clasificación ABC cargada para 'utiles_jardin': 433 registros
2026-02-03 16:57:12 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 16:57:15 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:57:15 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 16:57:15 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 16:57:15 - INFO - Ventas cargadas: 44082 registros
2026-02-03 16:57:15 - INFO - Filtrados 1009 registros de sección 'utiles_jardin' de 44082 total
2026-02-03 16:57:15 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 16:57:17 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:57:17 - INFO - Costes cargados: 22145 registros
2026-02-03 16:57:17 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA UTILES_JARDIN ===
2026-02-03 16:57:17 - INFO -   ABC: 433 registros
2026-02-03 16:57:17 - INFO -   Ventas: 1009 registros
2026-02-03 16:57:17 - INFO -   Costes: 22145 registros
2026-02-03 16:57:17 - INFO - Datos de ventas: 89 registros
2026-02-03 16:57:17 - INFO - Calculando pedido para semana 14 (89 registros)
2026-02-03 16:57:18 - INFO -   Objetivo: 1044.77€, Actual (ABC): 818.79€
2026-02-03 16:57:18 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 16:57:18 - INFO -   Factor total: 1.3125
2026-02-03 16:57:18 - INFO -   Factor escalado: 1.6747
2026-02-03 16:57:18 - INFO -   Ventas preliminares (con ceil): 1929.56€
2026-02-03 16:57:18 - INFO -   Objetivo final: 1371.26€
2026-02-03 16:57:18 - INFO -   Delta: 558.30€
2026-02-03 16:57:18 - INFO -   Ventas finales: 1390.00€
2026-02-03 16:57:18 - INFO - 
============================================================
2026-02-03 16:57:18 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 16:57:18 - INFO - ============================================================
2026-02-03 16:57:18 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 16:57:18 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 16:57:18 - INFO - DataLoader inicializado correctamente
2026-02-03 16:57:18 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 16:57:18 - INFO - ============================================================
2026-02-03 16:57:18 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 16:57:18 - INFO - ============================================================
2026-02-03 16:57:18 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 16:57:18 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 16:57:18 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 16:57:18 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 16:57:18 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 16:57:18 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:57:18 - INFO - Stock actual cargado: 30 registros
2026-02-03 16:57:18 - INFO -   Stock: 30 registros
2026-02-03 16:57:18 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 16:57:18 - INFO - Fusión completada: 78 registros
2026-02-03 16:57:18 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 16:57:18 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 16:57:18 - INFO - Corrección completada:
2026-02-03 16:57:18 - INFO -   - Artículos corregidos: 78/78
2026-02-03 16:57:18 - INFO -   - Artículos aumentados: 78
2026-02-03 16:57:18 - INFO -   - Artículos reducidos: 0
2026-02-03 16:57:18 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 16:57:18 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 16:57:18 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 16:57:18 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx
2026-02-03 16:57:18 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx
2026-02-03 16:57:18 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx
2026-02-03 16:57:18 - INFO -   Articulos: 78
2026-02-03 16:57:18 - INFO -   Importe: 1390.00€
2026-02-03 16:57:18 - INFO - 
==================================================
2026-02-03 16:57:18 - INFO - SECCION: TIERRAS_ARIDOS
2026-02-03 16:57:18 - INFO - ==================================================
2026-02-03 16:57:18 - INFO - === LEYENDO DATOS PARA SECCIÓN: TIERRAS_ARIDOS ===
2026-02-03 16:57:18 - WARNING - No se encontró archivo específico para 'tierras_aridos', usando: .\./data/input\CLASIFICACION_ABC+D_DECO_EXTERIOR.xlsx
2026-02-03 16:57:18 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_DECO_EXTERIOR.xlsx
2026-02-03 16:57:18 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 16:57:18 - INFO - Clasificación ABC cargada para 'tierras_aridos': 995 registros
2026-02-03 16:57:18 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 16:57:22 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:57:22 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 16:57:22 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 16:57:22 - INFO - Ventas cargadas: 44082 registros
2026-02-03 16:57:22 - INFO - Filtrados 3264 registros de sección 'tierras_aridos' de 44082 total
2026-02-03 16:57:22 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 16:57:24 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:57:24 - INFO - Costes cargados: 22145 registros
2026-02-03 16:57:24 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA TIERRAS_ARIDOS ===
2026-02-03 16:57:24 - INFO -   ABC: 995 registros
2026-02-03 16:57:24 - INFO -   Ventas: 3264 registros
2026-02-03 16:57:24 - INFO -   Costes: 22145 registros
2026-02-03 16:57:24 - INFO - Datos de ventas: 302 registros
2026-02-03 16:57:24 - INFO - Calculando pedido para semana 14 (302 registros)
2026-02-03 16:57:24 - INFO -   Objetivo: 4097.24€, Actual (ABC): 4019.19€
2026-02-03 16:57:24 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 16:57:24 - INFO -   Factor total: 1.3125
2026-02-03 16:57:24 - INFO -   Factor escalado: 1.3380
2026-02-03 16:57:24 - INFO -   Ventas preliminares (con ceil): 5809.66€
2026-02-03 16:57:24 - INFO -   Objetivo final: 5377.63€
2026-02-03 16:57:24 - INFO -   Delta: 432.03€
2026-02-03 16:57:24 - INFO -   Ventas finales: 5387.14€
2026-02-03 16:57:24 - INFO - 
============================================================
2026-02-03 16:57:24 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 16:57:24 - INFO - ============================================================
2026-02-03 16:57:24 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 16:57:24 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 16:57:24 - INFO - DataLoader inicializado correctamente
2026-02-03 16:57:24 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 16:57:24 - INFO - ============================================================
2026-02-03 16:57:24 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 16:57:24 - INFO - ============================================================
2026-02-03 16:57:24 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 16:57:24 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 16:57:24 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 16:57:24 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 16:57:24 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 16:57:24 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:57:24 - INFO - Stock actual cargado: 30 registros
2026-02-03 16:57:24 - INFO -   Stock: 30 registros
2026-02-03 16:57:24 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 16:57:24 - INFO - Fusión completada: 72 registros
2026-02-03 16:57:24 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 16:57:24 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 16:57:24 - INFO - Corrección completada:
2026-02-03 16:57:24 - INFO -   - Artículos corregidos: 71/72
2026-02-03 16:57:24 - INFO -   - Artículos aumentados: 71
2026-02-03 16:57:24 - INFO -   - Artículos reducidos: 0
2026-02-03 16:57:24 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 16:57:24 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 16:57:24 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 16:57:24 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx
2026-02-03 16:57:24 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx
2026-02-03 16:57:24 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx
2026-02-03 16:57:24 - INFO -   Articulos: 71
2026-02-03 16:57:24 - INFO -   Importe: 5387.14€
2026-02-03 16:57:24 - INFO - 
==================================================
2026-02-03 16:57:24 - INFO - SECCION: DECO_EXTERIOR
2026-02-03 16:57:24 - INFO - ==================================================
2026-02-03 16:57:24 - INFO - === LEYENDO DATOS PARA SECCIÓN: DECO_EXTERIOR ===
2026-02-03 16:57:24 - INFO - Archivo ABC encontrado para 'deco_exterior': .\./data/input\CLASIFICACION_ABC+D_deco_exterior.xlsx
2026-02-03 16:57:24 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_deco_exterior.xlsx
2026-02-03 16:57:24 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 16:57:24 - INFO - Clasificación ABC cargada para 'deco_exterior': 995 registros
2026-02-03 16:57:24 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 16:57:28 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:57:28 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 16:57:28 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 16:57:28 - INFO - Ventas cargadas: 44082 registros
2026-02-03 16:57:28 - INFO - Filtrados 4018 registros de sección 'deco_exterior' de 44082 total
2026-02-03 16:57:28 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 16:57:30 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:57:30 - INFO - Costes cargados: 22145 registros
2026-02-03 16:57:30 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA DECO_EXTERIOR ===
2026-02-03 16:57:30 - INFO -   ABC: 995 registros
2026-02-03 16:57:30 - INFO -   Ventas: 4018 registros
2026-02-03 16:57:30 - INFO -   Costes: 22145 registros
2026-02-03 16:57:30 - INFO - Datos de ventas: 316 registros
2026-02-03 16:57:30 - INFO - Calculando pedido para semana 14 (316 registros)
2026-02-03 16:57:31 - INFO -   Objetivo: 3740.34€, Actual (ABC): 4104.66€
2026-02-03 16:57:31 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 16:57:31 - INFO -   Factor total: 1.3125
2026-02-03 16:57:31 - INFO -   Factor escalado: 1.1960
2026-02-03 16:57:31 - INFO -   Ventas preliminares (con ceil): 6094.59€
2026-02-03 16:57:31 - INFO -   Objetivo final: 4909.20€
2026-02-03 16:57:31 - INFO -   Delta: 1185.39€
2026-02-03 16:57:31 - INFO -   Ventas finales: 4923.89€
2026-02-03 16:57:31 - INFO - 
============================================================
2026-02-03 16:57:31 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 16:57:31 - INFO - ============================================================
2026-02-03 16:57:31 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 16:57:31 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 16:57:31 - INFO - DataLoader inicializado correctamente
2026-02-03 16:57:31 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 16:57:31 - INFO - ============================================================
2026-02-03 16:57:31 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 16:57:31 - INFO - ============================================================
2026-02-03 16:57:31 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 16:57:31 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 16:57:31 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 16:57:31 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 16:57:31 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 16:57:31 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 16:57:31 - INFO - Stock actual cargado: 30 registros
2026-02-03 16:57:31 - INFO -   Stock: 30 registros
2026-02-03 16:57:31 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 16:57:31 - INFO - Fusión completada: 224 registros
2026-02-03 16:57:31 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 16:57:31 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 16:57:31 - INFO - Corrección completada:
2026-02-03 16:57:31 - INFO -   - Artículos corregidos: 205/224
2026-02-03 16:57:31 - INFO -   - Artículos aumentados: 205
2026-02-03 16:57:31 - INFO -   - Artículos reducidos: 0
2026-02-03 16:57:31 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 16:57:31 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 16:57:31 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 16:57:31 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_deco_exterior.xlsx
2026-02-03 16:57:31 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_deco_exterior.xlsx
2026-02-03 16:57:31 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_deco_exterior.xlsx
2026-02-03 16:57:31 - INFO -   Articulos: 205
2026-02-03 16:57:31 - INFO -   Importe: 4923.89€
2026-02-03 16:57:31 - INFO - Estado guardado correctamente
2026-02-03 16:57:31 - INFO - Generando resumen: .\./data/output\Resumen_Pedidos_VIVERO_2026-02-03.xlsx
2026-02-03 16:57:31 - INFO - Resumen guardado: .\./data/output\Resumen_Pedidos_VIVERO_2026-02-03.xlsx
2026-02-03 16:57:31 - INFO - Estado guardado correctamente
2026-02-03 16:57:31 - INFO - 
============================================================
2026-02-03 16:57:31 - INFO - PREPARANDO ENVÍO DE EMAILS
2026-02-03 16:57:31 - INFO - ============================================================
2026-02-03 16:57:31 - INFO - 
============================================================
2026-02-03 16:57:31 - INFO - ENVÍO DE EMAILS A RESPONSABLES
2026-02-03 16:57:31 - INFO - ============================================================
2026-02-03 16:57:31 - INFO - EmailService inicializado correctamente
2026-02-03 16:57:31 - ERROR - La variable de entorno 'EMAIL_PASSWORD' no está configurada. Por favor, configúrala antes de enviar emails.
2026-02-03 16:57:31 - WARNING - Problemas de configuración detectados:
2026-02-03 16:57:31 - WARNING -   - La variable de entorno 'EMAIL_PASSWORD' no está configurada
2026-02-03 16:57:31 - INFO - 
Enviando email para sección: maf
2026-02-03 16:57:31 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_maf.xlsx']
2026-02-03 16:57:31 - INFO - ============================================================
2026-02-03 16:57:31 - INFO - ENVIANDO EMAIL PARA SECCIÓN: MAF
2026-02-03 16:57:31 - INFO - ============================================================
2026-02-03 16:57:31 - INFO - Destinatarios: ['ivan.delgado@viveverde.es']
2026-02-03 16:57:31 - INFO - Archivos a enviar: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_maf.xlsx']
2026-02-03 16:57:31 - INFO - Archivo adjuntado: Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 16:57:31 - ERROR - La variable de entorno 'EMAIL_PASSWORD' no está configurada. Por favor, configúrala antes de enviar emails.
2026-02-03 16:57:31 - ERROR - Error al enviar email: La variable de entorno 'EMAIL_PASSWORD' no está configurada. Por favor, configúrala antes de enviar emails.
2026-02-03 16:57:31 - ERROR - ✗ Error al enviar email para maf
2026-02-03 16:57:31 - ERROR - ✗ Error al enviar email a maf: error_envio
2026-02-03 16:57:31 - INFO - 
Enviando email para sección: interior
2026-02-03 16:57:31 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_deco_interior.xlsx', '.\\./data/output\\Pedido_Semana_14_2026-02-03_interior.xlsx']
2026-02-03 16:57:31 - INFO - ============================================================
2026-02-03 16:57:31 - INFO - ENVIANDO EMAIL PARA SECCIÓN: INTERIOR
2026-02-03 16:57:31 - INFO - ============================================================
2026-02-03 16:57:31 - INFO - Destinatarios: ['ivan.delgado@viveverde.es']
2026-02-03 16:57:31 - INFO - Archivos a enviar: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_deco_interior.xlsx', '.\\./data/output\\Pedido_Semana_14_2026-02-03_interior.xlsx']
2026-02-03 16:57:31 - INFO - Archivo adjuntado: Pedido_Semana_14_2026-02-03_deco_interior.xlsx
2026-02-03 16:57:31 - INFO - Archivo adjuntado: Pedido_Semana_14_2026-02-03_interior.xlsx
2026-02-03 16:57:31 - ERROR - La variable de entorno 'EMAIL_PASSWORD' no está configurada. Por favor, configúrala antes de enviar emails.
2026-02-03 16:57:31 - ERROR - Error al enviar email: La variable de entorno 'EMAIL_PASSWORD' no está configurada. Por favor, configúrala antes de enviar emails.
2026-02-03 16:57:31 - ERROR - ✗ Error al enviar email para interior
2026-02-03 16:57:31 - ERROR - ✗ Error al enviar email a interior: error_envio
2026-02-03 16:57:31 - INFO - 
Enviando email para sección: semillas
2026-02-03 16:57:31 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_semillas.xlsx']
2026-02-03 16:57:31 - INFO - ============================================================
2026-02-03 16:57:31 - INFO - ENVIANDO EMAIL PARA SECCIÓN: SEMILLAS
2026-02-03 16:57:31 - INFO - ============================================================
2026-02-03 16:57:31 - INFO - Destinatarios: ['ivan.delgado@viveverde.es']
2026-02-03 16:57:31 - INFO - Archivos a enviar: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_semillas.xlsx']
2026-02-03 16:57:31 - INFO - Archivo adjuntado: Pedido_Semana_14_2026-02-03_semillas.xlsx
2026-02-03 16:57:31 - ERROR - La variable de entorno 'EMAIL_PASSWORD' no está configurada. Por favor, configúrala antes de enviar emails.
2026-02-03 16:57:31 - ERROR - Error al enviar email: La variable de entorno 'EMAIL_PASSWORD' no está configurada. Por favor, configúrala antes de enviar emails.
2026-02-03 16:57:31 - ERROR - ✗ Error al enviar email para semillas
2026-02-03 16:57:31 - ERROR - ✗ Error al enviar email a semillas: error_envio
2026-02-03 16:57:31 - INFO - 
Enviando email para sección: vivo
2026-02-03 16:57:31 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx']
2026-02-03 16:57:31 - INFO - ============================================================
2026-02-03 16:57:31 - INFO - ENVIANDO EMAIL PARA SECCIÓN: VIVO
2026-02-03 16:57:31 - INFO - ============================================================
2026-02-03 16:57:31 - WARNING - No hay destinatarios configurados para la sección: vivo
2026-02-03 16:57:31 - ERROR - ✗ Error al enviar email a vivo: sin_destinatarios
2026-02-03 16:57:31 - INFO - 
Enviando email para sección: manufacturado
2026-02-03 16:57:31 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx']
2026-02-03 16:57:31 - INFO - ============================================================
2026-02-03 16:57:31 - INFO - ENVIANDO EMAIL PARA SECCIÓN: MANUFACTURADO
2026-02-03 16:57:31 - INFO - ============================================================
2026-02-03 16:57:31 - WARNING - No hay destinatarios configurados para la sección: manufacturado
2026-02-03 16:57:31 - ERROR - ✗ Error al enviar email a manufacturado: sin_destinatarios
2026-02-03 16:57:31 - INFO - 
Enviando email para sección: fitos
2026-02-03 16:57:31 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_fitos.xlsx']
2026-02-03 16:57:31 - INFO - ============================================================
2026-02-03 16:57:31 - INFO - ENVIANDO EMAIL PARA SECCIÓN: FITOS
2026-02-03 16:57:31 - INFO - ============================================================
2026-02-03 16:57:31 - INFO - Destinatarios: ['ivan.delgado@viveverde.es']
2026-02-03 16:57:31 - INFO - Archivos a enviar: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_fitos.xlsx']
2026-02-03 16:57:31 - INFO - Archivo adjuntado: Pedido_Semana_14_2026-02-03_fitos.xlsx
2026-02-03 16:57:31 - ERROR - La variable de entorno 'EMAIL_PASSWORD' no está configurada. Por favor, configúrala antes de enviar emails.
2026-02-03 16:57:31 - ERROR - Error al enviar email: La variable de entorno 'EMAIL_PASSWORD' no está configurada. Por favor, configúrala antes de enviar emails.
2026-02-03 16:57:31 - ERROR - ✗ Error al enviar email para fitos
2026-02-03 16:57:31 - ERROR - ✗ Error al enviar email a fitos: error_envio
2026-02-03 16:57:31 - INFO - 
Enviando email para sección: vivero
2026-02-03 16:57:31 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_vivero.xlsx']
2026-02-03 16:57:31 - INFO - ============================================================
2026-02-03 16:57:31 - INFO - ENVIANDO EMAIL PARA SECCIÓN: VIVERO
2026-02-03 16:57:31 - INFO - ============================================================
2026-02-03 16:57:31 - INFO - Destinatarios: ['ivan.delgado@viveverde.es']
2026-02-03 16:57:31 - INFO - Archivos a enviar: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_vivero.xlsx']
2026-02-03 16:57:31 - INFO - Archivo adjuntado: Pedido_Semana_14_2026-02-03_vivero.xlsx
2026-02-03 16:57:31 - ERROR - La variable de entorno 'EMAIL_PASSWORD' no está configurada. Por favor, configúrala antes de enviar emails.
2026-02-03 16:57:31 - ERROR - Error al enviar email: La variable de entorno 'EMAIL_PASSWORD' no está configurada. Por favor, configúrala antes de enviar emails.
2026-02-03 16:57:31 - ERROR - ✗ Error al enviar email para vivero
2026-02-03 16:57:31 - ERROR - ✗ Error al enviar email a vivero: error_envio
2026-02-03 16:57:31 - INFO - 
Enviando email para sección: jardin
2026-02-03 16:57:31 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx']
2026-02-03 16:57:31 - INFO - ============================================================
2026-02-03 16:57:31 - INFO - ENVIANDO EMAIL PARA SECCIÓN: JARDIN
2026-02-03 16:57:31 - INFO - ============================================================
2026-02-03 16:57:31 - WARNING - No hay destinatarios configurados para la sección: jardin
2026-02-03 16:57:31 - ERROR - ✗ Error al enviar email a jardin: sin_destinatarios
2026-02-03 16:57:31 - INFO - 
Enviando email para sección: aridos
2026-02-03 16:57:31 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx']
2026-02-03 16:57:31 - INFO - ============================================================
2026-02-03 16:57:31 - INFO - ENVIANDO EMAIL PARA SECCIÓN: ARIDOS
2026-02-03 16:57:31 - INFO - ============================================================
2026-02-03 16:57:31 - WARNING - No hay destinatarios configurados para la sección: aridos
2026-02-03 16:57:31 - ERROR - ✗ Error al enviar email a aridos: sin_destinatarios
2026-02-03 16:57:31 - INFO - 
Enviando email para sección: exterior
2026-02-03 16:57:31 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_deco_exterior.xlsx']
2026-02-03 16:57:31 - INFO - ============================================================
2026-02-03 16:57:31 - INFO - ENVIANDO EMAIL PARA SECCIÓN: EXTERIOR
2026-02-03 16:57:31 - INFO - ============================================================
2026-02-03 16:57:31 - WARNING - No hay destinatarios configurados para la sección: exterior
2026-02-03 16:57:31 - ERROR - ✗ Error al enviar email a exterior: sin_destinatarios
2026-02-03 16:57:31 - INFO - 
============================================================
2026-02-03 16:57:31 - INFO - RESUMEN DE ENVÍO DE EMAILS
2026-02-03 16:57:31 - INFO - ============================================================
2026-02-03 16:57:31 - INFO - Emails enviados exitosamente: 0
2026-02-03 16:57:31 - INFO - Emails fallidos: 10
2026-02-03 16:57:31 - INFO - Secciones procesadas: 10
2026-02-03 16:57:31 - INFO - 
======================================================================
2026-02-03 16:57:31 - INFO - RESUMEN DE EJECUCION
2026-02-03 16:57:31 - INFO - ======================================================================
2026-02-03 16:57:31 - INFO - Semana procesada: 14
2026-02-03 16:57:31 - INFO - Archivos generados: 12
2026-02-03 16:57:31 - INFO - Total articulos: 1510
2026-02-03 16:57:31 - INFO - Total importe: 48113.87€
2026-02-03 16:57:31 - WARNING - 
✗ EMAILS FALLIDOS: 10
2026-02-03 16:57:31 - INFO - ======================================================================
2026-02-03 16:57:31 - INFO - 
¡PEDIDO GENERADO EXITOSAMENTE!
2026-02-03 16:57:31 - INFO - Archivo principal: .\./data/output\Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 16:57:31 - INFO - Artículos: 1510
2026-02-03 16:57:31 - INFO - Importe: 48113.87€
2026-02-03 17:30:25 - INFO - ======================================================================
2026-02-03 17:30:25 - INFO - SISTEMA DE PEDIDOS DE COMPRA - VIVERO ARANJUEZ V2
2026-02-03 17:30:25 - INFO - Fecha de ejecución: 2026-02-03 17:30:25
2026-02-03 17:30:25 - INFO - ======================================================================
2026-02-03 17:30:25 - INFO - 
VERIFICANDO CONFIGURACIÓN DE EMAIL:
2026-02-03 17:30:25 - INFO - ----------------------------------------
2026-02-03 17:30:25 - INFO - EmailService inicializado correctamente
2026-02-03 17:30:25 - ERROR - La variable de entorno 'EMAIL_PASSWORD' no está configurada. Por favor, configúrala antes de enviar emails.
2026-02-03 17:30:25 - WARNING - Problemas de configuración detectados:
2026-02-03 17:30:25 - WARNING -   - La variable de entorno 'EMAIL_PASSWORD' no está configurada
2026-02-03 17:30:25 - INFO - ✓ Configuración de email válida
2026-02-03 17:30:25 - WARNING - ✗ Variable EMAIL_PASSWORD NO configurada
2026-02-03 17:30:25 - INFO -   Para configurarla, ejecuta:
2026-02-03 17:30:25 - INFO -   export EMAIL_PASSWORD='tu_contraseña'
2026-02-03 17:31:36 - INFO - ======================================================================
2026-02-03 17:31:36 - INFO - SISTEMA DE PEDIDOS DE COMPRA - VIVERO ARANJUEZ V2
2026-02-03 17:31:36 - INFO - Fecha de ejecución: 2026-02-03 17:31:36
2026-02-03 17:31:36 - INFO - ======================================================================
2026-02-03 17:31:36 - INFO - 
VERIFICANDO CONFIGURACIÓN DE EMAIL:
2026-02-03 17:31:36 - INFO - ----------------------------------------
2026-02-03 17:31:36 - INFO - EmailService inicializado correctamente
2026-02-03 17:31:36 - INFO - ✓ Configuración de email válida
2026-02-03 17:31:36 - INFO - ✓ Variable EMAIL_PASSWORD configurada
2026-02-03 17:33:27 - INFO - ======================================================================
2026-02-03 17:33:27 - INFO - SISTEMA DE PEDIDOS DE COMPRA - VIVERO ARANJUEZ V2
2026-02-03 17:33:27 - INFO - Fecha de ejecución: 2026-02-03 17:33:27
2026-02-03 17:33:27 - INFO - ======================================================================
2026-02-03 17:33:27 - INFO - Modo de ejecución: FASE 1 + FASE 2
2026-02-03 17:33:27 - INFO - Envío de emails: Sí
2026-02-03 17:33:27 - INFO - StateManager inicializado. Archivo de estado: .\./data\state.json
2026-02-03 17:33:27 - INFO - Cargando estado desde: .\./data\state.json
2026-02-03 17:33:27 - INFO - Estado cargado correctamente
2026-02-03 17:33:27 - INFO - SchedulerService inicializado correctamente
2026-02-03 17:33:27 - INFO - Horario configurado: sunday a las 15:00
2026-02-03 17:33:27 - INFO - Semana forzada por argumento: 14
2026-02-03 17:33:27 - INFO - ======================================================================
2026-02-03 17:33:27 - INFO - PROCESANDO PEDIDO PARA SEMANA 14
2026-02-03 17:33:27 - INFO - ======================================================================
2026-02-03 17:33:27 - INFO - MODO: FASE 1 (Forecast) + FASE 2 (Corrección)
2026-02-03 17:33:27 - INFO - DataLoader inicializado correctamente
2026-02-03 17:33:27 - INFO - ForecastEngine inicializado correctamente
2026-02-03 17:33:27 - INFO - OrderGenerator inicializado correctamente
2026-02-03 17:33:27 - INFO - SchedulerService inicializado correctamente
2026-02-03 17:33:27 - INFO - Horario configurado: sunday a las 15:00
2026-02-03 17:33:27 - INFO - Período de la semana: 2026-03-30 al 2026-04-05
2026-02-03 17:33:27 - INFO - Stock acumulado cargado: 2633 artículos
2026-02-03 17:33:27 - INFO - 
==================================================
2026-02-03 17:33:27 - INFO - SECCION: MAF
2026-02-03 17:33:27 - INFO - ==================================================
2026-02-03 17:33:27 - INFO - === LEYENDO DATOS PARA SECCIÓN: MAF ===
2026-02-03 17:33:27 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 17:33:27 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: maf
2026-02-03 17:33:27 - INFO - Archivo ABC encontrado para 'maf': .\./data/input\CLASIFICACION_ABC+D_maf.xlsx
2026-02-03 17:33:27 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_maf.xlsx
2026-02-03 17:33:27 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 17:33:27 - INFO - Clasificación ABC cargada para 'maf': 499 registros
2026-02-03 17:33:27 - DEBUG - [DEBUG] ABC leído: 499 registros
2026-02-03 17:33:27 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 17:33:27 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 17:33:27 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 17:33:31 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:33:31 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 17:33:31 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 17:33:31 - INFO - Ventas cargadas: 44082 registros
2026-02-03 17:33:31 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 17:33:31 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 17:33:31 - DEBUG - [DEBUG] Filtrando ventas por sección: maf
2026-02-03 17:33:31 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 17:33:31 - DEBUG -   maf: 10970 registros
2026-02-03 17:33:31 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 17:33:31 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 17:33:31 - DEBUG -   interior: 3624 registros
2026-02-03 17:33:31 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 17:33:31 - DEBUG -   deco_interior: 2468 registros
2026-02-03 17:33:31 - DEBUG -   vivero: 2460 registros
2026-02-03 17:33:31 - DEBUG -   fitos: 1987 registros
2026-02-03 17:33:31 - DEBUG -   semillas: 1180 registros
2026-02-03 17:33:31 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 17:33:31 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 17:33:31 - DEBUG - [DEBUG] Tras filtrar por 'maf': 10970 registros
2026-02-03 17:33:31 - INFO - Filtrados 10970 registros de sección 'maf' de 44082 total
2026-02-03 17:33:31 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 17:33:31 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 17:33:33 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:33:33 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 17:33:33 - INFO - Costes cargados: 22145 registros
2026-02-03 17:33:33 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 17:33:33 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 17:33:33 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MAF ===
2026-02-03 17:33:33 - INFO -   ABC: 499 registros
2026-02-03 17:33:33 - INFO -   Ventas: 10970 registros
2026-02-03 17:33:33 - INFO -   Costes: 22145 registros
2026-02-03 17:33:33 - DEBUG - [DEBUG] abc_df: 499 registros
2026-02-03 17:33:33 - DEBUG - [DEBUG] ventas_df: 10970 registros
2026-02-03 17:33:33 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 17:33:33 - INFO - Datos de ventas: 1011 registros
2026-02-03 17:33:33 - INFO - Calculando pedido para semana 14 (1011 registros)
2026-02-03 17:33:33 - INFO -   Objetivo: 7050.65€, Actual (ABC): 5843.77€
2026-02-03 17:33:33 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 17:33:33 - INFO -   Factor total: 1.3125
2026-02-03 17:33:33 - INFO -   Factor escalado: 1.5836
2026-02-03 17:33:33 - INFO -   Ventas preliminares (con ceil): 9931.01€
2026-02-03 17:33:33 - INFO -   Objetivo final: 9253.98€
2026-02-03 17:33:33 - INFO -   Delta: 677.03€
2026-02-03 17:33:34 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 17:33:34 - DEBUG -   Total registros: 222
2026-02-03 17:33:34 - DEBUG -   Registros con Unidades_Finales > 0: 191
2026-02-03 17:33:34 - DEBUG -   Ventas finales: 9259.59€
2026-02-03 17:33:34 - INFO -   Ventas finales: 9259.59€
2026-02-03 17:33:34 - INFO - 
============================================================
2026-02-03 17:33:34 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 17:33:34 - INFO - ============================================================
2026-02-03 17:33:34 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 17:33:34 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 17:33:34 - INFO - DataLoader inicializado correctamente
2026-02-03 17:33:34 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 17:33:34 - INFO - ============================================================
2026-02-03 17:33:34 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 17:33:34 - INFO - ============================================================
2026-02-03 17:33:34 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 17:33:34 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 17:33:34 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:33:34 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:33:34 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 17:33:34 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:33:34 - DEBUG - Usando hoja: Stock
2026-02-03 17:33:34 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 17:33:34 - INFO - Stock actual cargado: 30 registros
2026-02-03 17:33:34 - INFO -   Stock: 30 registros
2026-02-03 17:33:34 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 17:33:34 - INFO - Fusión completada: 222 registros
2026-02-03 17:33:34 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 17:33:34 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 17:33:34 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 17:33:34 - INFO - Corrección completada:
2026-02-03 17:33:34 - INFO -   - Artículos corregidos: 191/222
2026-02-03 17:33:34 - INFO -   - Artículos aumentados: 191
2026-02-03 17:33:34 - INFO -   - Artículos reducidos: 0
2026-02-03 17:33:34 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 17:33:34 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 17:33:34 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 17:33:34 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 222 registros
2026-02-03 17:33:34 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 17:33:34 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 17:33:34 - DEBUG -   Con valor 0: 31
2026-02-03 17:33:34 - DEBUG -   Con valor > 0: 191
2026-02-03 17:33:34 - DEBUG -   Suma Ventas_Objetivo: 9259.59€
2026-02-03 17:33:34 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 191 registros
2026-02-03 17:33:34 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 17:33:34 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 17:33:34 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 17:33:34 - INFO -   Articulos: 191
2026-02-03 17:33:34 - INFO -   Importe: 9259.59€
2026-02-03 17:33:34 - INFO - 
==================================================
2026-02-03 17:33:34 - INFO - SECCION: DECO_INTERIOR
2026-02-03 17:33:34 - INFO - ==================================================
2026-02-03 17:33:34 - INFO - === LEYENDO DATOS PARA SECCIÓN: DECO_INTERIOR ===
2026-02-03 17:33:34 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 17:33:34 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: deco_interior
2026-02-03 17:33:34 - INFO - Archivo ABC encontrado para 'deco_interior': .\./data/input\CLASIFICACION_ABC+D_deco_interior.xlsx
2026-02-03 17:33:34 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_deco_interior.xlsx
2026-02-03 17:33:34 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 17:33:34 - INFO - Clasificación ABC cargada para 'deco_interior': 1827 registros
2026-02-03 17:33:34 - DEBUG - [DEBUG] ABC leído: 1827 registros
2026-02-03 17:33:34 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 17:33:34 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 17:33:34 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 17:33:38 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:33:38 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 17:33:38 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 17:33:38 - INFO - Ventas cargadas: 44082 registros
2026-02-03 17:33:38 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 17:33:38 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 17:33:38 - DEBUG - [DEBUG] Filtrando ventas por sección: deco_interior
2026-02-03 17:33:38 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 17:33:38 - DEBUG -   maf: 10970 registros
2026-02-03 17:33:38 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 17:33:38 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 17:33:38 - DEBUG -   interior: 3624 registros
2026-02-03 17:33:38 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 17:33:38 - DEBUG -   deco_interior: 2468 registros
2026-02-03 17:33:38 - DEBUG -   vivero: 2460 registros
2026-02-03 17:33:38 - DEBUG -   fitos: 1987 registros
2026-02-03 17:33:38 - DEBUG -   semillas: 1180 registros
2026-02-03 17:33:38 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 17:33:38 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 17:33:38 - DEBUG - [DEBUG] Tras filtrar por 'deco_interior': 2468 registros
2026-02-03 17:33:38 - INFO - Filtrados 2468 registros de sección 'deco_interior' de 44082 total
2026-02-03 17:33:38 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 17:33:38 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 17:33:40 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:33:40 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 17:33:40 - INFO - Costes cargados: 22145 registros
2026-02-03 17:33:40 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 17:33:40 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 17:33:40 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA DECO_INTERIOR ===
2026-02-03 17:33:40 - INFO -   ABC: 1827 registros
2026-02-03 17:33:40 - INFO -   Ventas: 2468 registros
2026-02-03 17:33:40 - INFO -   Costes: 22145 registros
2026-02-03 17:33:40 - DEBUG - [DEBUG] abc_df: 1827 registros
2026-02-03 17:33:40 - DEBUG - [DEBUG] ventas_df: 2468 registros
2026-02-03 17:33:40 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 17:33:40 - INFO - Datos de ventas: 180 registros
2026-02-03 17:33:40 - INFO - Calculando pedido para semana 14 (180 registros)
2026-02-03 17:33:41 - INFO -   Objetivo: 1962.99€, Actual (ABC): 1636.15€
2026-02-03 17:33:41 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 17:33:41 - INFO -   Factor total: 1.3125
2026-02-03 17:33:41 - INFO -   Factor escalado: 1.5747
2026-02-03 17:33:41 - INFO -   Ventas preliminares (con ceil): 2950.01€
2026-02-03 17:33:41 - INFO -   Objetivo final: 2576.42€
2026-02-03 17:33:41 - INFO -   Delta: 373.59€
2026-02-03 17:33:41 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 17:33:41 - DEBUG -   Total registros: 139
2026-02-03 17:33:41 - DEBUG -   Registros con Unidades_Finales > 0: 135
2026-02-03 17:33:41 - DEBUG -   Ventas finales: 2580.73€
2026-02-03 17:33:41 - INFO -   Ventas finales: 2580.73€
2026-02-03 17:33:41 - INFO - 
============================================================
2026-02-03 17:33:41 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 17:33:41 - INFO - ============================================================
2026-02-03 17:33:41 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 17:33:41 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 17:33:41 - INFO - DataLoader inicializado correctamente
2026-02-03 17:33:41 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 17:33:41 - INFO - ============================================================
2026-02-03 17:33:41 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 17:33:41 - INFO - ============================================================
2026-02-03 17:33:41 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 17:33:41 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 17:33:41 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:33:41 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:33:41 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 17:33:41 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:33:41 - DEBUG - Usando hoja: Stock
2026-02-03 17:33:41 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 17:33:41 - INFO - Stock actual cargado: 30 registros
2026-02-03 17:33:41 - INFO -   Stock: 30 registros
2026-02-03 17:33:41 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 17:33:41 - INFO - Fusión completada: 139 registros
2026-02-03 17:33:41 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 17:33:41 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 17:33:41 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 17:33:41 - INFO - Corrección completada:
2026-02-03 17:33:41 - INFO -   - Artículos corregidos: 135/139
2026-02-03 17:33:41 - INFO -   - Artículos aumentados: 135
2026-02-03 17:33:41 - INFO -   - Artículos reducidos: 0
2026-02-03 17:33:41 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 17:33:41 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 17:33:41 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 17:33:41 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 139 registros
2026-02-03 17:33:41 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 17:33:41 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 17:33:41 - DEBUG -   Con valor 0: 4
2026-02-03 17:33:41 - DEBUG -   Con valor > 0: 135
2026-02-03 17:33:41 - DEBUG -   Suma Ventas_Objetivo: 2580.73€
2026-02-03 17:33:41 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 135 registros
2026-02-03 17:33:41 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_deco_interior.xlsx
2026-02-03 17:33:41 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_deco_interior.xlsx
2026-02-03 17:33:41 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_deco_interior.xlsx
2026-02-03 17:33:41 - INFO -   Articulos: 135
2026-02-03 17:33:41 - INFO -   Importe: 2580.73€
2026-02-03 17:33:41 - INFO - 
==================================================
2026-02-03 17:33:41 - INFO - SECCION: SEMILLAS
2026-02-03 17:33:41 - INFO - ==================================================
2026-02-03 17:33:41 - INFO - === LEYENDO DATOS PARA SECCIÓN: SEMILLAS ===
2026-02-03 17:33:41 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 17:33:41 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: semillas
2026-02-03 17:33:41 - INFO - Archivo ABC encontrado para 'semillas': .\./data/input\CLASIFICACION_ABC+D_semillas.xlsx
2026-02-03 17:33:41 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_semillas.xlsx
2026-02-03 17:33:41 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 17:33:41 - INFO - Clasificación ABC cargada para 'semillas': 218 registros
2026-02-03 17:33:41 - DEBUG - [DEBUG] ABC leído: 218 registros
2026-02-03 17:33:41 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 17:33:41 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 17:33:41 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 17:33:45 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:33:45 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 17:33:45 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 17:33:45 - INFO - Ventas cargadas: 44082 registros
2026-02-03 17:33:45 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 17:33:45 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 17:33:45 - DEBUG - [DEBUG] Filtrando ventas por sección: semillas
2026-02-03 17:33:45 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 17:33:45 - DEBUG -   maf: 10970 registros
2026-02-03 17:33:45 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 17:33:45 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 17:33:45 - DEBUG -   interior: 3624 registros
2026-02-03 17:33:45 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 17:33:45 - DEBUG -   deco_interior: 2468 registros
2026-02-03 17:33:45 - DEBUG -   vivero: 2460 registros
2026-02-03 17:33:45 - DEBUG -   fitos: 1987 registros
2026-02-03 17:33:45 - DEBUG -   semillas: 1180 registros
2026-02-03 17:33:45 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 17:33:45 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 17:33:45 - DEBUG - [DEBUG] Tras filtrar por 'semillas': 1180 registros
2026-02-03 17:33:45 - INFO - Filtrados 1180 registros de sección 'semillas' de 44082 total
2026-02-03 17:33:45 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 17:33:45 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 17:33:47 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:33:47 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 17:33:47 - INFO - Costes cargados: 22145 registros
2026-02-03 17:33:47 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 17:33:47 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 17:33:47 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA SEMILLAS ===
2026-02-03 17:33:47 - INFO -   ABC: 218 registros
2026-02-03 17:33:47 - INFO -   Ventas: 1180 registros
2026-02-03 17:33:47 - INFO -   Costes: 22145 registros
2026-02-03 17:33:47 - DEBUG - [DEBUG] abc_df: 218 registros
2026-02-03 17:33:47 - DEBUG - [DEBUG] ventas_df: 1180 registros
2026-02-03 17:33:47 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 17:33:47 - INFO - Datos de ventas: 136 registros
2026-02-03 17:33:47 - INFO - Calculando pedido para semana 14 (136 registros)
2026-02-03 17:33:47 - INFO -   Objetivo: 694.34€, Actual (ABC): 455.14€
2026-02-03 17:33:47 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 17:33:47 - INFO -   Factor total: 1.3125
2026-02-03 17:33:47 - INFO -   Factor escalado: 2.0023
2026-02-03 17:33:47 - INFO -   Ventas preliminares (con ceil): 1129.15€
2026-02-03 17:33:47 - INFO -   Objetivo final: 911.32€
2026-02-03 17:33:47 - INFO -   Delta: 217.83€
2026-02-03 17:33:47 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 17:33:47 - DEBUG -   Total registros: 84
2026-02-03 17:33:47 - DEBUG -   Registros con Unidades_Finales > 0: 84
2026-02-03 17:33:47 - DEBUG -   Ventas finales: 911.60€
2026-02-03 17:33:47 - INFO -   Ventas finales: 911.60€
2026-02-03 17:33:47 - INFO - 
============================================================
2026-02-03 17:33:47 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 17:33:47 - INFO - ============================================================
2026-02-03 17:33:47 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 17:33:47 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 17:33:47 - INFO - DataLoader inicializado correctamente
2026-02-03 17:33:47 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 17:33:47 - INFO - ============================================================
2026-02-03 17:33:47 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 17:33:47 - INFO - ============================================================
2026-02-03 17:33:47 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 17:33:47 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 17:33:47 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:33:47 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:33:47 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 17:33:47 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:33:47 - DEBUG - Usando hoja: Stock
2026-02-03 17:33:47 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 17:33:47 - INFO - Stock actual cargado: 30 registros
2026-02-03 17:33:47 - INFO -   Stock: 30 registros
2026-02-03 17:33:47 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 17:33:47 - INFO - Fusión completada: 84 registros
2026-02-03 17:33:47 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 17:33:47 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 17:33:47 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 17:33:47 - INFO - Corrección completada:
2026-02-03 17:33:47 - INFO -   - Artículos corregidos: 84/84
2026-02-03 17:33:47 - INFO -   - Artículos aumentados: 84
2026-02-03 17:33:47 - INFO -   - Artículos reducidos: 0
2026-02-03 17:33:47 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 17:33:47 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 17:33:47 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 17:33:47 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 84 registros
2026-02-03 17:33:47 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 17:33:47 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 17:33:47 - DEBUG -   Con valor 0: 0
2026-02-03 17:33:47 - DEBUG -   Con valor > 0: 84
2026-02-03 17:33:47 - DEBUG -   Suma Ventas_Objetivo: 911.60€
2026-02-03 17:33:47 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 84 registros
2026-02-03 17:33:47 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_semillas.xlsx
2026-02-03 17:33:47 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_semillas.xlsx
2026-02-03 17:33:47 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_semillas.xlsx
2026-02-03 17:33:47 - INFO -   Articulos: 84
2026-02-03 17:33:47 - INFO -   Importe: 911.60€
2026-02-03 17:33:47 - INFO - 
==================================================
2026-02-03 17:33:47 - INFO - SECCION: MASCOTAS_VIVO
2026-02-03 17:33:47 - INFO - ==================================================
2026-02-03 17:33:47 - INFO - === LEYENDO DATOS PARA SECCIÓN: MASCOTAS_VIVO ===
2026-02-03 17:33:47 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 17:33:47 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: mascotas_vivo
2026-02-03 17:33:47 - INFO - Archivo ABC encontrado para 'mascotas_vivo': .\./data/input\CLASIFICACION_ABC+D_mascotas_vivo.xlsx
2026-02-03 17:33:47 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_mascotas_vivo.xlsx
2026-02-03 17:33:47 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 17:33:48 - INFO - Clasificación ABC cargada para 'mascotas_vivo': 205 registros
2026-02-03 17:33:48 - DEBUG - [DEBUG] ABC leído: 205 registros
2026-02-03 17:33:48 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 17:33:48 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 17:33:48 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 17:33:51 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:33:51 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 17:33:51 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 17:33:51 - INFO - Ventas cargadas: 44082 registros
2026-02-03 17:33:51 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 17:33:51 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 17:33:51 - DEBUG - [DEBUG] Filtrando ventas por sección: mascotas_vivo
2026-02-03 17:33:51 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 17:33:51 - DEBUG -   maf: 10970 registros
2026-02-03 17:33:51 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 17:33:51 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 17:33:51 - DEBUG -   interior: 3624 registros
2026-02-03 17:33:51 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 17:33:51 - DEBUG -   deco_interior: 2468 registros
2026-02-03 17:33:51 - DEBUG -   vivero: 2460 registros
2026-02-03 17:33:51 - DEBUG -   fitos: 1987 registros
2026-02-03 17:33:51 - DEBUG -   semillas: 1180 registros
2026-02-03 17:33:51 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 17:33:51 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 17:33:51 - DEBUG - [DEBUG] Tras filtrar por 'mascotas_vivo': 1124 registros
2026-02-03 17:33:51 - INFO - Filtrados 1124 registros de sección 'mascotas_vivo' de 44082 total
2026-02-03 17:33:51 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 17:33:51 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 17:33:53 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:33:53 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 17:33:53 - INFO - Costes cargados: 22145 registros
2026-02-03 17:33:53 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 17:33:53 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 17:33:53 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MASCOTAS_VIVO ===
2026-02-03 17:33:53 - INFO -   ABC: 205 registros
2026-02-03 17:33:53 - INFO -   Ventas: 1124 registros
2026-02-03 17:33:53 - INFO -   Costes: 22145 registros
2026-02-03 17:33:53 - DEBUG - [DEBUG] abc_df: 205 registros
2026-02-03 17:33:53 - DEBUG - [DEBUG] ventas_df: 1124 registros
2026-02-03 17:33:53 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 17:33:53 - INFO - Datos de ventas: 88 registros
2026-02-03 17:33:53 - INFO - Calculando pedido para semana 14 (88 registros)
2026-02-03 17:33:54 - INFO -   Objetivo: 1087.15€, Actual (ABC): 846.63€
2026-02-03 17:33:54 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 17:33:54 - INFO -   Factor total: 1.3125
2026-02-03 17:33:54 - INFO -   Factor escalado: 1.6854
2026-02-03 17:33:54 - INFO -   Ventas preliminares (con ceil): 1773.66€
2026-02-03 17:33:54 - INFO -   Objetivo final: 1426.88€
2026-02-03 17:33:54 - INFO -   Delta: 346.78€
2026-02-03 17:33:54 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 17:33:54 - DEBUG -   Total registros: 43
2026-02-03 17:33:54 - DEBUG -   Registros con Unidades_Finales > 0: 36
2026-02-03 17:33:54 - DEBUG -   Ventas finales: 1455.34€
2026-02-03 17:33:54 - INFO -   Ventas finales: 1455.34€
2026-02-03 17:33:54 - INFO - 
============================================================
2026-02-03 17:33:54 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 17:33:54 - INFO - ============================================================
2026-02-03 17:33:54 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 17:33:54 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 17:33:54 - INFO - DataLoader inicializado correctamente
2026-02-03 17:33:54 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 17:33:54 - INFO - ============================================================
2026-02-03 17:33:54 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 17:33:54 - INFO - ============================================================
2026-02-03 17:33:54 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 17:33:54 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 17:33:54 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:33:54 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:33:54 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 17:33:54 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:33:54 - DEBUG - Usando hoja: Stock
2026-02-03 17:33:54 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 17:33:54 - INFO - Stock actual cargado: 30 registros
2026-02-03 17:33:54 - INFO -   Stock: 30 registros
2026-02-03 17:33:54 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 17:33:54 - INFO - Fusión completada: 43 registros
2026-02-03 17:33:54 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 17:33:54 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 17:33:54 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 17:33:54 - INFO - Corrección completada:
2026-02-03 17:33:54 - INFO -   - Artículos corregidos: 36/43
2026-02-03 17:33:54 - INFO -   - Artículos aumentados: 36
2026-02-03 17:33:54 - INFO -   - Artículos reducidos: 0
2026-02-03 17:33:54 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 17:33:54 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 17:33:54 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 17:33:54 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 43 registros
2026-02-03 17:33:54 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 17:33:54 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 17:33:54 - DEBUG -   Con valor 0: 7
2026-02-03 17:33:54 - DEBUG -   Con valor > 0: 36
2026-02-03 17:33:54 - DEBUG -   Suma Ventas_Objetivo: 1455.34€
2026-02-03 17:33:54 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 36 registros
2026-02-03 17:33:54 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx
2026-02-03 17:33:54 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx
2026-02-03 17:33:54 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx
2026-02-03 17:33:54 - INFO -   Articulos: 36
2026-02-03 17:33:54 - INFO -   Importe: 1455.34€
2026-02-03 17:33:54 - INFO - 
==================================================
2026-02-03 17:33:54 - INFO - SECCION: MASCOTAS_MANUFACTURADO
2026-02-03 17:33:54 - INFO - ==================================================
2026-02-03 17:33:54 - INFO - === LEYENDO DATOS PARA SECCIÓN: MASCOTAS_MANUFACTURADO ===
2026-02-03 17:33:54 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 17:33:54 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: mascotas_manufacturado
2026-02-03 17:33:54 - INFO - Archivo ABC encontrado para 'mascotas_manufacturado': .\./data/input\CLASIFICACION_ABC+D_mascotas_manufacturado.xlsx
2026-02-03 17:33:54 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_mascotas_manufacturado.xlsx
2026-02-03 17:33:54 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 17:33:54 - INFO - Clasificación ABC cargada para 'mascotas_manufacturado': 2749 registros
2026-02-03 17:33:54 - DEBUG - [DEBUG] ABC leído: 2749 registros
2026-02-03 17:33:54 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 17:33:54 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 17:33:54 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 17:33:58 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:33:58 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 17:33:58 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 17:33:58 - INFO - Ventas cargadas: 44082 registros
2026-02-03 17:33:58 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 17:33:58 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 17:33:58 - DEBUG - [DEBUG] Filtrando ventas por sección: mascotas_manufacturado
2026-02-03 17:33:58 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 17:33:58 - DEBUG -   maf: 10970 registros
2026-02-03 17:33:58 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 17:33:58 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 17:33:58 - DEBUG -   interior: 3624 registros
2026-02-03 17:33:58 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 17:33:58 - DEBUG -   deco_interior: 2468 registros
2026-02-03 17:33:58 - DEBUG -   vivero: 2460 registros
2026-02-03 17:33:58 - DEBUG -   fitos: 1987 registros
2026-02-03 17:33:58 - DEBUG -   semillas: 1180 registros
2026-02-03 17:33:58 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 17:33:58 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 17:33:58 - DEBUG - [DEBUG] Tras filtrar por 'mascotas_manufacturado': 9784 registros
2026-02-03 17:33:58 - INFO - Filtrados 9784 registros de sección 'mascotas_manufacturado' de 44082 total
2026-02-03 17:33:58 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 17:33:58 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 17:34:00 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:34:00 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 17:34:00 - INFO - Costes cargados: 22145 registros
2026-02-03 17:34:00 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 17:34:00 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 17:34:00 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MASCOTAS_MANUFACTURADO ===
2026-02-03 17:34:00 - INFO -   ABC: 2749 registros
2026-02-03 17:34:00 - INFO -   Ventas: 9784 registros
2026-02-03 17:34:00 - INFO -   Costes: 22145 registros
2026-02-03 17:34:00 - DEBUG - [DEBUG] abc_df: 2749 registros
2026-02-03 17:34:00 - DEBUG - [DEBUG] ventas_df: 9784 registros
2026-02-03 17:34:00 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 17:34:00 - INFO - Datos de ventas: 822 registros
2026-02-03 17:34:00 - INFO - Calculando pedido para semana 14 (822 registros)
2026-02-03 17:34:02 - INFO -   Objetivo: 6839.82€, Actual (ABC): 8742.92€
2026-02-03 17:34:02 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 17:34:02 - INFO -   Factor total: 1.3125
2026-02-03 17:34:02 - INFO -   Factor escalado: 1.0268
2026-02-03 17:34:02 - INFO -   Ventas preliminares (con ceil): 12379.25€
2026-02-03 17:34:02 - INFO -   Objetivo final: 8977.26€
2026-02-03 17:34:02 - INFO -   Delta: 3401.99€
2026-02-03 17:34:02 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 17:34:02 - DEBUG -   Total registros: 538
2026-02-03 17:34:02 - DEBUG -   Registros con Unidades_Finales > 0: 411
2026-02-03 17:34:02 - DEBUG -   Ventas finales: 8993.98€
2026-02-03 17:34:02 - INFO -   Ventas finales: 8993.98€
2026-02-03 17:34:02 - INFO - 
============================================================
2026-02-03 17:34:02 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 17:34:02 - INFO - ============================================================
2026-02-03 17:34:02 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 17:34:02 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 17:34:02 - INFO - DataLoader inicializado correctamente
2026-02-03 17:34:02 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 17:34:02 - INFO - ============================================================
2026-02-03 17:34:02 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 17:34:02 - INFO - ============================================================
2026-02-03 17:34:02 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 17:34:02 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 17:34:02 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:34:02 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:34:02 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 17:34:02 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:34:02 - DEBUG - Usando hoja: Stock
2026-02-03 17:34:02 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 17:34:02 - INFO - Stock actual cargado: 30 registros
2026-02-03 17:34:02 - INFO -   Stock: 30 registros
2026-02-03 17:34:02 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 17:34:02 - INFO - Fusión completada: 538 registros
2026-02-03 17:34:02 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 17:34:02 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 17:34:02 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 17:34:02 - INFO - Corrección completada:
2026-02-03 17:34:02 - INFO -   - Artículos corregidos: 411/538
2026-02-03 17:34:02 - INFO -   - Artículos aumentados: 411
2026-02-03 17:34:02 - INFO -   - Artículos reducidos: 0
2026-02-03 17:34:02 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 17:34:02 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 17:34:02 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 17:34:02 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 538 registros
2026-02-03 17:34:02 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 17:34:02 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 17:34:02 - DEBUG -   Con valor 0: 127
2026-02-03 17:34:02 - DEBUG -   Con valor > 0: 411
2026-02-03 17:34:02 - DEBUG -   Suma Ventas_Objetivo: 8993.98€
2026-02-03 17:34:02 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 411 registros
2026-02-03 17:34:02 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx
2026-02-03 17:34:02 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx
2026-02-03 17:34:02 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx
2026-02-03 17:34:02 - INFO -   Articulos: 411
2026-02-03 17:34:02 - INFO -   Importe: 8993.98€
2026-02-03 17:34:02 - INFO - 
==================================================
2026-02-03 17:34:02 - INFO - SECCION: INTERIOR
2026-02-03 17:34:02 - INFO - ==================================================
2026-02-03 17:34:02 - INFO - === LEYENDO DATOS PARA SECCIÓN: INTERIOR ===
2026-02-03 17:34:02 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 17:34:02 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: interior
2026-02-03 17:34:02 - INFO - Archivo ABC encontrado para 'interior': .\./data/input\CLASIFICACION_ABC+D_interior.xlsx
2026-02-03 17:34:02 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_interior.xlsx
2026-02-03 17:34:02 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 17:34:02 - INFO - Clasificación ABC cargada para 'interior': 555 registros
2026-02-03 17:34:02 - DEBUG - [DEBUG] ABC leído: 555 registros
2026-02-03 17:34:02 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 17:34:02 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 17:34:02 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 17:34:06 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:34:06 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 17:34:06 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 17:34:06 - INFO - Ventas cargadas: 44082 registros
2026-02-03 17:34:06 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 17:34:06 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 17:34:06 - DEBUG - [DEBUG] Filtrando ventas por sección: interior
2026-02-03 17:34:06 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 17:34:06 - DEBUG -   maf: 10970 registros
2026-02-03 17:34:06 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 17:34:06 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 17:34:06 - DEBUG -   interior: 3624 registros
2026-02-03 17:34:06 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 17:34:06 - DEBUG -   deco_interior: 2468 registros
2026-02-03 17:34:06 - DEBUG -   vivero: 2460 registros
2026-02-03 17:34:06 - DEBUG -   fitos: 1987 registros
2026-02-03 17:34:06 - DEBUG -   semillas: 1180 registros
2026-02-03 17:34:06 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 17:34:06 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 17:34:06 - DEBUG - [DEBUG] Tras filtrar por 'interior': 3624 registros
2026-02-03 17:34:06 - INFO - Filtrados 3624 registros de sección 'interior' de 44082 total
2026-02-03 17:34:06 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 17:34:06 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 17:34:08 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:34:08 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 17:34:08 - INFO - Costes cargados: 22145 registros
2026-02-03 17:34:08 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 17:34:08 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 17:34:08 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA INTERIOR ===
2026-02-03 17:34:08 - INFO -   ABC: 555 registros
2026-02-03 17:34:08 - INFO -   Ventas: 3624 registros
2026-02-03 17:34:08 - INFO -   Costes: 22145 registros
2026-02-03 17:34:08 - DEBUG - [DEBUG] abc_df: 555 registros
2026-02-03 17:34:08 - DEBUG - [DEBUG] ventas_df: 3624 registros
2026-02-03 17:34:08 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 17:34:08 - INFO - Datos de ventas: 286 registros
2026-02-03 17:34:08 - INFO - Calculando pedido para semana 14 (286 registros)
2026-02-03 17:34:08 - INFO -   Objetivo: 2930.63€, Actual (ABC): 2409.44€
2026-02-03 17:34:08 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 17:34:08 - INFO -   Factor total: 1.3125
2026-02-03 17:34:08 - INFO -   Factor escalado: 1.5964
2026-02-03 17:34:08 - INFO -   Ventas preliminares (con ceil): 4541.81€
2026-02-03 17:34:08 - INFO -   Objetivo final: 3846.45€
2026-02-03 17:34:08 - INFO -   Delta: 695.36€
2026-02-03 17:34:08 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 17:34:08 - DEBUG -   Total registros: 138
2026-02-03 17:34:09 - DEBUG -   Registros con Unidades_Finales > 0: 121
2026-02-03 17:34:09 - DEBUG -   Ventas finales: 3855.17€
2026-02-03 17:34:09 - INFO -   Ventas finales: 3855.17€
2026-02-03 17:34:09 - INFO - 
============================================================
2026-02-03 17:34:09 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 17:34:09 - INFO - ============================================================
2026-02-03 17:34:09 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 17:34:09 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 17:34:09 - INFO - DataLoader inicializado correctamente
2026-02-03 17:34:09 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 17:34:09 - INFO - ============================================================
2026-02-03 17:34:09 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 17:34:09 - INFO - ============================================================
2026-02-03 17:34:09 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 17:34:09 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 17:34:09 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:34:09 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:34:09 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 17:34:09 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:34:09 - DEBUG - Usando hoja: Stock
2026-02-03 17:34:09 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 17:34:09 - INFO - Stock actual cargado: 30 registros
2026-02-03 17:34:09 - INFO -   Stock: 30 registros
2026-02-03 17:34:09 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 17:34:09 - INFO - Fusión completada: 138 registros
2026-02-03 17:34:09 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 17:34:09 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 17:34:09 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 17:34:09 - INFO - Corrección completada:
2026-02-03 17:34:09 - INFO -   - Artículos corregidos: 121/138
2026-02-03 17:34:09 - INFO -   - Artículos aumentados: 121
2026-02-03 17:34:09 - INFO -   - Artículos reducidos: 0
2026-02-03 17:34:09 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 17:34:09 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 17:34:09 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 17:34:09 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 138 registros
2026-02-03 17:34:09 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 17:34:09 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 17:34:09 - DEBUG -   Con valor 0: 17
2026-02-03 17:34:09 - DEBUG -   Con valor > 0: 121
2026-02-03 17:34:09 - DEBUG -   Suma Ventas_Objetivo: 3855.17€
2026-02-03 17:34:09 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 121 registros
2026-02-03 17:34:09 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_interior.xlsx
2026-02-03 17:34:09 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_interior.xlsx
2026-02-03 17:34:09 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_interior.xlsx
2026-02-03 17:34:09 - INFO -   Articulos: 121
2026-02-03 17:34:09 - INFO -   Importe: 3855.17€
2026-02-03 17:34:09 - INFO - 
==================================================
2026-02-03 17:34:09 - INFO - SECCION: FITOS
2026-02-03 17:34:09 - INFO - ==================================================
2026-02-03 17:34:09 - INFO - === LEYENDO DATOS PARA SECCIÓN: FITOS ===
2026-02-03 17:34:09 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 17:34:09 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: fitos
2026-02-03 17:34:09 - INFO - Archivo ABC encontrado para 'fitos': .\./data/input\CLASIFICACION_ABC+D_fitos.xlsx
2026-02-03 17:34:09 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_fitos.xlsx
2026-02-03 17:34:09 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 17:34:09 - INFO - Clasificación ABC cargada para 'fitos': 247 registros
2026-02-03 17:34:09 - DEBUG - [DEBUG] ABC leído: 247 registros
2026-02-03 17:34:09 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 17:34:09 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 17:34:09 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 17:34:12 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:34:12 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 17:34:12 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 17:34:12 - INFO - Ventas cargadas: 44082 registros
2026-02-03 17:34:12 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 17:34:12 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 17:34:12 - DEBUG - [DEBUG] Filtrando ventas por sección: fitos
2026-02-03 17:34:13 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 17:34:13 - DEBUG -   maf: 10970 registros
2026-02-03 17:34:13 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 17:34:13 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 17:34:13 - DEBUG -   interior: 3624 registros
2026-02-03 17:34:13 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 17:34:13 - DEBUG -   deco_interior: 2468 registros
2026-02-03 17:34:13 - DEBUG -   vivero: 2460 registros
2026-02-03 17:34:13 - DEBUG -   fitos: 1987 registros
2026-02-03 17:34:13 - DEBUG -   semillas: 1180 registros
2026-02-03 17:34:13 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 17:34:13 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 17:34:13 - DEBUG - [DEBUG] Tras filtrar por 'fitos': 1987 registros
2026-02-03 17:34:13 - INFO - Filtrados 1987 registros de sección 'fitos' de 44082 total
2026-02-03 17:34:13 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 17:34:13 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 17:34:14 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:34:14 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 17:34:14 - INFO - Costes cargados: 22145 registros
2026-02-03 17:34:14 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 17:34:14 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 17:34:14 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA FITOS ===
2026-02-03 17:34:14 - INFO -   ABC: 247 registros
2026-02-03 17:34:14 - INFO -   Ventas: 1987 registros
2026-02-03 17:34:14 - INFO -   Costes: 22145 registros
2026-02-03 17:34:14 - DEBUG - [DEBUG] abc_df: 247 registros
2026-02-03 17:34:14 - DEBUG - [DEBUG] ventas_df: 1987 registros
2026-02-03 17:34:14 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 17:34:14 - INFO - Datos de ventas: 157 registros
2026-02-03 17:34:14 - INFO - Calculando pedido para semana 14 (157 registros)
2026-02-03 17:34:15 - INFO -   Objetivo: 1798.25€, Actual (ABC): 1679.26€
2026-02-03 17:34:15 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 17:34:15 - INFO -   Factor total: 1.3125
2026-02-03 17:34:15 - INFO -   Factor escalado: 1.4055
2026-02-03 17:34:15 - INFO -   Ventas preliminares (con ceil): 2784.94€
2026-02-03 17:34:15 - INFO -   Objetivo final: 2360.20€
2026-02-03 17:34:15 - INFO -   Delta: 424.74€
2026-02-03 17:34:15 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 17:34:15 - DEBUG -   Total registros: 84
2026-02-03 17:34:15 - DEBUG -   Registros con Unidades_Finales > 0: 82
2026-02-03 17:34:15 - DEBUG -   Ventas finales: 2365.92€
2026-02-03 17:34:15 - INFO -   Ventas finales: 2365.92€
2026-02-03 17:34:15 - INFO - 
============================================================
2026-02-03 17:34:15 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 17:34:15 - INFO - ============================================================
2026-02-03 17:34:15 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 17:34:15 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 17:34:15 - INFO - DataLoader inicializado correctamente
2026-02-03 17:34:15 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 17:34:15 - INFO - ============================================================
2026-02-03 17:34:15 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 17:34:15 - INFO - ============================================================
2026-02-03 17:34:15 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 17:34:15 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 17:34:15 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:34:15 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:34:15 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 17:34:15 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:34:15 - DEBUG - Usando hoja: Stock
2026-02-03 17:34:15 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 17:34:15 - INFO - Stock actual cargado: 30 registros
2026-02-03 17:34:15 - INFO -   Stock: 30 registros
2026-02-03 17:34:15 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 17:34:15 - INFO - Fusión completada: 84 registros
2026-02-03 17:34:15 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 17:34:15 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 17:34:15 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 17:34:15 - INFO - Corrección completada:
2026-02-03 17:34:15 - INFO -   - Artículos corregidos: 82/84
2026-02-03 17:34:15 - INFO -   - Artículos aumentados: 82
2026-02-03 17:34:15 - INFO -   - Artículos reducidos: 0
2026-02-03 17:34:15 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 17:34:15 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 17:34:15 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 17:34:15 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 84 registros
2026-02-03 17:34:15 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 17:34:15 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 17:34:15 - DEBUG -   Con valor 0: 2
2026-02-03 17:34:15 - DEBUG -   Con valor > 0: 82
2026-02-03 17:34:15 - DEBUG -   Suma Ventas_Objetivo: 2365.92€
2026-02-03 17:34:15 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 82 registros
2026-02-03 17:34:15 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_fitos.xlsx
2026-02-03 17:34:15 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_fitos.xlsx
2026-02-03 17:34:15 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_fitos.xlsx
2026-02-03 17:34:15 - INFO -   Articulos: 82
2026-02-03 17:34:15 - INFO -   Importe: 2365.92€
2026-02-03 17:34:15 - INFO - 
==================================================
2026-02-03 17:34:15 - INFO - SECCION: VIVERO
2026-02-03 17:34:15 - INFO - ==================================================
2026-02-03 17:34:15 - INFO - === LEYENDO DATOS PARA SECCIÓN: VIVERO ===
2026-02-03 17:34:15 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 17:34:15 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: vivero
2026-02-03 17:34:15 - INFO - Archivo ABC encontrado para 'vivero': .\./data/input\CLASIFICACION_ABC+D_vivero.xlsx
2026-02-03 17:34:15 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_vivero.xlsx
2026-02-03 17:34:15 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 17:34:15 - INFO - Clasificación ABC cargada para 'vivero': 565 registros
2026-02-03 17:34:15 - DEBUG - [DEBUG] ABC leído: 565 registros
2026-02-03 17:34:15 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 17:34:15 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 17:34:15 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 17:34:19 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:34:19 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 17:34:19 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 17:34:19 - INFO - Ventas cargadas: 44082 registros
2026-02-03 17:34:19 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 17:34:19 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 17:34:19 - DEBUG - [DEBUG] Filtrando ventas por sección: vivero
2026-02-03 17:34:19 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 17:34:19 - DEBUG -   maf: 10970 registros
2026-02-03 17:34:19 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 17:34:19 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 17:34:19 - DEBUG -   interior: 3624 registros
2026-02-03 17:34:19 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 17:34:19 - DEBUG -   deco_interior: 2468 registros
2026-02-03 17:34:19 - DEBUG -   vivero: 2460 registros
2026-02-03 17:34:19 - DEBUG -   fitos: 1987 registros
2026-02-03 17:34:19 - DEBUG -   semillas: 1180 registros
2026-02-03 17:34:19 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 17:34:19 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 17:34:19 - DEBUG - [DEBUG] Tras filtrar por 'vivero': 2460 registros
2026-02-03 17:34:19 - INFO - Filtrados 2460 registros de sección 'vivero' de 44082 total
2026-02-03 17:34:19 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 17:34:19 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 17:34:21 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:34:21 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 17:34:21 - INFO - Costes cargados: 22145 registros
2026-02-03 17:34:21 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 17:34:21 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 17:34:21 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA VIVERO ===
2026-02-03 17:34:21 - INFO -   ABC: 565 registros
2026-02-03 17:34:21 - INFO -   Ventas: 2460 registros
2026-02-03 17:34:21 - INFO -   Costes: 22145 registros
2026-02-03 17:34:21 - DEBUG - [DEBUG] abc_df: 565 registros
2026-02-03 17:34:21 - DEBUG - [DEBUG] ventas_df: 2460 registros
2026-02-03 17:34:21 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 17:34:21 - INFO - Datos de ventas: 189 registros
2026-02-03 17:34:21 - INFO - Calculando pedido para semana 14 (189 registros)
2026-02-03 17:34:21 - INFO -   Objetivo: 5297.17€, Actual (ABC): 4113.14€
2026-02-03 17:34:21 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 17:34:21 - INFO -   Factor total: 1.3125
2026-02-03 17:34:21 - INFO -   Factor escalado: 1.6903
2026-02-03 17:34:21 - INFO -   Ventas preliminares (con ceil): 8761.94€
2026-02-03 17:34:21 - INFO -   Objetivo final: 6952.54€
2026-02-03 17:34:21 - INFO -   Delta: 1809.40€
2026-02-03 17:34:21 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 17:34:21 - DEBUG -   Total registros: 107
2026-02-03 17:34:21 - DEBUG -   Registros con Unidades_Finales > 0: 96
2026-02-03 17:34:21 - DEBUG -   Ventas finales: 6990.51€
2026-02-03 17:34:21 - INFO -   Ventas finales: 6990.51€
2026-02-03 17:34:21 - INFO - 
============================================================
2026-02-03 17:34:21 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 17:34:21 - INFO - ============================================================
2026-02-03 17:34:21 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 17:34:21 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 17:34:21 - INFO - DataLoader inicializado correctamente
2026-02-03 17:34:21 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 17:34:21 - INFO - ============================================================
2026-02-03 17:34:21 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 17:34:21 - INFO - ============================================================
2026-02-03 17:34:21 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 17:34:21 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 17:34:21 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:34:21 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:34:21 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 17:34:21 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:34:21 - DEBUG - Usando hoja: Stock
2026-02-03 17:34:21 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 17:34:21 - INFO - Stock actual cargado: 30 registros
2026-02-03 17:34:21 - INFO -   Stock: 30 registros
2026-02-03 17:34:21 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 17:34:21 - INFO - Fusión completada: 107 registros
2026-02-03 17:34:21 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 17:34:21 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 17:34:21 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 17:34:21 - INFO - Corrección completada:
2026-02-03 17:34:21 - INFO -   - Artículos corregidos: 96/107
2026-02-03 17:34:21 - INFO -   - Artículos aumentados: 96
2026-02-03 17:34:21 - INFO -   - Artículos reducidos: 0
2026-02-03 17:34:21 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 17:34:21 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 17:34:21 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 17:34:21 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 107 registros
2026-02-03 17:34:21 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 17:34:21 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 17:34:21 - DEBUG -   Con valor 0: 11
2026-02-03 17:34:21 - DEBUG -   Con valor > 0: 96
2026-02-03 17:34:21 - DEBUG -   Suma Ventas_Objetivo: 6990.51€
2026-02-03 17:34:21 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 96 registros
2026-02-03 17:34:21 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_vivero.xlsx
2026-02-03 17:34:21 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_vivero.xlsx
2026-02-03 17:34:21 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_vivero.xlsx
2026-02-03 17:34:21 - INFO -   Articulos: 96
2026-02-03 17:34:21 - INFO -   Importe: 6990.51€
2026-02-03 17:34:21 - INFO - 
==================================================
2026-02-03 17:34:21 - INFO - SECCION: UTILES_JARDIN
2026-02-03 17:34:21 - INFO - ==================================================
2026-02-03 17:34:21 - INFO - === LEYENDO DATOS PARA SECCIÓN: UTILES_JARDIN ===
2026-02-03 17:34:21 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 17:34:21 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: utiles_jardin
2026-02-03 17:34:21 - INFO - Archivo ABC encontrado para 'utiles_jardin': .\./data/input\CLASIFICACION_ABC+D_utiles_jardin.xlsx
2026-02-03 17:34:21 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_utiles_jardin.xlsx
2026-02-03 17:34:21 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 17:34:21 - INFO - Clasificación ABC cargada para 'utiles_jardin': 433 registros
2026-02-03 17:34:21 - DEBUG - [DEBUG] ABC leído: 433 registros
2026-02-03 17:34:21 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 17:34:21 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 17:34:21 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 17:34:25 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:34:25 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 17:34:25 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 17:34:25 - INFO - Ventas cargadas: 44082 registros
2026-02-03 17:34:25 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 17:34:25 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 17:34:25 - DEBUG - [DEBUG] Filtrando ventas por sección: utiles_jardin
2026-02-03 17:34:25 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 17:34:25 - DEBUG -   maf: 10970 registros
2026-02-03 17:34:25 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 17:34:25 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 17:34:25 - DEBUG -   interior: 3624 registros
2026-02-03 17:34:25 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 17:34:25 - DEBUG -   deco_interior: 2468 registros
2026-02-03 17:34:25 - DEBUG -   vivero: 2460 registros
2026-02-03 17:34:25 - DEBUG -   fitos: 1987 registros
2026-02-03 17:34:25 - DEBUG -   semillas: 1180 registros
2026-02-03 17:34:25 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 17:34:25 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 17:34:25 - DEBUG - [DEBUG] Tras filtrar por 'utiles_jardin': 1009 registros
2026-02-03 17:34:25 - INFO - Filtrados 1009 registros de sección 'utiles_jardin' de 44082 total
2026-02-03 17:34:25 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 17:34:25 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 17:34:27 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:34:27 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 17:34:27 - INFO - Costes cargados: 22145 registros
2026-02-03 17:34:27 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 17:34:27 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 17:34:27 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA UTILES_JARDIN ===
2026-02-03 17:34:27 - INFO -   ABC: 433 registros
2026-02-03 17:34:27 - INFO -   Ventas: 1009 registros
2026-02-03 17:34:27 - INFO -   Costes: 22145 registros
2026-02-03 17:34:27 - DEBUG - [DEBUG] abc_df: 433 registros
2026-02-03 17:34:27 - DEBUG - [DEBUG] ventas_df: 1009 registros
2026-02-03 17:34:27 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 17:34:27 - INFO - Datos de ventas: 89 registros
2026-02-03 17:34:27 - INFO - Calculando pedido para semana 14 (89 registros)
2026-02-03 17:34:28 - INFO -   Objetivo: 1044.77€, Actual (ABC): 818.79€
2026-02-03 17:34:28 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 17:34:28 - INFO -   Factor total: 1.3125
2026-02-03 17:34:28 - INFO -   Factor escalado: 1.6747
2026-02-03 17:34:28 - INFO -   Ventas preliminares (con ceil): 1929.56€
2026-02-03 17:34:28 - INFO -   Objetivo final: 1371.26€
2026-02-03 17:34:28 - INFO -   Delta: 558.30€
2026-02-03 17:34:28 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 17:34:28 - DEBUG -   Total registros: 78
2026-02-03 17:34:28 - DEBUG -   Registros con Unidades_Finales > 0: 78
2026-02-03 17:34:28 - DEBUG -   Ventas finales: 1390.00€
2026-02-03 17:34:28 - INFO -   Ventas finales: 1390.00€
2026-02-03 17:34:28 - INFO - 
============================================================
2026-02-03 17:34:28 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 17:34:28 - INFO - ============================================================
2026-02-03 17:34:28 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 17:34:28 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 17:34:28 - INFO - DataLoader inicializado correctamente
2026-02-03 17:34:28 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 17:34:28 - INFO - ============================================================
2026-02-03 17:34:28 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 17:34:28 - INFO - ============================================================
2026-02-03 17:34:28 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 17:34:28 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 17:34:28 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:34:28 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:34:28 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 17:34:28 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:34:28 - DEBUG - Usando hoja: Stock
2026-02-03 17:34:28 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 17:34:28 - INFO - Stock actual cargado: 30 registros
2026-02-03 17:34:28 - INFO -   Stock: 30 registros
2026-02-03 17:34:28 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 17:34:28 - INFO - Fusión completada: 78 registros
2026-02-03 17:34:28 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 17:34:28 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 17:34:28 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 17:34:28 - INFO - Corrección completada:
2026-02-03 17:34:28 - INFO -   - Artículos corregidos: 78/78
2026-02-03 17:34:28 - INFO -   - Artículos aumentados: 78
2026-02-03 17:34:28 - INFO -   - Artículos reducidos: 0
2026-02-03 17:34:28 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 17:34:28 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 17:34:28 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 17:34:28 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 78 registros
2026-02-03 17:34:28 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 17:34:28 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 17:34:28 - DEBUG -   Con valor 0: 0
2026-02-03 17:34:28 - DEBUG -   Con valor > 0: 78
2026-02-03 17:34:28 - DEBUG -   Suma Ventas_Objetivo: 1390.00€
2026-02-03 17:34:28 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 78 registros
2026-02-03 17:34:28 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx
2026-02-03 17:34:28 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx
2026-02-03 17:34:28 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx
2026-02-03 17:34:28 - INFO -   Articulos: 78
2026-02-03 17:34:28 - INFO -   Importe: 1390.00€
2026-02-03 17:34:28 - INFO - 
==================================================
2026-02-03 17:34:28 - INFO - SECCION: TIERRAS_ARIDOS
2026-02-03 17:34:28 - INFO - ==================================================
2026-02-03 17:34:28 - INFO - === LEYENDO DATOS PARA SECCIÓN: TIERRAS_ARIDOS ===
2026-02-03 17:34:28 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 17:34:28 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: tierras_aridos
2026-02-03 17:34:28 - WARNING - No se encontró archivo específico para 'tierras_aridos', usando: .\./data/input\CLASIFICACION_ABC+D_DECO_EXTERIOR.xlsx
2026-02-03 17:34:28 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_DECO_EXTERIOR.xlsx
2026-02-03 17:34:28 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 17:34:28 - INFO - Clasificación ABC cargada para 'tierras_aridos': 995 registros
2026-02-03 17:34:28 - DEBUG - [DEBUG] ABC leído: 995 registros
2026-02-03 17:34:28 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 17:34:28 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 17:34:28 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 17:34:32 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:34:32 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 17:34:32 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 17:34:32 - INFO - Ventas cargadas: 44082 registros
2026-02-03 17:34:32 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 17:34:32 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 17:34:32 - DEBUG - [DEBUG] Filtrando ventas por sección: tierras_aridos
2026-02-03 17:34:32 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 17:34:32 - DEBUG -   maf: 10970 registros
2026-02-03 17:34:32 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 17:34:32 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 17:34:32 - DEBUG -   interior: 3624 registros
2026-02-03 17:34:32 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 17:34:32 - DEBUG -   deco_interior: 2468 registros
2026-02-03 17:34:32 - DEBUG -   vivero: 2460 registros
2026-02-03 17:34:32 - DEBUG -   fitos: 1987 registros
2026-02-03 17:34:32 - DEBUG -   semillas: 1180 registros
2026-02-03 17:34:32 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 17:34:32 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 17:34:32 - DEBUG - [DEBUG] Tras filtrar por 'tierras_aridos': 3264 registros
2026-02-03 17:34:32 - INFO - Filtrados 3264 registros de sección 'tierras_aridos' de 44082 total
2026-02-03 17:34:32 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 17:34:32 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 17:34:34 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:34:34 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 17:34:34 - INFO - Costes cargados: 22145 registros
2026-02-03 17:34:34 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 17:34:34 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 17:34:34 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA TIERRAS_ARIDOS ===
2026-02-03 17:34:34 - INFO -   ABC: 995 registros
2026-02-03 17:34:34 - INFO -   Ventas: 3264 registros
2026-02-03 17:34:34 - INFO -   Costes: 22145 registros
2026-02-03 17:34:34 - DEBUG - [DEBUG] abc_df: 995 registros
2026-02-03 17:34:34 - DEBUG - [DEBUG] ventas_df: 3264 registros
2026-02-03 17:34:34 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 17:34:34 - INFO - Datos de ventas: 302 registros
2026-02-03 17:34:34 - INFO - Calculando pedido para semana 14 (302 registros)
2026-02-03 17:34:34 - INFO -   Objetivo: 4097.24€, Actual (ABC): 4019.19€
2026-02-03 17:34:34 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 17:34:34 - INFO -   Factor total: 1.3125
2026-02-03 17:34:34 - INFO -   Factor escalado: 1.3380
2026-02-03 17:34:34 - INFO -   Ventas preliminares (con ceil): 5809.66€
2026-02-03 17:34:34 - INFO -   Objetivo final: 5377.63€
2026-02-03 17:34:34 - INFO -   Delta: 432.03€
2026-02-03 17:34:34 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 17:34:34 - DEBUG -   Total registros: 72
2026-02-03 17:34:34 - DEBUG -   Registros con Unidades_Finales > 0: 71
2026-02-03 17:34:34 - DEBUG -   Ventas finales: 5387.14€
2026-02-03 17:34:34 - INFO -   Ventas finales: 5387.14€
2026-02-03 17:34:34 - INFO - 
============================================================
2026-02-03 17:34:34 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 17:34:34 - INFO - ============================================================
2026-02-03 17:34:34 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 17:34:34 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 17:34:34 - INFO - DataLoader inicializado correctamente
2026-02-03 17:34:34 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 17:34:34 - INFO - ============================================================
2026-02-03 17:34:34 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 17:34:34 - INFO - ============================================================
2026-02-03 17:34:34 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 17:34:34 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 17:34:34 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:34:34 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:34:34 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 17:34:34 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:34:34 - DEBUG - Usando hoja: Stock
2026-02-03 17:34:34 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 17:34:34 - INFO - Stock actual cargado: 30 registros
2026-02-03 17:34:34 - INFO -   Stock: 30 registros
2026-02-03 17:34:34 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 17:34:34 - INFO - Fusión completada: 72 registros
2026-02-03 17:34:34 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 17:34:34 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 17:34:34 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 17:34:34 - INFO - Corrección completada:
2026-02-03 17:34:34 - INFO -   - Artículos corregidos: 71/72
2026-02-03 17:34:34 - INFO -   - Artículos aumentados: 71
2026-02-03 17:34:34 - INFO -   - Artículos reducidos: 0
2026-02-03 17:34:34 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 17:34:34 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 17:34:34 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 17:34:34 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 72 registros
2026-02-03 17:34:34 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 17:34:34 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 17:34:34 - DEBUG -   Con valor 0: 1
2026-02-03 17:34:34 - DEBUG -   Con valor > 0: 71
2026-02-03 17:34:34 - DEBUG -   Suma Ventas_Objetivo: 5387.14€
2026-02-03 17:34:34 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 71 registros
2026-02-03 17:34:34 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx
2026-02-03 17:34:34 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx
2026-02-03 17:34:34 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx
2026-02-03 17:34:34 - INFO -   Articulos: 71
2026-02-03 17:34:34 - INFO -   Importe: 5387.14€
2026-02-03 17:34:34 - INFO - 
==================================================
2026-02-03 17:34:34 - INFO - SECCION: DECO_EXTERIOR
2026-02-03 17:34:34 - INFO - ==================================================
2026-02-03 17:34:34 - INFO - === LEYENDO DATOS PARA SECCIÓN: DECO_EXTERIOR ===
2026-02-03 17:34:34 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 17:34:34 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: deco_exterior
2026-02-03 17:34:34 - INFO - Archivo ABC encontrado para 'deco_exterior': .\./data/input\CLASIFICACION_ABC+D_deco_exterior.xlsx
2026-02-03 17:34:34 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_deco_exterior.xlsx
2026-02-03 17:34:34 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 17:34:34 - INFO - Clasificación ABC cargada para 'deco_exterior': 995 registros
2026-02-03 17:34:34 - DEBUG - [DEBUG] ABC leído: 995 registros
2026-02-03 17:34:34 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 17:34:34 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 17:34:34 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 17:34:38 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:34:38 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 17:34:38 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 17:34:38 - INFO - Ventas cargadas: 44082 registros
2026-02-03 17:34:38 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 17:34:38 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 17:34:38 - DEBUG - [DEBUG] Filtrando ventas por sección: deco_exterior
2026-02-03 17:34:38 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 17:34:38 - DEBUG -   maf: 10970 registros
2026-02-03 17:34:38 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 17:34:38 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 17:34:38 - DEBUG -   interior: 3624 registros
2026-02-03 17:34:38 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 17:34:38 - DEBUG -   deco_interior: 2468 registros
2026-02-03 17:34:38 - DEBUG -   vivero: 2460 registros
2026-02-03 17:34:38 - DEBUG -   fitos: 1987 registros
2026-02-03 17:34:38 - DEBUG -   semillas: 1180 registros
2026-02-03 17:34:38 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 17:34:38 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 17:34:39 - DEBUG - [DEBUG] Tras filtrar por 'deco_exterior': 4018 registros
2026-02-03 17:34:39 - INFO - Filtrados 4018 registros de sección 'deco_exterior' de 44082 total
2026-02-03 17:34:39 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 17:34:39 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 17:34:41 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:34:41 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 17:34:41 - INFO - Costes cargados: 22145 registros
2026-02-03 17:34:41 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 17:34:41 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 17:34:41 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA DECO_EXTERIOR ===
2026-02-03 17:34:41 - INFO -   ABC: 995 registros
2026-02-03 17:34:41 - INFO -   Ventas: 4018 registros
2026-02-03 17:34:41 - INFO -   Costes: 22145 registros
2026-02-03 17:34:41 - DEBUG - [DEBUG] abc_df: 995 registros
2026-02-03 17:34:41 - DEBUG - [DEBUG] ventas_df: 4018 registros
2026-02-03 17:34:41 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 17:34:41 - INFO - Datos de ventas: 316 registros
2026-02-03 17:34:41 - INFO - Calculando pedido para semana 14 (316 registros)
2026-02-03 17:34:41 - INFO -   Objetivo: 3740.34€, Actual (ABC): 4104.66€
2026-02-03 17:34:41 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 17:34:41 - INFO -   Factor total: 1.3125
2026-02-03 17:34:41 - INFO -   Factor escalado: 1.1960
2026-02-03 17:34:41 - INFO -   Ventas preliminares (con ceil): 6094.59€
2026-02-03 17:34:41 - INFO -   Objetivo final: 4909.20€
2026-02-03 17:34:41 - INFO -   Delta: 1185.39€
2026-02-03 17:34:41 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 17:34:41 - DEBUG -   Total registros: 224
2026-02-03 17:34:41 - DEBUG -   Registros con Unidades_Finales > 0: 205
2026-02-03 17:34:41 - DEBUG -   Ventas finales: 4923.89€
2026-02-03 17:34:41 - INFO -   Ventas finales: 4923.89€
2026-02-03 17:34:41 - INFO - 
============================================================
2026-02-03 17:34:41 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 17:34:41 - INFO - ============================================================
2026-02-03 17:34:41 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 17:34:41 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 17:34:41 - INFO - DataLoader inicializado correctamente
2026-02-03 17:34:41 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 17:34:41 - INFO - ============================================================
2026-02-03 17:34:41 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 17:34:41 - INFO - ============================================================
2026-02-03 17:34:41 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 17:34:41 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 17:34:41 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:34:41 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:34:41 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 17:34:41 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:34:41 - DEBUG - Usando hoja: Stock
2026-02-03 17:34:41 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 17:34:41 - INFO - Stock actual cargado: 30 registros
2026-02-03 17:34:41 - INFO -   Stock: 30 registros
2026-02-03 17:34:41 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 17:34:41 - INFO - Fusión completada: 224 registros
2026-02-03 17:34:41 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 17:34:41 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 17:34:41 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 17:34:41 - INFO - Corrección completada:
2026-02-03 17:34:41 - INFO -   - Artículos corregidos: 205/224
2026-02-03 17:34:41 - INFO -   - Artículos aumentados: 205
2026-02-03 17:34:41 - INFO -   - Artículos reducidos: 0
2026-02-03 17:34:41 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 17:34:41 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 17:34:41 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 17:34:41 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 224 registros
2026-02-03 17:34:41 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 17:34:41 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 17:34:41 - DEBUG -   Con valor 0: 19
2026-02-03 17:34:41 - DEBUG -   Con valor > 0: 205
2026-02-03 17:34:41 - DEBUG -   Suma Ventas_Objetivo: 4923.89€
2026-02-03 17:34:41 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 205 registros
2026-02-03 17:34:41 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_deco_exterior.xlsx
2026-02-03 17:34:41 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_deco_exterior.xlsx
2026-02-03 17:34:41 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_deco_exterior.xlsx
2026-02-03 17:34:41 - INFO -   Articulos: 205
2026-02-03 17:34:41 - INFO -   Importe: 4923.89€
2026-02-03 17:34:41 - INFO - Estado guardado correctamente
2026-02-03 17:34:41 - INFO - Generando resumen: .\./data/output\Resumen_Pedidos_VIVERO_2026-02-03.xlsx
2026-02-03 17:34:41 - INFO - Resumen guardado: .\./data/output\Resumen_Pedidos_VIVERO_2026-02-03.xlsx
2026-02-03 17:34:41 - INFO - Estado guardado correctamente
2026-02-03 17:34:41 - INFO - 
============================================================
2026-02-03 17:34:41 - INFO - PREPARANDO ENVÍO DE EMAILS
2026-02-03 17:34:41 - INFO - ============================================================
2026-02-03 17:34:41 - DEBUG - [DEBUG] Archivos agrupados por sección: {'maf': ['.\\./data/output\\Pedido_Semana_14_2026-02-03_maf.xlsx'], 'interior': ['.\\./data/output\\Pedido_Semana_14_2026-02-03_deco_interior.xlsx', '.\\./data/output\\Pedido_Semana_14_2026-02-03_interior.xlsx'], 'semillas': ['.\\./data/output\\Pedido_Semana_14_2026-02-03_semillas.xlsx'], 'vivo': ['.\\./data/output\\Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx'], 'manufacturado': ['.\\./data/output\\Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx'], 'fitos': ['.\\./data/output\\Pedido_Semana_14_2026-02-03_fitos.xlsx'], 'vivero': ['.\\./data/output\\Pedido_Semana_14_2026-02-03_vivero.xlsx'], 'jardin': ['.\\./data/output\\Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx'], 'aridos': ['.\\./data/output\\Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx'], 'exterior': ['.\\./data/output\\Pedido_Semana_14_2026-02-03_deco_exterior.xlsx']}
2026-02-03 17:34:41 - INFO - 
============================================================
2026-02-03 17:34:41 - INFO - ENVÍO DE EMAILS A RESPONSABLES
2026-02-03 17:34:41 - INFO - ============================================================
2026-02-03 17:34:41 - DEBUG - [DEBUG] SMTP configurado: {'servidor': 'smtp.serviciodecorreo.es', 'puerto': 465, 'usar_ssl': True, 'usar_tls': False}
2026-02-03 17:34:41 - DEBUG - [DEBUG] Remitente: {'email': 'ivan.delgado@viveverde.es', 'nombre': 'Sistema de Pedidos VIVEVERDE'}
2026-02-03 17:34:41 - DEBUG - [DEBUG] Destinatarios: {'maf': 'ivan.delgado@viveverde.es', 'interior': 'ivan.delgado@viveverde.es', 'mascotas_vivo': 'ivan.delgado@viveverde.es', 'mascotas_manufacturado': 'ivan.delgado@viveverde.es', 'deco_interior': ['ivan.delgado@viveverde.ess', 'ivan.delgado@viveverde.es'], 'deco_exterior': 'ivan.delgado@viveverde.es', 'tierras_aridos': 'ivan.delgado@viveverde.es', 'fitos': 'ivan.delgado@viveverde.es', 'semillas': 'ivan.delgado@viveverde.es', 'utiles_jardin': 'ivan.delgado@viveverde.es', 'vivero': 'ivan.delgado@viveverde.es'}
2026-02-03 17:34:41 - INFO - EmailService inicializado correctamente
2026-02-03 17:34:41 - INFO - 
Enviando email para sección: maf
2026-02-03 17:34:41 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_maf.xlsx']
2026-02-03 17:34:41 - INFO - ============================================================
2026-02-03 17:34:41 - INFO - ENVIANDO EMAIL PARA SECCIÓN: MAF
2026-02-03 17:34:41 - INFO - ============================================================
2026-02-03 17:34:41 - DEBUG - [DEBUG] Destinatarios para maf: [{'email': 'ivan.delgado@viveverde.es', 'nombre': 'Encargado'}]
2026-02-03 17:34:41 - INFO - Destinatarios: ['ivan.delgado@viveverde.es']
2026-02-03 17:34:41 - INFO - Archivos a enviar: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_maf.xlsx']
2026-02-03 17:34:41 - WARNING - Archivo no encontrado para adjuntar: .\./data/output\Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 17:34:42 - INFO - Email enviado exitosamente a: ivan.delgado@viveverde.es
2026-02-03 17:34:42 - INFO - ✓ Email enviado exitosamente para maf
2026-02-03 17:34:42 - INFO - ✓ Email enviado exitosamente a maf
2026-02-03 17:34:42 - INFO - 
Enviando email para sección: interior
2026-02-03 17:34:42 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_deco_interior.xlsx', '.\\./data/output\\Pedido_Semana_14_2026-02-03_interior.xlsx']
2026-02-03 17:34:42 - INFO - ============================================================
2026-02-03 17:34:42 - INFO - ENVIANDO EMAIL PARA SECCIÓN: INTERIOR
2026-02-03 17:34:42 - INFO - ============================================================
2026-02-03 17:34:42 - DEBUG - [DEBUG] Destinatarios para interior: [{'email': 'ivan.delgado@viveverde.es', 'nombre': 'Encargado'}]
2026-02-03 17:34:42 - INFO - Destinatarios: ['ivan.delgado@viveverde.es']
2026-02-03 17:34:42 - INFO - Archivos a enviar: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_deco_interior.xlsx', '.\\./data/output\\Pedido_Semana_14_2026-02-03_interior.xlsx']
2026-02-03 17:34:42 - WARNING - Archivo no encontrado para adjuntar: .\./data/output\Pedido_Semana_14_2026-02-03_deco_interior.xlsx
2026-02-03 17:34:42 - INFO - Archivo adjuntado: Pedido_Semana_14_2026-02-03_interior.xlsx
2026-02-03 17:34:42 - INFO - Email enviado exitosamente a: ivan.delgado@viveverde.es
2026-02-03 17:34:42 - INFO - ✓ Email enviado exitosamente para interior
2026-02-03 17:34:42 - INFO - ✓ Email enviado exitosamente a interior
2026-02-03 17:34:42 - INFO - 
Enviando email para sección: semillas
2026-02-03 17:34:42 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_semillas.xlsx']
2026-02-03 17:34:42 - INFO - ============================================================
2026-02-03 17:34:42 - INFO - ENVIANDO EMAIL PARA SECCIÓN: SEMILLAS
2026-02-03 17:34:42 - INFO - ============================================================
2026-02-03 17:34:42 - DEBUG - [DEBUG] Destinatarios para semillas: [{'email': 'ivan.delgado@viveverde.es', 'nombre': 'Encargado'}]
2026-02-03 17:34:42 - INFO - Destinatarios: ['ivan.delgado@viveverde.es']
2026-02-03 17:34:42 - INFO - Archivos a enviar: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_semillas.xlsx']
2026-02-03 17:34:42 - INFO - Archivo adjuntado: Pedido_Semana_14_2026-02-03_semillas.xlsx
2026-02-03 17:34:43 - INFO - Email enviado exitosamente a: ivan.delgado@viveverde.es
2026-02-03 17:34:43 - INFO - ✓ Email enviado exitosamente para semillas
2026-02-03 17:34:43 - INFO - ✓ Email enviado exitosamente a semillas
2026-02-03 17:34:43 - INFO - 
Enviando email para sección: vivo
2026-02-03 17:34:43 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx']
2026-02-03 17:34:43 - INFO - ============================================================
2026-02-03 17:34:43 - INFO - ENVIANDO EMAIL PARA SECCIÓN: VIVO
2026-02-03 17:34:43 - INFO - ============================================================
2026-02-03 17:34:43 - DEBUG - [DEBUG] Destinatarios para vivo: []
2026-02-03 17:34:43 - WARNING - No hay destinatarios configurados para la sección: vivo
2026-02-03 17:34:43 - ERROR - ✗ Error al enviar email a vivo: sin_destinatarios
2026-02-03 17:34:43 - INFO - 
Enviando email para sección: manufacturado
2026-02-03 17:34:43 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx']
2026-02-03 17:34:43 - INFO - ============================================================
2026-02-03 17:34:43 - INFO - ENVIANDO EMAIL PARA SECCIÓN: MANUFACTURADO
2026-02-03 17:34:43 - INFO - ============================================================
2026-02-03 17:34:43 - DEBUG - [DEBUG] Destinatarios para manufacturado: []
2026-02-03 17:34:43 - WARNING - No hay destinatarios configurados para la sección: manufacturado
2026-02-03 17:34:43 - ERROR - ✗ Error al enviar email a manufacturado: sin_destinatarios
2026-02-03 17:34:43 - INFO - 
Enviando email para sección: fitos
2026-02-03 17:34:43 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_fitos.xlsx']
2026-02-03 17:34:43 - INFO - ============================================================
2026-02-03 17:34:43 - INFO - ENVIANDO EMAIL PARA SECCIÓN: FITOS
2026-02-03 17:34:43 - INFO - ============================================================
2026-02-03 17:34:43 - DEBUG - [DEBUG] Destinatarios para fitos: [{'email': 'ivan.delgado@viveverde.es', 'nombre': 'Encargado'}]
2026-02-03 17:34:43 - INFO - Destinatarios: ['ivan.delgado@viveverde.es']
2026-02-03 17:34:43 - INFO - Archivos a enviar: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_fitos.xlsx']
2026-02-03 17:34:43 - INFO - Archivo adjuntado: Pedido_Semana_14_2026-02-03_fitos.xlsx
2026-02-03 17:34:43 - INFO - Email enviado exitosamente a: ivan.delgado@viveverde.es
2026-02-03 17:34:43 - INFO - ✓ Email enviado exitosamente para fitos
2026-02-03 17:34:43 - INFO - ✓ Email enviado exitosamente a fitos
2026-02-03 17:34:43 - INFO - 
Enviando email para sección: vivero
2026-02-03 17:34:43 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_vivero.xlsx']
2026-02-03 17:34:43 - INFO - ============================================================
2026-02-03 17:34:43 - INFO - ENVIANDO EMAIL PARA SECCIÓN: VIVERO
2026-02-03 17:34:43 - INFO - ============================================================
2026-02-03 17:34:43 - DEBUG - [DEBUG] Destinatarios para vivero: [{'email': 'ivan.delgado@viveverde.es', 'nombre': 'Encargado'}]
2026-02-03 17:34:43 - INFO - Destinatarios: ['ivan.delgado@viveverde.es']
2026-02-03 17:34:43 - INFO - Archivos a enviar: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_vivero.xlsx']
2026-02-03 17:34:43 - INFO - Archivo adjuntado: Pedido_Semana_14_2026-02-03_vivero.xlsx
2026-02-03 17:34:43 - INFO - Email enviado exitosamente a: ivan.delgado@viveverde.es
2026-02-03 17:34:43 - INFO - ✓ Email enviado exitosamente para vivero
2026-02-03 17:34:43 - INFO - ✓ Email enviado exitosamente a vivero
2026-02-03 17:34:43 - INFO - 
Enviando email para sección: jardin
2026-02-03 17:34:43 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx']
2026-02-03 17:34:43 - INFO - ============================================================
2026-02-03 17:34:43 - INFO - ENVIANDO EMAIL PARA SECCIÓN: JARDIN
2026-02-03 17:34:43 - INFO - ============================================================
2026-02-03 17:34:43 - DEBUG - [DEBUG] Destinatarios para jardin: []
2026-02-03 17:34:43 - WARNING - No hay destinatarios configurados para la sección: jardin
2026-02-03 17:34:43 - ERROR - ✗ Error al enviar email a jardin: sin_destinatarios
2026-02-03 17:34:43 - INFO - 
Enviando email para sección: aridos
2026-02-03 17:34:43 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx']
2026-02-03 17:34:43 - INFO - ============================================================
2026-02-03 17:34:43 - INFO - ENVIANDO EMAIL PARA SECCIÓN: ARIDOS
2026-02-03 17:34:43 - INFO - ============================================================
2026-02-03 17:34:43 - DEBUG - [DEBUG] Destinatarios para aridos: []
2026-02-03 17:34:43 - WARNING - No hay destinatarios configurados para la sección: aridos
2026-02-03 17:34:43 - ERROR - ✗ Error al enviar email a aridos: sin_destinatarios
2026-02-03 17:34:43 - INFO - 
Enviando email para sección: exterior
2026-02-03 17:34:43 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_deco_exterior.xlsx']
2026-02-03 17:34:43 - INFO - ============================================================
2026-02-03 17:34:43 - INFO - ENVIANDO EMAIL PARA SECCIÓN: EXTERIOR
2026-02-03 17:34:43 - INFO - ============================================================
2026-02-03 17:34:43 - DEBUG - [DEBUG] Destinatarios para exterior: []
2026-02-03 17:34:43 - WARNING - No hay destinatarios configurados para la sección: exterior
2026-02-03 17:34:43 - ERROR - ✗ Error al enviar email a exterior: sin_destinatarios
2026-02-03 17:34:43 - INFO - 
============================================================
2026-02-03 17:34:43 - INFO - RESUMEN DE ENVÍO DE EMAILS
2026-02-03 17:34:43 - INFO - ============================================================
2026-02-03 17:34:43 - INFO - Emails enviados exitosamente: 5
2026-02-03 17:34:43 - INFO - Emails fallidos: 5
2026-02-03 17:34:43 - INFO - Secciones procesadas: 10
2026-02-03 17:34:43 - INFO - 
======================================================================
2026-02-03 17:34:43 - INFO - RESUMEN DE EJECUCION
2026-02-03 17:34:43 - INFO - ======================================================================
2026-02-03 17:34:43 - INFO - Semana procesada: 14
2026-02-03 17:34:43 - INFO - Archivos generados: 12
2026-02-03 17:34:43 - INFO - Total articulos: 1510
2026-02-03 17:34:43 - INFO - Total importe: 48113.87€
2026-02-03 17:34:43 - INFO - 
✓ EMAILS ENVIADOS: 5
2026-02-03 17:34:43 - INFO - ======================================================================
2026-02-03 17:34:43 - INFO - 
¡PEDIDO GENERADO EXITOSAMENTE!
2026-02-03 17:34:43 - INFO - Archivo principal: .\./data/output\Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 17:34:43 - INFO - Artículos: 1510
2026-02-03 17:34:43 - INFO - Importe: 48113.87€
2026-02-03 17:34:43 - INFO - 
Emails enviados: 5
2026-02-03 17:39:24 - INFO - ======================================================================
2026-02-03 17:39:24 - INFO - SISTEMA DE PEDIDOS DE COMPRA - VIVERO ARANJUEZ V2
2026-02-03 17:39:24 - INFO - Fecha de ejecución: 2026-02-03 17:39:24
2026-02-03 17:39:24 - INFO - ======================================================================
2026-02-03 17:39:24 - INFO - Modo de ejecución: FASE 1 + FASE 2
2026-02-03 17:39:24 - INFO - Envío de emails: Sí
2026-02-03 17:39:24 - INFO - StateManager inicializado. Archivo de estado: .\./data\state.json
2026-02-03 17:39:24 - INFO - Cargando estado desde: .\./data\state.json
2026-02-03 17:39:24 - INFO - Estado cargado correctamente
2026-02-03 17:39:24 - INFO - SchedulerService inicializado correctamente
2026-02-03 17:39:24 - INFO - Horario configurado: sunday a las 15:00
2026-02-03 17:39:24 - INFO - Semana forzada por argumento: 14
2026-02-03 17:39:24 - INFO - ======================================================================
2026-02-03 17:39:24 - INFO - PROCESANDO PEDIDO PARA SEMANA 14
2026-02-03 17:39:24 - INFO - ======================================================================
2026-02-03 17:39:24 - INFO - MODO: FASE 1 (Forecast) + FASE 2 (Corrección)
2026-02-03 17:39:24 - INFO - DataLoader inicializado correctamente
2026-02-03 17:39:24 - INFO - ForecastEngine inicializado correctamente
2026-02-03 17:39:24 - INFO - OrderGenerator inicializado correctamente
2026-02-03 17:39:24 - INFO - SchedulerService inicializado correctamente
2026-02-03 17:39:24 - INFO - Horario configurado: sunday a las 15:00
2026-02-03 17:39:24 - INFO - Período de la semana: 2026-03-30 al 2026-04-05
2026-02-03 17:39:24 - INFO - Stock acumulado cargado: 2633 artículos
2026-02-03 17:39:24 - INFO - 
==================================================
2026-02-03 17:39:24 - INFO - SECCION: MAF
2026-02-03 17:39:24 - INFO - ==================================================
2026-02-03 17:39:24 - INFO - === LEYENDO DATOS PARA SECCIÓN: MAF ===
2026-02-03 17:39:24 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 17:39:24 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: maf
2026-02-03 17:39:24 - INFO - Archivo ABC encontrado para 'maf': .\./data/input\CLASIFICACION_ABC+D_maf.xlsx
2026-02-03 17:39:24 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_maf.xlsx
2026-02-03 17:39:24 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 17:39:24 - INFO - Clasificación ABC cargada para 'maf': 499 registros
2026-02-03 17:39:24 - DEBUG - [DEBUG] ABC leído: 499 registros
2026-02-03 17:39:24 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 17:39:24 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 17:39:24 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 17:39:28 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:39:28 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 17:39:28 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 17:39:28 - INFO - Ventas cargadas: 44082 registros
2026-02-03 17:39:28 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 17:39:28 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 17:39:28 - DEBUG - [DEBUG] Filtrando ventas por sección: maf
2026-02-03 17:39:28 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 17:39:28 - DEBUG -   maf: 10970 registros
2026-02-03 17:39:28 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 17:39:28 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 17:39:28 - DEBUG -   interior: 3624 registros
2026-02-03 17:39:28 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 17:39:28 - DEBUG -   deco_interior: 2468 registros
2026-02-03 17:39:28 - DEBUG -   vivero: 2460 registros
2026-02-03 17:39:28 - DEBUG -   fitos: 1987 registros
2026-02-03 17:39:28 - DEBUG -   semillas: 1180 registros
2026-02-03 17:39:28 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 17:39:28 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 17:39:28 - DEBUG - [DEBUG] Tras filtrar por 'maf': 10970 registros
2026-02-03 17:39:28 - INFO - Filtrados 10970 registros de sección 'maf' de 44082 total
2026-02-03 17:39:28 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 17:39:28 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 17:39:30 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:39:30 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 17:39:30 - INFO - Costes cargados: 22145 registros
2026-02-03 17:39:30 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 17:39:30 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 17:39:30 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MAF ===
2026-02-03 17:39:30 - INFO -   ABC: 499 registros
2026-02-03 17:39:30 - INFO -   Ventas: 10970 registros
2026-02-03 17:39:30 - INFO -   Costes: 22145 registros
2026-02-03 17:39:30 - DEBUG - [DEBUG] abc_df: 499 registros
2026-02-03 17:39:30 - DEBUG - [DEBUG] ventas_df: 10970 registros
2026-02-03 17:39:30 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 17:39:30 - INFO - Datos de ventas: 1011 registros
2026-02-03 17:39:30 - INFO - Calculando pedido para semana 14 (1011 registros)
2026-02-03 17:39:30 - INFO -   Objetivo: 7050.65€, Actual (ABC): 5843.77€
2026-02-03 17:39:30 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 17:39:30 - INFO -   Factor total: 1.3125
2026-02-03 17:39:30 - INFO -   Factor escalado: 1.5836
2026-02-03 17:39:30 - INFO -   Ventas preliminares (con ceil): 9931.01€
2026-02-03 17:39:30 - INFO -   Objetivo final: 9253.98€
2026-02-03 17:39:30 - INFO -   Delta: 677.03€
2026-02-03 17:39:30 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 17:39:30 - DEBUG -   Total registros: 222
2026-02-03 17:39:30 - DEBUG -   Registros con Unidades_Finales > 0: 191
2026-02-03 17:39:30 - DEBUG -   Ventas finales: 9259.59€
2026-02-03 17:39:30 - INFO -   Ventas finales: 9259.59€
2026-02-03 17:39:30 - INFO - 
============================================================
2026-02-03 17:39:30 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 17:39:30 - INFO - ============================================================
2026-02-03 17:39:30 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 17:39:30 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 17:39:30 - INFO - DataLoader inicializado correctamente
2026-02-03 17:39:30 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 17:39:30 - INFO - ============================================================
2026-02-03 17:39:30 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 17:39:30 - INFO - ============================================================
2026-02-03 17:39:30 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 17:39:30 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 17:39:30 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:39:30 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:39:30 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 17:39:30 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:39:30 - DEBUG - Usando hoja: Stock
2026-02-03 17:39:30 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 17:39:30 - INFO - Stock actual cargado: 30 registros
2026-02-03 17:39:30 - INFO -   Stock: 30 registros
2026-02-03 17:39:30 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 17:39:30 - INFO - Fusión completada: 222 registros
2026-02-03 17:39:30 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 17:39:30 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 17:39:30 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 17:39:31 - INFO - Corrección completada:
2026-02-03 17:39:31 - INFO -   - Artículos corregidos: 191/222
2026-02-03 17:39:31 - INFO -   - Artículos aumentados: 191
2026-02-03 17:39:31 - INFO -   - Artículos reducidos: 0
2026-02-03 17:39:31 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 17:39:31 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 17:39:31 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 17:39:31 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 222 registros
2026-02-03 17:39:31 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 17:39:31 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 17:39:31 - DEBUG -   Con valor 0: 31
2026-02-03 17:39:31 - DEBUG -   Con valor > 0: 191
2026-02-03 17:39:31 - DEBUG -   Suma Ventas_Objetivo: 9259.59€
2026-02-03 17:39:31 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 191 registros
2026-02-03 17:39:31 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 17:39:31 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 17:39:31 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 17:39:31 - INFO -   Articulos: 191
2026-02-03 17:39:31 - INFO -   Importe: 9259.59€
2026-02-03 17:39:31 - INFO - 
==================================================
2026-02-03 17:39:31 - INFO - SECCION: DECO_INTERIOR
2026-02-03 17:39:31 - INFO - ==================================================
2026-02-03 17:39:31 - INFO - === LEYENDO DATOS PARA SECCIÓN: DECO_INTERIOR ===
2026-02-03 17:39:31 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 17:39:31 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: deco_interior
2026-02-03 17:39:31 - INFO - Archivo ABC encontrado para 'deco_interior': .\./data/input\CLASIFICACION_ABC+D_deco_interior.xlsx
2026-02-03 17:39:31 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_deco_interior.xlsx
2026-02-03 17:39:31 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 17:39:31 - INFO - Clasificación ABC cargada para 'deco_interior': 1827 registros
2026-02-03 17:39:31 - DEBUG - [DEBUG] ABC leído: 1827 registros
2026-02-03 17:39:31 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 17:39:31 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 17:39:31 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 17:39:35 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:39:35 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 17:39:35 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 17:39:35 - INFO - Ventas cargadas: 44082 registros
2026-02-03 17:39:35 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 17:39:35 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 17:39:35 - DEBUG - [DEBUG] Filtrando ventas por sección: deco_interior
2026-02-03 17:39:35 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 17:39:35 - DEBUG -   maf: 10970 registros
2026-02-03 17:39:35 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 17:39:35 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 17:39:35 - DEBUG -   interior: 3624 registros
2026-02-03 17:39:35 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 17:39:35 - DEBUG -   deco_interior: 2468 registros
2026-02-03 17:39:35 - DEBUG -   vivero: 2460 registros
2026-02-03 17:39:35 - DEBUG -   fitos: 1987 registros
2026-02-03 17:39:35 - DEBUG -   semillas: 1180 registros
2026-02-03 17:39:35 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 17:39:35 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 17:39:35 - DEBUG - [DEBUG] Tras filtrar por 'deco_interior': 2468 registros
2026-02-03 17:39:35 - INFO - Filtrados 2468 registros de sección 'deco_interior' de 44082 total
2026-02-03 17:39:35 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 17:39:35 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 17:39:37 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:39:37 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 17:39:37 - INFO - Costes cargados: 22145 registros
2026-02-03 17:39:37 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 17:39:37 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 17:39:37 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA DECO_INTERIOR ===
2026-02-03 17:39:37 - INFO -   ABC: 1827 registros
2026-02-03 17:39:37 - INFO -   Ventas: 2468 registros
2026-02-03 17:39:37 - INFO -   Costes: 22145 registros
2026-02-03 17:39:37 - DEBUG - [DEBUG] abc_df: 1827 registros
2026-02-03 17:39:37 - DEBUG - [DEBUG] ventas_df: 2468 registros
2026-02-03 17:39:37 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 17:39:37 - INFO - Datos de ventas: 180 registros
2026-02-03 17:39:37 - INFO - Calculando pedido para semana 14 (180 registros)
2026-02-03 17:39:37 - INFO -   Objetivo: 1962.99€, Actual (ABC): 1636.15€
2026-02-03 17:39:37 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 17:39:37 - INFO -   Factor total: 1.3125
2026-02-03 17:39:37 - INFO -   Factor escalado: 1.5747
2026-02-03 17:39:37 - INFO -   Ventas preliminares (con ceil): 2950.01€
2026-02-03 17:39:37 - INFO -   Objetivo final: 2576.42€
2026-02-03 17:39:37 - INFO -   Delta: 373.59€
2026-02-03 17:39:37 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 17:39:37 - DEBUG -   Total registros: 139
2026-02-03 17:39:37 - DEBUG -   Registros con Unidades_Finales > 0: 135
2026-02-03 17:39:37 - DEBUG -   Ventas finales: 2580.73€
2026-02-03 17:39:37 - INFO -   Ventas finales: 2580.73€
2026-02-03 17:39:37 - INFO - 
============================================================
2026-02-03 17:39:37 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 17:39:37 - INFO - ============================================================
2026-02-03 17:39:37 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 17:39:37 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 17:39:37 - INFO - DataLoader inicializado correctamente
2026-02-03 17:39:37 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 17:39:37 - INFO - ============================================================
2026-02-03 17:39:37 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 17:39:37 - INFO - ============================================================
2026-02-03 17:39:37 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 17:39:37 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 17:39:37 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:39:37 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:39:37 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 17:39:37 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:39:37 - DEBUG - Usando hoja: Stock
2026-02-03 17:39:37 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 17:39:37 - INFO - Stock actual cargado: 30 registros
2026-02-03 17:39:37 - INFO -   Stock: 30 registros
2026-02-03 17:39:37 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 17:39:37 - INFO - Fusión completada: 139 registros
2026-02-03 17:39:37 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 17:39:37 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 17:39:37 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 17:39:37 - INFO - Corrección completada:
2026-02-03 17:39:37 - INFO -   - Artículos corregidos: 135/139
2026-02-03 17:39:37 - INFO -   - Artículos aumentados: 135
2026-02-03 17:39:37 - INFO -   - Artículos reducidos: 0
2026-02-03 17:39:37 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 17:39:37 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 17:39:37 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 17:39:37 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 139 registros
2026-02-03 17:39:37 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 17:39:37 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 17:39:37 - DEBUG -   Con valor 0: 4
2026-02-03 17:39:37 - DEBUG -   Con valor > 0: 135
2026-02-03 17:39:37 - DEBUG -   Suma Ventas_Objetivo: 2580.73€
2026-02-03 17:39:37 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 135 registros
2026-02-03 17:39:37 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_deco_interior.xlsx
2026-02-03 17:39:37 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_deco_interior.xlsx
2026-02-03 17:39:37 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_deco_interior.xlsx
2026-02-03 17:39:37 - INFO -   Articulos: 135
2026-02-03 17:39:37 - INFO -   Importe: 2580.73€
2026-02-03 17:39:37 - INFO - 
==================================================
2026-02-03 17:39:37 - INFO - SECCION: SEMILLAS
2026-02-03 17:39:37 - INFO - ==================================================
2026-02-03 17:39:37 - INFO - === LEYENDO DATOS PARA SECCIÓN: SEMILLAS ===
2026-02-03 17:39:37 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 17:39:37 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: semillas
2026-02-03 17:39:37 - INFO - Archivo ABC encontrado para 'semillas': .\./data/input\CLASIFICACION_ABC+D_semillas.xlsx
2026-02-03 17:39:37 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_semillas.xlsx
2026-02-03 17:39:37 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 17:39:37 - INFO - Clasificación ABC cargada para 'semillas': 218 registros
2026-02-03 17:39:37 - DEBUG - [DEBUG] ABC leído: 218 registros
2026-02-03 17:39:37 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 17:39:37 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 17:39:37 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 17:39:41 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:39:41 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 17:39:41 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 17:39:41 - INFO - Ventas cargadas: 44082 registros
2026-02-03 17:39:41 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 17:39:41 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 17:39:41 - DEBUG - [DEBUG] Filtrando ventas por sección: semillas
2026-02-03 17:39:41 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 17:39:41 - DEBUG -   maf: 10970 registros
2026-02-03 17:39:41 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 17:39:41 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 17:39:41 - DEBUG -   interior: 3624 registros
2026-02-03 17:39:41 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 17:39:41 - DEBUG -   deco_interior: 2468 registros
2026-02-03 17:39:41 - DEBUG -   vivero: 2460 registros
2026-02-03 17:39:41 - DEBUG -   fitos: 1987 registros
2026-02-03 17:39:41 - DEBUG -   semillas: 1180 registros
2026-02-03 17:39:41 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 17:39:41 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 17:39:41 - DEBUG - [DEBUG] Tras filtrar por 'semillas': 1180 registros
2026-02-03 17:39:41 - INFO - Filtrados 1180 registros de sección 'semillas' de 44082 total
2026-02-03 17:39:41 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 17:39:41 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 17:39:43 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:39:43 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 17:39:43 - INFO - Costes cargados: 22145 registros
2026-02-03 17:39:43 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 17:39:43 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 17:39:43 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA SEMILLAS ===
2026-02-03 17:39:43 - INFO -   ABC: 218 registros
2026-02-03 17:39:43 - INFO -   Ventas: 1180 registros
2026-02-03 17:39:43 - INFO -   Costes: 22145 registros
2026-02-03 17:39:43 - DEBUG - [DEBUG] abc_df: 218 registros
2026-02-03 17:39:43 - DEBUG - [DEBUG] ventas_df: 1180 registros
2026-02-03 17:39:43 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 17:39:43 - INFO - Datos de ventas: 136 registros
2026-02-03 17:39:43 - INFO - Calculando pedido para semana 14 (136 registros)
2026-02-03 17:39:44 - INFO -   Objetivo: 694.34€, Actual (ABC): 455.14€
2026-02-03 17:39:44 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 17:39:44 - INFO -   Factor total: 1.3125
2026-02-03 17:39:44 - INFO -   Factor escalado: 2.0023
2026-02-03 17:39:44 - INFO -   Ventas preliminares (con ceil): 1129.15€
2026-02-03 17:39:44 - INFO -   Objetivo final: 911.32€
2026-02-03 17:39:44 - INFO -   Delta: 217.83€
2026-02-03 17:39:44 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 17:39:44 - DEBUG -   Total registros: 84
2026-02-03 17:39:44 - DEBUG -   Registros con Unidades_Finales > 0: 84
2026-02-03 17:39:44 - DEBUG -   Ventas finales: 911.60€
2026-02-03 17:39:44 - INFO -   Ventas finales: 911.60€
2026-02-03 17:39:44 - INFO - 
============================================================
2026-02-03 17:39:44 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 17:39:44 - INFO - ============================================================
2026-02-03 17:39:44 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 17:39:44 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 17:39:44 - INFO - DataLoader inicializado correctamente
2026-02-03 17:39:44 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 17:39:44 - INFO - ============================================================
2026-02-03 17:39:44 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 17:39:44 - INFO - ============================================================
2026-02-03 17:39:44 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 17:39:44 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 17:39:44 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:39:44 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:39:44 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 17:39:44 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:39:44 - DEBUG - Usando hoja: Stock
2026-02-03 17:39:44 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 17:39:44 - INFO - Stock actual cargado: 30 registros
2026-02-03 17:39:44 - INFO -   Stock: 30 registros
2026-02-03 17:39:44 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 17:39:44 - INFO - Fusión completada: 84 registros
2026-02-03 17:39:44 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 17:39:44 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 17:39:44 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 17:39:44 - INFO - Corrección completada:
2026-02-03 17:39:44 - INFO -   - Artículos corregidos: 84/84
2026-02-03 17:39:44 - INFO -   - Artículos aumentados: 84
2026-02-03 17:39:44 - INFO -   - Artículos reducidos: 0
2026-02-03 17:39:44 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 17:39:44 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 17:39:44 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 17:39:44 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 84 registros
2026-02-03 17:39:44 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 17:39:44 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 17:39:44 - DEBUG -   Con valor 0: 0
2026-02-03 17:39:44 - DEBUG -   Con valor > 0: 84
2026-02-03 17:39:44 - DEBUG -   Suma Ventas_Objetivo: 911.60€
2026-02-03 17:39:44 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 84 registros
2026-02-03 17:39:44 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_semillas.xlsx
2026-02-03 17:39:44 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_semillas.xlsx
2026-02-03 17:39:44 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_semillas.xlsx
2026-02-03 17:39:44 - INFO -   Articulos: 84
2026-02-03 17:39:44 - INFO -   Importe: 911.60€
2026-02-03 17:39:44 - INFO - 
==================================================
2026-02-03 17:39:44 - INFO - SECCION: MASCOTAS_VIVO
2026-02-03 17:39:44 - INFO - ==================================================
2026-02-03 17:39:44 - INFO - === LEYENDO DATOS PARA SECCIÓN: MASCOTAS_VIVO ===
2026-02-03 17:39:44 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 17:39:44 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: mascotas_vivo
2026-02-03 17:39:44 - INFO - Archivo ABC encontrado para 'mascotas_vivo': .\./data/input\CLASIFICACION_ABC+D_mascotas_vivo.xlsx
2026-02-03 17:39:44 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_mascotas_vivo.xlsx
2026-02-03 17:39:44 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 17:39:44 - INFO - Clasificación ABC cargada para 'mascotas_vivo': 205 registros
2026-02-03 17:39:44 - DEBUG - [DEBUG] ABC leído: 205 registros
2026-02-03 17:39:44 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 17:39:44 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 17:39:44 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 17:39:47 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:39:47 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 17:39:48 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 17:39:48 - INFO - Ventas cargadas: 44082 registros
2026-02-03 17:39:48 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 17:39:48 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 17:39:48 - DEBUG - [DEBUG] Filtrando ventas por sección: mascotas_vivo
2026-02-03 17:39:48 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 17:39:48 - DEBUG -   maf: 10970 registros
2026-02-03 17:39:48 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 17:39:48 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 17:39:48 - DEBUG -   interior: 3624 registros
2026-02-03 17:39:48 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 17:39:48 - DEBUG -   deco_interior: 2468 registros
2026-02-03 17:39:48 - DEBUG -   vivero: 2460 registros
2026-02-03 17:39:48 - DEBUG -   fitos: 1987 registros
2026-02-03 17:39:48 - DEBUG -   semillas: 1180 registros
2026-02-03 17:39:48 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 17:39:48 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 17:39:48 - DEBUG - [DEBUG] Tras filtrar por 'mascotas_vivo': 1124 registros
2026-02-03 17:39:48 - INFO - Filtrados 1124 registros de sección 'mascotas_vivo' de 44082 total
2026-02-03 17:39:48 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 17:39:48 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 17:39:50 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:39:50 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 17:39:50 - INFO - Costes cargados: 22145 registros
2026-02-03 17:39:50 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 17:39:50 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 17:39:50 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MASCOTAS_VIVO ===
2026-02-03 17:39:50 - INFO -   ABC: 205 registros
2026-02-03 17:39:50 - INFO -   Ventas: 1124 registros
2026-02-03 17:39:50 - INFO -   Costes: 22145 registros
2026-02-03 17:39:50 - DEBUG - [DEBUG] abc_df: 205 registros
2026-02-03 17:39:50 - DEBUG - [DEBUG] ventas_df: 1124 registros
2026-02-03 17:39:50 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 17:39:50 - INFO - Datos de ventas: 88 registros
2026-02-03 17:39:50 - INFO - Calculando pedido para semana 14 (88 registros)
2026-02-03 17:39:50 - INFO -   Objetivo: 1087.15€, Actual (ABC): 846.63€
2026-02-03 17:39:50 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 17:39:50 - INFO -   Factor total: 1.3125
2026-02-03 17:39:50 - INFO -   Factor escalado: 1.6854
2026-02-03 17:39:50 - INFO -   Ventas preliminares (con ceil): 1773.66€
2026-02-03 17:39:50 - INFO -   Objetivo final: 1426.88€
2026-02-03 17:39:50 - INFO -   Delta: 346.78€
2026-02-03 17:39:50 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 17:39:50 - DEBUG -   Total registros: 43
2026-02-03 17:39:50 - DEBUG -   Registros con Unidades_Finales > 0: 36
2026-02-03 17:39:50 - DEBUG -   Ventas finales: 1455.34€
2026-02-03 17:39:50 - INFO -   Ventas finales: 1455.34€
2026-02-03 17:39:50 - INFO - 
============================================================
2026-02-03 17:39:50 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 17:39:50 - INFO - ============================================================
2026-02-03 17:39:50 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 17:39:50 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 17:39:50 - INFO - DataLoader inicializado correctamente
2026-02-03 17:39:50 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 17:39:50 - INFO - ============================================================
2026-02-03 17:39:50 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 17:39:50 - INFO - ============================================================
2026-02-03 17:39:50 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 17:39:50 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 17:39:50 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:39:50 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:39:50 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 17:39:50 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:39:50 - DEBUG - Usando hoja: Stock
2026-02-03 17:39:50 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 17:39:50 - INFO - Stock actual cargado: 30 registros
2026-02-03 17:39:50 - INFO -   Stock: 30 registros
2026-02-03 17:39:50 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 17:39:50 - INFO - Fusión completada: 43 registros
2026-02-03 17:39:50 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 17:39:50 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 17:39:50 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 17:39:50 - INFO - Corrección completada:
2026-02-03 17:39:50 - INFO -   - Artículos corregidos: 36/43
2026-02-03 17:39:50 - INFO -   - Artículos aumentados: 36
2026-02-03 17:39:50 - INFO -   - Artículos reducidos: 0
2026-02-03 17:39:50 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 17:39:50 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 17:39:50 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 17:39:50 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 43 registros
2026-02-03 17:39:50 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 17:39:50 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 17:39:50 - DEBUG -   Con valor 0: 7
2026-02-03 17:39:50 - DEBUG -   Con valor > 0: 36
2026-02-03 17:39:50 - DEBUG -   Suma Ventas_Objetivo: 1455.34€
2026-02-03 17:39:50 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 36 registros
2026-02-03 17:39:50 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx
2026-02-03 17:39:50 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx
2026-02-03 17:39:50 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx
2026-02-03 17:39:50 - INFO -   Articulos: 36
2026-02-03 17:39:50 - INFO -   Importe: 1455.34€
2026-02-03 17:39:50 - INFO - 
==================================================
2026-02-03 17:39:50 - INFO - SECCION: MASCOTAS_MANUFACTURADO
2026-02-03 17:39:50 - INFO - ==================================================
2026-02-03 17:39:50 - INFO - === LEYENDO DATOS PARA SECCIÓN: MASCOTAS_MANUFACTURADO ===
2026-02-03 17:39:50 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 17:39:50 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: mascotas_manufacturado
2026-02-03 17:39:50 - INFO - Archivo ABC encontrado para 'mascotas_manufacturado': .\./data/input\CLASIFICACION_ABC+D_mascotas_manufacturado.xlsx
2026-02-03 17:39:50 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_mascotas_manufacturado.xlsx
2026-02-03 17:39:50 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 17:39:50 - INFO - Clasificación ABC cargada para 'mascotas_manufacturado': 2749 registros
2026-02-03 17:39:50 - DEBUG - [DEBUG] ABC leído: 2749 registros
2026-02-03 17:39:50 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 17:39:50 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 17:39:50 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 17:39:54 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:39:54 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 17:39:54 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 17:39:54 - INFO - Ventas cargadas: 44082 registros
2026-02-03 17:39:54 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 17:39:54 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 17:39:54 - DEBUG - [DEBUG] Filtrando ventas por sección: mascotas_manufacturado
2026-02-03 17:39:54 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 17:39:54 - DEBUG -   maf: 10970 registros
2026-02-03 17:39:54 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 17:39:54 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 17:39:54 - DEBUG -   interior: 3624 registros
2026-02-03 17:39:54 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 17:39:54 - DEBUG -   deco_interior: 2468 registros
2026-02-03 17:39:54 - DEBUG -   vivero: 2460 registros
2026-02-03 17:39:54 - DEBUG -   fitos: 1987 registros
2026-02-03 17:39:54 - DEBUG -   semillas: 1180 registros
2026-02-03 17:39:54 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 17:39:54 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 17:39:54 - DEBUG - [DEBUG] Tras filtrar por 'mascotas_manufacturado': 9784 registros
2026-02-03 17:39:54 - INFO - Filtrados 9784 registros de sección 'mascotas_manufacturado' de 44082 total
2026-02-03 17:39:54 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 17:39:54 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 17:39:56 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:39:56 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 17:39:56 - INFO - Costes cargados: 22145 registros
2026-02-03 17:39:56 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 17:39:56 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 17:39:56 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MASCOTAS_MANUFACTURADO ===
2026-02-03 17:39:56 - INFO -   ABC: 2749 registros
2026-02-03 17:39:56 - INFO -   Ventas: 9784 registros
2026-02-03 17:39:56 - INFO -   Costes: 22145 registros
2026-02-03 17:39:56 - DEBUG - [DEBUG] abc_df: 2749 registros
2026-02-03 17:39:56 - DEBUG - [DEBUG] ventas_df: 9784 registros
2026-02-03 17:39:56 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 17:39:56 - INFO - Datos de ventas: 822 registros
2026-02-03 17:39:56 - INFO - Calculando pedido para semana 14 (822 registros)
2026-02-03 17:39:58 - INFO -   Objetivo: 6839.82€, Actual (ABC): 8742.92€
2026-02-03 17:39:58 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 17:39:58 - INFO -   Factor total: 1.3125
2026-02-03 17:39:58 - INFO -   Factor escalado: 1.0268
2026-02-03 17:39:58 - INFO -   Ventas preliminares (con ceil): 12379.25€
2026-02-03 17:39:58 - INFO -   Objetivo final: 8977.26€
2026-02-03 17:39:58 - INFO -   Delta: 3401.99€
2026-02-03 17:39:58 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 17:39:58 - DEBUG -   Total registros: 538
2026-02-03 17:39:58 - DEBUG -   Registros con Unidades_Finales > 0: 411
2026-02-03 17:39:58 - DEBUG -   Ventas finales: 8993.98€
2026-02-03 17:39:58 - INFO -   Ventas finales: 8993.98€
2026-02-03 17:39:58 - INFO - 
============================================================
2026-02-03 17:39:58 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 17:39:58 - INFO - ============================================================
2026-02-03 17:39:58 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 17:39:58 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 17:39:58 - INFO - DataLoader inicializado correctamente
2026-02-03 17:39:58 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 17:39:58 - INFO - ============================================================
2026-02-03 17:39:58 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 17:39:58 - INFO - ============================================================
2026-02-03 17:39:58 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 17:39:58 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 17:39:58 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:39:58 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:39:58 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 17:39:58 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:39:58 - DEBUG - Usando hoja: Stock
2026-02-03 17:39:58 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 17:39:58 - INFO - Stock actual cargado: 30 registros
2026-02-03 17:39:58 - INFO -   Stock: 30 registros
2026-02-03 17:39:58 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 17:39:58 - INFO - Fusión completada: 538 registros
2026-02-03 17:39:58 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 17:39:58 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 17:39:58 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 17:39:58 - INFO - Corrección completada:
2026-02-03 17:39:58 - INFO -   - Artículos corregidos: 411/538
2026-02-03 17:39:58 - INFO -   - Artículos aumentados: 411
2026-02-03 17:39:58 - INFO -   - Artículos reducidos: 0
2026-02-03 17:39:58 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 17:39:58 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 17:39:58 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 17:39:58 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 538 registros
2026-02-03 17:39:58 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 17:39:58 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 17:39:58 - DEBUG -   Con valor 0: 127
2026-02-03 17:39:58 - DEBUG -   Con valor > 0: 411
2026-02-03 17:39:58 - DEBUG -   Suma Ventas_Objetivo: 8993.98€
2026-02-03 17:39:58 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 411 registros
2026-02-03 17:39:58 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx
2026-02-03 17:39:59 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx
2026-02-03 17:39:59 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx
2026-02-03 17:39:59 - INFO -   Articulos: 411
2026-02-03 17:39:59 - INFO -   Importe: 8993.98€
2026-02-03 17:39:59 - INFO - 
==================================================
2026-02-03 17:39:59 - INFO - SECCION: INTERIOR
2026-02-03 17:39:59 - INFO - ==================================================
2026-02-03 17:39:59 - INFO - === LEYENDO DATOS PARA SECCIÓN: INTERIOR ===
2026-02-03 17:39:59 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 17:39:59 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: interior
2026-02-03 17:39:59 - INFO - Archivo ABC encontrado para 'interior': .\./data/input\CLASIFICACION_ABC+D_interior.xlsx
2026-02-03 17:39:59 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_interior.xlsx
2026-02-03 17:39:59 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 17:39:59 - INFO - Clasificación ABC cargada para 'interior': 555 registros
2026-02-03 17:39:59 - DEBUG - [DEBUG] ABC leído: 555 registros
2026-02-03 17:39:59 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 17:39:59 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 17:39:59 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 17:40:02 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:40:02 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 17:40:03 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 17:40:03 - INFO - Ventas cargadas: 44082 registros
2026-02-03 17:40:03 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 17:40:03 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 17:40:03 - DEBUG - [DEBUG] Filtrando ventas por sección: interior
2026-02-03 17:40:03 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 17:40:03 - DEBUG -   maf: 10970 registros
2026-02-03 17:40:03 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 17:40:03 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 17:40:03 - DEBUG -   interior: 3624 registros
2026-02-03 17:40:03 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 17:40:03 - DEBUG -   deco_interior: 2468 registros
2026-02-03 17:40:03 - DEBUG -   vivero: 2460 registros
2026-02-03 17:40:03 - DEBUG -   fitos: 1987 registros
2026-02-03 17:40:03 - DEBUG -   semillas: 1180 registros
2026-02-03 17:40:03 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 17:40:03 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 17:40:03 - DEBUG - [DEBUG] Tras filtrar por 'interior': 3624 registros
2026-02-03 17:40:03 - INFO - Filtrados 3624 registros de sección 'interior' de 44082 total
2026-02-03 17:40:03 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 17:40:03 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 17:40:05 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:40:05 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 17:40:05 - INFO - Costes cargados: 22145 registros
2026-02-03 17:40:05 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 17:40:05 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 17:40:05 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA INTERIOR ===
2026-02-03 17:40:05 - INFO -   ABC: 555 registros
2026-02-03 17:40:05 - INFO -   Ventas: 3624 registros
2026-02-03 17:40:05 - INFO -   Costes: 22145 registros
2026-02-03 17:40:05 - DEBUG - [DEBUG] abc_df: 555 registros
2026-02-03 17:40:05 - DEBUG - [DEBUG] ventas_df: 3624 registros
2026-02-03 17:40:05 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 17:40:05 - INFO - Datos de ventas: 286 registros
2026-02-03 17:40:05 - INFO - Calculando pedido para semana 14 (286 registros)
2026-02-03 17:40:05 - INFO -   Objetivo: 2930.63€, Actual (ABC): 2409.44€
2026-02-03 17:40:05 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 17:40:05 - INFO -   Factor total: 1.3125
2026-02-03 17:40:05 - INFO -   Factor escalado: 1.5964
2026-02-03 17:40:05 - INFO -   Ventas preliminares (con ceil): 4541.81€
2026-02-03 17:40:05 - INFO -   Objetivo final: 3846.45€
2026-02-03 17:40:05 - INFO -   Delta: 695.36€
2026-02-03 17:40:05 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 17:40:05 - DEBUG -   Total registros: 138
2026-02-03 17:40:05 - DEBUG -   Registros con Unidades_Finales > 0: 121
2026-02-03 17:40:05 - DEBUG -   Ventas finales: 3855.17€
2026-02-03 17:40:05 - INFO -   Ventas finales: 3855.17€
2026-02-03 17:40:05 - INFO - 
============================================================
2026-02-03 17:40:05 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 17:40:05 - INFO - ============================================================
2026-02-03 17:40:05 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 17:40:05 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 17:40:05 - INFO - DataLoader inicializado correctamente
2026-02-03 17:40:05 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 17:40:05 - INFO - ============================================================
2026-02-03 17:40:05 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 17:40:05 - INFO - ============================================================
2026-02-03 17:40:05 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 17:40:05 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 17:40:05 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:40:05 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:40:05 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 17:40:05 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:40:05 - DEBUG - Usando hoja: Stock
2026-02-03 17:40:05 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 17:40:05 - INFO - Stock actual cargado: 30 registros
2026-02-03 17:40:05 - INFO -   Stock: 30 registros
2026-02-03 17:40:05 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 17:40:05 - INFO - Fusión completada: 138 registros
2026-02-03 17:40:05 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 17:40:05 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 17:40:05 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 17:40:05 - INFO - Corrección completada:
2026-02-03 17:40:05 - INFO -   - Artículos corregidos: 121/138
2026-02-03 17:40:05 - INFO -   - Artículos aumentados: 121
2026-02-03 17:40:05 - INFO -   - Artículos reducidos: 0
2026-02-03 17:40:05 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 17:40:05 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 17:40:05 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 17:40:05 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 138 registros
2026-02-03 17:40:05 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 17:40:05 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 17:40:05 - DEBUG -   Con valor 0: 17
2026-02-03 17:40:05 - DEBUG -   Con valor > 0: 121
2026-02-03 17:40:05 - DEBUG -   Suma Ventas_Objetivo: 3855.17€
2026-02-03 17:40:05 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 121 registros
2026-02-03 17:40:05 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_interior.xlsx
2026-02-03 17:40:05 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_interior.xlsx
2026-02-03 17:40:05 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_interior.xlsx
2026-02-03 17:40:05 - INFO -   Articulos: 121
2026-02-03 17:40:05 - INFO -   Importe: 3855.17€
2026-02-03 17:40:05 - INFO - 
==================================================
2026-02-03 17:40:05 - INFO - SECCION: FITOS
2026-02-03 17:40:05 - INFO - ==================================================
2026-02-03 17:40:05 - INFO - === LEYENDO DATOS PARA SECCIÓN: FITOS ===
2026-02-03 17:40:05 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 17:40:05 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: fitos
2026-02-03 17:40:05 - INFO - Archivo ABC encontrado para 'fitos': .\./data/input\CLASIFICACION_ABC+D_fitos.xlsx
2026-02-03 17:40:05 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_fitos.xlsx
2026-02-03 17:40:05 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 17:40:05 - INFO - Clasificación ABC cargada para 'fitos': 247 registros
2026-02-03 17:40:05 - DEBUG - [DEBUG] ABC leído: 247 registros
2026-02-03 17:40:05 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 17:40:05 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 17:40:05 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 17:40:09 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:40:09 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 17:40:09 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 17:40:09 - INFO - Ventas cargadas: 44082 registros
2026-02-03 17:40:09 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 17:40:09 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 17:40:09 - DEBUG - [DEBUG] Filtrando ventas por sección: fitos
2026-02-03 17:40:09 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 17:40:09 - DEBUG -   maf: 10970 registros
2026-02-03 17:40:09 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 17:40:09 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 17:40:09 - DEBUG -   interior: 3624 registros
2026-02-03 17:40:09 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 17:40:09 - DEBUG -   deco_interior: 2468 registros
2026-02-03 17:40:09 - DEBUG -   vivero: 2460 registros
2026-02-03 17:40:09 - DEBUG -   fitos: 1987 registros
2026-02-03 17:40:09 - DEBUG -   semillas: 1180 registros
2026-02-03 17:40:09 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 17:40:09 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 17:40:09 - DEBUG - [DEBUG] Tras filtrar por 'fitos': 1987 registros
2026-02-03 17:40:09 - INFO - Filtrados 1987 registros de sección 'fitos' de 44082 total
2026-02-03 17:40:09 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 17:40:09 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 17:40:11 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:40:11 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 17:40:11 - INFO - Costes cargados: 22145 registros
2026-02-03 17:40:11 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 17:40:11 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 17:40:11 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA FITOS ===
2026-02-03 17:40:11 - INFO -   ABC: 247 registros
2026-02-03 17:40:11 - INFO -   Ventas: 1987 registros
2026-02-03 17:40:11 - INFO -   Costes: 22145 registros
2026-02-03 17:40:11 - DEBUG - [DEBUG] abc_df: 247 registros
2026-02-03 17:40:11 - DEBUG - [DEBUG] ventas_df: 1987 registros
2026-02-03 17:40:11 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 17:40:11 - INFO - Datos de ventas: 157 registros
2026-02-03 17:40:11 - INFO - Calculando pedido para semana 14 (157 registros)
2026-02-03 17:40:11 - INFO -   Objetivo: 1798.25€, Actual (ABC): 1679.26€
2026-02-03 17:40:11 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 17:40:11 - INFO -   Factor total: 1.3125
2026-02-03 17:40:11 - INFO -   Factor escalado: 1.4055
2026-02-03 17:40:11 - INFO -   Ventas preliminares (con ceil): 2784.94€
2026-02-03 17:40:11 - INFO -   Objetivo final: 2360.20€
2026-02-03 17:40:11 - INFO -   Delta: 424.74€
2026-02-03 17:40:11 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 17:40:11 - DEBUG -   Total registros: 84
2026-02-03 17:40:11 - DEBUG -   Registros con Unidades_Finales > 0: 82
2026-02-03 17:40:11 - DEBUG -   Ventas finales: 2365.92€
2026-02-03 17:40:11 - INFO -   Ventas finales: 2365.92€
2026-02-03 17:40:11 - INFO - 
============================================================
2026-02-03 17:40:11 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 17:40:11 - INFO - ============================================================
2026-02-03 17:40:11 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 17:40:11 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 17:40:11 - INFO - DataLoader inicializado correctamente
2026-02-03 17:40:11 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 17:40:11 - INFO - ============================================================
2026-02-03 17:40:11 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 17:40:11 - INFO - ============================================================
2026-02-03 17:40:11 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 17:40:11 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 17:40:11 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:40:11 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:40:11 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 17:40:11 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:40:11 - DEBUG - Usando hoja: Stock
2026-02-03 17:40:11 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 17:40:11 - INFO - Stock actual cargado: 30 registros
2026-02-03 17:40:11 - INFO -   Stock: 30 registros
2026-02-03 17:40:11 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 17:40:11 - INFO - Fusión completada: 84 registros
2026-02-03 17:40:11 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 17:40:11 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 17:40:11 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 17:40:11 - INFO - Corrección completada:
2026-02-03 17:40:11 - INFO -   - Artículos corregidos: 82/84
2026-02-03 17:40:11 - INFO -   - Artículos aumentados: 82
2026-02-03 17:40:11 - INFO -   - Artículos reducidos: 0
2026-02-03 17:40:11 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 17:40:11 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 17:40:11 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 17:40:11 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 84 registros
2026-02-03 17:40:11 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 17:40:11 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 17:40:11 - DEBUG -   Con valor 0: 2
2026-02-03 17:40:11 - DEBUG -   Con valor > 0: 82
2026-02-03 17:40:11 - DEBUG -   Suma Ventas_Objetivo: 2365.92€
2026-02-03 17:40:11 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 82 registros
2026-02-03 17:40:11 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_fitos.xlsx
2026-02-03 17:40:11 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_fitos.xlsx
2026-02-03 17:40:11 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_fitos.xlsx
2026-02-03 17:40:11 - INFO -   Articulos: 82
2026-02-03 17:40:11 - INFO -   Importe: 2365.92€
2026-02-03 17:40:11 - INFO - 
==================================================
2026-02-03 17:40:11 - INFO - SECCION: VIVERO
2026-02-03 17:40:11 - INFO - ==================================================
2026-02-03 17:40:11 - INFO - === LEYENDO DATOS PARA SECCIÓN: VIVERO ===
2026-02-03 17:40:11 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 17:40:11 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: vivero
2026-02-03 17:40:11 - INFO - Archivo ABC encontrado para 'vivero': .\./data/input\CLASIFICACION_ABC+D_vivero.xlsx
2026-02-03 17:40:11 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_vivero.xlsx
2026-02-03 17:40:12 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 17:40:12 - INFO - Clasificación ABC cargada para 'vivero': 565 registros
2026-02-03 17:40:12 - DEBUG - [DEBUG] ABC leído: 565 registros
2026-02-03 17:40:12 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 17:40:12 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 17:40:12 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 17:40:15 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:40:15 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 17:40:15 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 17:40:15 - INFO - Ventas cargadas: 44082 registros
2026-02-03 17:40:15 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 17:40:15 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 17:40:15 - DEBUG - [DEBUG] Filtrando ventas por sección: vivero
2026-02-03 17:40:15 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 17:40:15 - DEBUG -   maf: 10970 registros
2026-02-03 17:40:15 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 17:40:15 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 17:40:15 - DEBUG -   interior: 3624 registros
2026-02-03 17:40:15 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 17:40:15 - DEBUG -   deco_interior: 2468 registros
2026-02-03 17:40:15 - DEBUG -   vivero: 2460 registros
2026-02-03 17:40:15 - DEBUG -   fitos: 1987 registros
2026-02-03 17:40:15 - DEBUG -   semillas: 1180 registros
2026-02-03 17:40:15 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 17:40:15 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 17:40:15 - DEBUG - [DEBUG] Tras filtrar por 'vivero': 2460 registros
2026-02-03 17:40:15 - INFO - Filtrados 2460 registros de sección 'vivero' de 44082 total
2026-02-03 17:40:15 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 17:40:15 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 17:40:17 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:40:17 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 17:40:17 - INFO - Costes cargados: 22145 registros
2026-02-03 17:40:17 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 17:40:17 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 17:40:17 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA VIVERO ===
2026-02-03 17:40:17 - INFO -   ABC: 565 registros
2026-02-03 17:40:17 - INFO -   Ventas: 2460 registros
2026-02-03 17:40:17 - INFO -   Costes: 22145 registros
2026-02-03 17:40:17 - DEBUG - [DEBUG] abc_df: 565 registros
2026-02-03 17:40:17 - DEBUG - [DEBUG] ventas_df: 2460 registros
2026-02-03 17:40:17 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 17:40:17 - INFO - Datos de ventas: 189 registros
2026-02-03 17:40:17 - INFO - Calculando pedido para semana 14 (189 registros)
2026-02-03 17:40:18 - INFO -   Objetivo: 5297.17€, Actual (ABC): 4113.14€
2026-02-03 17:40:18 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 17:40:18 - INFO -   Factor total: 1.3125
2026-02-03 17:40:18 - INFO -   Factor escalado: 1.6903
2026-02-03 17:40:18 - INFO -   Ventas preliminares (con ceil): 8761.94€
2026-02-03 17:40:18 - INFO -   Objetivo final: 6952.54€
2026-02-03 17:40:18 - INFO -   Delta: 1809.40€
2026-02-03 17:40:18 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 17:40:18 - DEBUG -   Total registros: 107
2026-02-03 17:40:18 - DEBUG -   Registros con Unidades_Finales > 0: 96
2026-02-03 17:40:18 - DEBUG -   Ventas finales: 6990.51€
2026-02-03 17:40:18 - INFO -   Ventas finales: 6990.51€
2026-02-03 17:40:18 - INFO - 
============================================================
2026-02-03 17:40:18 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 17:40:18 - INFO - ============================================================
2026-02-03 17:40:18 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 17:40:18 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 17:40:18 - INFO - DataLoader inicializado correctamente
2026-02-03 17:40:18 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 17:40:18 - INFO - ============================================================
2026-02-03 17:40:18 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 17:40:18 - INFO - ============================================================
2026-02-03 17:40:18 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 17:40:18 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 17:40:18 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:40:18 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:40:18 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 17:40:18 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:40:18 - DEBUG - Usando hoja: Stock
2026-02-03 17:40:18 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 17:40:18 - INFO - Stock actual cargado: 30 registros
2026-02-03 17:40:18 - INFO -   Stock: 30 registros
2026-02-03 17:40:18 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 17:40:18 - INFO - Fusión completada: 107 registros
2026-02-03 17:40:18 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 17:40:18 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 17:40:18 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 17:40:18 - INFO - Corrección completada:
2026-02-03 17:40:18 - INFO -   - Artículos corregidos: 96/107
2026-02-03 17:40:18 - INFO -   - Artículos aumentados: 96
2026-02-03 17:40:18 - INFO -   - Artículos reducidos: 0
2026-02-03 17:40:18 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 17:40:18 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 17:40:18 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 17:40:18 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 107 registros
2026-02-03 17:40:18 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 17:40:18 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 17:40:18 - DEBUG -   Con valor 0: 11
2026-02-03 17:40:18 - DEBUG -   Con valor > 0: 96
2026-02-03 17:40:18 - DEBUG -   Suma Ventas_Objetivo: 6990.51€
2026-02-03 17:40:18 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 96 registros
2026-02-03 17:40:18 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_vivero.xlsx
2026-02-03 17:40:18 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_vivero.xlsx
2026-02-03 17:40:18 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_vivero.xlsx
2026-02-03 17:40:18 - INFO -   Articulos: 96
2026-02-03 17:40:18 - INFO -   Importe: 6990.51€
2026-02-03 17:40:18 - INFO - 
==================================================
2026-02-03 17:40:18 - INFO - SECCION: UTILES_JARDIN
2026-02-03 17:40:18 - INFO - ==================================================
2026-02-03 17:40:18 - INFO - === LEYENDO DATOS PARA SECCIÓN: UTILES_JARDIN ===
2026-02-03 17:40:18 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 17:40:18 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: utiles_jardin
2026-02-03 17:40:18 - INFO - Archivo ABC encontrado para 'utiles_jardin': .\./data/input\CLASIFICACION_ABC+D_utiles_jardin.xlsx
2026-02-03 17:40:18 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_utiles_jardin.xlsx
2026-02-03 17:40:18 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 17:40:18 - INFO - Clasificación ABC cargada para 'utiles_jardin': 433 registros
2026-02-03 17:40:18 - DEBUG - [DEBUG] ABC leído: 433 registros
2026-02-03 17:40:18 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 17:40:18 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 17:40:18 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 17:40:22 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:40:22 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 17:40:22 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 17:40:22 - INFO - Ventas cargadas: 44082 registros
2026-02-03 17:40:22 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 17:40:22 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 17:40:22 - DEBUG - [DEBUG] Filtrando ventas por sección: utiles_jardin
2026-02-03 17:40:22 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 17:40:22 - DEBUG -   maf: 10970 registros
2026-02-03 17:40:22 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 17:40:22 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 17:40:22 - DEBUG -   interior: 3624 registros
2026-02-03 17:40:22 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 17:40:22 - DEBUG -   deco_interior: 2468 registros
2026-02-03 17:40:22 - DEBUG -   vivero: 2460 registros
2026-02-03 17:40:22 - DEBUG -   fitos: 1987 registros
2026-02-03 17:40:22 - DEBUG -   semillas: 1180 registros
2026-02-03 17:40:22 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 17:40:22 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 17:40:22 - DEBUG - [DEBUG] Tras filtrar por 'utiles_jardin': 1009 registros
2026-02-03 17:40:22 - INFO - Filtrados 1009 registros de sección 'utiles_jardin' de 44082 total
2026-02-03 17:40:22 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 17:40:22 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 17:40:24 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:40:24 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 17:40:24 - INFO - Costes cargados: 22145 registros
2026-02-03 17:40:24 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 17:40:24 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 17:40:24 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA UTILES_JARDIN ===
2026-02-03 17:40:24 - INFO -   ABC: 433 registros
2026-02-03 17:40:24 - INFO -   Ventas: 1009 registros
2026-02-03 17:40:24 - INFO -   Costes: 22145 registros
2026-02-03 17:40:24 - DEBUG - [DEBUG] abc_df: 433 registros
2026-02-03 17:40:24 - DEBUG - [DEBUG] ventas_df: 1009 registros
2026-02-03 17:40:24 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 17:40:24 - INFO - Datos de ventas: 89 registros
2026-02-03 17:40:24 - INFO - Calculando pedido para semana 14 (89 registros)
2026-02-03 17:40:24 - INFO -   Objetivo: 1044.77€, Actual (ABC): 818.79€
2026-02-03 17:40:24 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 17:40:24 - INFO -   Factor total: 1.3125
2026-02-03 17:40:24 - INFO -   Factor escalado: 1.6747
2026-02-03 17:40:24 - INFO -   Ventas preliminares (con ceil): 1929.56€
2026-02-03 17:40:24 - INFO -   Objetivo final: 1371.26€
2026-02-03 17:40:24 - INFO -   Delta: 558.30€
2026-02-03 17:40:24 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 17:40:24 - DEBUG -   Total registros: 78
2026-02-03 17:40:24 - DEBUG -   Registros con Unidades_Finales > 0: 78
2026-02-03 17:40:24 - DEBUG -   Ventas finales: 1390.00€
2026-02-03 17:40:24 - INFO -   Ventas finales: 1390.00€
2026-02-03 17:40:24 - INFO - 
============================================================
2026-02-03 17:40:24 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 17:40:24 - INFO - ============================================================
2026-02-03 17:40:24 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 17:40:24 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 17:40:24 - INFO - DataLoader inicializado correctamente
2026-02-03 17:40:24 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 17:40:24 - INFO - ============================================================
2026-02-03 17:40:24 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 17:40:24 - INFO - ============================================================
2026-02-03 17:40:24 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 17:40:24 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 17:40:24 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:40:24 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:40:24 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 17:40:24 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:40:24 - DEBUG - Usando hoja: Stock
2026-02-03 17:40:24 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 17:40:24 - INFO - Stock actual cargado: 30 registros
2026-02-03 17:40:24 - INFO -   Stock: 30 registros
2026-02-03 17:40:24 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 17:40:24 - INFO - Fusión completada: 78 registros
2026-02-03 17:40:24 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 17:40:24 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 17:40:24 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 17:40:24 - INFO - Corrección completada:
2026-02-03 17:40:24 - INFO -   - Artículos corregidos: 78/78
2026-02-03 17:40:24 - INFO -   - Artículos aumentados: 78
2026-02-03 17:40:24 - INFO -   - Artículos reducidos: 0
2026-02-03 17:40:24 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 17:40:24 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 17:40:24 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 17:40:24 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 78 registros
2026-02-03 17:40:24 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 17:40:24 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 17:40:24 - DEBUG -   Con valor 0: 0
2026-02-03 17:40:24 - DEBUG -   Con valor > 0: 78
2026-02-03 17:40:24 - DEBUG -   Suma Ventas_Objetivo: 1390.00€
2026-02-03 17:40:24 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 78 registros
2026-02-03 17:40:24 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx
2026-02-03 17:40:24 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx
2026-02-03 17:40:24 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx
2026-02-03 17:40:24 - INFO -   Articulos: 78
2026-02-03 17:40:24 - INFO -   Importe: 1390.00€
2026-02-03 17:40:24 - INFO - 
==================================================
2026-02-03 17:40:24 - INFO - SECCION: TIERRAS_ARIDOS
2026-02-03 17:40:24 - INFO - ==================================================
2026-02-03 17:40:24 - INFO - === LEYENDO DATOS PARA SECCIÓN: TIERRAS_ARIDOS ===
2026-02-03 17:40:24 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 17:40:24 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: tierras_aridos
2026-02-03 17:40:24 - WARNING - No se encontró archivo específico para 'tierras_aridos', usando: .\./data/input\CLASIFICACION_ABC+D_DECO_EXTERIOR.xlsx
2026-02-03 17:40:24 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_DECO_EXTERIOR.xlsx
2026-02-03 17:40:24 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 17:40:24 - INFO - Clasificación ABC cargada para 'tierras_aridos': 995 registros
2026-02-03 17:40:24 - DEBUG - [DEBUG] ABC leído: 995 registros
2026-02-03 17:40:24 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 17:40:24 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 17:40:24 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 17:40:28 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:40:28 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 17:40:28 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 17:40:28 - INFO - Ventas cargadas: 44082 registros
2026-02-03 17:40:28 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 17:40:28 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 17:40:28 - DEBUG - [DEBUG] Filtrando ventas por sección: tierras_aridos
2026-02-03 17:40:28 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 17:40:28 - DEBUG -   maf: 10970 registros
2026-02-03 17:40:28 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 17:40:28 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 17:40:28 - DEBUG -   interior: 3624 registros
2026-02-03 17:40:28 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 17:40:28 - DEBUG -   deco_interior: 2468 registros
2026-02-03 17:40:28 - DEBUG -   vivero: 2460 registros
2026-02-03 17:40:28 - DEBUG -   fitos: 1987 registros
2026-02-03 17:40:28 - DEBUG -   semillas: 1180 registros
2026-02-03 17:40:28 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 17:40:28 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 17:40:28 - DEBUG - [DEBUG] Tras filtrar por 'tierras_aridos': 3264 registros
2026-02-03 17:40:28 - INFO - Filtrados 3264 registros de sección 'tierras_aridos' de 44082 total
2026-02-03 17:40:28 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 17:40:28 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 17:40:30 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:40:30 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 17:40:30 - INFO - Costes cargados: 22145 registros
2026-02-03 17:40:30 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 17:40:30 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 17:40:30 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA TIERRAS_ARIDOS ===
2026-02-03 17:40:30 - INFO -   ABC: 995 registros
2026-02-03 17:40:30 - INFO -   Ventas: 3264 registros
2026-02-03 17:40:30 - INFO -   Costes: 22145 registros
2026-02-03 17:40:30 - DEBUG - [DEBUG] abc_df: 995 registros
2026-02-03 17:40:30 - DEBUG - [DEBUG] ventas_df: 3264 registros
2026-02-03 17:40:30 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 17:40:30 - INFO - Datos de ventas: 302 registros
2026-02-03 17:40:30 - INFO - Calculando pedido para semana 14 (302 registros)
2026-02-03 17:40:31 - INFO -   Objetivo: 4097.24€, Actual (ABC): 4019.19€
2026-02-03 17:40:31 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 17:40:31 - INFO -   Factor total: 1.3125
2026-02-03 17:40:31 - INFO -   Factor escalado: 1.3380
2026-02-03 17:40:31 - INFO -   Ventas preliminares (con ceil): 5809.66€
2026-02-03 17:40:31 - INFO -   Objetivo final: 5377.63€
2026-02-03 17:40:31 - INFO -   Delta: 432.03€
2026-02-03 17:40:31 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 17:40:31 - DEBUG -   Total registros: 72
2026-02-03 17:40:31 - DEBUG -   Registros con Unidades_Finales > 0: 71
2026-02-03 17:40:31 - DEBUG -   Ventas finales: 5387.14€
2026-02-03 17:40:31 - INFO -   Ventas finales: 5387.14€
2026-02-03 17:40:31 - INFO - 
============================================================
2026-02-03 17:40:31 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 17:40:31 - INFO - ============================================================
2026-02-03 17:40:31 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 17:40:31 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 17:40:31 - INFO - DataLoader inicializado correctamente
2026-02-03 17:40:31 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 17:40:31 - INFO - ============================================================
2026-02-03 17:40:31 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 17:40:31 - INFO - ============================================================
2026-02-03 17:40:31 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 17:40:31 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 17:40:31 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:40:31 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:40:31 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 17:40:31 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:40:31 - DEBUG - Usando hoja: Stock
2026-02-03 17:40:31 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 17:40:31 - INFO - Stock actual cargado: 30 registros
2026-02-03 17:40:31 - INFO -   Stock: 30 registros
2026-02-03 17:40:31 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 17:40:31 - INFO - Fusión completada: 72 registros
2026-02-03 17:40:31 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 17:40:31 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 17:40:31 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 17:40:31 - INFO - Corrección completada:
2026-02-03 17:40:31 - INFO -   - Artículos corregidos: 71/72
2026-02-03 17:40:31 - INFO -   - Artículos aumentados: 71
2026-02-03 17:40:31 - INFO -   - Artículos reducidos: 0
2026-02-03 17:40:31 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 17:40:31 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 17:40:31 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 17:40:31 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 72 registros
2026-02-03 17:40:31 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 17:40:31 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 17:40:31 - DEBUG -   Con valor 0: 1
2026-02-03 17:40:31 - DEBUG -   Con valor > 0: 71
2026-02-03 17:40:31 - DEBUG -   Suma Ventas_Objetivo: 5387.14€
2026-02-03 17:40:31 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 71 registros
2026-02-03 17:40:31 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx
2026-02-03 17:40:31 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx
2026-02-03 17:40:31 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx
2026-02-03 17:40:31 - INFO -   Articulos: 71
2026-02-03 17:40:31 - INFO -   Importe: 5387.14€
2026-02-03 17:40:31 - INFO - 
==================================================
2026-02-03 17:40:31 - INFO - SECCION: DECO_EXTERIOR
2026-02-03 17:40:31 - INFO - ==================================================
2026-02-03 17:40:31 - INFO - === LEYENDO DATOS PARA SECCIÓN: DECO_EXTERIOR ===
2026-02-03 17:40:31 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 17:40:31 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: deco_exterior
2026-02-03 17:40:31 - INFO - Archivo ABC encontrado para 'deco_exterior': .\./data/input\CLASIFICACION_ABC+D_deco_exterior.xlsx
2026-02-03 17:40:31 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_deco_exterior.xlsx
2026-02-03 17:40:31 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 17:40:31 - INFO - Clasificación ABC cargada para 'deco_exterior': 995 registros
2026-02-03 17:40:31 - DEBUG - [DEBUG] ABC leído: 995 registros
2026-02-03 17:40:31 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 17:40:31 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 17:40:31 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 17:40:35 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:40:35 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 17:40:35 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 17:40:35 - INFO - Ventas cargadas: 44082 registros
2026-02-03 17:40:35 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 17:40:35 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 17:40:35 - DEBUG - [DEBUG] Filtrando ventas por sección: deco_exterior
2026-02-03 17:40:35 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 17:40:35 - DEBUG -   maf: 10970 registros
2026-02-03 17:40:35 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 17:40:35 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 17:40:35 - DEBUG -   interior: 3624 registros
2026-02-03 17:40:35 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 17:40:35 - DEBUG -   deco_interior: 2468 registros
2026-02-03 17:40:35 - DEBUG -   vivero: 2460 registros
2026-02-03 17:40:35 - DEBUG -   fitos: 1987 registros
2026-02-03 17:40:35 - DEBUG -   semillas: 1180 registros
2026-02-03 17:40:35 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 17:40:35 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 17:40:35 - DEBUG - [DEBUG] Tras filtrar por 'deco_exterior': 4018 registros
2026-02-03 17:40:35 - INFO - Filtrados 4018 registros de sección 'deco_exterior' de 44082 total
2026-02-03 17:40:35 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 17:40:35 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 17:40:37 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:40:37 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 17:40:37 - INFO - Costes cargados: 22145 registros
2026-02-03 17:40:37 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 17:40:37 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 17:40:37 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA DECO_EXTERIOR ===
2026-02-03 17:40:37 - INFO -   ABC: 995 registros
2026-02-03 17:40:37 - INFO -   Ventas: 4018 registros
2026-02-03 17:40:37 - INFO -   Costes: 22145 registros
2026-02-03 17:40:37 - DEBUG - [DEBUG] abc_df: 995 registros
2026-02-03 17:40:37 - DEBUG - [DEBUG] ventas_df: 4018 registros
2026-02-03 17:40:37 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 17:40:37 - INFO - Datos de ventas: 316 registros
2026-02-03 17:40:37 - INFO - Calculando pedido para semana 14 (316 registros)
2026-02-03 17:40:37 - INFO -   Objetivo: 3740.34€, Actual (ABC): 4104.66€
2026-02-03 17:40:37 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 17:40:37 - INFO -   Factor total: 1.3125
2026-02-03 17:40:37 - INFO -   Factor escalado: 1.1960
2026-02-03 17:40:37 - INFO -   Ventas preliminares (con ceil): 6094.59€
2026-02-03 17:40:37 - INFO -   Objetivo final: 4909.20€
2026-02-03 17:40:37 - INFO -   Delta: 1185.39€
2026-02-03 17:40:37 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 17:40:37 - DEBUG -   Total registros: 224
2026-02-03 17:40:37 - DEBUG -   Registros con Unidades_Finales > 0: 205
2026-02-03 17:40:37 - DEBUG -   Ventas finales: 4923.89€
2026-02-03 17:40:37 - INFO -   Ventas finales: 4923.89€
2026-02-03 17:40:37 - INFO - 
============================================================
2026-02-03 17:40:37 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 17:40:37 - INFO - ============================================================
2026-02-03 17:40:37 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 17:40:37 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 17:40:37 - INFO - DataLoader inicializado correctamente
2026-02-03 17:40:37 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 17:40:37 - INFO - ============================================================
2026-02-03 17:40:37 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 17:40:37 - INFO - ============================================================
2026-02-03 17:40:37 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 17:40:37 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 17:40:37 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:40:37 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:40:37 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 17:40:37 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:40:37 - DEBUG - Usando hoja: Stock
2026-02-03 17:40:37 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 17:40:37 - INFO - Stock actual cargado: 30 registros
2026-02-03 17:40:37 - INFO -   Stock: 30 registros
2026-02-03 17:40:37 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 17:40:37 - INFO - Fusión completada: 224 registros
2026-02-03 17:40:37 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 17:40:37 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 17:40:37 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 17:40:37 - INFO - Corrección completada:
2026-02-03 17:40:37 - INFO -   - Artículos corregidos: 205/224
2026-02-03 17:40:37 - INFO -   - Artículos aumentados: 205
2026-02-03 17:40:37 - INFO -   - Artículos reducidos: 0
2026-02-03 17:40:37 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 17:40:37 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 17:40:37 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 17:40:37 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 224 registros
2026-02-03 17:40:37 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 17:40:37 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 17:40:37 - DEBUG -   Con valor 0: 19
2026-02-03 17:40:37 - DEBUG -   Con valor > 0: 205
2026-02-03 17:40:37 - DEBUG -   Suma Ventas_Objetivo: 4923.89€
2026-02-03 17:40:37 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 205 registros
2026-02-03 17:40:37 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_deco_exterior.xlsx
2026-02-03 17:40:38 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_deco_exterior.xlsx
2026-02-03 17:40:38 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_deco_exterior.xlsx
2026-02-03 17:40:38 - INFO -   Articulos: 205
2026-02-03 17:40:38 - INFO -   Importe: 4923.89€
2026-02-03 17:40:38 - INFO - Estado guardado correctamente
2026-02-03 17:40:38 - INFO - Generando resumen: .\./data/output\Resumen_Pedidos_VIVERO_2026-02-03.xlsx
2026-02-03 17:40:38 - INFO - Resumen guardado: .\./data/output\Resumen_Pedidos_VIVERO_2026-02-03.xlsx
2026-02-03 17:40:38 - INFO - Estado guardado correctamente
2026-02-03 17:40:38 - INFO - 
============================================================
2026-02-03 17:40:38 - INFO - PREPARANDO ENVÍO DE EMAILS
2026-02-03 17:40:38 - INFO - ============================================================
2026-02-03 17:40:38 - DEBUG - [DEBUG] Archivos agrupados por sección: {'maf': ['.\\./data/output\\Pedido_Semana_14_2026-02-03_maf.xlsx'], 'interior': ['.\\./data/output\\Pedido_Semana_14_2026-02-03_deco_interior.xlsx', '.\\./data/output\\Pedido_Semana_14_2026-02-03_interior.xlsx'], 'semillas': ['.\\./data/output\\Pedido_Semana_14_2026-02-03_semillas.xlsx'], 'vivo': ['.\\./data/output\\Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx'], 'manufacturado': ['.\\./data/output\\Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx'], 'fitos': ['.\\./data/output\\Pedido_Semana_14_2026-02-03_fitos.xlsx'], 'vivero': ['.\\./data/output\\Pedido_Semana_14_2026-02-03_vivero.xlsx'], 'jardin': ['.\\./data/output\\Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx'], 'aridos': ['.\\./data/output\\Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx'], 'exterior': ['.\\./data/output\\Pedido_Semana_14_2026-02-03_deco_exterior.xlsx']}
2026-02-03 17:40:38 - INFO - 
============================================================
2026-02-03 17:40:38 - INFO - ENVÍO DE EMAILS A RESPONSABLES
2026-02-03 17:40:38 - INFO - ============================================================
2026-02-03 17:40:38 - DEBUG - [DEBUG] SMTP configurado: {'servidor': 'smtp.serviciodecorreo.es', 'puerto': 465, 'usar_ssl': True, 'usar_tls': False}
2026-02-03 17:40:38 - DEBUG - [DEBUG] Remitente: {'email': 'ivan.delgado@viveverde.es', 'nombre': 'Sistema de Pedidos VIVEVERDE'}
2026-02-03 17:40:38 - DEBUG - [DEBUG] Destinatarios: {'maf': 'ivan.delgado@viveverde.es', 'interior': 'ivan.delgado@viveverde.es', 'mascotas_vivo': 'ivan.delgado@viveverde.es', 'mascotas_manufacturado': 'ivan.delgado@viveverde.es', 'deco_interior': ['ivan.delgado@viveverde.ess', 'ivan.delgado@viveverde.es'], 'deco_exterior': 'ivan.delgado@viveverde.es', 'tierras_aridos': 'ivan.delgado@viveverde.es', 'fitos': 'ivan.delgado@viveverde.es', 'semillas': 'ivan.delgado@viveverde.es', 'utiles_jardin': 'ivan.delgado@viveverde.es', 'vivero': 'ivan.delgado@viveverde.es'}
2026-02-03 17:40:38 - INFO - EmailService inicializado correctamente
2026-02-03 17:40:38 - INFO - 
Enviando email para sección: maf
2026-02-03 17:40:38 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_maf.xlsx']
2026-02-03 17:40:38 - INFO - ============================================================
2026-02-03 17:40:38 - INFO - ENVIANDO EMAIL PARA SECCIÓN: MAF
2026-02-03 17:40:38 - INFO - ============================================================
2026-02-03 17:40:38 - DEBUG - [DEBUG] Destinatarios para maf: [{'email': 'ivan.delgado@viveverde.es', 'nombre': 'Encargado'}]
2026-02-03 17:40:38 - INFO - Destinatarios: ['ivan.delgado@viveverde.es']
2026-02-03 17:40:38 - INFO - Archivos a enviar: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_maf.xlsx']
2026-02-03 17:40:38 - INFO - Archivo adjuntado: Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 17:40:38 - INFO - Email enviado exitosamente a: ivan.delgado@viveverde.es
2026-02-03 17:40:38 - INFO - ✓ Email enviado exitosamente para maf
2026-02-03 17:40:38 - INFO - ✓ Email enviado exitosamente a maf
2026-02-03 17:40:38 - INFO - 
Enviando email para sección: interior
2026-02-03 17:40:38 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_deco_interior.xlsx', '.\\./data/output\\Pedido_Semana_14_2026-02-03_interior.xlsx']
2026-02-03 17:40:38 - INFO - ============================================================
2026-02-03 17:40:38 - INFO - ENVIANDO EMAIL PARA SECCIÓN: INTERIOR
2026-02-03 17:40:38 - INFO - ============================================================
2026-02-03 17:40:38 - DEBUG - [DEBUG] Destinatarios para interior: [{'email': 'ivan.delgado@viveverde.es', 'nombre': 'Encargado'}]
2026-02-03 17:40:38 - INFO - Destinatarios: ['ivan.delgado@viveverde.es']
2026-02-03 17:40:38 - INFO - Archivos a enviar: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_deco_interior.xlsx', '.\\./data/output\\Pedido_Semana_14_2026-02-03_interior.xlsx']
2026-02-03 17:40:38 - INFO - Archivo adjuntado: Pedido_Semana_14_2026-02-03_deco_interior.xlsx
2026-02-03 17:40:38 - INFO - Archivo adjuntado: Pedido_Semana_14_2026-02-03_interior.xlsx
2026-02-03 17:40:38 - INFO - Email enviado exitosamente a: ivan.delgado@viveverde.es
2026-02-03 17:40:38 - INFO - ✓ Email enviado exitosamente para interior
2026-02-03 17:40:38 - INFO - ✓ Email enviado exitosamente a interior
2026-02-03 17:40:38 - INFO - 
Enviando email para sección: semillas
2026-02-03 17:40:38 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_semillas.xlsx']
2026-02-03 17:40:38 - INFO - ============================================================
2026-02-03 17:40:38 - INFO - ENVIANDO EMAIL PARA SECCIÓN: SEMILLAS
2026-02-03 17:40:38 - INFO - ============================================================
2026-02-03 17:40:38 - DEBUG - [DEBUG] Destinatarios para semillas: [{'email': 'ivan.delgado@viveverde.es', 'nombre': 'Encargado'}]
2026-02-03 17:40:38 - INFO - Destinatarios: ['ivan.delgado@viveverde.es']
2026-02-03 17:40:38 - INFO - Archivos a enviar: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_semillas.xlsx']
2026-02-03 17:40:38 - INFO - Archivo adjuntado: Pedido_Semana_14_2026-02-03_semillas.xlsx
2026-02-03 17:40:39 - INFO - Email enviado exitosamente a: ivan.delgado@viveverde.es
2026-02-03 17:40:39 - INFO - ✓ Email enviado exitosamente para semillas
2026-02-03 17:40:39 - INFO - ✓ Email enviado exitosamente a semillas
2026-02-03 17:40:39 - INFO - 
Enviando email para sección: vivo
2026-02-03 17:40:39 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx']
2026-02-03 17:40:39 - INFO - ============================================================
2026-02-03 17:40:39 - INFO - ENVIANDO EMAIL PARA SECCIÓN: VIVO
2026-02-03 17:40:39 - INFO - ============================================================
2026-02-03 17:40:39 - DEBUG - [DEBUG] Destinatarios para vivo: []
2026-02-03 17:40:39 - WARNING - No hay destinatarios configurados para la sección: vivo
2026-02-03 17:40:39 - ERROR - ✗ Error al enviar email a vivo: sin_destinatarios
2026-02-03 17:40:39 - INFO - 
Enviando email para sección: manufacturado
2026-02-03 17:40:39 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx']
2026-02-03 17:40:39 - INFO - ============================================================
2026-02-03 17:40:39 - INFO - ENVIANDO EMAIL PARA SECCIÓN: MANUFACTURADO
2026-02-03 17:40:39 - INFO - ============================================================
2026-02-03 17:40:39 - DEBUG - [DEBUG] Destinatarios para manufacturado: []
2026-02-03 17:40:39 - WARNING - No hay destinatarios configurados para la sección: manufacturado
2026-02-03 17:40:39 - ERROR - ✗ Error al enviar email a manufacturado: sin_destinatarios
2026-02-03 17:40:39 - INFO - 
Enviando email para sección: fitos
2026-02-03 17:40:39 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_fitos.xlsx']
2026-02-03 17:40:39 - INFO - ============================================================
2026-02-03 17:40:39 - INFO - ENVIANDO EMAIL PARA SECCIÓN: FITOS
2026-02-03 17:40:39 - INFO - ============================================================
2026-02-03 17:40:39 - DEBUG - [DEBUG] Destinatarios para fitos: [{'email': 'ivan.delgado@viveverde.es', 'nombre': 'Encargado'}]
2026-02-03 17:40:39 - INFO - Destinatarios: ['ivan.delgado@viveverde.es']
2026-02-03 17:40:39 - INFO - Archivos a enviar: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_fitos.xlsx']
2026-02-03 17:40:39 - INFO - Archivo adjuntado: Pedido_Semana_14_2026-02-03_fitos.xlsx
2026-02-03 17:40:39 - INFO - Email enviado exitosamente a: ivan.delgado@viveverde.es
2026-02-03 17:40:39 - INFO - ✓ Email enviado exitosamente para fitos
2026-02-03 17:40:39 - INFO - ✓ Email enviado exitosamente a fitos
2026-02-03 17:40:39 - INFO - 
Enviando email para sección: vivero
2026-02-03 17:40:39 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_vivero.xlsx']
2026-02-03 17:40:39 - INFO - ============================================================
2026-02-03 17:40:39 - INFO - ENVIANDO EMAIL PARA SECCIÓN: VIVERO
2026-02-03 17:40:39 - INFO - ============================================================
2026-02-03 17:40:39 - DEBUG - [DEBUG] Destinatarios para vivero: [{'email': 'ivan.delgado@viveverde.es', 'nombre': 'Encargado'}]
2026-02-03 17:40:39 - INFO - Destinatarios: ['ivan.delgado@viveverde.es']
2026-02-03 17:40:39 - INFO - Archivos a enviar: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_vivero.xlsx']
2026-02-03 17:40:39 - INFO - Archivo adjuntado: Pedido_Semana_14_2026-02-03_vivero.xlsx
2026-02-03 17:40:39 - INFO - Email enviado exitosamente a: ivan.delgado@viveverde.es
2026-02-03 17:40:39 - INFO - ✓ Email enviado exitosamente para vivero
2026-02-03 17:40:39 - INFO - ✓ Email enviado exitosamente a vivero
2026-02-03 17:40:39 - INFO - 
Enviando email para sección: jardin
2026-02-03 17:40:39 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx']
2026-02-03 17:40:39 - INFO - ============================================================
2026-02-03 17:40:39 - INFO - ENVIANDO EMAIL PARA SECCIÓN: JARDIN
2026-02-03 17:40:39 - INFO - ============================================================
2026-02-03 17:40:39 - DEBUG - [DEBUG] Destinatarios para jardin: []
2026-02-03 17:40:39 - WARNING - No hay destinatarios configurados para la sección: jardin
2026-02-03 17:40:39 - ERROR - ✗ Error al enviar email a jardin: sin_destinatarios
2026-02-03 17:40:39 - INFO - 
Enviando email para sección: aridos
2026-02-03 17:40:39 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx']
2026-02-03 17:40:39 - INFO - ============================================================
2026-02-03 17:40:39 - INFO - ENVIANDO EMAIL PARA SECCIÓN: ARIDOS
2026-02-03 17:40:39 - INFO - ============================================================
2026-02-03 17:40:39 - DEBUG - [DEBUG] Destinatarios para aridos: []
2026-02-03 17:40:39 - WARNING - No hay destinatarios configurados para la sección: aridos
2026-02-03 17:40:39 - ERROR - ✗ Error al enviar email a aridos: sin_destinatarios
2026-02-03 17:40:39 - INFO - 
Enviando email para sección: exterior
2026-02-03 17:40:39 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_deco_exterior.xlsx']
2026-02-03 17:40:39 - INFO - ============================================================
2026-02-03 17:40:39 - INFO - ENVIANDO EMAIL PARA SECCIÓN: EXTERIOR
2026-02-03 17:40:39 - INFO - ============================================================
2026-02-03 17:40:39 - DEBUG - [DEBUG] Destinatarios para exterior: []
2026-02-03 17:40:39 - WARNING - No hay destinatarios configurados para la sección: exterior
2026-02-03 17:40:39 - ERROR - ✗ Error al enviar email a exterior: sin_destinatarios
2026-02-03 17:40:39 - INFO - 
============================================================
2026-02-03 17:40:39 - INFO - RESUMEN DE ENVÍO DE EMAILS
2026-02-03 17:40:39 - INFO - ============================================================
2026-02-03 17:40:39 - INFO - Emails enviados exitosamente: 5
2026-02-03 17:40:39 - INFO - Emails fallidos: 5
2026-02-03 17:40:39 - INFO - Secciones procesadas: 10
2026-02-03 17:40:39 - INFO - 
======================================================================
2026-02-03 17:40:39 - INFO - RESUMEN DE EJECUCION
2026-02-03 17:40:39 - INFO - ======================================================================
2026-02-03 17:40:39 - INFO - Semana procesada: 14
2026-02-03 17:40:39 - INFO - Archivos generados: 12
2026-02-03 17:40:39 - INFO - Total articulos: 1510
2026-02-03 17:40:39 - INFO - Total importe: 48113.87€
2026-02-03 17:40:39 - INFO - 
✓ EMAILS ENVIADOS: 5
2026-02-03 17:40:39 - INFO - ======================================================================
2026-02-03 17:40:39 - INFO - 
¡PEDIDO GENERADO EXITOSAMENTE!
2026-02-03 17:40:39 - INFO - Archivo principal: .\./data/output\Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 17:40:39 - INFO - Artículos: 1510
2026-02-03 17:40:39 - INFO - Importe: 48113.87€
2026-02-03 17:40:39 - INFO - 
Emails enviados: 5
2026-02-03 17:55:01 - INFO - ======================================================================
2026-02-03 17:55:01 - INFO - SISTEMA DE PEDIDOS DE COMPRA - VIVERO ARANJUEZ V2
2026-02-03 17:55:01 - INFO - Fecha de ejecución: 2026-02-03 17:55:01
2026-02-03 17:55:01 - INFO - ======================================================================
2026-02-03 17:55:01 - INFO - Modo de ejecución: FASE 1 + FASE 2
2026-02-03 17:55:01 - INFO - Envío de emails: Sí
2026-02-03 17:55:01 - INFO - StateManager inicializado. Archivo de estado: .\./data\state.json
2026-02-03 17:55:01 - INFO - Cargando estado desde: .\./data\state.json
2026-02-03 17:55:01 - INFO - Estado cargado correctamente
2026-02-03 17:55:01 - INFO - SchedulerService inicializado correctamente
2026-02-03 17:55:01 - INFO - Horario configurado: sunday a las 15:00
2026-02-03 17:55:01 - INFO - Semana forzada por argumento: 14
2026-02-03 17:55:01 - INFO - ======================================================================
2026-02-03 17:55:01 - INFO - PROCESANDO PEDIDO PARA SEMANA 14
2026-02-03 17:55:01 - INFO - ======================================================================
2026-02-03 17:55:01 - INFO - MODO: FASE 1 (Forecast) + FASE 2 (Corrección)
2026-02-03 17:55:01 - INFO - DataLoader inicializado correctamente
2026-02-03 17:55:01 - INFO - ForecastEngine inicializado correctamente
2026-02-03 17:55:01 - INFO - OrderGenerator inicializado correctamente
2026-02-03 17:55:01 - INFO - SchedulerService inicializado correctamente
2026-02-03 17:55:01 - INFO - Horario configurado: sunday a las 15:00
2026-02-03 17:55:01 - INFO - Período de la semana: 2026-03-30 al 2026-04-05
2026-02-03 17:55:01 - INFO - Stock acumulado cargado: 2633 artículos
2026-02-03 17:55:01 - INFO - 
==================================================
2026-02-03 17:55:01 - INFO - SECCION: MAF
2026-02-03 17:55:01 - INFO - ==================================================
2026-02-03 17:55:01 - INFO - === LEYENDO DATOS PARA SECCIÓN: MAF ===
2026-02-03 17:55:01 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 17:55:01 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: maf
2026-02-03 17:55:01 - INFO - Archivo ABC encontrado para 'maf': .\./data/input\CLASIFICACION_ABC+D_maf.xlsx
2026-02-03 17:55:01 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_maf.xlsx
2026-02-03 17:55:02 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 17:55:02 - INFO - Clasificación ABC cargada para 'maf': 499 registros
2026-02-03 17:55:02 - DEBUG - [DEBUG] ABC leído: 499 registros
2026-02-03 17:55:02 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 17:55:02 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 17:55:02 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 17:55:05 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:55:05 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 17:55:05 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 17:55:05 - INFO - Ventas cargadas: 44082 registros
2026-02-03 17:55:05 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 17:55:05 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 17:55:05 - DEBUG - [DEBUG] Filtrando ventas por sección: maf
2026-02-03 17:55:06 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 17:55:06 - DEBUG -   maf: 10970 registros
2026-02-03 17:55:06 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 17:55:06 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 17:55:06 - DEBUG -   interior: 3624 registros
2026-02-03 17:55:06 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 17:55:06 - DEBUG -   deco_interior: 2468 registros
2026-02-03 17:55:06 - DEBUG -   vivero: 2460 registros
2026-02-03 17:55:06 - DEBUG -   fitos: 1987 registros
2026-02-03 17:55:06 - DEBUG -   semillas: 1180 registros
2026-02-03 17:55:06 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 17:55:06 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 17:55:06 - DEBUG - [DEBUG] Tras filtrar por 'maf': 10970 registros
2026-02-03 17:55:06 - INFO - Filtrados 10970 registros de sección 'maf' de 44082 total
2026-02-03 17:55:06 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 17:55:06 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 17:55:08 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:55:08 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 17:55:08 - INFO - Costes cargados: 22145 registros
2026-02-03 17:55:08 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 17:55:08 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 17:55:08 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MAF ===
2026-02-03 17:55:08 - INFO -   ABC: 499 registros
2026-02-03 17:55:08 - INFO -   Ventas: 10970 registros
2026-02-03 17:55:08 - INFO -   Costes: 22145 registros
2026-02-03 17:55:08 - DEBUG - [DEBUG] abc_df: 499 registros
2026-02-03 17:55:08 - DEBUG - [DEBUG] ventas_df: 10970 registros
2026-02-03 17:55:08 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 17:55:08 - INFO - Datos de ventas: 1011 registros
2026-02-03 17:55:08 - INFO - Calculando pedido para semana 14 (1011 registros)
2026-02-03 17:55:08 - INFO -   Objetivo: 7050.65€, Actual (ABC): 5843.77€
2026-02-03 17:55:08 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 17:55:08 - INFO -   Factor total: 1.3125
2026-02-03 17:55:08 - INFO -   Factor escalado: 1.5836
2026-02-03 17:55:08 - INFO -   Ventas preliminares (con ceil): 9931.01€
2026-02-03 17:55:08 - INFO -   Objetivo final: 9253.98€
2026-02-03 17:55:08 - INFO -   Delta: 677.03€
2026-02-03 17:55:08 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 17:55:08 - DEBUG -   Total registros: 222
2026-02-03 17:55:08 - DEBUG -   Registros con Unidades_Finales > 0: 191
2026-02-03 17:55:08 - DEBUG -   Ventas finales: 9259.59€
2026-02-03 17:55:08 - INFO -   Ventas finales: 9259.59€
2026-02-03 17:55:08 - INFO - 
============================================================
2026-02-03 17:55:08 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 17:55:08 - INFO - ============================================================
2026-02-03 17:55:08 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 17:55:08 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 17:55:08 - INFO - DataLoader inicializado correctamente
2026-02-03 17:55:08 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 17:55:08 - INFO - ============================================================
2026-02-03 17:55:08 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 17:55:08 - INFO - ============================================================
2026-02-03 17:55:08 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 17:55:08 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 17:55:08 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:55:08 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:55:08 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 17:55:08 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:55:08 - DEBUG - Usando hoja: Stock
2026-02-03 17:55:08 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 17:55:08 - INFO - Stock actual cargado: 30 registros
2026-02-03 17:55:08 - INFO -   Stock: 30 registros
2026-02-03 17:55:08 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 17:55:08 - INFO - Fusión completada: 222 registros
2026-02-03 17:55:08 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 17:55:08 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 17:55:08 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 17:55:08 - INFO - Corrección completada:
2026-02-03 17:55:08 - INFO -   - Artículos corregidos: 191/222
2026-02-03 17:55:08 - INFO -   - Artículos aumentados: 191
2026-02-03 17:55:08 - INFO -   - Artículos reducidos: 0
2026-02-03 17:55:08 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 17:55:08 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 17:55:08 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 17:55:08 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 222 registros
2026-02-03 17:55:08 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 17:55:08 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 17:55:08 - DEBUG -   Con valor 0: 31
2026-02-03 17:55:08 - DEBUG -   Con valor > 0: 191
2026-02-03 17:55:08 - DEBUG -   Suma Ventas_Objetivo: 9259.59€
2026-02-03 17:55:08 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 191 registros
2026-02-03 17:55:08 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 17:55:08 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 17:55:08 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 17:55:08 - INFO -   Articulos: 191
2026-02-03 17:55:08 - INFO -   Importe: 9259.59€
2026-02-03 17:55:08 - INFO - 
==================================================
2026-02-03 17:55:08 - INFO - SECCION: DECO_INTERIOR
2026-02-03 17:55:08 - INFO - ==================================================
2026-02-03 17:55:08 - INFO - === LEYENDO DATOS PARA SECCIÓN: DECO_INTERIOR ===
2026-02-03 17:55:08 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 17:55:08 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: deco_interior
2026-02-03 17:55:08 - INFO - Archivo ABC encontrado para 'deco_interior': .\./data/input\CLASIFICACION_ABC+D_deco_interior.xlsx
2026-02-03 17:55:08 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_deco_interior.xlsx
2026-02-03 17:55:09 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 17:55:09 - INFO - Clasificación ABC cargada para 'deco_interior': 1827 registros
2026-02-03 17:55:09 - DEBUG - [DEBUG] ABC leído: 1827 registros
2026-02-03 17:55:09 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 17:55:09 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 17:55:09 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 17:55:13 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:55:13 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 17:55:13 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 17:55:13 - INFO - Ventas cargadas: 44082 registros
2026-02-03 17:55:13 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 17:55:13 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 17:55:13 - DEBUG - [DEBUG] Filtrando ventas por sección: deco_interior
2026-02-03 17:55:13 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 17:55:13 - DEBUG -   maf: 10970 registros
2026-02-03 17:55:13 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 17:55:13 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 17:55:13 - DEBUG -   interior: 3624 registros
2026-02-03 17:55:13 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 17:55:13 - DEBUG -   deco_interior: 2468 registros
2026-02-03 17:55:13 - DEBUG -   vivero: 2460 registros
2026-02-03 17:55:13 - DEBUG -   fitos: 1987 registros
2026-02-03 17:55:13 - DEBUG -   semillas: 1180 registros
2026-02-03 17:55:13 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 17:55:13 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 17:55:13 - DEBUG - [DEBUG] Tras filtrar por 'deco_interior': 2468 registros
2026-02-03 17:55:13 - INFO - Filtrados 2468 registros de sección 'deco_interior' de 44082 total
2026-02-03 17:55:13 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 17:55:13 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 17:55:15 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:55:15 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 17:55:15 - INFO - Costes cargados: 22145 registros
2026-02-03 17:55:15 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 17:55:15 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 17:55:15 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA DECO_INTERIOR ===
2026-02-03 17:55:15 - INFO -   ABC: 1827 registros
2026-02-03 17:55:15 - INFO -   Ventas: 2468 registros
2026-02-03 17:55:15 - INFO -   Costes: 22145 registros
2026-02-03 17:55:15 - DEBUG - [DEBUG] abc_df: 1827 registros
2026-02-03 17:55:15 - DEBUG - [DEBUG] ventas_df: 2468 registros
2026-02-03 17:55:15 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 17:55:15 - INFO - Datos de ventas: 180 registros
2026-02-03 17:55:15 - INFO - Calculando pedido para semana 14 (180 registros)
2026-02-03 17:55:15 - INFO -   Objetivo: 1962.99€, Actual (ABC): 1636.15€
2026-02-03 17:55:15 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 17:55:15 - INFO -   Factor total: 1.3125
2026-02-03 17:55:15 - INFO -   Factor escalado: 1.5747
2026-02-03 17:55:15 - INFO -   Ventas preliminares (con ceil): 2950.01€
2026-02-03 17:55:15 - INFO -   Objetivo final: 2576.42€
2026-02-03 17:55:15 - INFO -   Delta: 373.59€
2026-02-03 17:55:15 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 17:55:15 - DEBUG -   Total registros: 139
2026-02-03 17:55:15 - DEBUG -   Registros con Unidades_Finales > 0: 135
2026-02-03 17:55:15 - DEBUG -   Ventas finales: 2580.73€
2026-02-03 17:55:15 - INFO -   Ventas finales: 2580.73€
2026-02-03 17:55:15 - INFO - 
============================================================
2026-02-03 17:55:15 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 17:55:15 - INFO - ============================================================
2026-02-03 17:55:15 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 17:55:15 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 17:55:15 - INFO - DataLoader inicializado correctamente
2026-02-03 17:55:15 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 17:55:15 - INFO - ============================================================
2026-02-03 17:55:15 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 17:55:15 - INFO - ============================================================
2026-02-03 17:55:15 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 17:55:15 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 17:55:15 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:55:15 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:55:15 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 17:55:15 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:55:15 - DEBUG - Usando hoja: Stock
2026-02-03 17:55:15 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 17:55:15 - INFO - Stock actual cargado: 30 registros
2026-02-03 17:55:15 - INFO -   Stock: 30 registros
2026-02-03 17:55:15 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 17:55:15 - INFO - Fusión completada: 139 registros
2026-02-03 17:55:15 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 17:55:15 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 17:55:15 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 17:55:15 - INFO - Corrección completada:
2026-02-03 17:55:15 - INFO -   - Artículos corregidos: 135/139
2026-02-03 17:55:15 - INFO -   - Artículos aumentados: 135
2026-02-03 17:55:15 - INFO -   - Artículos reducidos: 0
2026-02-03 17:55:15 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 17:55:15 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 17:55:15 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 17:55:15 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 139 registros
2026-02-03 17:55:15 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 17:55:15 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 17:55:15 - DEBUG -   Con valor 0: 4
2026-02-03 17:55:15 - DEBUG -   Con valor > 0: 135
2026-02-03 17:55:15 - DEBUG -   Suma Ventas_Objetivo: 2580.73€
2026-02-03 17:55:15 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 135 registros
2026-02-03 17:55:15 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_deco_interior.xlsx
2026-02-03 17:55:15 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_deco_interior.xlsx
2026-02-03 17:55:15 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_deco_interior.xlsx
2026-02-03 17:55:15 - INFO -   Articulos: 135
2026-02-03 17:55:15 - INFO -   Importe: 2580.73€
2026-02-03 17:55:15 - INFO - 
==================================================
2026-02-03 17:55:15 - INFO - SECCION: SEMILLAS
2026-02-03 17:55:15 - INFO - ==================================================
2026-02-03 17:55:15 - INFO - === LEYENDO DATOS PARA SECCIÓN: SEMILLAS ===
2026-02-03 17:55:15 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 17:55:15 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: semillas
2026-02-03 17:55:15 - INFO - Archivo ABC encontrado para 'semillas': .\./data/input\CLASIFICACION_ABC+D_semillas.xlsx
2026-02-03 17:55:15 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_semillas.xlsx
2026-02-03 17:55:15 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 17:55:15 - INFO - Clasificación ABC cargada para 'semillas': 218 registros
2026-02-03 17:55:15 - DEBUG - [DEBUG] ABC leído: 218 registros
2026-02-03 17:55:15 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 17:55:15 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 17:55:15 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 17:55:19 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:55:19 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 17:55:19 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 17:55:19 - INFO - Ventas cargadas: 44082 registros
2026-02-03 17:55:19 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 17:55:19 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 17:55:19 - DEBUG - [DEBUG] Filtrando ventas por sección: semillas
2026-02-03 17:55:19 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 17:55:19 - DEBUG -   maf: 10970 registros
2026-02-03 17:55:19 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 17:55:19 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 17:55:19 - DEBUG -   interior: 3624 registros
2026-02-03 17:55:19 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 17:55:19 - DEBUG -   deco_interior: 2468 registros
2026-02-03 17:55:19 - DEBUG -   vivero: 2460 registros
2026-02-03 17:55:19 - DEBUG -   fitos: 1987 registros
2026-02-03 17:55:19 - DEBUG -   semillas: 1180 registros
2026-02-03 17:55:19 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 17:55:19 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 17:55:19 - DEBUG - [DEBUG] Tras filtrar por 'semillas': 1180 registros
2026-02-03 17:55:19 - INFO - Filtrados 1180 registros de sección 'semillas' de 44082 total
2026-02-03 17:55:19 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 17:55:19 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 17:55:21 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:55:21 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 17:55:21 - INFO - Costes cargados: 22145 registros
2026-02-03 17:55:21 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 17:55:21 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 17:55:21 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA SEMILLAS ===
2026-02-03 17:55:21 - INFO -   ABC: 218 registros
2026-02-03 17:55:21 - INFO -   Ventas: 1180 registros
2026-02-03 17:55:21 - INFO -   Costes: 22145 registros
2026-02-03 17:55:21 - DEBUG - [DEBUG] abc_df: 218 registros
2026-02-03 17:55:21 - DEBUG - [DEBUG] ventas_df: 1180 registros
2026-02-03 17:55:21 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 17:55:21 - INFO - Datos de ventas: 136 registros
2026-02-03 17:55:21 - INFO - Calculando pedido para semana 14 (136 registros)
2026-02-03 17:55:22 - INFO -   Objetivo: 694.34€, Actual (ABC): 455.14€
2026-02-03 17:55:22 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 17:55:22 - INFO -   Factor total: 1.3125
2026-02-03 17:55:22 - INFO -   Factor escalado: 2.0023
2026-02-03 17:55:22 - INFO -   Ventas preliminares (con ceil): 1129.15€
2026-02-03 17:55:22 - INFO -   Objetivo final: 911.32€
2026-02-03 17:55:22 - INFO -   Delta: 217.83€
2026-02-03 17:55:22 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 17:55:22 - DEBUG -   Total registros: 84
2026-02-03 17:55:22 - DEBUG -   Registros con Unidades_Finales > 0: 84
2026-02-03 17:55:22 - DEBUG -   Ventas finales: 911.60€
2026-02-03 17:55:22 - INFO -   Ventas finales: 911.60€
2026-02-03 17:55:22 - INFO - 
============================================================
2026-02-03 17:55:22 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 17:55:22 - INFO - ============================================================
2026-02-03 17:55:22 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 17:55:22 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 17:55:22 - INFO - DataLoader inicializado correctamente
2026-02-03 17:55:22 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 17:55:22 - INFO - ============================================================
2026-02-03 17:55:22 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 17:55:22 - INFO - ============================================================
2026-02-03 17:55:22 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 17:55:22 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 17:55:22 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:55:22 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:55:22 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 17:55:22 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:55:22 - DEBUG - Usando hoja: Stock
2026-02-03 17:55:22 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 17:55:22 - INFO - Stock actual cargado: 30 registros
2026-02-03 17:55:22 - INFO -   Stock: 30 registros
2026-02-03 17:55:22 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 17:55:22 - INFO - Fusión completada: 84 registros
2026-02-03 17:55:22 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 17:55:22 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 17:55:22 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 17:55:22 - INFO - Corrección completada:
2026-02-03 17:55:22 - INFO -   - Artículos corregidos: 84/84
2026-02-03 17:55:22 - INFO -   - Artículos aumentados: 84
2026-02-03 17:55:22 - INFO -   - Artículos reducidos: 0
2026-02-03 17:55:22 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 17:55:22 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 17:55:22 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 17:55:22 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 84 registros
2026-02-03 17:55:22 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 17:55:22 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 17:55:22 - DEBUG -   Con valor 0: 0
2026-02-03 17:55:22 - DEBUG -   Con valor > 0: 84
2026-02-03 17:55:22 - DEBUG -   Suma Ventas_Objetivo: 911.60€
2026-02-03 17:55:22 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 84 registros
2026-02-03 17:55:22 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_semillas.xlsx
2026-02-03 17:55:22 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_semillas.xlsx
2026-02-03 17:55:22 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_semillas.xlsx
2026-02-03 17:55:22 - INFO -   Articulos: 84
2026-02-03 17:55:22 - INFO -   Importe: 911.60€
2026-02-03 17:55:22 - INFO - 
==================================================
2026-02-03 17:55:22 - INFO - SECCION: MASCOTAS_VIVO
2026-02-03 17:55:22 - INFO - ==================================================
2026-02-03 17:55:22 - INFO - === LEYENDO DATOS PARA SECCIÓN: MASCOTAS_VIVO ===
2026-02-03 17:55:22 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 17:55:22 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: mascotas_vivo
2026-02-03 17:55:22 - INFO - Archivo ABC encontrado para 'mascotas_vivo': .\./data/input\CLASIFICACION_ABC+D_mascotas_vivo.xlsx
2026-02-03 17:55:22 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_mascotas_vivo.xlsx
2026-02-03 17:55:22 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 17:55:22 - INFO - Clasificación ABC cargada para 'mascotas_vivo': 205 registros
2026-02-03 17:55:22 - DEBUG - [DEBUG] ABC leído: 205 registros
2026-02-03 17:55:22 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 17:55:22 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 17:55:22 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 17:55:25 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:55:25 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 17:55:26 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 17:55:26 - INFO - Ventas cargadas: 44082 registros
2026-02-03 17:55:26 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 17:55:26 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 17:55:26 - DEBUG - [DEBUG] Filtrando ventas por sección: mascotas_vivo
2026-02-03 17:55:26 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 17:55:26 - DEBUG -   maf: 10970 registros
2026-02-03 17:55:26 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 17:55:26 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 17:55:26 - DEBUG -   interior: 3624 registros
2026-02-03 17:55:26 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 17:55:26 - DEBUG -   deco_interior: 2468 registros
2026-02-03 17:55:26 - DEBUG -   vivero: 2460 registros
2026-02-03 17:55:26 - DEBUG -   fitos: 1987 registros
2026-02-03 17:55:26 - DEBUG -   semillas: 1180 registros
2026-02-03 17:55:26 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 17:55:26 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 17:55:26 - DEBUG - [DEBUG] Tras filtrar por 'mascotas_vivo': 1124 registros
2026-02-03 17:55:26 - INFO - Filtrados 1124 registros de sección 'mascotas_vivo' de 44082 total
2026-02-03 17:55:26 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 17:55:26 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 17:55:28 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:55:28 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 17:55:28 - INFO - Costes cargados: 22145 registros
2026-02-03 17:55:28 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 17:55:28 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 17:55:28 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MASCOTAS_VIVO ===
2026-02-03 17:55:28 - INFO -   ABC: 205 registros
2026-02-03 17:55:28 - INFO -   Ventas: 1124 registros
2026-02-03 17:55:28 - INFO -   Costes: 22145 registros
2026-02-03 17:55:28 - DEBUG - [DEBUG] abc_df: 205 registros
2026-02-03 17:55:28 - DEBUG - [DEBUG] ventas_df: 1124 registros
2026-02-03 17:55:28 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 17:55:28 - INFO - Datos de ventas: 88 registros
2026-02-03 17:55:28 - INFO - Calculando pedido para semana 14 (88 registros)
2026-02-03 17:55:28 - INFO -   Objetivo: 1087.15€, Actual (ABC): 846.63€
2026-02-03 17:55:28 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 17:55:28 - INFO -   Factor total: 1.3125
2026-02-03 17:55:28 - INFO -   Factor escalado: 1.6854
2026-02-03 17:55:28 - INFO -   Ventas preliminares (con ceil): 1773.66€
2026-02-03 17:55:28 - INFO -   Objetivo final: 1426.88€
2026-02-03 17:55:28 - INFO -   Delta: 346.78€
2026-02-03 17:55:28 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 17:55:28 - DEBUG -   Total registros: 43
2026-02-03 17:55:28 - DEBUG -   Registros con Unidades_Finales > 0: 36
2026-02-03 17:55:28 - DEBUG -   Ventas finales: 1455.34€
2026-02-03 17:55:28 - INFO -   Ventas finales: 1455.34€
2026-02-03 17:55:28 - INFO - 
============================================================
2026-02-03 17:55:28 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 17:55:28 - INFO - ============================================================
2026-02-03 17:55:28 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 17:55:28 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 17:55:28 - INFO - DataLoader inicializado correctamente
2026-02-03 17:55:28 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 17:55:28 - INFO - ============================================================
2026-02-03 17:55:28 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 17:55:28 - INFO - ============================================================
2026-02-03 17:55:28 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 17:55:28 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 17:55:28 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:55:28 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:55:28 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 17:55:28 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:55:28 - DEBUG - Usando hoja: Stock
2026-02-03 17:55:28 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 17:55:28 - INFO - Stock actual cargado: 30 registros
2026-02-03 17:55:28 - INFO -   Stock: 30 registros
2026-02-03 17:55:28 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 17:55:28 - INFO - Fusión completada: 43 registros
2026-02-03 17:55:28 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 17:55:28 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 17:55:28 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 17:55:28 - INFO - Corrección completada:
2026-02-03 17:55:28 - INFO -   - Artículos corregidos: 36/43
2026-02-03 17:55:28 - INFO -   - Artículos aumentados: 36
2026-02-03 17:55:28 - INFO -   - Artículos reducidos: 0
2026-02-03 17:55:28 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 17:55:28 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 17:55:28 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 17:55:28 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 43 registros
2026-02-03 17:55:28 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 17:55:28 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 17:55:28 - DEBUG -   Con valor 0: 7
2026-02-03 17:55:28 - DEBUG -   Con valor > 0: 36
2026-02-03 17:55:28 - DEBUG -   Suma Ventas_Objetivo: 1455.34€
2026-02-03 17:55:28 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 36 registros
2026-02-03 17:55:28 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx
2026-02-03 17:55:28 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx
2026-02-03 17:55:28 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx
2026-02-03 17:55:28 - INFO -   Articulos: 36
2026-02-03 17:55:28 - INFO -   Importe: 1455.34€
2026-02-03 17:55:28 - INFO - 
==================================================
2026-02-03 17:55:28 - INFO - SECCION: MASCOTAS_MANUFACTURADO
2026-02-03 17:55:28 - INFO - ==================================================
2026-02-03 17:55:28 - INFO - === LEYENDO DATOS PARA SECCIÓN: MASCOTAS_MANUFACTURADO ===
2026-02-03 17:55:28 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 17:55:28 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: mascotas_manufacturado
2026-02-03 17:55:28 - INFO - Archivo ABC encontrado para 'mascotas_manufacturado': .\./data/input\CLASIFICACION_ABC+D_mascotas_manufacturado.xlsx
2026-02-03 17:55:28 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_mascotas_manufacturado.xlsx
2026-02-03 17:55:28 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 17:55:28 - INFO - Clasificación ABC cargada para 'mascotas_manufacturado': 2749 registros
2026-02-03 17:55:28 - DEBUG - [DEBUG] ABC leído: 2749 registros
2026-02-03 17:55:28 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 17:55:28 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 17:55:28 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 17:55:32 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:55:32 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 17:55:32 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 17:55:32 - INFO - Ventas cargadas: 44082 registros
2026-02-03 17:55:32 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 17:55:32 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 17:55:32 - DEBUG - [DEBUG] Filtrando ventas por sección: mascotas_manufacturado
2026-02-03 17:55:32 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 17:55:32 - DEBUG -   maf: 10970 registros
2026-02-03 17:55:32 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 17:55:32 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 17:55:32 - DEBUG -   interior: 3624 registros
2026-02-03 17:55:32 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 17:55:32 - DEBUG -   deco_interior: 2468 registros
2026-02-03 17:55:32 - DEBUG -   vivero: 2460 registros
2026-02-03 17:55:32 - DEBUG -   fitos: 1987 registros
2026-02-03 17:55:32 - DEBUG -   semillas: 1180 registros
2026-02-03 17:55:32 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 17:55:32 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 17:55:32 - DEBUG - [DEBUG] Tras filtrar por 'mascotas_manufacturado': 9784 registros
2026-02-03 17:55:32 - INFO - Filtrados 9784 registros de sección 'mascotas_manufacturado' de 44082 total
2026-02-03 17:55:32 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 17:55:32 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 17:55:34 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:55:34 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 17:55:34 - INFO - Costes cargados: 22145 registros
2026-02-03 17:55:34 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 17:55:34 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 17:55:34 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MASCOTAS_MANUFACTURADO ===
2026-02-03 17:55:34 - INFO -   ABC: 2749 registros
2026-02-03 17:55:34 - INFO -   Ventas: 9784 registros
2026-02-03 17:55:34 - INFO -   Costes: 22145 registros
2026-02-03 17:55:34 - DEBUG - [DEBUG] abc_df: 2749 registros
2026-02-03 17:55:34 - DEBUG - [DEBUG] ventas_df: 9784 registros
2026-02-03 17:55:34 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 17:55:34 - INFO - Datos de ventas: 822 registros
2026-02-03 17:55:34 - INFO - Calculando pedido para semana 14 (822 registros)
2026-02-03 17:55:36 - INFO -   Objetivo: 6839.82€, Actual (ABC): 8742.92€
2026-02-03 17:55:36 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 17:55:36 - INFO -   Factor total: 1.3125
2026-02-03 17:55:36 - INFO -   Factor escalado: 1.0268
2026-02-03 17:55:36 - INFO -   Ventas preliminares (con ceil): 12379.25€
2026-02-03 17:55:36 - INFO -   Objetivo final: 8977.26€
2026-02-03 17:55:36 - INFO -   Delta: 3401.99€
2026-02-03 17:55:36 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 17:55:36 - DEBUG -   Total registros: 538
2026-02-03 17:55:36 - DEBUG -   Registros con Unidades_Finales > 0: 411
2026-02-03 17:55:36 - DEBUG -   Ventas finales: 8993.98€
2026-02-03 17:55:36 - INFO -   Ventas finales: 8993.98€
2026-02-03 17:55:36 - INFO - 
============================================================
2026-02-03 17:55:36 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 17:55:36 - INFO - ============================================================
2026-02-03 17:55:36 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 17:55:36 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 17:55:36 - INFO - DataLoader inicializado correctamente
2026-02-03 17:55:36 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 17:55:36 - INFO - ============================================================
2026-02-03 17:55:36 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 17:55:36 - INFO - ============================================================
2026-02-03 17:55:36 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 17:55:36 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 17:55:36 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:55:36 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:55:36 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 17:55:36 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:55:36 - DEBUG - Usando hoja: Stock
2026-02-03 17:55:36 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 17:55:36 - INFO - Stock actual cargado: 30 registros
2026-02-03 17:55:36 - INFO -   Stock: 30 registros
2026-02-03 17:55:36 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 17:55:36 - INFO - Fusión completada: 538 registros
2026-02-03 17:55:36 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 17:55:36 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 17:55:36 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 17:55:36 - INFO - Corrección completada:
2026-02-03 17:55:36 - INFO -   - Artículos corregidos: 411/538
2026-02-03 17:55:36 - INFO -   - Artículos aumentados: 411
2026-02-03 17:55:36 - INFO -   - Artículos reducidos: 0
2026-02-03 17:55:36 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 17:55:36 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 17:55:36 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 17:55:36 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 538 registros
2026-02-03 17:55:36 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 17:55:36 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 17:55:36 - DEBUG -   Con valor 0: 127
2026-02-03 17:55:36 - DEBUG -   Con valor > 0: 411
2026-02-03 17:55:36 - DEBUG -   Suma Ventas_Objetivo: 8993.98€
2026-02-03 17:55:36 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 411 registros
2026-02-03 17:55:36 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx
2026-02-03 17:55:36 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx
2026-02-03 17:55:36 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx
2026-02-03 17:55:36 - INFO -   Articulos: 411
2026-02-03 17:55:36 - INFO -   Importe: 8993.98€
2026-02-03 17:55:36 - INFO - 
==================================================
2026-02-03 17:55:36 - INFO - SECCION: INTERIOR
2026-02-03 17:55:36 - INFO - ==================================================
2026-02-03 17:55:36 - INFO - === LEYENDO DATOS PARA SECCIÓN: INTERIOR ===
2026-02-03 17:55:36 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 17:55:36 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: interior
2026-02-03 17:55:36 - INFO - Archivo ABC encontrado para 'interior': .\./data/input\CLASIFICACION_ABC+D_interior.xlsx
2026-02-03 17:55:36 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_interior.xlsx
2026-02-03 17:55:37 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 17:55:37 - INFO - Clasificación ABC cargada para 'interior': 555 registros
2026-02-03 17:55:37 - DEBUG - [DEBUG] ABC leído: 555 registros
2026-02-03 17:55:37 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 17:55:37 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 17:55:37 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 17:55:40 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:55:40 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 17:55:40 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 17:55:40 - INFO - Ventas cargadas: 44082 registros
2026-02-03 17:55:40 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 17:55:40 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 17:55:40 - DEBUG - [DEBUG] Filtrando ventas por sección: interior
2026-02-03 17:55:40 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 17:55:40 - DEBUG -   maf: 10970 registros
2026-02-03 17:55:40 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 17:55:40 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 17:55:40 - DEBUG -   interior: 3624 registros
2026-02-03 17:55:40 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 17:55:40 - DEBUG -   deco_interior: 2468 registros
2026-02-03 17:55:40 - DEBUG -   vivero: 2460 registros
2026-02-03 17:55:40 - DEBUG -   fitos: 1987 registros
2026-02-03 17:55:40 - DEBUG -   semillas: 1180 registros
2026-02-03 17:55:40 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 17:55:40 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 17:55:40 - DEBUG - [DEBUG] Tras filtrar por 'interior': 3624 registros
2026-02-03 17:55:40 - INFO - Filtrados 3624 registros de sección 'interior' de 44082 total
2026-02-03 17:55:40 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 17:55:40 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 17:55:42 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:55:42 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 17:55:42 - INFO - Costes cargados: 22145 registros
2026-02-03 17:55:42 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 17:55:42 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 17:55:42 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA INTERIOR ===
2026-02-03 17:55:42 - INFO -   ABC: 555 registros
2026-02-03 17:55:42 - INFO -   Ventas: 3624 registros
2026-02-03 17:55:42 - INFO -   Costes: 22145 registros
2026-02-03 17:55:42 - DEBUG - [DEBUG] abc_df: 555 registros
2026-02-03 17:55:42 - DEBUG - [DEBUG] ventas_df: 3624 registros
2026-02-03 17:55:42 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 17:55:42 - INFO - Datos de ventas: 286 registros
2026-02-03 17:55:42 - INFO - Calculando pedido para semana 14 (286 registros)
2026-02-03 17:55:43 - INFO -   Objetivo: 2930.63€, Actual (ABC): 2409.44€
2026-02-03 17:55:43 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 17:55:43 - INFO -   Factor total: 1.3125
2026-02-03 17:55:43 - INFO -   Factor escalado: 1.5964
2026-02-03 17:55:43 - INFO -   Ventas preliminares (con ceil): 4541.81€
2026-02-03 17:55:43 - INFO -   Objetivo final: 3846.45€
2026-02-03 17:55:43 - INFO -   Delta: 695.36€
2026-02-03 17:55:43 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 17:55:43 - DEBUG -   Total registros: 138
2026-02-03 17:55:43 - DEBUG -   Registros con Unidades_Finales > 0: 121
2026-02-03 17:55:43 - DEBUG -   Ventas finales: 3855.17€
2026-02-03 17:55:43 - INFO -   Ventas finales: 3855.17€
2026-02-03 17:55:43 - INFO - 
============================================================
2026-02-03 17:55:43 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 17:55:43 - INFO - ============================================================
2026-02-03 17:55:43 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 17:55:43 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 17:55:43 - INFO - DataLoader inicializado correctamente
2026-02-03 17:55:43 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 17:55:43 - INFO - ============================================================
2026-02-03 17:55:43 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 17:55:43 - INFO - ============================================================
2026-02-03 17:55:43 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 17:55:43 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 17:55:43 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:55:43 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:55:43 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 17:55:43 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:55:43 - DEBUG - Usando hoja: Stock
2026-02-03 17:55:43 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 17:55:43 - INFO - Stock actual cargado: 30 registros
2026-02-03 17:55:43 - INFO -   Stock: 30 registros
2026-02-03 17:55:43 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 17:55:43 - INFO - Fusión completada: 138 registros
2026-02-03 17:55:43 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 17:55:43 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 17:55:43 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 17:55:43 - INFO - Corrección completada:
2026-02-03 17:55:43 - INFO -   - Artículos corregidos: 121/138
2026-02-03 17:55:43 - INFO -   - Artículos aumentados: 121
2026-02-03 17:55:43 - INFO -   - Artículos reducidos: 0
2026-02-03 17:55:43 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 17:55:43 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 17:55:43 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 17:55:43 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 138 registros
2026-02-03 17:55:43 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 17:55:43 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 17:55:43 - DEBUG -   Con valor 0: 17
2026-02-03 17:55:43 - DEBUG -   Con valor > 0: 121
2026-02-03 17:55:43 - DEBUG -   Suma Ventas_Objetivo: 3855.17€
2026-02-03 17:55:43 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 121 registros
2026-02-03 17:55:43 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_interior.xlsx
2026-02-03 17:55:43 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_interior.xlsx
2026-02-03 17:55:43 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_interior.xlsx
2026-02-03 17:55:43 - INFO -   Articulos: 121
2026-02-03 17:55:43 - INFO -   Importe: 3855.17€
2026-02-03 17:55:43 - INFO - 
==================================================
2026-02-03 17:55:43 - INFO - SECCION: FITOS
2026-02-03 17:55:43 - INFO - ==================================================
2026-02-03 17:55:43 - INFO - === LEYENDO DATOS PARA SECCIÓN: FITOS ===
2026-02-03 17:55:43 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 17:55:43 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: fitos
2026-02-03 17:55:43 - INFO - Archivo ABC encontrado para 'fitos': .\./data/input\CLASIFICACION_ABC+D_fitos.xlsx
2026-02-03 17:55:43 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_fitos.xlsx
2026-02-03 17:55:43 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 17:55:43 - INFO - Clasificación ABC cargada para 'fitos': 247 registros
2026-02-03 17:55:43 - DEBUG - [DEBUG] ABC leído: 247 registros
2026-02-03 17:55:43 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 17:55:43 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 17:55:43 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 17:55:47 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:55:47 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 17:55:47 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 17:55:47 - INFO - Ventas cargadas: 44082 registros
2026-02-03 17:55:47 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 17:55:47 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 17:55:47 - DEBUG - [DEBUG] Filtrando ventas por sección: fitos
2026-02-03 17:55:47 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 17:55:47 - DEBUG -   maf: 10970 registros
2026-02-03 17:55:47 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 17:55:47 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 17:55:47 - DEBUG -   interior: 3624 registros
2026-02-03 17:55:47 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 17:55:47 - DEBUG -   deco_interior: 2468 registros
2026-02-03 17:55:47 - DEBUG -   vivero: 2460 registros
2026-02-03 17:55:47 - DEBUG -   fitos: 1987 registros
2026-02-03 17:55:47 - DEBUG -   semillas: 1180 registros
2026-02-03 17:55:47 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 17:55:47 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 17:55:47 - DEBUG - [DEBUG] Tras filtrar por 'fitos': 1987 registros
2026-02-03 17:55:47 - INFO - Filtrados 1987 registros de sección 'fitos' de 44082 total
2026-02-03 17:55:47 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 17:55:47 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 17:55:49 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:55:49 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 17:55:49 - INFO - Costes cargados: 22145 registros
2026-02-03 17:55:49 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 17:55:49 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 17:55:49 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA FITOS ===
2026-02-03 17:55:49 - INFO -   ABC: 247 registros
2026-02-03 17:55:49 - INFO -   Ventas: 1987 registros
2026-02-03 17:55:49 - INFO -   Costes: 22145 registros
2026-02-03 17:55:49 - DEBUG - [DEBUG] abc_df: 247 registros
2026-02-03 17:55:49 - DEBUG - [DEBUG] ventas_df: 1987 registros
2026-02-03 17:55:49 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 17:55:49 - INFO - Datos de ventas: 157 registros
2026-02-03 17:55:49 - INFO - Calculando pedido para semana 14 (157 registros)
2026-02-03 17:55:49 - INFO -   Objetivo: 1798.25€, Actual (ABC): 1679.26€
2026-02-03 17:55:49 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 17:55:49 - INFO -   Factor total: 1.3125
2026-02-03 17:55:49 - INFO -   Factor escalado: 1.4055
2026-02-03 17:55:49 - INFO -   Ventas preliminares (con ceil): 2784.94€
2026-02-03 17:55:49 - INFO -   Objetivo final: 2360.20€
2026-02-03 17:55:49 - INFO -   Delta: 424.74€
2026-02-03 17:55:49 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 17:55:49 - DEBUG -   Total registros: 84
2026-02-03 17:55:49 - DEBUG -   Registros con Unidades_Finales > 0: 82
2026-02-03 17:55:49 - DEBUG -   Ventas finales: 2365.92€
2026-02-03 17:55:49 - INFO -   Ventas finales: 2365.92€
2026-02-03 17:55:49 - INFO - 
============================================================
2026-02-03 17:55:49 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 17:55:49 - INFO - ============================================================
2026-02-03 17:55:49 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 17:55:49 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 17:55:49 - INFO - DataLoader inicializado correctamente
2026-02-03 17:55:49 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 17:55:49 - INFO - ============================================================
2026-02-03 17:55:49 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 17:55:49 - INFO - ============================================================
2026-02-03 17:55:49 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 17:55:49 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 17:55:49 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:55:49 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:55:49 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 17:55:49 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:55:49 - DEBUG - Usando hoja: Stock
2026-02-03 17:55:49 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 17:55:49 - INFO - Stock actual cargado: 30 registros
2026-02-03 17:55:49 - INFO -   Stock: 30 registros
2026-02-03 17:55:49 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 17:55:49 - INFO - Fusión completada: 84 registros
2026-02-03 17:55:49 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 17:55:49 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 17:55:49 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 17:55:49 - INFO - Corrección completada:
2026-02-03 17:55:49 - INFO -   - Artículos corregidos: 82/84
2026-02-03 17:55:49 - INFO -   - Artículos aumentados: 82
2026-02-03 17:55:49 - INFO -   - Artículos reducidos: 0
2026-02-03 17:55:49 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 17:55:49 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 17:55:49 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 17:55:49 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 84 registros
2026-02-03 17:55:49 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 17:55:49 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 17:55:49 - DEBUG -   Con valor 0: 2
2026-02-03 17:55:49 - DEBUG -   Con valor > 0: 82
2026-02-03 17:55:49 - DEBUG -   Suma Ventas_Objetivo: 2365.92€
2026-02-03 17:55:49 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 82 registros
2026-02-03 17:55:49 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_fitos.xlsx
2026-02-03 17:55:49 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_fitos.xlsx
2026-02-03 17:55:49 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_fitos.xlsx
2026-02-03 17:55:49 - INFO -   Articulos: 82
2026-02-03 17:55:49 - INFO -   Importe: 2365.92€
2026-02-03 17:55:49 - INFO - 
==================================================
2026-02-03 17:55:49 - INFO - SECCION: VIVERO
2026-02-03 17:55:49 - INFO - ==================================================
2026-02-03 17:55:49 - INFO - === LEYENDO DATOS PARA SECCIÓN: VIVERO ===
2026-02-03 17:55:49 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 17:55:49 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: vivero
2026-02-03 17:55:49 - INFO - Archivo ABC encontrado para 'vivero': .\./data/input\CLASIFICACION_ABC+D_vivero.xlsx
2026-02-03 17:55:49 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_vivero.xlsx
2026-02-03 17:55:49 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 17:55:49 - INFO - Clasificación ABC cargada para 'vivero': 565 registros
2026-02-03 17:55:49 - DEBUG - [DEBUG] ABC leído: 565 registros
2026-02-03 17:55:49 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 17:55:49 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 17:55:49 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 17:55:53 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:55:53 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 17:55:53 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 17:55:53 - INFO - Ventas cargadas: 44082 registros
2026-02-03 17:55:53 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 17:55:53 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 17:55:53 - DEBUG - [DEBUG] Filtrando ventas por sección: vivero
2026-02-03 17:55:53 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 17:55:53 - DEBUG -   maf: 10970 registros
2026-02-03 17:55:53 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 17:55:53 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 17:55:53 - DEBUG -   interior: 3624 registros
2026-02-03 17:55:53 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 17:55:53 - DEBUG -   deco_interior: 2468 registros
2026-02-03 17:55:53 - DEBUG -   vivero: 2460 registros
2026-02-03 17:55:53 - DEBUG -   fitos: 1987 registros
2026-02-03 17:55:53 - DEBUG -   semillas: 1180 registros
2026-02-03 17:55:53 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 17:55:53 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 17:55:53 - DEBUG - [DEBUG] Tras filtrar por 'vivero': 2460 registros
2026-02-03 17:55:53 - INFO - Filtrados 2460 registros de sección 'vivero' de 44082 total
2026-02-03 17:55:53 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 17:55:53 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 17:55:55 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:55:55 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 17:55:55 - INFO - Costes cargados: 22145 registros
2026-02-03 17:55:55 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 17:55:55 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 17:55:55 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA VIVERO ===
2026-02-03 17:55:55 - INFO -   ABC: 565 registros
2026-02-03 17:55:55 - INFO -   Ventas: 2460 registros
2026-02-03 17:55:55 - INFO -   Costes: 22145 registros
2026-02-03 17:55:55 - DEBUG - [DEBUG] abc_df: 565 registros
2026-02-03 17:55:55 - DEBUG - [DEBUG] ventas_df: 2460 registros
2026-02-03 17:55:55 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 17:55:55 - INFO - Datos de ventas: 189 registros
2026-02-03 17:55:55 - INFO - Calculando pedido para semana 14 (189 registros)
2026-02-03 17:55:56 - INFO -   Objetivo: 5297.17€, Actual (ABC): 4113.14€
2026-02-03 17:55:56 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 17:55:56 - INFO -   Factor total: 1.3125
2026-02-03 17:55:56 - INFO -   Factor escalado: 1.6903
2026-02-03 17:55:56 - INFO -   Ventas preliminares (con ceil): 8761.94€
2026-02-03 17:55:56 - INFO -   Objetivo final: 6952.54€
2026-02-03 17:55:56 - INFO -   Delta: 1809.40€
2026-02-03 17:55:56 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 17:55:56 - DEBUG -   Total registros: 107
2026-02-03 17:55:56 - DEBUG -   Registros con Unidades_Finales > 0: 96
2026-02-03 17:55:56 - DEBUG -   Ventas finales: 6990.51€
2026-02-03 17:55:56 - INFO -   Ventas finales: 6990.51€
2026-02-03 17:55:56 - INFO - 
============================================================
2026-02-03 17:55:56 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 17:55:56 - INFO - ============================================================
2026-02-03 17:55:56 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 17:55:56 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 17:55:56 - INFO - DataLoader inicializado correctamente
2026-02-03 17:55:56 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 17:55:56 - INFO - ============================================================
2026-02-03 17:55:56 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 17:55:56 - INFO - ============================================================
2026-02-03 17:55:56 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 17:55:56 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 17:55:56 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:55:56 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:55:56 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 17:55:56 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:55:56 - DEBUG - Usando hoja: Stock
2026-02-03 17:55:56 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 17:55:56 - INFO - Stock actual cargado: 30 registros
2026-02-03 17:55:56 - INFO -   Stock: 30 registros
2026-02-03 17:55:56 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 17:55:56 - INFO - Fusión completada: 107 registros
2026-02-03 17:55:56 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 17:55:56 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 17:55:56 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 17:55:56 - INFO - Corrección completada:
2026-02-03 17:55:56 - INFO -   - Artículos corregidos: 96/107
2026-02-03 17:55:56 - INFO -   - Artículos aumentados: 96
2026-02-03 17:55:56 - INFO -   - Artículos reducidos: 0
2026-02-03 17:55:56 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 17:55:56 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 17:55:56 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 17:55:56 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 107 registros
2026-02-03 17:55:56 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 17:55:56 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 17:55:56 - DEBUG -   Con valor 0: 11
2026-02-03 17:55:56 - DEBUG -   Con valor > 0: 96
2026-02-03 17:55:56 - DEBUG -   Suma Ventas_Objetivo: 6990.51€
2026-02-03 17:55:56 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 96 registros
2026-02-03 17:55:56 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_vivero.xlsx
2026-02-03 17:55:56 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_vivero.xlsx
2026-02-03 17:55:56 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_vivero.xlsx
2026-02-03 17:55:56 - INFO -   Articulos: 96
2026-02-03 17:55:56 - INFO -   Importe: 6990.51€
2026-02-03 17:55:56 - INFO - 
==================================================
2026-02-03 17:55:56 - INFO - SECCION: UTILES_JARDIN
2026-02-03 17:55:56 - INFO - ==================================================
2026-02-03 17:55:56 - INFO - === LEYENDO DATOS PARA SECCIÓN: UTILES_JARDIN ===
2026-02-03 17:55:56 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 17:55:56 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: utiles_jardin
2026-02-03 17:55:56 - INFO - Archivo ABC encontrado para 'utiles_jardin': .\./data/input\CLASIFICACION_ABC+D_utiles_jardin.xlsx
2026-02-03 17:55:56 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_utiles_jardin.xlsx
2026-02-03 17:55:56 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 17:55:56 - INFO - Clasificación ABC cargada para 'utiles_jardin': 433 registros
2026-02-03 17:55:56 - DEBUG - [DEBUG] ABC leído: 433 registros
2026-02-03 17:55:56 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 17:55:56 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 17:55:56 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 17:55:59 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:55:59 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 17:56:00 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 17:56:00 - INFO - Ventas cargadas: 44082 registros
2026-02-03 17:56:00 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 17:56:00 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 17:56:00 - DEBUG - [DEBUG] Filtrando ventas por sección: utiles_jardin
2026-02-03 17:56:00 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 17:56:00 - DEBUG -   maf: 10970 registros
2026-02-03 17:56:00 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 17:56:00 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 17:56:00 - DEBUG -   interior: 3624 registros
2026-02-03 17:56:00 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 17:56:00 - DEBUG -   deco_interior: 2468 registros
2026-02-03 17:56:00 - DEBUG -   vivero: 2460 registros
2026-02-03 17:56:00 - DEBUG -   fitos: 1987 registros
2026-02-03 17:56:00 - DEBUG -   semillas: 1180 registros
2026-02-03 17:56:00 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 17:56:00 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 17:56:00 - DEBUG - [DEBUG] Tras filtrar por 'utiles_jardin': 1009 registros
2026-02-03 17:56:00 - INFO - Filtrados 1009 registros de sección 'utiles_jardin' de 44082 total
2026-02-03 17:56:00 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 17:56:00 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 17:56:02 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:56:02 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 17:56:02 - INFO - Costes cargados: 22145 registros
2026-02-03 17:56:02 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 17:56:02 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 17:56:02 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA UTILES_JARDIN ===
2026-02-03 17:56:02 - INFO -   ABC: 433 registros
2026-02-03 17:56:02 - INFO -   Ventas: 1009 registros
2026-02-03 17:56:02 - INFO -   Costes: 22145 registros
2026-02-03 17:56:02 - DEBUG - [DEBUG] abc_df: 433 registros
2026-02-03 17:56:02 - DEBUG - [DEBUG] ventas_df: 1009 registros
2026-02-03 17:56:02 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 17:56:02 - INFO - Datos de ventas: 89 registros
2026-02-03 17:56:02 - INFO - Calculando pedido para semana 14 (89 registros)
2026-02-03 17:56:02 - INFO -   Objetivo: 1044.77€, Actual (ABC): 818.79€
2026-02-03 17:56:02 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 17:56:02 - INFO -   Factor total: 1.3125
2026-02-03 17:56:02 - INFO -   Factor escalado: 1.6747
2026-02-03 17:56:02 - INFO -   Ventas preliminares (con ceil): 1929.56€
2026-02-03 17:56:02 - INFO -   Objetivo final: 1371.26€
2026-02-03 17:56:02 - INFO -   Delta: 558.30€
2026-02-03 17:56:02 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 17:56:02 - DEBUG -   Total registros: 78
2026-02-03 17:56:02 - DEBUG -   Registros con Unidades_Finales > 0: 78
2026-02-03 17:56:02 - DEBUG -   Ventas finales: 1390.00€
2026-02-03 17:56:02 - INFO -   Ventas finales: 1390.00€
2026-02-03 17:56:02 - INFO - 
============================================================
2026-02-03 17:56:02 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 17:56:02 - INFO - ============================================================
2026-02-03 17:56:02 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 17:56:02 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 17:56:02 - INFO - DataLoader inicializado correctamente
2026-02-03 17:56:02 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 17:56:02 - INFO - ============================================================
2026-02-03 17:56:02 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 17:56:02 - INFO - ============================================================
2026-02-03 17:56:02 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 17:56:02 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 17:56:02 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:56:02 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:56:02 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 17:56:02 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:56:02 - DEBUG - Usando hoja: Stock
2026-02-03 17:56:02 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 17:56:02 - INFO - Stock actual cargado: 30 registros
2026-02-03 17:56:02 - INFO -   Stock: 30 registros
2026-02-03 17:56:02 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 17:56:02 - INFO - Fusión completada: 78 registros
2026-02-03 17:56:02 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 17:56:02 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 17:56:02 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 17:56:02 - INFO - Corrección completada:
2026-02-03 17:56:02 - INFO -   - Artículos corregidos: 78/78
2026-02-03 17:56:02 - INFO -   - Artículos aumentados: 78
2026-02-03 17:56:02 - INFO -   - Artículos reducidos: 0
2026-02-03 17:56:02 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 17:56:02 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 17:56:02 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 17:56:02 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 78 registros
2026-02-03 17:56:02 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 17:56:02 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 17:56:02 - DEBUG -   Con valor 0: 0
2026-02-03 17:56:02 - DEBUG -   Con valor > 0: 78
2026-02-03 17:56:02 - DEBUG -   Suma Ventas_Objetivo: 1390.00€
2026-02-03 17:56:02 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 78 registros
2026-02-03 17:56:02 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx
2026-02-03 17:56:02 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx
2026-02-03 17:56:02 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx
2026-02-03 17:56:02 - INFO -   Articulos: 78
2026-02-03 17:56:02 - INFO -   Importe: 1390.00€
2026-02-03 17:56:02 - INFO - 
==================================================
2026-02-03 17:56:02 - INFO - SECCION: TIERRAS_ARIDOS
2026-02-03 17:56:02 - INFO - ==================================================
2026-02-03 17:56:02 - INFO - === LEYENDO DATOS PARA SECCIÓN: TIERRAS_ARIDOS ===
2026-02-03 17:56:02 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 17:56:02 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: tierras_aridos
2026-02-03 17:56:02 - WARNING - No se encontró archivo específico para 'tierras_aridos', usando: .\./data/input\CLASIFICACION_ABC+D_DECO_EXTERIOR.xlsx
2026-02-03 17:56:02 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_DECO_EXTERIOR.xlsx
2026-02-03 17:56:02 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 17:56:02 - INFO - Clasificación ABC cargada para 'tierras_aridos': 995 registros
2026-02-03 17:56:02 - DEBUG - [DEBUG] ABC leído: 995 registros
2026-02-03 17:56:02 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 17:56:02 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 17:56:02 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 17:56:06 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:56:06 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 17:56:06 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 17:56:06 - INFO - Ventas cargadas: 44082 registros
2026-02-03 17:56:06 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 17:56:06 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 17:56:06 - DEBUG - [DEBUG] Filtrando ventas por sección: tierras_aridos
2026-02-03 17:56:06 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 17:56:06 - DEBUG -   maf: 10970 registros
2026-02-03 17:56:06 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 17:56:06 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 17:56:06 - DEBUG -   interior: 3624 registros
2026-02-03 17:56:06 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 17:56:06 - DEBUG -   deco_interior: 2468 registros
2026-02-03 17:56:06 - DEBUG -   vivero: 2460 registros
2026-02-03 17:56:06 - DEBUG -   fitos: 1987 registros
2026-02-03 17:56:06 - DEBUG -   semillas: 1180 registros
2026-02-03 17:56:06 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 17:56:06 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 17:56:06 - DEBUG - [DEBUG] Tras filtrar por 'tierras_aridos': 3264 registros
2026-02-03 17:56:06 - INFO - Filtrados 3264 registros de sección 'tierras_aridos' de 44082 total
2026-02-03 17:56:06 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 17:56:06 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 17:56:08 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:56:08 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 17:56:08 - INFO - Costes cargados: 22145 registros
2026-02-03 17:56:08 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 17:56:08 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 17:56:08 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA TIERRAS_ARIDOS ===
2026-02-03 17:56:08 - INFO -   ABC: 995 registros
2026-02-03 17:56:08 - INFO -   Ventas: 3264 registros
2026-02-03 17:56:08 - INFO -   Costes: 22145 registros
2026-02-03 17:56:08 - DEBUG - [DEBUG] abc_df: 995 registros
2026-02-03 17:56:08 - DEBUG - [DEBUG] ventas_df: 3264 registros
2026-02-03 17:56:08 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 17:56:08 - INFO - Datos de ventas: 302 registros
2026-02-03 17:56:08 - INFO - Calculando pedido para semana 14 (302 registros)
2026-02-03 17:56:08 - INFO -   Objetivo: 4097.24€, Actual (ABC): 4019.19€
2026-02-03 17:56:08 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 17:56:08 - INFO -   Factor total: 1.3125
2026-02-03 17:56:08 - INFO -   Factor escalado: 1.3380
2026-02-03 17:56:08 - INFO -   Ventas preliminares (con ceil): 5809.66€
2026-02-03 17:56:08 - INFO -   Objetivo final: 5377.63€
2026-02-03 17:56:08 - INFO -   Delta: 432.03€
2026-02-03 17:56:08 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 17:56:08 - DEBUG -   Total registros: 72
2026-02-03 17:56:08 - DEBUG -   Registros con Unidades_Finales > 0: 71
2026-02-03 17:56:08 - DEBUG -   Ventas finales: 5387.14€
2026-02-03 17:56:08 - INFO -   Ventas finales: 5387.14€
2026-02-03 17:56:08 - INFO - 
============================================================
2026-02-03 17:56:08 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 17:56:08 - INFO - ============================================================
2026-02-03 17:56:08 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 17:56:08 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 17:56:08 - INFO - DataLoader inicializado correctamente
2026-02-03 17:56:08 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 17:56:08 - INFO - ============================================================
2026-02-03 17:56:08 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 17:56:08 - INFO - ============================================================
2026-02-03 17:56:08 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 17:56:08 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 17:56:08 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:56:08 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:56:08 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 17:56:08 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:56:08 - DEBUG - Usando hoja: Stock
2026-02-03 17:56:08 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 17:56:08 - INFO - Stock actual cargado: 30 registros
2026-02-03 17:56:08 - INFO -   Stock: 30 registros
2026-02-03 17:56:08 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 17:56:08 - INFO - Fusión completada: 72 registros
2026-02-03 17:56:08 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 17:56:08 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 17:56:08 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 17:56:08 - INFO - Corrección completada:
2026-02-03 17:56:08 - INFO -   - Artículos corregidos: 71/72
2026-02-03 17:56:08 - INFO -   - Artículos aumentados: 71
2026-02-03 17:56:08 - INFO -   - Artículos reducidos: 0
2026-02-03 17:56:08 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 17:56:08 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 17:56:08 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 17:56:08 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 72 registros
2026-02-03 17:56:08 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 17:56:08 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 17:56:08 - DEBUG -   Con valor 0: 1
2026-02-03 17:56:08 - DEBUG -   Con valor > 0: 71
2026-02-03 17:56:08 - DEBUG -   Suma Ventas_Objetivo: 5387.14€
2026-02-03 17:56:08 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 71 registros
2026-02-03 17:56:08 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx
2026-02-03 17:56:08 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx
2026-02-03 17:56:08 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx
2026-02-03 17:56:08 - INFO -   Articulos: 71
2026-02-03 17:56:08 - INFO -   Importe: 5387.14€
2026-02-03 17:56:08 - INFO - 
==================================================
2026-02-03 17:56:08 - INFO - SECCION: DECO_EXTERIOR
2026-02-03 17:56:08 - INFO - ==================================================
2026-02-03 17:56:08 - INFO - === LEYENDO DATOS PARA SECCIÓN: DECO_EXTERIOR ===
2026-02-03 17:56:08 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 17:56:08 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: deco_exterior
2026-02-03 17:56:08 - INFO - Archivo ABC encontrado para 'deco_exterior': .\./data/input\CLASIFICACION_ABC+D_deco_exterior.xlsx
2026-02-03 17:56:08 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_deco_exterior.xlsx
2026-02-03 17:56:09 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 17:56:09 - INFO - Clasificación ABC cargada para 'deco_exterior': 995 registros
2026-02-03 17:56:09 - DEBUG - [DEBUG] ABC leído: 995 registros
2026-02-03 17:56:09 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 17:56:09 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 17:56:09 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 17:56:12 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:56:12 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 17:56:12 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 17:56:12 - INFO - Ventas cargadas: 44082 registros
2026-02-03 17:56:12 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 17:56:12 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 17:56:12 - DEBUG - [DEBUG] Filtrando ventas por sección: deco_exterior
2026-02-03 17:56:12 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 17:56:12 - DEBUG -   maf: 10970 registros
2026-02-03 17:56:12 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 17:56:12 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 17:56:12 - DEBUG -   interior: 3624 registros
2026-02-03 17:56:12 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 17:56:12 - DEBUG -   deco_interior: 2468 registros
2026-02-03 17:56:12 - DEBUG -   vivero: 2460 registros
2026-02-03 17:56:12 - DEBUG -   fitos: 1987 registros
2026-02-03 17:56:12 - DEBUG -   semillas: 1180 registros
2026-02-03 17:56:12 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 17:56:12 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 17:56:12 - DEBUG - [DEBUG] Tras filtrar por 'deco_exterior': 4018 registros
2026-02-03 17:56:12 - INFO - Filtrados 4018 registros de sección 'deco_exterior' de 44082 total
2026-02-03 17:56:12 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 17:56:12 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 17:56:14 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:56:14 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 17:56:14 - INFO - Costes cargados: 22145 registros
2026-02-03 17:56:14 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 17:56:14 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 17:56:14 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA DECO_EXTERIOR ===
2026-02-03 17:56:14 - INFO -   ABC: 995 registros
2026-02-03 17:56:14 - INFO -   Ventas: 4018 registros
2026-02-03 17:56:14 - INFO -   Costes: 22145 registros
2026-02-03 17:56:14 - DEBUG - [DEBUG] abc_df: 995 registros
2026-02-03 17:56:14 - DEBUG - [DEBUG] ventas_df: 4018 registros
2026-02-03 17:56:14 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 17:56:14 - INFO - Datos de ventas: 316 registros
2026-02-03 17:56:14 - INFO - Calculando pedido para semana 14 (316 registros)
2026-02-03 17:56:15 - INFO -   Objetivo: 3740.34€, Actual (ABC): 4104.66€
2026-02-03 17:56:15 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 17:56:15 - INFO -   Factor total: 1.3125
2026-02-03 17:56:15 - INFO -   Factor escalado: 1.1960
2026-02-03 17:56:15 - INFO -   Ventas preliminares (con ceil): 6094.59€
2026-02-03 17:56:15 - INFO -   Objetivo final: 4909.20€
2026-02-03 17:56:15 - INFO -   Delta: 1185.39€
2026-02-03 17:56:15 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 17:56:15 - DEBUG -   Total registros: 224
2026-02-03 17:56:15 - DEBUG -   Registros con Unidades_Finales > 0: 205
2026-02-03 17:56:15 - DEBUG -   Ventas finales: 4923.89€
2026-02-03 17:56:15 - INFO -   Ventas finales: 4923.89€
2026-02-03 17:56:15 - INFO - 
============================================================
2026-02-03 17:56:15 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 17:56:15 - INFO - ============================================================
2026-02-03 17:56:15 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 17:56:15 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 17:56:15 - INFO - DataLoader inicializado correctamente
2026-02-03 17:56:15 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 17:56:15 - INFO - ============================================================
2026-02-03 17:56:15 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 17:56:15 - INFO - ============================================================
2026-02-03 17:56:15 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 17:56:15 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 17:56:15 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:56:15 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 17:56:15 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 17:56:15 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 17:56:15 - DEBUG - Usando hoja: Stock
2026-02-03 17:56:15 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 17:56:15 - INFO - Stock actual cargado: 30 registros
2026-02-03 17:56:15 - INFO -   Stock: 30 registros
2026-02-03 17:56:15 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 17:56:15 - INFO - Fusión completada: 224 registros
2026-02-03 17:56:15 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 17:56:15 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 17:56:15 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 17:56:15 - INFO - Corrección completada:
2026-02-03 17:56:15 - INFO -   - Artículos corregidos: 205/224
2026-02-03 17:56:15 - INFO -   - Artículos aumentados: 205
2026-02-03 17:56:15 - INFO -   - Artículos reducidos: 0
2026-02-03 17:56:15 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 17:56:15 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 17:56:15 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 17:56:15 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 224 registros
2026-02-03 17:56:15 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 17:56:15 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 17:56:15 - DEBUG -   Con valor 0: 19
2026-02-03 17:56:15 - DEBUG -   Con valor > 0: 205
2026-02-03 17:56:15 - DEBUG -   Suma Ventas_Objetivo: 4923.89€
2026-02-03 17:56:15 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 205 registros
2026-02-03 17:56:15 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_deco_exterior.xlsx
2026-02-03 17:56:15 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_deco_exterior.xlsx
2026-02-03 17:56:15 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_deco_exterior.xlsx
2026-02-03 17:56:15 - INFO -   Articulos: 205
2026-02-03 17:56:15 - INFO -   Importe: 4923.89€
2026-02-03 17:56:15 - INFO - Estado guardado correctamente
2026-02-03 17:56:15 - INFO - Generando resumen: .\./data/output\Resumen_Pedidos_VIVERO_2026-02-03.xlsx
2026-02-03 17:56:15 - INFO - Resumen guardado: .\./data/output\Resumen_Pedidos_VIVERO_2026-02-03.xlsx
2026-02-03 17:56:15 - INFO - Estado guardado correctamente
2026-02-03 17:56:15 - INFO - 
============================================================
2026-02-03 17:56:15 - INFO - PREPARANDO ENVÍO DE EMAILS
2026-02-03 17:56:15 - INFO - ============================================================
2026-02-03 17:56:15 - DEBUG - [DEBUG] Archivos agrupados por sección: {'maf': ['.\\./data/output\\Pedido_Semana_14_2026-02-03_maf.xlsx'], 'interior': ['.\\./data/output\\Pedido_Semana_14_2026-02-03_deco_interior.xlsx', '.\\./data/output\\Pedido_Semana_14_2026-02-03_interior.xlsx'], 'semillas': ['.\\./data/output\\Pedido_Semana_14_2026-02-03_semillas.xlsx'], 'vivo': ['.\\./data/output\\Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx'], 'manufacturado': ['.\\./data/output\\Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx'], 'fitos': ['.\\./data/output\\Pedido_Semana_14_2026-02-03_fitos.xlsx'], 'vivero': ['.\\./data/output\\Pedido_Semana_14_2026-02-03_vivero.xlsx'], 'jardin': ['.\\./data/output\\Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx'], 'aridos': ['.\\./data/output\\Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx'], 'exterior': ['.\\./data/output\\Pedido_Semana_14_2026-02-03_deco_exterior.xlsx']}
2026-02-03 17:56:15 - INFO - 
============================================================
2026-02-03 17:56:15 - INFO - ENVÍO DE EMAILS A RESPONSABLES
2026-02-03 17:56:15 - INFO - ============================================================
2026-02-03 17:56:15 - DEBUG - [DEBUG] SMTP configurado: {'servidor': 'smtp.serviciodecorreo.es', 'puerto': 465, 'usar_ssl': True, 'usar_tls': False}
2026-02-03 17:56:15 - DEBUG - [DEBUG] Remitente: {'email': 'ivan.delgado@viveverde.es', 'nombre': 'Sistema de Pedidos VIVEVERDE'}
2026-02-03 17:56:15 - DEBUG - [DEBUG] Destinatarios: {'maf': 'ivan.delgado@viveverde.es', 'interior': 'ivan.delgado@viveverde.es', 'mascotas_vivo': 'ivan.delgado@viveverde.es', 'mascotas_manufacturado': 'ivan.delgado@viveverde.es', 'deco_interior': ['ivan.delgado@viveverde.es', 'ivan.delgado@viveverde.es'], 'deco_exterior': 'ivan.delgado@viveverde.es', 'tierras_aridos': 'ivan.delgado@viveverde.es', 'fitos': 'ivan.delgado@viveverde.es', 'semillas': 'ivan.delgado@viveverde.es', 'utiles_jardin': 'ivan.delgado@viveverde.es', 'vivero': 'ivan.delgado@viveverde.es'}
2026-02-03 17:56:15 - INFO - EmailService inicializado correctamente
2026-02-03 17:56:15 - INFO - 
Enviando email para sección: maf
2026-02-03 17:56:15 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_maf.xlsx']
2026-02-03 17:56:15 - INFO - ============================================================
2026-02-03 17:56:15 - INFO - ENVIANDO EMAIL PARA SECCIÓN: MAF
2026-02-03 17:56:15 - INFO - ============================================================
2026-02-03 17:56:15 - DEBUG - [DEBUG] Destinatarios para maf: [{'email': 'ivan.delgado@viveverde.es', 'nombre': 'Encargado'}]
2026-02-03 17:56:15 - INFO - Destinatarios: ['ivan.delgado@viveverde.es']
2026-02-03 17:56:15 - INFO - Archivos a enviar: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_maf.xlsx']
2026-02-03 17:56:15 - WARNING - Archivo no encontrado para adjuntar: .\./data/output\Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 17:56:16 - INFO - Email enviado exitosamente a: ivan.delgado@viveverde.es
2026-02-03 17:56:16 - INFO - ✓ Email enviado exitosamente para maf
2026-02-03 17:56:16 - INFO - ✓ Email enviado exitosamente a maf
2026-02-03 17:56:16 - INFO - 
Enviando email para sección: interior
2026-02-03 17:56:16 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_deco_interior.xlsx', '.\\./data/output\\Pedido_Semana_14_2026-02-03_interior.xlsx']
2026-02-03 17:56:16 - INFO - ============================================================
2026-02-03 17:56:16 - INFO - ENVIANDO EMAIL PARA SECCIÓN: INTERIOR
2026-02-03 17:56:16 - INFO - ============================================================
2026-02-03 17:56:16 - DEBUG - [DEBUG] Destinatarios para interior: [{'email': 'ivan.delgado@viveverde.es', 'nombre': 'Encargado'}]
2026-02-03 17:56:16 - INFO - Destinatarios: ['ivan.delgado@viveverde.es']
2026-02-03 17:56:16 - INFO - Archivos a enviar: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_deco_interior.xlsx', '.\\./data/output\\Pedido_Semana_14_2026-02-03_interior.xlsx']
2026-02-03 17:56:16 - INFO - Archivo adjuntado: Pedido_Semana_14_2026-02-03_deco_interior.xlsx
2026-02-03 17:56:16 - INFO - Archivo adjuntado: Pedido_Semana_14_2026-02-03_interior.xlsx
2026-02-03 17:56:16 - INFO - Email enviado exitosamente a: ivan.delgado@viveverde.es
2026-02-03 17:56:16 - INFO - ✓ Email enviado exitosamente para interior
2026-02-03 17:56:16 - INFO - ✓ Email enviado exitosamente a interior
2026-02-03 17:56:16 - INFO - 
Enviando email para sección: semillas
2026-02-03 17:56:16 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_semillas.xlsx']
2026-02-03 17:56:16 - INFO - ============================================================
2026-02-03 17:56:16 - INFO - ENVIANDO EMAIL PARA SECCIÓN: SEMILLAS
2026-02-03 17:56:16 - INFO - ============================================================
2026-02-03 17:56:16 - DEBUG - [DEBUG] Destinatarios para semillas: [{'email': 'ivan.delgado@viveverde.es', 'nombre': 'Encargado'}]
2026-02-03 17:56:16 - INFO - Destinatarios: ['ivan.delgado@viveverde.es']
2026-02-03 17:56:16 - INFO - Archivos a enviar: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_semillas.xlsx']
2026-02-03 17:56:16 - INFO - Archivo adjuntado: Pedido_Semana_14_2026-02-03_semillas.xlsx
2026-02-03 17:56:16 - INFO - Email enviado exitosamente a: ivan.delgado@viveverde.es
2026-02-03 17:56:16 - INFO - ✓ Email enviado exitosamente para semillas
2026-02-03 17:56:16 - INFO - ✓ Email enviado exitosamente a semillas
2026-02-03 17:56:16 - INFO - 
Enviando email para sección: vivo
2026-02-03 17:56:16 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx']
2026-02-03 17:56:16 - INFO - ============================================================
2026-02-03 17:56:16 - INFO - ENVIANDO EMAIL PARA SECCIÓN: VIVO
2026-02-03 17:56:16 - INFO - ============================================================
2026-02-03 17:56:16 - DEBUG - [DEBUG] Destinatarios para vivo: []
2026-02-03 17:56:16 - WARNING - No hay destinatarios configurados para la sección: vivo
2026-02-03 17:56:16 - ERROR - ✗ Error al enviar email a vivo: sin_destinatarios
2026-02-03 17:56:16 - INFO - 
Enviando email para sección: manufacturado
2026-02-03 17:56:16 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx']
2026-02-03 17:56:16 - INFO - ============================================================
2026-02-03 17:56:16 - INFO - ENVIANDO EMAIL PARA SECCIÓN: MANUFACTURADO
2026-02-03 17:56:16 - INFO - ============================================================
2026-02-03 17:56:16 - DEBUG - [DEBUG] Destinatarios para manufacturado: []
2026-02-03 17:56:16 - WARNING - No hay destinatarios configurados para la sección: manufacturado
2026-02-03 17:56:16 - ERROR - ✗ Error al enviar email a manufacturado: sin_destinatarios
2026-02-03 17:56:16 - INFO - 
Enviando email para sección: fitos
2026-02-03 17:56:16 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_fitos.xlsx']
2026-02-03 17:56:16 - INFO - ============================================================
2026-02-03 17:56:16 - INFO - ENVIANDO EMAIL PARA SECCIÓN: FITOS
2026-02-03 17:56:16 - INFO - ============================================================
2026-02-03 17:56:16 - DEBUG - [DEBUG] Destinatarios para fitos: [{'email': 'ivan.delgado@viveverde.es', 'nombre': 'Encargado'}]
2026-02-03 17:56:16 - INFO - Destinatarios: ['ivan.delgado@viveverde.es']
2026-02-03 17:56:16 - INFO - Archivos a enviar: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_fitos.xlsx']
2026-02-03 17:56:16 - INFO - Archivo adjuntado: Pedido_Semana_14_2026-02-03_fitos.xlsx
2026-02-03 17:56:17 - INFO - Email enviado exitosamente a: ivan.delgado@viveverde.es
2026-02-03 17:56:17 - INFO - ✓ Email enviado exitosamente para fitos
2026-02-03 17:56:17 - INFO - ✓ Email enviado exitosamente a fitos
2026-02-03 17:56:17 - INFO - 
Enviando email para sección: vivero
2026-02-03 17:56:17 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_vivero.xlsx']
2026-02-03 17:56:17 - INFO - ============================================================
2026-02-03 17:56:17 - INFO - ENVIANDO EMAIL PARA SECCIÓN: VIVERO
2026-02-03 17:56:17 - INFO - ============================================================
2026-02-03 17:56:17 - DEBUG - [DEBUG] Destinatarios para vivero: [{'email': 'ivan.delgado@viveverde.es', 'nombre': 'Encargado'}]
2026-02-03 17:56:17 - INFO - Destinatarios: ['ivan.delgado@viveverde.es']
2026-02-03 17:56:17 - INFO - Archivos a enviar: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_vivero.xlsx']
2026-02-03 17:56:17 - INFO - Archivo adjuntado: Pedido_Semana_14_2026-02-03_vivero.xlsx
2026-02-03 17:56:17 - INFO - Email enviado exitosamente a: ivan.delgado@viveverde.es
2026-02-03 17:56:17 - INFO - ✓ Email enviado exitosamente para vivero
2026-02-03 17:56:17 - INFO - ✓ Email enviado exitosamente a vivero
2026-02-03 17:56:17 - INFO - 
Enviando email para sección: jardin
2026-02-03 17:56:17 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx']
2026-02-03 17:56:17 - INFO - ============================================================
2026-02-03 17:56:17 - INFO - ENVIANDO EMAIL PARA SECCIÓN: JARDIN
2026-02-03 17:56:17 - INFO - ============================================================
2026-02-03 17:56:17 - DEBUG - [DEBUG] Destinatarios para jardin: []
2026-02-03 17:56:17 - WARNING - No hay destinatarios configurados para la sección: jardin
2026-02-03 17:56:17 - ERROR - ✗ Error al enviar email a jardin: sin_destinatarios
2026-02-03 17:56:17 - INFO - 
Enviando email para sección: aridos
2026-02-03 17:56:17 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx']
2026-02-03 17:56:17 - INFO - ============================================================
2026-02-03 17:56:17 - INFO - ENVIANDO EMAIL PARA SECCIÓN: ARIDOS
2026-02-03 17:56:17 - INFO - ============================================================
2026-02-03 17:56:17 - DEBUG - [DEBUG] Destinatarios para aridos: []
2026-02-03 17:56:17 - WARNING - No hay destinatarios configurados para la sección: aridos
2026-02-03 17:56:17 - ERROR - ✗ Error al enviar email a aridos: sin_destinatarios
2026-02-03 17:56:17 - INFO - 
Enviando email para sección: exterior
2026-02-03 17:56:17 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_deco_exterior.xlsx']
2026-02-03 17:56:17 - INFO - ============================================================
2026-02-03 17:56:17 - INFO - ENVIANDO EMAIL PARA SECCIÓN: EXTERIOR
2026-02-03 17:56:17 - INFO - ============================================================
2026-02-03 17:56:17 - DEBUG - [DEBUG] Destinatarios para exterior: []
2026-02-03 17:56:17 - WARNING - No hay destinatarios configurados para la sección: exterior
2026-02-03 17:56:17 - ERROR - ✗ Error al enviar email a exterior: sin_destinatarios
2026-02-03 17:56:17 - INFO - 
============================================================
2026-02-03 17:56:17 - INFO - RESUMEN DE ENVÍO DE EMAILS
2026-02-03 17:56:17 - INFO - ============================================================
2026-02-03 17:56:17 - INFO - Emails enviados exitosamente: 5
2026-02-03 17:56:17 - INFO - Emails fallidos: 5
2026-02-03 17:56:17 - INFO - Secciones procesadas: 10
2026-02-03 17:56:17 - INFO - 
======================================================================
2026-02-03 17:56:17 - INFO - RESUMEN DE EJECUCION
2026-02-03 17:56:17 - INFO - ======================================================================
2026-02-03 17:56:17 - INFO - Semana procesada: 14
2026-02-03 17:56:17 - INFO - Archivos generados: 12
2026-02-03 17:56:17 - INFO - Total articulos: 1510
2026-02-03 17:56:17 - INFO - Total importe: 48113.87€
2026-02-03 17:56:17 - INFO - 
✓ EMAILS ENVIADOS: 5
2026-02-03 17:56:17 - INFO - ======================================================================
2026-02-03 17:56:17 - INFO - 
¡PEDIDO GENERADO EXITOSAMENTE!
2026-02-03 17:56:17 - INFO - Archivo principal: .\./data/output\Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 17:56:17 - INFO - Artículos: 1510
2026-02-03 17:56:17 - INFO - Importe: 48113.87€
2026-02-03 17:56:17 - INFO - 
Emails enviados: 5
2026-02-03 18:23:09 - INFO - ======================================================================
2026-02-03 18:23:09 - INFO - SISTEMA DE PEDIDOS DE COMPRA - VIVERO ARANJUEZ V2
2026-02-03 18:23:09 - INFO - Fecha de ejecución: 2026-02-03 18:23:09
2026-02-03 18:23:09 - INFO - ======================================================================
2026-02-03 18:23:09 - INFO - Modo de ejecución: FASE 1 + FASE 2
2026-02-03 18:23:09 - INFO - Envío de emails: Sí
2026-02-03 18:23:09 - INFO - StateManager inicializado. Archivo de estado: .\./data\state.json
2026-02-03 18:23:09 - INFO - Cargando estado desde: .\./data\state.json
2026-02-03 18:23:09 - INFO - Estado cargado correctamente
2026-02-03 18:23:09 - INFO - SchedulerService inicializado correctamente
2026-02-03 18:23:09 - INFO - Horario configurado: sunday a las 15:00
2026-02-03 18:23:09 - INFO - Semana forzada por argumento: 14
2026-02-03 18:23:09 - INFO - ======================================================================
2026-02-03 18:23:09 - INFO - PROCESANDO PEDIDO PARA SEMANA 14
2026-02-03 18:23:09 - INFO - ======================================================================
2026-02-03 18:23:09 - INFO - MODO: FASE 1 (Forecast) + FASE 2 (Corrección)
2026-02-03 18:23:09 - INFO - DataLoader inicializado correctamente
2026-02-03 18:23:09 - INFO - ForecastEngine inicializado correctamente
2026-02-03 18:23:09 - INFO - OrderGenerator inicializado correctamente
2026-02-03 18:23:09 - INFO - SchedulerService inicializado correctamente
2026-02-03 18:23:09 - INFO - Horario configurado: sunday a las 15:00
2026-02-03 18:23:09 - INFO - Período de la semana: 2026-03-30 al 2026-04-05
2026-02-03 18:23:09 - INFO - Stock acumulado cargado: 2633 artículos
2026-02-03 18:23:09 - INFO - 
==================================================
2026-02-03 18:23:09 - INFO - SECCION: MAF
2026-02-03 18:23:09 - INFO - ==================================================
2026-02-03 18:23:09 - INFO - === LEYENDO DATOS PARA SECCIÓN: MAF ===
2026-02-03 18:23:09 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 18:23:09 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: maf
2026-02-03 18:23:09 - INFO - Archivo ABC encontrado para 'maf': .\./data/input\CLASIFICACION_ABC+D_maf.xlsx
2026-02-03 18:23:09 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_maf.xlsx
2026-02-03 18:23:09 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 18:23:09 - INFO - Clasificación ABC cargada para 'maf': 499 registros
2026-02-03 18:23:09 - DEBUG - [DEBUG] ABC leído: 499 registros
2026-02-03 18:23:09 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 18:23:09 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 18:23:09 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 18:23:13 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 18:23:13 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 18:23:13 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 18:23:13 - INFO - Ventas cargadas: 44082 registros
2026-02-03 18:23:13 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 18:23:13 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 18:23:13 - DEBUG - [DEBUG] Filtrando ventas por sección: maf
2026-02-03 18:23:13 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 18:23:13 - DEBUG -   maf: 10970 registros
2026-02-03 18:23:13 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 18:23:13 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 18:23:13 - DEBUG -   interior: 3624 registros
2026-02-03 18:23:13 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 18:23:13 - DEBUG -   deco_interior: 2468 registros
2026-02-03 18:23:13 - DEBUG -   vivero: 2460 registros
2026-02-03 18:23:13 - DEBUG -   fitos: 1987 registros
2026-02-03 18:23:13 - DEBUG -   semillas: 1180 registros
2026-02-03 18:23:13 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 18:23:13 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 18:23:13 - DEBUG - [DEBUG] Tras filtrar por 'maf': 10970 registros
2026-02-03 18:23:13 - INFO - Filtrados 10970 registros de sección 'maf' de 44082 total
2026-02-03 18:23:13 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 18:23:13 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 18:23:15 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 18:23:15 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 18:23:15 - INFO - Costes cargados: 22145 registros
2026-02-03 18:23:15 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 18:23:15 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 18:23:15 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MAF ===
2026-02-03 18:23:15 - INFO -   ABC: 499 registros
2026-02-03 18:23:15 - INFO -   Ventas: 10970 registros
2026-02-03 18:23:15 - INFO -   Costes: 22145 registros
2026-02-03 18:23:15 - DEBUG - [DEBUG] abc_df: 499 registros
2026-02-03 18:23:15 - DEBUG - [DEBUG] ventas_df: 10970 registros
2026-02-03 18:23:15 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 18:23:15 - INFO - Datos de ventas: 1011 registros
2026-02-03 18:23:15 - INFO - Calculando pedido para semana 14 (1011 registros)
2026-02-03 18:23:16 - INFO -   Objetivo: 7050.65€, Actual (ABC): 5843.77€
2026-02-03 18:23:16 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 18:23:16 - INFO -   Factor total: 1.3125
2026-02-03 18:23:16 - INFO -   Factor escalado: 1.5836
2026-02-03 18:23:16 - INFO -   Ventas preliminares (con ceil): 9931.01€
2026-02-03 18:23:16 - INFO -   Objetivo final: 9253.98€
2026-02-03 18:23:16 - INFO -   Delta: 677.03€
2026-02-03 18:23:16 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 18:23:16 - DEBUG -   Total registros: 222
2026-02-03 18:23:16 - DEBUG -   Registros con Unidades_Finales > 0: 191
2026-02-03 18:23:16 - DEBUG -   Ventas finales: 9259.59€
2026-02-03 18:23:16 - INFO -   Ventas finales: 9259.59€
2026-02-03 18:23:16 - INFO - 
============================================================
2026-02-03 18:23:16 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 18:23:16 - INFO - ============================================================
2026-02-03 18:23:16 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 18:23:16 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 18:23:16 - INFO - DataLoader inicializado correctamente
2026-02-03 18:23:16 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 18:23:16 - INFO - ============================================================
2026-02-03 18:23:16 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 18:23:16 - INFO - ============================================================
2026-02-03 18:23:16 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 18:23:16 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 18:23:16 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 18:23:16 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 18:23:16 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 18:23:16 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 18:23:16 - DEBUG - Usando hoja: Stock
2026-02-03 18:23:16 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 18:23:16 - INFO - Stock actual cargado: 30 registros
2026-02-03 18:23:16 - INFO -   Stock: 30 registros
2026-02-03 18:23:16 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 18:23:16 - INFO - Fusión completada: 222 registros
2026-02-03 18:23:16 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 18:23:16 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 18:23:16 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 18:23:16 - INFO - Corrección completada:
2026-02-03 18:23:16 - INFO -   - Artículos corregidos: 191/222
2026-02-03 18:23:16 - INFO -   - Artículos aumentados: 191
2026-02-03 18:23:16 - INFO -   - Artículos reducidos: 0
2026-02-03 18:23:16 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 18:23:16 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 18:23:16 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 18:23:16 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 222 registros
2026-02-03 18:23:16 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 18:23:16 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 18:23:16 - DEBUG -   Con valor 0: 31
2026-02-03 18:23:16 - DEBUG -   Con valor > 0: 191
2026-02-03 18:23:16 - DEBUG -   Suma Ventas_Objetivo: 9259.59€
2026-02-03 18:23:16 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 191 registros
2026-02-03 18:23:16 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 18:23:16 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 18:23:16 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 18:23:16 - INFO -   Articulos: 191
2026-02-03 18:23:16 - INFO -   Importe: 9259.59€
2026-02-03 18:23:16 - INFO - 
==================================================
2026-02-03 18:23:16 - INFO - SECCION: DECO_INTERIOR
2026-02-03 18:23:16 - INFO - ==================================================
2026-02-03 18:23:16 - INFO - === LEYENDO DATOS PARA SECCIÓN: DECO_INTERIOR ===
2026-02-03 18:23:16 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 18:23:16 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: deco_interior
2026-02-03 18:23:16 - INFO - Archivo ABC encontrado para 'deco_interior': .\./data/input\CLASIFICACION_ABC+D_deco_interior.xlsx
2026-02-03 18:23:16 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_deco_interior.xlsx
2026-02-03 18:23:17 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 18:23:17 - INFO - Clasificación ABC cargada para 'deco_interior': 1827 registros
2026-02-03 18:23:17 - DEBUG - [DEBUG] ABC leído: 1827 registros
2026-02-03 18:23:17 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 18:23:17 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 18:23:17 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 18:23:21 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 18:23:21 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 18:23:21 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 18:23:21 - INFO - Ventas cargadas: 44082 registros
2026-02-03 18:23:21 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 18:23:21 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 18:23:21 - DEBUG - [DEBUG] Filtrando ventas por sección: deco_interior
2026-02-03 18:23:21 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 18:23:21 - DEBUG -   maf: 10970 registros
2026-02-03 18:23:21 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 18:23:21 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 18:23:21 - DEBUG -   interior: 3624 registros
2026-02-03 18:23:21 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 18:23:21 - DEBUG -   deco_interior: 2468 registros
2026-02-03 18:23:21 - DEBUG -   vivero: 2460 registros
2026-02-03 18:23:21 - DEBUG -   fitos: 1987 registros
2026-02-03 18:23:21 - DEBUG -   semillas: 1180 registros
2026-02-03 18:23:21 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 18:23:21 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 18:23:21 - DEBUG - [DEBUG] Tras filtrar por 'deco_interior': 2468 registros
2026-02-03 18:23:21 - INFO - Filtrados 2468 registros de sección 'deco_interior' de 44082 total
2026-02-03 18:23:21 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 18:23:21 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 18:23:23 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 18:23:23 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 18:23:23 - INFO - Costes cargados: 22145 registros
2026-02-03 18:23:23 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 18:23:23 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 18:23:23 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA DECO_INTERIOR ===
2026-02-03 18:23:23 - INFO -   ABC: 1827 registros
2026-02-03 18:23:23 - INFO -   Ventas: 2468 registros
2026-02-03 18:23:23 - INFO -   Costes: 22145 registros
2026-02-03 18:23:23 - DEBUG - [DEBUG] abc_df: 1827 registros
2026-02-03 18:23:23 - DEBUG - [DEBUG] ventas_df: 2468 registros
2026-02-03 18:23:23 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 18:23:23 - INFO - Datos de ventas: 180 registros
2026-02-03 18:23:23 - INFO - Calculando pedido para semana 14 (180 registros)
2026-02-03 18:23:24 - INFO -   Objetivo: 1962.99€, Actual (ABC): 1636.15€
2026-02-03 18:23:24 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 18:23:24 - INFO -   Factor total: 1.3125
2026-02-03 18:23:24 - INFO -   Factor escalado: 1.5747
2026-02-03 18:23:24 - INFO -   Ventas preliminares (con ceil): 2950.01€
2026-02-03 18:23:24 - INFO -   Objetivo final: 2576.42€
2026-02-03 18:23:24 - INFO -   Delta: 373.59€
2026-02-03 18:23:24 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 18:23:24 - DEBUG -   Total registros: 139
2026-02-03 18:23:24 - DEBUG -   Registros con Unidades_Finales > 0: 135
2026-02-03 18:23:24 - DEBUG -   Ventas finales: 2580.73€
2026-02-03 18:23:24 - INFO -   Ventas finales: 2580.73€
2026-02-03 18:23:24 - INFO - 
============================================================
2026-02-03 18:23:24 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 18:23:24 - INFO - ============================================================
2026-02-03 18:23:24 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 18:23:24 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 18:23:24 - INFO - DataLoader inicializado correctamente
2026-02-03 18:23:24 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 18:23:24 - INFO - ============================================================
2026-02-03 18:23:24 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 18:23:24 - INFO - ============================================================
2026-02-03 18:23:24 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 18:23:24 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 18:23:24 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 18:23:24 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 18:23:24 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 18:23:24 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 18:23:24 - DEBUG - Usando hoja: Stock
2026-02-03 18:23:24 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 18:23:24 - INFO - Stock actual cargado: 30 registros
2026-02-03 18:23:24 - INFO -   Stock: 30 registros
2026-02-03 18:23:24 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 18:23:24 - INFO - Fusión completada: 139 registros
2026-02-03 18:23:24 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 18:23:24 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 18:23:24 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 18:23:24 - INFO - Corrección completada:
2026-02-03 18:23:24 - INFO -   - Artículos corregidos: 135/139
2026-02-03 18:23:24 - INFO -   - Artículos aumentados: 135
2026-02-03 18:23:24 - INFO -   - Artículos reducidos: 0
2026-02-03 18:23:24 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 18:23:24 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 18:23:24 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 18:23:24 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 139 registros
2026-02-03 18:23:24 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 18:23:24 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 18:23:24 - DEBUG -   Con valor 0: 4
2026-02-03 18:23:24 - DEBUG -   Con valor > 0: 135
2026-02-03 18:23:24 - DEBUG -   Suma Ventas_Objetivo: 2580.73€
2026-02-03 18:23:24 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 135 registros
2026-02-03 18:23:24 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_deco_interior.xlsx
2026-02-03 18:23:24 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_deco_interior.xlsx
2026-02-03 18:23:24 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_deco_interior.xlsx
2026-02-03 18:23:24 - INFO -   Articulos: 135
2026-02-03 18:23:24 - INFO -   Importe: 2580.73€
2026-02-03 18:23:24 - INFO - 
==================================================
2026-02-03 18:23:24 - INFO - SECCION: SEMILLAS
2026-02-03 18:23:24 - INFO - ==================================================
2026-02-03 18:23:24 - INFO - === LEYENDO DATOS PARA SECCIÓN: SEMILLAS ===
2026-02-03 18:23:24 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 18:23:24 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: semillas
2026-02-03 18:23:24 - INFO - Archivo ABC encontrado para 'semillas': .\./data/input\CLASIFICACION_ABC+D_semillas.xlsx
2026-02-03 18:23:24 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_semillas.xlsx
2026-02-03 18:23:24 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 18:23:24 - INFO - Clasificación ABC cargada para 'semillas': 218 registros
2026-02-03 18:23:24 - DEBUG - [DEBUG] ABC leído: 218 registros
2026-02-03 18:23:24 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 18:23:24 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 18:23:24 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 18:23:28 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 18:23:28 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 18:23:28 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 18:23:28 - INFO - Ventas cargadas: 44082 registros
2026-02-03 18:23:28 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 18:23:28 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 18:23:28 - DEBUG - [DEBUG] Filtrando ventas por sección: semillas
2026-02-03 18:23:28 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 18:23:28 - DEBUG -   maf: 10970 registros
2026-02-03 18:23:28 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 18:23:28 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 18:23:28 - DEBUG -   interior: 3624 registros
2026-02-03 18:23:28 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 18:23:28 - DEBUG -   deco_interior: 2468 registros
2026-02-03 18:23:28 - DEBUG -   vivero: 2460 registros
2026-02-03 18:23:28 - DEBUG -   fitos: 1987 registros
2026-02-03 18:23:28 - DEBUG -   semillas: 1180 registros
2026-02-03 18:23:28 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 18:23:28 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 18:23:28 - DEBUG - [DEBUG] Tras filtrar por 'semillas': 1180 registros
2026-02-03 18:23:28 - INFO - Filtrados 1180 registros de sección 'semillas' de 44082 total
2026-02-03 18:23:28 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 18:23:28 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 18:23:30 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 18:23:30 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 18:23:30 - INFO - Costes cargados: 22145 registros
2026-02-03 18:23:30 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 18:23:30 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 18:23:30 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA SEMILLAS ===
2026-02-03 18:23:30 - INFO -   ABC: 218 registros
2026-02-03 18:23:30 - INFO -   Ventas: 1180 registros
2026-02-03 18:23:30 - INFO -   Costes: 22145 registros
2026-02-03 18:23:30 - DEBUG - [DEBUG] abc_df: 218 registros
2026-02-03 18:23:30 - DEBUG - [DEBUG] ventas_df: 1180 registros
2026-02-03 18:23:30 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 18:23:30 - INFO - Datos de ventas: 136 registros
2026-02-03 18:23:30 - INFO - Calculando pedido para semana 14 (136 registros)
2026-02-03 18:23:30 - INFO -   Objetivo: 694.34€, Actual (ABC): 455.14€
2026-02-03 18:23:30 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 18:23:30 - INFO -   Factor total: 1.3125
2026-02-03 18:23:30 - INFO -   Factor escalado: 2.0023
2026-02-03 18:23:30 - INFO -   Ventas preliminares (con ceil): 1129.15€
2026-02-03 18:23:30 - INFO -   Objetivo final: 911.32€
2026-02-03 18:23:30 - INFO -   Delta: 217.83€
2026-02-03 18:23:30 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 18:23:30 - DEBUG -   Total registros: 84
2026-02-03 18:23:30 - DEBUG -   Registros con Unidades_Finales > 0: 84
2026-02-03 18:23:30 - DEBUG -   Ventas finales: 911.60€
2026-02-03 18:23:30 - INFO -   Ventas finales: 911.60€
2026-02-03 18:23:30 - INFO - 
============================================================
2026-02-03 18:23:30 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 18:23:30 - INFO - ============================================================
2026-02-03 18:23:30 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 18:23:30 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 18:23:30 - INFO - DataLoader inicializado correctamente
2026-02-03 18:23:30 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 18:23:30 - INFO - ============================================================
2026-02-03 18:23:30 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 18:23:30 - INFO - ============================================================
2026-02-03 18:23:30 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 18:23:30 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 18:23:30 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 18:23:30 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 18:23:30 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 18:23:30 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 18:23:30 - DEBUG - Usando hoja: Stock
2026-02-03 18:23:30 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 18:23:30 - INFO - Stock actual cargado: 30 registros
2026-02-03 18:23:30 - INFO -   Stock: 30 registros
2026-02-03 18:23:30 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 18:23:30 - INFO - Fusión completada: 84 registros
2026-02-03 18:23:30 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 18:23:30 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 18:23:30 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 18:23:30 - INFO - Corrección completada:
2026-02-03 18:23:30 - INFO -   - Artículos corregidos: 84/84
2026-02-03 18:23:30 - INFO -   - Artículos aumentados: 84
2026-02-03 18:23:30 - INFO -   - Artículos reducidos: 0
2026-02-03 18:23:30 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 18:23:30 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 18:23:30 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 18:23:30 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 84 registros
2026-02-03 18:23:30 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 18:23:30 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 18:23:30 - DEBUG -   Con valor 0: 0
2026-02-03 18:23:30 - DEBUG -   Con valor > 0: 84
2026-02-03 18:23:30 - DEBUG -   Suma Ventas_Objetivo: 911.60€
2026-02-03 18:23:30 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 84 registros
2026-02-03 18:23:30 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_semillas.xlsx
2026-02-03 18:23:30 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_semillas.xlsx
2026-02-03 18:23:30 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_semillas.xlsx
2026-02-03 18:23:30 - INFO -   Articulos: 84
2026-02-03 18:23:30 - INFO -   Importe: 911.60€
2026-02-03 18:23:30 - INFO - 
==================================================
2026-02-03 18:23:30 - INFO - SECCION: MASCOTAS_VIVO
2026-02-03 18:23:30 - INFO - ==================================================
2026-02-03 18:23:30 - INFO - === LEYENDO DATOS PARA SECCIÓN: MASCOTAS_VIVO ===
2026-02-03 18:23:30 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 18:23:30 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: mascotas_vivo
2026-02-03 18:23:30 - INFO - Archivo ABC encontrado para 'mascotas_vivo': .\./data/input\CLASIFICACION_ABC+D_mascotas_vivo.xlsx
2026-02-03 18:23:30 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_mascotas_vivo.xlsx
2026-02-03 18:23:30 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 18:23:30 - INFO - Clasificación ABC cargada para 'mascotas_vivo': 205 registros
2026-02-03 18:23:30 - DEBUG - [DEBUG] ABC leído: 205 registros
2026-02-03 18:23:30 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 18:23:30 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 18:23:30 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 18:23:34 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 18:23:34 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 18:23:34 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 18:23:34 - INFO - Ventas cargadas: 44082 registros
2026-02-03 18:23:34 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 18:23:34 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 18:23:34 - DEBUG - [DEBUG] Filtrando ventas por sección: mascotas_vivo
2026-02-03 18:23:34 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 18:23:34 - DEBUG -   maf: 10970 registros
2026-02-03 18:23:34 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 18:23:34 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 18:23:34 - DEBUG -   interior: 3624 registros
2026-02-03 18:23:34 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 18:23:34 - DEBUG -   deco_interior: 2468 registros
2026-02-03 18:23:34 - DEBUG -   vivero: 2460 registros
2026-02-03 18:23:34 - DEBUG -   fitos: 1987 registros
2026-02-03 18:23:34 - DEBUG -   semillas: 1180 registros
2026-02-03 18:23:34 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 18:23:34 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 18:23:34 - DEBUG - [DEBUG] Tras filtrar por 'mascotas_vivo': 1124 registros
2026-02-03 18:23:34 - INFO - Filtrados 1124 registros de sección 'mascotas_vivo' de 44082 total
2026-02-03 18:23:34 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 18:23:34 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 18:23:36 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 18:23:36 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 18:23:36 - INFO - Costes cargados: 22145 registros
2026-02-03 18:23:36 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 18:23:36 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 18:23:36 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MASCOTAS_VIVO ===
2026-02-03 18:23:36 - INFO -   ABC: 205 registros
2026-02-03 18:23:36 - INFO -   Ventas: 1124 registros
2026-02-03 18:23:36 - INFO -   Costes: 22145 registros
2026-02-03 18:23:36 - DEBUG - [DEBUG] abc_df: 205 registros
2026-02-03 18:23:36 - DEBUG - [DEBUG] ventas_df: 1124 registros
2026-02-03 18:23:36 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 18:23:36 - INFO - Datos de ventas: 88 registros
2026-02-03 18:23:36 - INFO - Calculando pedido para semana 14 (88 registros)
2026-02-03 18:23:37 - INFO -   Objetivo: 1087.15€, Actual (ABC): 846.63€
2026-02-03 18:23:37 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 18:23:37 - INFO -   Factor total: 1.3125
2026-02-03 18:23:37 - INFO -   Factor escalado: 1.6854
2026-02-03 18:23:37 - INFO -   Ventas preliminares (con ceil): 1773.66€
2026-02-03 18:23:37 - INFO -   Objetivo final: 1426.88€
2026-02-03 18:23:37 - INFO -   Delta: 346.78€
2026-02-03 18:23:37 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 18:23:37 - DEBUG -   Total registros: 43
2026-02-03 18:23:37 - DEBUG -   Registros con Unidades_Finales > 0: 36
2026-02-03 18:23:37 - DEBUG -   Ventas finales: 1455.34€
2026-02-03 18:23:37 - INFO -   Ventas finales: 1455.34€
2026-02-03 18:23:37 - INFO - 
============================================================
2026-02-03 18:23:37 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 18:23:37 - INFO - ============================================================
2026-02-03 18:23:37 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 18:23:37 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 18:23:37 - INFO - DataLoader inicializado correctamente
2026-02-03 18:23:37 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 18:23:37 - INFO - ============================================================
2026-02-03 18:23:37 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 18:23:37 - INFO - ============================================================
2026-02-03 18:23:37 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 18:23:37 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 18:23:37 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 18:23:37 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 18:23:37 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 18:23:37 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 18:23:37 - DEBUG - Usando hoja: Stock
2026-02-03 18:23:37 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 18:23:37 - INFO - Stock actual cargado: 30 registros
2026-02-03 18:23:37 - INFO -   Stock: 30 registros
2026-02-03 18:23:37 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 18:23:37 - INFO - Fusión completada: 43 registros
2026-02-03 18:23:37 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 18:23:37 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 18:23:37 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 18:23:37 - INFO - Corrección completada:
2026-02-03 18:23:37 - INFO -   - Artículos corregidos: 36/43
2026-02-03 18:23:37 - INFO -   - Artículos aumentados: 36
2026-02-03 18:23:37 - INFO -   - Artículos reducidos: 0
2026-02-03 18:23:37 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 18:23:37 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 18:23:37 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 18:23:37 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 43 registros
2026-02-03 18:23:37 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 18:23:37 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 18:23:37 - DEBUG -   Con valor 0: 7
2026-02-03 18:23:37 - DEBUG -   Con valor > 0: 36
2026-02-03 18:23:37 - DEBUG -   Suma Ventas_Objetivo: 1455.34€
2026-02-03 18:23:37 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 36 registros
2026-02-03 18:23:37 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx
2026-02-03 18:23:37 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx
2026-02-03 18:23:37 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx
2026-02-03 18:23:37 - INFO -   Articulos: 36
2026-02-03 18:23:37 - INFO -   Importe: 1455.34€
2026-02-03 18:23:37 - INFO - 
==================================================
2026-02-03 18:23:37 - INFO - SECCION: MASCOTAS_MANUFACTURADO
2026-02-03 18:23:37 - INFO - ==================================================
2026-02-03 18:23:37 - INFO - === LEYENDO DATOS PARA SECCIÓN: MASCOTAS_MANUFACTURADO ===
2026-02-03 18:23:37 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 18:23:37 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: mascotas_manufacturado
2026-02-03 18:23:37 - INFO - Archivo ABC encontrado para 'mascotas_manufacturado': .\./data/input\CLASIFICACION_ABC+D_mascotas_manufacturado.xlsx
2026-02-03 18:23:37 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_mascotas_manufacturado.xlsx
2026-02-03 18:23:37 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 18:23:37 - INFO - Clasificación ABC cargada para 'mascotas_manufacturado': 2749 registros
2026-02-03 18:23:37 - DEBUG - [DEBUG] ABC leído: 2749 registros
2026-02-03 18:23:37 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 18:23:37 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 18:23:37 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 18:23:41 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 18:23:41 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 18:23:41 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 18:23:41 - INFO - Ventas cargadas: 44082 registros
2026-02-03 18:23:41 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 18:23:41 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 18:23:41 - DEBUG - [DEBUG] Filtrando ventas por sección: mascotas_manufacturado
2026-02-03 18:23:41 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 18:23:41 - DEBUG -   maf: 10970 registros
2026-02-03 18:23:41 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 18:23:41 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 18:23:41 - DEBUG -   interior: 3624 registros
2026-02-03 18:23:41 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 18:23:41 - DEBUG -   deco_interior: 2468 registros
2026-02-03 18:23:41 - DEBUG -   vivero: 2460 registros
2026-02-03 18:23:41 - DEBUG -   fitos: 1987 registros
2026-02-03 18:23:41 - DEBUG -   semillas: 1180 registros
2026-02-03 18:23:41 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 18:23:41 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 18:23:41 - DEBUG - [DEBUG] Tras filtrar por 'mascotas_manufacturado': 9784 registros
2026-02-03 18:23:41 - INFO - Filtrados 9784 registros de sección 'mascotas_manufacturado' de 44082 total
2026-02-03 18:23:41 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 18:23:41 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 18:23:43 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 18:23:43 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 18:23:43 - INFO - Costes cargados: 22145 registros
2026-02-03 18:23:43 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 18:23:43 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 18:23:43 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MASCOTAS_MANUFACTURADO ===
2026-02-03 18:23:43 - INFO -   ABC: 2749 registros
2026-02-03 18:23:43 - INFO -   Ventas: 9784 registros
2026-02-03 18:23:43 - INFO -   Costes: 22145 registros
2026-02-03 18:23:43 - DEBUG - [DEBUG] abc_df: 2749 registros
2026-02-03 18:23:43 - DEBUG - [DEBUG] ventas_df: 9784 registros
2026-02-03 18:23:43 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 18:23:43 - INFO - Datos de ventas: 822 registros
2026-02-03 18:23:43 - INFO - Calculando pedido para semana 14 (822 registros)
2026-02-03 18:23:45 - INFO -   Objetivo: 6839.82€, Actual (ABC): 8742.92€
2026-02-03 18:23:45 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 18:23:45 - INFO -   Factor total: 1.3125
2026-02-03 18:23:45 - INFO -   Factor escalado: 1.0268
2026-02-03 18:23:45 - INFO -   Ventas preliminares (con ceil): 12379.25€
2026-02-03 18:23:45 - INFO -   Objetivo final: 8977.26€
2026-02-03 18:23:45 - INFO -   Delta: 3401.99€
2026-02-03 18:23:45 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 18:23:45 - DEBUG -   Total registros: 538
2026-02-03 18:23:45 - DEBUG -   Registros con Unidades_Finales > 0: 411
2026-02-03 18:23:45 - DEBUG -   Ventas finales: 8993.98€
2026-02-03 18:23:45 - INFO -   Ventas finales: 8993.98€
2026-02-03 18:23:45 - INFO - 
============================================================
2026-02-03 18:23:45 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 18:23:45 - INFO - ============================================================
2026-02-03 18:23:45 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 18:23:45 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 18:23:45 - INFO - DataLoader inicializado correctamente
2026-02-03 18:23:45 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 18:23:45 - INFO - ============================================================
2026-02-03 18:23:45 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 18:23:45 - INFO - ============================================================
2026-02-03 18:23:45 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 18:23:45 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 18:23:45 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 18:23:45 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 18:23:45 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 18:23:45 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 18:23:45 - DEBUG - Usando hoja: Stock
2026-02-03 18:23:45 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 18:23:45 - INFO - Stock actual cargado: 30 registros
2026-02-03 18:23:45 - INFO -   Stock: 30 registros
2026-02-03 18:23:45 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 18:23:45 - INFO - Fusión completada: 538 registros
2026-02-03 18:23:45 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 18:23:45 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 18:23:45 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 18:23:45 - INFO - Corrección completada:
2026-02-03 18:23:45 - INFO -   - Artículos corregidos: 411/538
2026-02-03 18:23:45 - INFO -   - Artículos aumentados: 411
2026-02-03 18:23:45 - INFO -   - Artículos reducidos: 0
2026-02-03 18:23:45 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 18:23:45 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 18:23:45 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 18:23:45 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 538 registros
2026-02-03 18:23:45 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 18:23:45 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 18:23:45 - DEBUG -   Con valor 0: 127
2026-02-03 18:23:45 - DEBUG -   Con valor > 0: 411
2026-02-03 18:23:45 - DEBUG -   Suma Ventas_Objetivo: 8993.98€
2026-02-03 18:23:45 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 411 registros
2026-02-03 18:23:45 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx
2026-02-03 18:23:45 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx
2026-02-03 18:23:45 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx
2026-02-03 18:23:45 - INFO -   Articulos: 411
2026-02-03 18:23:45 - INFO -   Importe: 8993.98€
2026-02-03 18:23:45 - INFO - 
==================================================
2026-02-03 18:23:45 - INFO - SECCION: INTERIOR
2026-02-03 18:23:45 - INFO - ==================================================
2026-02-03 18:23:45 - INFO - === LEYENDO DATOS PARA SECCIÓN: INTERIOR ===
2026-02-03 18:23:45 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 18:23:45 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: interior
2026-02-03 18:23:45 - INFO - Archivo ABC encontrado para 'interior': .\./data/input\CLASIFICACION_ABC+D_interior.xlsx
2026-02-03 18:23:45 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_interior.xlsx
2026-02-03 18:23:45 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 18:23:45 - INFO - Clasificación ABC cargada para 'interior': 555 registros
2026-02-03 18:23:45 - DEBUG - [DEBUG] ABC leído: 555 registros
2026-02-03 18:23:45 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 18:23:45 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 18:23:45 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 18:23:49 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 18:23:49 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 18:23:49 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 18:23:49 - INFO - Ventas cargadas: 44082 registros
2026-02-03 18:23:49 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 18:23:49 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 18:23:49 - DEBUG - [DEBUG] Filtrando ventas por sección: interior
2026-02-03 18:23:49 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 18:23:49 - DEBUG -   maf: 10970 registros
2026-02-03 18:23:49 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 18:23:49 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 18:23:49 - DEBUG -   interior: 3624 registros
2026-02-03 18:23:49 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 18:23:49 - DEBUG -   deco_interior: 2468 registros
2026-02-03 18:23:49 - DEBUG -   vivero: 2460 registros
2026-02-03 18:23:49 - DEBUG -   fitos: 1987 registros
2026-02-03 18:23:49 - DEBUG -   semillas: 1180 registros
2026-02-03 18:23:49 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 18:23:49 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 18:23:49 - DEBUG - [DEBUG] Tras filtrar por 'interior': 3624 registros
2026-02-03 18:23:49 - INFO - Filtrados 3624 registros de sección 'interior' de 44082 total
2026-02-03 18:23:49 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 18:23:49 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 18:23:51 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 18:23:51 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 18:23:51 - INFO - Costes cargados: 22145 registros
2026-02-03 18:23:51 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 18:23:51 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 18:23:51 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA INTERIOR ===
2026-02-03 18:23:51 - INFO -   ABC: 555 registros
2026-02-03 18:23:51 - INFO -   Ventas: 3624 registros
2026-02-03 18:23:51 - INFO -   Costes: 22145 registros
2026-02-03 18:23:51 - DEBUG - [DEBUG] abc_df: 555 registros
2026-02-03 18:23:51 - DEBUG - [DEBUG] ventas_df: 3624 registros
2026-02-03 18:23:51 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 18:23:51 - INFO - Datos de ventas: 286 registros
2026-02-03 18:23:51 - INFO - Calculando pedido para semana 14 (286 registros)
2026-02-03 18:23:52 - INFO -   Objetivo: 2930.63€, Actual (ABC): 2409.44€
2026-02-03 18:23:52 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 18:23:52 - INFO -   Factor total: 1.3125
2026-02-03 18:23:52 - INFO -   Factor escalado: 1.5964
2026-02-03 18:23:52 - INFO -   Ventas preliminares (con ceil): 4541.81€
2026-02-03 18:23:52 - INFO -   Objetivo final: 3846.45€
2026-02-03 18:23:52 - INFO -   Delta: 695.36€
2026-02-03 18:23:52 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 18:23:52 - DEBUG -   Total registros: 138
2026-02-03 18:23:52 - DEBUG -   Registros con Unidades_Finales > 0: 121
2026-02-03 18:23:52 - DEBUG -   Ventas finales: 3855.17€
2026-02-03 18:23:52 - INFO -   Ventas finales: 3855.17€
2026-02-03 18:23:52 - INFO - 
============================================================
2026-02-03 18:23:52 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 18:23:52 - INFO - ============================================================
2026-02-03 18:23:52 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 18:23:52 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 18:23:52 - INFO - DataLoader inicializado correctamente
2026-02-03 18:23:52 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 18:23:52 - INFO - ============================================================
2026-02-03 18:23:52 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 18:23:52 - INFO - ============================================================
2026-02-03 18:23:52 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 18:23:52 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 18:23:52 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 18:23:52 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 18:23:52 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 18:23:52 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 18:23:52 - DEBUG - Usando hoja: Stock
2026-02-03 18:23:52 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 18:23:52 - INFO - Stock actual cargado: 30 registros
2026-02-03 18:23:52 - INFO -   Stock: 30 registros
2026-02-03 18:23:52 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 18:23:52 - INFO - Fusión completada: 138 registros
2026-02-03 18:23:52 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 18:23:52 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 18:23:52 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 18:23:52 - INFO - Corrección completada:
2026-02-03 18:23:52 - INFO -   - Artículos corregidos: 121/138
2026-02-03 18:23:52 - INFO -   - Artículos aumentados: 121
2026-02-03 18:23:52 - INFO -   - Artículos reducidos: 0
2026-02-03 18:23:52 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 18:23:52 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 18:23:52 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 18:23:52 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 138 registros
2026-02-03 18:23:52 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 18:23:52 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 18:23:52 - DEBUG -   Con valor 0: 17
2026-02-03 18:23:52 - DEBUG -   Con valor > 0: 121
2026-02-03 18:23:52 - DEBUG -   Suma Ventas_Objetivo: 3855.17€
2026-02-03 18:23:52 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 121 registros
2026-02-03 18:23:52 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_interior.xlsx
2026-02-03 18:23:52 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_interior.xlsx
2026-02-03 18:23:52 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_interior.xlsx
2026-02-03 18:23:52 - INFO -   Articulos: 121
2026-02-03 18:23:52 - INFO -   Importe: 3855.17€
2026-02-03 18:23:52 - INFO - 
==================================================
2026-02-03 18:23:52 - INFO - SECCION: FITOS
2026-02-03 18:23:52 - INFO - ==================================================
2026-02-03 18:23:52 - INFO - === LEYENDO DATOS PARA SECCIÓN: FITOS ===
2026-02-03 18:23:52 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 18:23:52 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: fitos
2026-02-03 18:23:52 - INFO - Archivo ABC encontrado para 'fitos': .\./data/input\CLASIFICACION_ABC+D_fitos.xlsx
2026-02-03 18:23:52 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_fitos.xlsx
2026-02-03 18:23:52 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 18:23:52 - INFO - Clasificación ABC cargada para 'fitos': 247 registros
2026-02-03 18:23:52 - DEBUG - [DEBUG] ABC leído: 247 registros
2026-02-03 18:23:52 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 18:23:52 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 18:23:52 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 18:23:56 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 18:23:56 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 18:23:56 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 18:23:56 - INFO - Ventas cargadas: 44082 registros
2026-02-03 18:23:56 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 18:23:56 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 18:23:56 - DEBUG - [DEBUG] Filtrando ventas por sección: fitos
2026-02-03 18:23:56 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 18:23:56 - DEBUG -   maf: 10970 registros
2026-02-03 18:23:56 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 18:23:56 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 18:23:56 - DEBUG -   interior: 3624 registros
2026-02-03 18:23:56 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 18:23:56 - DEBUG -   deco_interior: 2468 registros
2026-02-03 18:23:56 - DEBUG -   vivero: 2460 registros
2026-02-03 18:23:56 - DEBUG -   fitos: 1987 registros
2026-02-03 18:23:56 - DEBUG -   semillas: 1180 registros
2026-02-03 18:23:56 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 18:23:56 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 18:23:56 - DEBUG - [DEBUG] Tras filtrar por 'fitos': 1987 registros
2026-02-03 18:23:56 - INFO - Filtrados 1987 registros de sección 'fitos' de 44082 total
2026-02-03 18:23:56 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 18:23:56 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 18:23:58 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 18:23:58 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 18:23:58 - INFO - Costes cargados: 22145 registros
2026-02-03 18:23:58 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 18:23:58 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 18:23:58 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA FITOS ===
2026-02-03 18:23:58 - INFO -   ABC: 247 registros
2026-02-03 18:23:58 - INFO -   Ventas: 1987 registros
2026-02-03 18:23:58 - INFO -   Costes: 22145 registros
2026-02-03 18:23:58 - DEBUG - [DEBUG] abc_df: 247 registros
2026-02-03 18:23:58 - DEBUG - [DEBUG] ventas_df: 1987 registros
2026-02-03 18:23:58 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 18:23:58 - INFO - Datos de ventas: 157 registros
2026-02-03 18:23:58 - INFO - Calculando pedido para semana 14 (157 registros)
2026-02-03 18:23:58 - INFO -   Objetivo: 1798.25€, Actual (ABC): 1679.26€
2026-02-03 18:23:58 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 18:23:58 - INFO -   Factor total: 1.3125
2026-02-03 18:23:58 - INFO -   Factor escalado: 1.4055
2026-02-03 18:23:58 - INFO -   Ventas preliminares (con ceil): 2784.94€
2026-02-03 18:23:58 - INFO -   Objetivo final: 2360.20€
2026-02-03 18:23:58 - INFO -   Delta: 424.74€
2026-02-03 18:23:58 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 18:23:58 - DEBUG -   Total registros: 84
2026-02-03 18:23:58 - DEBUG -   Registros con Unidades_Finales > 0: 82
2026-02-03 18:23:58 - DEBUG -   Ventas finales: 2365.92€
2026-02-03 18:23:58 - INFO -   Ventas finales: 2365.92€
2026-02-03 18:23:58 - INFO - 
============================================================
2026-02-03 18:23:58 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 18:23:58 - INFO - ============================================================
2026-02-03 18:23:58 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 18:23:58 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 18:23:58 - INFO - DataLoader inicializado correctamente
2026-02-03 18:23:58 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 18:23:58 - INFO - ============================================================
2026-02-03 18:23:58 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 18:23:58 - INFO - ============================================================
2026-02-03 18:23:58 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 18:23:58 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 18:23:58 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 18:23:58 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 18:23:58 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 18:23:58 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 18:23:58 - DEBUG - Usando hoja: Stock
2026-02-03 18:23:58 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 18:23:58 - INFO - Stock actual cargado: 30 registros
2026-02-03 18:23:58 - INFO -   Stock: 30 registros
2026-02-03 18:23:58 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 18:23:58 - INFO - Fusión completada: 84 registros
2026-02-03 18:23:58 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 18:23:58 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 18:23:58 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 18:23:58 - INFO - Corrección completada:
2026-02-03 18:23:58 - INFO -   - Artículos corregidos: 82/84
2026-02-03 18:23:58 - INFO -   - Artículos aumentados: 82
2026-02-03 18:23:58 - INFO -   - Artículos reducidos: 0
2026-02-03 18:23:58 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 18:23:58 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 18:23:58 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 18:23:58 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 84 registros
2026-02-03 18:23:58 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 18:23:58 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 18:23:58 - DEBUG -   Con valor 0: 2
2026-02-03 18:23:58 - DEBUG -   Con valor > 0: 82
2026-02-03 18:23:58 - DEBUG -   Suma Ventas_Objetivo: 2365.92€
2026-02-03 18:23:58 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 82 registros
2026-02-03 18:23:58 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_fitos.xlsx
2026-02-03 18:23:58 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_fitos.xlsx
2026-02-03 18:23:58 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_fitos.xlsx
2026-02-03 18:23:58 - INFO -   Articulos: 82
2026-02-03 18:23:58 - INFO -   Importe: 2365.92€
2026-02-03 18:23:58 - INFO - 
==================================================
2026-02-03 18:23:58 - INFO - SECCION: VIVERO
2026-02-03 18:23:58 - INFO - ==================================================
2026-02-03 18:23:58 - INFO - === LEYENDO DATOS PARA SECCIÓN: VIVERO ===
2026-02-03 18:23:58 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 18:23:58 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: vivero
2026-02-03 18:23:58 - INFO - Archivo ABC encontrado para 'vivero': .\./data/input\CLASIFICACION_ABC+D_vivero.xlsx
2026-02-03 18:23:58 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_vivero.xlsx
2026-02-03 18:23:58 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 18:23:58 - INFO - Clasificación ABC cargada para 'vivero': 565 registros
2026-02-03 18:23:58 - DEBUG - [DEBUG] ABC leído: 565 registros
2026-02-03 18:23:58 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 18:23:58 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 18:23:58 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 18:24:02 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 18:24:02 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 18:24:02 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 18:24:02 - INFO - Ventas cargadas: 44082 registros
2026-02-03 18:24:02 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 18:24:02 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 18:24:02 - DEBUG - [DEBUG] Filtrando ventas por sección: vivero
2026-02-03 18:24:02 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 18:24:02 - DEBUG -   maf: 10970 registros
2026-02-03 18:24:02 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 18:24:02 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 18:24:02 - DEBUG -   interior: 3624 registros
2026-02-03 18:24:02 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 18:24:02 - DEBUG -   deco_interior: 2468 registros
2026-02-03 18:24:02 - DEBUG -   vivero: 2460 registros
2026-02-03 18:24:02 - DEBUG -   fitos: 1987 registros
2026-02-03 18:24:02 - DEBUG -   semillas: 1180 registros
2026-02-03 18:24:02 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 18:24:02 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 18:24:02 - DEBUG - [DEBUG] Tras filtrar por 'vivero': 2460 registros
2026-02-03 18:24:02 - INFO - Filtrados 2460 registros de sección 'vivero' de 44082 total
2026-02-03 18:24:02 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 18:24:02 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 18:24:04 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 18:24:04 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 18:24:04 - INFO - Costes cargados: 22145 registros
2026-02-03 18:24:04 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 18:24:04 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 18:24:04 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA VIVERO ===
2026-02-03 18:24:04 - INFO -   ABC: 565 registros
2026-02-03 18:24:04 - INFO -   Ventas: 2460 registros
2026-02-03 18:24:04 - INFO -   Costes: 22145 registros
2026-02-03 18:24:04 - DEBUG - [DEBUG] abc_df: 565 registros
2026-02-03 18:24:04 - DEBUG - [DEBUG] ventas_df: 2460 registros
2026-02-03 18:24:04 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 18:24:04 - INFO - Datos de ventas: 189 registros
2026-02-03 18:24:04 - INFO - Calculando pedido para semana 14 (189 registros)
2026-02-03 18:24:05 - INFO -   Objetivo: 5297.17€, Actual (ABC): 4113.14€
2026-02-03 18:24:05 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 18:24:05 - INFO -   Factor total: 1.3125
2026-02-03 18:24:05 - INFO -   Factor escalado: 1.6903
2026-02-03 18:24:05 - INFO -   Ventas preliminares (con ceil): 8761.94€
2026-02-03 18:24:05 - INFO -   Objetivo final: 6952.54€
2026-02-03 18:24:05 - INFO -   Delta: 1809.40€
2026-02-03 18:24:05 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 18:24:05 - DEBUG -   Total registros: 107
2026-02-03 18:24:05 - DEBUG -   Registros con Unidades_Finales > 0: 96
2026-02-03 18:24:05 - DEBUG -   Ventas finales: 6990.51€
2026-02-03 18:24:05 - INFO -   Ventas finales: 6990.51€
2026-02-03 18:24:05 - INFO - 
============================================================
2026-02-03 18:24:05 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 18:24:05 - INFO - ============================================================
2026-02-03 18:24:05 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 18:24:05 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 18:24:05 - INFO - DataLoader inicializado correctamente
2026-02-03 18:24:05 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 18:24:05 - INFO - ============================================================
2026-02-03 18:24:05 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 18:24:05 - INFO - ============================================================
2026-02-03 18:24:05 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 18:24:05 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 18:24:05 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 18:24:05 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 18:24:05 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 18:24:05 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 18:24:05 - DEBUG - Usando hoja: Stock
2026-02-03 18:24:05 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 18:24:05 - INFO - Stock actual cargado: 30 registros
2026-02-03 18:24:05 - INFO -   Stock: 30 registros
2026-02-03 18:24:05 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 18:24:05 - INFO - Fusión completada: 107 registros
2026-02-03 18:24:05 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 18:24:05 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 18:24:05 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 18:24:05 - INFO - Corrección completada:
2026-02-03 18:24:05 - INFO -   - Artículos corregidos: 96/107
2026-02-03 18:24:05 - INFO -   - Artículos aumentados: 96
2026-02-03 18:24:05 - INFO -   - Artículos reducidos: 0
2026-02-03 18:24:05 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 18:24:05 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 18:24:05 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 18:24:05 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 107 registros
2026-02-03 18:24:05 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 18:24:05 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 18:24:05 - DEBUG -   Con valor 0: 11
2026-02-03 18:24:05 - DEBUG -   Con valor > 0: 96
2026-02-03 18:24:05 - DEBUG -   Suma Ventas_Objetivo: 6990.51€
2026-02-03 18:24:05 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 96 registros
2026-02-03 18:24:05 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_vivero.xlsx
2026-02-03 18:24:05 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_vivero.xlsx
2026-02-03 18:24:05 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_vivero.xlsx
2026-02-03 18:24:05 - INFO -   Articulos: 96
2026-02-03 18:24:05 - INFO -   Importe: 6990.51€
2026-02-03 18:24:05 - INFO - 
==================================================
2026-02-03 18:24:05 - INFO - SECCION: UTILES_JARDIN
2026-02-03 18:24:05 - INFO - ==================================================
2026-02-03 18:24:05 - INFO - === LEYENDO DATOS PARA SECCIÓN: UTILES_JARDIN ===
2026-02-03 18:24:05 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 18:24:05 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: utiles_jardin
2026-02-03 18:24:05 - INFO - Archivo ABC encontrado para 'utiles_jardin': .\./data/input\CLASIFICACION_ABC+D_utiles_jardin.xlsx
2026-02-03 18:24:05 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_utiles_jardin.xlsx
2026-02-03 18:24:05 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 18:24:05 - INFO - Clasificación ABC cargada para 'utiles_jardin': 433 registros
2026-02-03 18:24:05 - DEBUG - [DEBUG] ABC leído: 433 registros
2026-02-03 18:24:05 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 18:24:05 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 18:24:05 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 18:24:09 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 18:24:09 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 18:24:09 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 18:24:09 - INFO - Ventas cargadas: 44082 registros
2026-02-03 18:24:09 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 18:24:09 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 18:24:09 - DEBUG - [DEBUG] Filtrando ventas por sección: utiles_jardin
2026-02-03 18:24:09 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 18:24:09 - DEBUG -   maf: 10970 registros
2026-02-03 18:24:09 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 18:24:09 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 18:24:09 - DEBUG -   interior: 3624 registros
2026-02-03 18:24:09 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 18:24:09 - DEBUG -   deco_interior: 2468 registros
2026-02-03 18:24:09 - DEBUG -   vivero: 2460 registros
2026-02-03 18:24:09 - DEBUG -   fitos: 1987 registros
2026-02-03 18:24:09 - DEBUG -   semillas: 1180 registros
2026-02-03 18:24:09 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 18:24:09 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 18:24:09 - DEBUG - [DEBUG] Tras filtrar por 'utiles_jardin': 1009 registros
2026-02-03 18:24:09 - INFO - Filtrados 1009 registros de sección 'utiles_jardin' de 44082 total
2026-02-03 18:24:09 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 18:24:09 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 18:24:11 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 18:24:11 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 18:24:11 - INFO - Costes cargados: 22145 registros
2026-02-03 18:24:11 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 18:24:11 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 18:24:11 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA UTILES_JARDIN ===
2026-02-03 18:24:11 - INFO -   ABC: 433 registros
2026-02-03 18:24:11 - INFO -   Ventas: 1009 registros
2026-02-03 18:24:11 - INFO -   Costes: 22145 registros
2026-02-03 18:24:11 - DEBUG - [DEBUG] abc_df: 433 registros
2026-02-03 18:24:11 - DEBUG - [DEBUG] ventas_df: 1009 registros
2026-02-03 18:24:11 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 18:24:11 - INFO - Datos de ventas: 89 registros
2026-02-03 18:24:11 - INFO - Calculando pedido para semana 14 (89 registros)
2026-02-03 18:24:11 - INFO -   Objetivo: 1044.77€, Actual (ABC): 818.79€
2026-02-03 18:24:11 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 18:24:11 - INFO -   Factor total: 1.3125
2026-02-03 18:24:11 - INFO -   Factor escalado: 1.6747
2026-02-03 18:24:11 - INFO -   Ventas preliminares (con ceil): 1929.56€
2026-02-03 18:24:11 - INFO -   Objetivo final: 1371.26€
2026-02-03 18:24:11 - INFO -   Delta: 558.30€
2026-02-03 18:24:11 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 18:24:11 - DEBUG -   Total registros: 78
2026-02-03 18:24:11 - DEBUG -   Registros con Unidades_Finales > 0: 78
2026-02-03 18:24:11 - DEBUG -   Ventas finales: 1390.00€
2026-02-03 18:24:11 - INFO -   Ventas finales: 1390.00€
2026-02-03 18:24:11 - INFO - 
============================================================
2026-02-03 18:24:11 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 18:24:11 - INFO - ============================================================
2026-02-03 18:24:11 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 18:24:11 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 18:24:11 - INFO - DataLoader inicializado correctamente
2026-02-03 18:24:11 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 18:24:11 - INFO - ============================================================
2026-02-03 18:24:11 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 18:24:11 - INFO - ============================================================
2026-02-03 18:24:11 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 18:24:11 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 18:24:11 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 18:24:11 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 18:24:11 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 18:24:11 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 18:24:11 - DEBUG - Usando hoja: Stock
2026-02-03 18:24:11 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 18:24:11 - INFO - Stock actual cargado: 30 registros
2026-02-03 18:24:11 - INFO -   Stock: 30 registros
2026-02-03 18:24:11 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 18:24:11 - INFO - Fusión completada: 78 registros
2026-02-03 18:24:11 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 18:24:11 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 18:24:11 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 18:24:11 - INFO - Corrección completada:
2026-02-03 18:24:11 - INFO -   - Artículos corregidos: 78/78
2026-02-03 18:24:11 - INFO -   - Artículos aumentados: 78
2026-02-03 18:24:11 - INFO -   - Artículos reducidos: 0
2026-02-03 18:24:11 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 18:24:11 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 18:24:11 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 18:24:11 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 78 registros
2026-02-03 18:24:11 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 18:24:11 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 18:24:11 - DEBUG -   Con valor 0: 0
2026-02-03 18:24:11 - DEBUG -   Con valor > 0: 78
2026-02-03 18:24:11 - DEBUG -   Suma Ventas_Objetivo: 1390.00€
2026-02-03 18:24:11 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 78 registros
2026-02-03 18:24:11 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx
2026-02-03 18:24:11 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx
2026-02-03 18:24:11 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx
2026-02-03 18:24:11 - INFO -   Articulos: 78
2026-02-03 18:24:11 - INFO -   Importe: 1390.00€
2026-02-03 18:24:11 - INFO - 
==================================================
2026-02-03 18:24:11 - INFO - SECCION: TIERRAS_ARIDOS
2026-02-03 18:24:11 - INFO - ==================================================
2026-02-03 18:24:11 - INFO - === LEYENDO DATOS PARA SECCIÓN: TIERRAS_ARIDOS ===
2026-02-03 18:24:11 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 18:24:11 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: tierras_aridos
2026-02-03 18:24:11 - WARNING - No se encontró archivo específico para 'tierras_aridos', usando: .\./data/input\CLASIFICACION_ABC+D_DECO_EXTERIOR.xlsx
2026-02-03 18:24:11 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_DECO_EXTERIOR.xlsx
2026-02-03 18:24:11 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 18:24:11 - INFO - Clasificación ABC cargada para 'tierras_aridos': 995 registros
2026-02-03 18:24:11 - DEBUG - [DEBUG] ABC leído: 995 registros
2026-02-03 18:24:11 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 18:24:11 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 18:24:11 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 18:24:15 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 18:24:15 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 18:24:15 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 18:24:15 - INFO - Ventas cargadas: 44082 registros
2026-02-03 18:24:15 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 18:24:15 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 18:24:15 - DEBUG - [DEBUG] Filtrando ventas por sección: tierras_aridos
2026-02-03 18:24:15 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 18:24:15 - DEBUG -   maf: 10970 registros
2026-02-03 18:24:15 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 18:24:15 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 18:24:15 - DEBUG -   interior: 3624 registros
2026-02-03 18:24:15 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 18:24:15 - DEBUG -   deco_interior: 2468 registros
2026-02-03 18:24:15 - DEBUG -   vivero: 2460 registros
2026-02-03 18:24:15 - DEBUG -   fitos: 1987 registros
2026-02-03 18:24:15 - DEBUG -   semillas: 1180 registros
2026-02-03 18:24:15 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 18:24:15 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 18:24:15 - DEBUG - [DEBUG] Tras filtrar por 'tierras_aridos': 3264 registros
2026-02-03 18:24:15 - INFO - Filtrados 3264 registros de sección 'tierras_aridos' de 44082 total
2026-02-03 18:24:15 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 18:24:15 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 18:24:17 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 18:24:17 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 18:24:17 - INFO - Costes cargados: 22145 registros
2026-02-03 18:24:17 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 18:24:17 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 18:24:17 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA TIERRAS_ARIDOS ===
2026-02-03 18:24:17 - INFO -   ABC: 995 registros
2026-02-03 18:24:17 - INFO -   Ventas: 3264 registros
2026-02-03 18:24:17 - INFO -   Costes: 22145 registros
2026-02-03 18:24:17 - DEBUG - [DEBUG] abc_df: 995 registros
2026-02-03 18:24:17 - DEBUG - [DEBUG] ventas_df: 3264 registros
2026-02-03 18:24:17 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 18:24:17 - INFO - Datos de ventas: 302 registros
2026-02-03 18:24:17 - INFO - Calculando pedido para semana 14 (302 registros)
2026-02-03 18:24:17 - INFO -   Objetivo: 4097.24€, Actual (ABC): 4019.19€
2026-02-03 18:24:17 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 18:24:17 - INFO -   Factor total: 1.3125
2026-02-03 18:24:17 - INFO -   Factor escalado: 1.3380
2026-02-03 18:24:17 - INFO -   Ventas preliminares (con ceil): 5809.66€
2026-02-03 18:24:17 - INFO -   Objetivo final: 5377.63€
2026-02-03 18:24:17 - INFO -   Delta: 432.03€
2026-02-03 18:24:17 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 18:24:17 - DEBUG -   Total registros: 72
2026-02-03 18:24:17 - DEBUG -   Registros con Unidades_Finales > 0: 71
2026-02-03 18:24:17 - DEBUG -   Ventas finales: 5387.14€
2026-02-03 18:24:17 - INFO -   Ventas finales: 5387.14€
2026-02-03 18:24:17 - INFO - 
============================================================
2026-02-03 18:24:17 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 18:24:17 - INFO - ============================================================
2026-02-03 18:24:17 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 18:24:17 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 18:24:17 - INFO - DataLoader inicializado correctamente
2026-02-03 18:24:17 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 18:24:17 - INFO - ============================================================
2026-02-03 18:24:17 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 18:24:17 - INFO - ============================================================
2026-02-03 18:24:17 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 18:24:17 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 18:24:17 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 18:24:17 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 18:24:17 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 18:24:17 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 18:24:17 - DEBUG - Usando hoja: Stock
2026-02-03 18:24:17 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 18:24:17 - INFO - Stock actual cargado: 30 registros
2026-02-03 18:24:17 - INFO -   Stock: 30 registros
2026-02-03 18:24:17 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 18:24:17 - INFO - Fusión completada: 72 registros
2026-02-03 18:24:17 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 18:24:17 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 18:24:17 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 18:24:17 - INFO - Corrección completada:
2026-02-03 18:24:17 - INFO -   - Artículos corregidos: 71/72
2026-02-03 18:24:17 - INFO -   - Artículos aumentados: 71
2026-02-03 18:24:17 - INFO -   - Artículos reducidos: 0
2026-02-03 18:24:17 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 18:24:17 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 18:24:17 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 18:24:17 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 72 registros
2026-02-03 18:24:17 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 18:24:17 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 18:24:17 - DEBUG -   Con valor 0: 1
2026-02-03 18:24:18 - DEBUG -   Con valor > 0: 71
2026-02-03 18:24:18 - DEBUG -   Suma Ventas_Objetivo: 5387.14€
2026-02-03 18:24:18 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 71 registros
2026-02-03 18:24:18 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx
2026-02-03 18:24:18 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx
2026-02-03 18:24:18 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx
2026-02-03 18:24:18 - INFO -   Articulos: 71
2026-02-03 18:24:18 - INFO -   Importe: 5387.14€
2026-02-03 18:24:18 - INFO - 
==================================================
2026-02-03 18:24:18 - INFO - SECCION: DECO_EXTERIOR
2026-02-03 18:24:18 - INFO - ==================================================
2026-02-03 18:24:18 - INFO - === LEYENDO DATOS PARA SECCIÓN: DECO_EXTERIOR ===
2026-02-03 18:24:18 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 18:24:18 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: deco_exterior
2026-02-03 18:24:18 - INFO - Archivo ABC encontrado para 'deco_exterior': .\./data/input\CLASIFICACION_ABC+D_deco_exterior.xlsx
2026-02-03 18:24:18 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_deco_exterior.xlsx
2026-02-03 18:24:18 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 18:24:18 - INFO - Clasificación ABC cargada para 'deco_exterior': 995 registros
2026-02-03 18:24:18 - DEBUG - [DEBUG] ABC leído: 995 registros
2026-02-03 18:24:18 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 18:24:18 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 18:24:18 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 18:24:22 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 18:24:22 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 18:24:22 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 18:24:22 - INFO - Ventas cargadas: 44082 registros
2026-02-03 18:24:22 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 18:24:22 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 18:24:22 - DEBUG - [DEBUG] Filtrando ventas por sección: deco_exterior
2026-02-03 18:24:22 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 18:24:22 - DEBUG -   maf: 10970 registros
2026-02-03 18:24:22 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 18:24:22 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 18:24:22 - DEBUG -   interior: 3624 registros
2026-02-03 18:24:22 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 18:24:22 - DEBUG -   deco_interior: 2468 registros
2026-02-03 18:24:22 - DEBUG -   vivero: 2460 registros
2026-02-03 18:24:22 - DEBUG -   fitos: 1987 registros
2026-02-03 18:24:22 - DEBUG -   semillas: 1180 registros
2026-02-03 18:24:22 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 18:24:22 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 18:24:22 - DEBUG - [DEBUG] Tras filtrar por 'deco_exterior': 4018 registros
2026-02-03 18:24:22 - INFO - Filtrados 4018 registros de sección 'deco_exterior' de 44082 total
2026-02-03 18:24:22 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 18:24:22 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 18:24:24 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 18:24:24 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 18:24:24 - INFO - Costes cargados: 22145 registros
2026-02-03 18:24:24 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 18:24:24 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 18:24:24 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA DECO_EXTERIOR ===
2026-02-03 18:24:24 - INFO -   ABC: 995 registros
2026-02-03 18:24:24 - INFO -   Ventas: 4018 registros
2026-02-03 18:24:24 - INFO -   Costes: 22145 registros
2026-02-03 18:24:24 - DEBUG - [DEBUG] abc_df: 995 registros
2026-02-03 18:24:24 - DEBUG - [DEBUG] ventas_df: 4018 registros
2026-02-03 18:24:24 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 18:24:24 - INFO - Datos de ventas: 316 registros
2026-02-03 18:24:24 - INFO - Calculando pedido para semana 14 (316 registros)
2026-02-03 18:24:24 - INFO -   Objetivo: 3740.34€, Actual (ABC): 4104.66€
2026-02-03 18:24:24 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 18:24:24 - INFO -   Factor total: 1.3125
2026-02-03 18:24:24 - INFO -   Factor escalado: 1.1960
2026-02-03 18:24:24 - INFO -   Ventas preliminares (con ceil): 6094.59€
2026-02-03 18:24:24 - INFO -   Objetivo final: 4909.20€
2026-02-03 18:24:24 - INFO -   Delta: 1185.39€
2026-02-03 18:24:24 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 18:24:24 - DEBUG -   Total registros: 224
2026-02-03 18:24:24 - DEBUG -   Registros con Unidades_Finales > 0: 205
2026-02-03 18:24:24 - DEBUG -   Ventas finales: 4923.89€
2026-02-03 18:24:24 - INFO -   Ventas finales: 4923.89€
2026-02-03 18:24:24 - INFO - 
============================================================
2026-02-03 18:24:24 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 18:24:24 - INFO - ============================================================
2026-02-03 18:24:24 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 18:24:24 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 18:24:24 - INFO - DataLoader inicializado correctamente
2026-02-03 18:24:24 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 18:24:24 - INFO - ============================================================
2026-02-03 18:24:24 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 18:24:24 - INFO - ============================================================
2026-02-03 18:24:24 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 18:24:24 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 18:24:24 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 18:24:24 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 18:24:24 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 18:24:24 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 18:24:24 - DEBUG - Usando hoja: Stock
2026-02-03 18:24:24 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 18:24:24 - INFO - Stock actual cargado: 30 registros
2026-02-03 18:24:24 - INFO -   Stock: 30 registros
2026-02-03 18:24:24 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 18:24:24 - INFO - Fusión completada: 224 registros
2026-02-03 18:24:24 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 18:24:24 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 18:24:24 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 18:24:24 - INFO - Corrección completada:
2026-02-03 18:24:24 - INFO -   - Artículos corregidos: 205/224
2026-02-03 18:24:24 - INFO -   - Artículos aumentados: 205
2026-02-03 18:24:24 - INFO -   - Artículos reducidos: 0
2026-02-03 18:24:24 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 18:24:24 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 18:24:24 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 18:24:24 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 224 registros
2026-02-03 18:24:24 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 18:24:24 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 18:24:24 - DEBUG -   Con valor 0: 19
2026-02-03 18:24:24 - DEBUG -   Con valor > 0: 205
2026-02-03 18:24:24 - DEBUG -   Suma Ventas_Objetivo: 4923.89€
2026-02-03 18:24:24 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 205 registros
2026-02-03 18:24:24 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_deco_exterior.xlsx
2026-02-03 18:24:24 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_deco_exterior.xlsx
2026-02-03 18:24:24 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_deco_exterior.xlsx
2026-02-03 18:24:24 - INFO -   Articulos: 205
2026-02-03 18:24:24 - INFO -   Importe: 4923.89€
2026-02-03 18:24:24 - INFO - Estado guardado correctamente
2026-02-03 18:24:24 - INFO - Generando resumen: .\./data/output\Resumen_Pedidos_VIVERO_2026-02-03.xlsx
2026-02-03 18:24:25 - INFO - Resumen guardado: .\./data/output\Resumen_Pedidos_VIVERO_2026-02-03.xlsx
2026-02-03 18:24:25 - INFO - Estado guardado correctamente
2026-02-03 18:24:25 - INFO - 
============================================================
2026-02-03 18:24:25 - INFO - PREPARANDO ENVÍO DE EMAILS
2026-02-03 18:24:25 - INFO - ============================================================
2026-02-03 18:24:25 - DEBUG - [DEBUG] Archivos agrupados por sección: {'maf': ['.\\./data/output\\Pedido_Semana_14_2026-02-03_maf.xlsx'], 'deco_interior': ['.\\./data/output\\Pedido_Semana_14_2026-02-03_deco_interior.xlsx'], 'semillas': ['.\\./data/output\\Pedido_Semana_14_2026-02-03_semillas.xlsx'], 'mascotas_vivo': ['.\\./data/output\\Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx'], 'mascotas_manufacturado': ['.\\./data/output\\Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx'], 'interior': ['.\\./data/output\\Pedido_Semana_14_2026-02-03_interior.xlsx'], 'fitos': ['.\\./data/output\\Pedido_Semana_14_2026-02-03_fitos.xlsx'], 'vivero': ['.\\./data/output\\Pedido_Semana_14_2026-02-03_vivero.xlsx'], 'utiles_jardin': ['.\\./data/output\\Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx'], 'tierras_aridos': ['.\\./data/output\\Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx'], 'deco_exterior': ['.\\./data/output\\Pedido_Semana_14_2026-02-03_deco_exterior.xlsx']}
2026-02-03 18:24:25 - INFO - 
============================================================
2026-02-03 18:24:25 - INFO - ENVÍO DE EMAILS A RESPONSABLES
2026-02-03 18:24:25 - INFO - ============================================================
2026-02-03 18:24:25 - DEBUG - [DEBUG] SMTP configurado: {'servidor': 'smtp.serviciodecorreo.es', 'puerto': 465, 'usar_ssl': True, 'usar_tls': False}
2026-02-03 18:24:25 - DEBUG - [DEBUG] Remitente: {'email': 'ivan.delgado@viveverde.es', 'nombre': 'Sistema de Pedidos VIVEVERDE'}
2026-02-03 18:24:25 - DEBUG - [DEBUG] Destinatarios: {'maf': 'ivan.delgado@viveverde.es', 'interior': 'ivan.delgado@viveverde.es', 'mascotas_vivo': 'ivan.delgado@viveverde.es', 'mascotas_manufacturado': 'ivan.delgado@viveverde.es', 'deco_interior': ['ivan.delgado@viveverde.es', 'ivan.delgado@viveverde.es'], 'deco_exterior': 'ivan.delgado@viveverde.es', 'tierras_aridos': 'ivan.delgado@viveverde.es', 'fitos': 'ivan.delgado@viveverde.es', 'semillas': 'ivan.delgado@viveverde.es', 'utiles_jardin': 'ivan.delgado@viveverde.es', 'vivero': 'ivan.delgado@viveverde.es'}
2026-02-03 18:24:25 - INFO - EmailService inicializado correctamente
2026-02-03 18:24:25 - INFO - 
Enviando email para sección: maf
2026-02-03 18:24:25 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_maf.xlsx']
2026-02-03 18:24:25 - INFO - ============================================================
2026-02-03 18:24:25 - INFO - ENVIANDO EMAIL PARA SECCIÓN: MAF
2026-02-03 18:24:25 - INFO - ============================================================
2026-02-03 18:24:25 - DEBUG - [DEBUG] Destinatarios para maf: [{'email': 'ivan.delgado@viveverde.es', 'nombre': 'Encargado'}]
2026-02-03 18:24:25 - INFO - Destinatarios: ['ivan.delgado@viveverde.es']
2026-02-03 18:24:25 - INFO - Archivos a enviar: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_maf.xlsx']
2026-02-03 18:24:25 - INFO - Archivo adjuntado: Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 18:24:25 - INFO - Email enviado exitosamente a: ivan.delgado@viveverde.es
2026-02-03 18:24:25 - INFO - ✓ Email enviado exitosamente para maf
2026-02-03 18:24:25 - INFO - ✓ Email enviado exitosamente a maf
2026-02-03 18:24:25 - INFO - 
Enviando email para sección: deco_interior
2026-02-03 18:24:25 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_deco_interior.xlsx']
2026-02-03 18:24:25 - INFO - ============================================================
2026-02-03 18:24:25 - INFO - ENVIANDO EMAIL PARA SECCIÓN: DECO_INTERIOR
2026-02-03 18:24:25 - INFO - ============================================================
2026-02-03 18:24:25 - DEBUG - [DEBUG] Destinatarios para deco_interior: [{'email': 'ivan.delgado@viveverde.es', 'nombre': 'Encargado'}, {'email': 'ivan.delgado@viveverde.es', 'nombre': 'Encargado'}]
2026-02-03 18:24:25 - INFO - Destinatarios: ['ivan.delgado@viveverde.es', 'ivan.delgado@viveverde.es']
2026-02-03 18:24:25 - INFO - Archivos a enviar: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_deco_interior.xlsx']
2026-02-03 18:24:25 - INFO - Archivo adjuntado: Pedido_Semana_14_2026-02-03_deco_interior.xlsx
2026-02-03 18:24:25 - INFO - Email enviado exitosamente a: ivan.delgado@viveverde.es, ivan.delgado@viveverde.es
2026-02-03 18:24:25 - INFO - ✓ Email enviado exitosamente para deco_interior
2026-02-03 18:24:25 - INFO - ✓ Email enviado exitosamente a deco_interior
2026-02-03 18:24:25 - INFO - 
Enviando email para sección: semillas
2026-02-03 18:24:25 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_semillas.xlsx']
2026-02-03 18:24:25 - INFO - ============================================================
2026-02-03 18:24:25 - INFO - ENVIANDO EMAIL PARA SECCIÓN: SEMILLAS
2026-02-03 18:24:25 - INFO - ============================================================
2026-02-03 18:24:25 - DEBUG - [DEBUG] Destinatarios para semillas: [{'email': 'ivan.delgado@viveverde.es', 'nombre': 'Encargado'}]
2026-02-03 18:24:25 - INFO - Destinatarios: ['ivan.delgado@viveverde.es']
2026-02-03 18:24:25 - INFO - Archivos a enviar: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_semillas.xlsx']
2026-02-03 18:24:25 - INFO - Archivo adjuntado: Pedido_Semana_14_2026-02-03_semillas.xlsx
2026-02-03 18:24:26 - INFO - Email enviado exitosamente a: ivan.delgado@viveverde.es
2026-02-03 18:24:26 - INFO - ✓ Email enviado exitosamente para semillas
2026-02-03 18:24:26 - INFO - ✓ Email enviado exitosamente a semillas
2026-02-03 18:24:26 - INFO - 
Enviando email para sección: mascotas_vivo
2026-02-03 18:24:26 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx']
2026-02-03 18:24:26 - INFO - ============================================================
2026-02-03 18:24:26 - INFO - ENVIANDO EMAIL PARA SECCIÓN: MASCOTAS_VIVO
2026-02-03 18:24:26 - INFO - ============================================================
2026-02-03 18:24:26 - DEBUG - [DEBUG] Destinatarios para mascotas_vivo: [{'email': 'ivan.delgado@viveverde.es', 'nombre': 'Encargado'}]
2026-02-03 18:24:26 - INFO - Destinatarios: ['ivan.delgado@viveverde.es']
2026-02-03 18:24:26 - INFO - Archivos a enviar: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx']
2026-02-03 18:24:26 - INFO - Archivo adjuntado: Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx
2026-02-03 18:24:26 - INFO - Email enviado exitosamente a: ivan.delgado@viveverde.es
2026-02-03 18:24:26 - INFO - ✓ Email enviado exitosamente para mascotas_vivo
2026-02-03 18:24:26 - INFO - ✓ Email enviado exitosamente a mascotas_vivo
2026-02-03 18:24:26 - INFO - 
Enviando email para sección: mascotas_manufacturado
2026-02-03 18:24:26 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx']
2026-02-03 18:24:26 - INFO - ============================================================
2026-02-03 18:24:26 - INFO - ENVIANDO EMAIL PARA SECCIÓN: MASCOTAS_MANUFACTURADO
2026-02-03 18:24:26 - INFO - ============================================================
2026-02-03 18:24:26 - DEBUG - [DEBUG] Destinatarios para mascotas_manufacturado: [{'email': 'ivan.delgado@viveverde.es', 'nombre': 'Encargado'}]
2026-02-03 18:24:26 - INFO - Destinatarios: ['ivan.delgado@viveverde.es']
2026-02-03 18:24:26 - INFO - Archivos a enviar: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx']
2026-02-03 18:24:26 - INFO - Archivo adjuntado: Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx
2026-02-03 18:24:26 - INFO - Email enviado exitosamente a: ivan.delgado@viveverde.es
2026-02-03 18:24:26 - INFO - ✓ Email enviado exitosamente para mascotas_manufacturado
2026-02-03 18:24:26 - INFO - ✓ Email enviado exitosamente a mascotas_manufacturado
2026-02-03 18:24:26 - INFO - 
Enviando email para sección: interior
2026-02-03 18:24:26 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_interior.xlsx']
2026-02-03 18:24:26 - INFO - ============================================================
2026-02-03 18:24:26 - INFO - ENVIANDO EMAIL PARA SECCIÓN: INTERIOR
2026-02-03 18:24:26 - INFO - ============================================================
2026-02-03 18:24:26 - DEBUG - [DEBUG] Destinatarios para interior: [{'email': 'ivan.delgado@viveverde.es', 'nombre': 'Encargado'}]
2026-02-03 18:24:26 - INFO - Destinatarios: ['ivan.delgado@viveverde.es']
2026-02-03 18:24:26 - INFO - Archivos a enviar: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_interior.xlsx']
2026-02-03 18:24:26 - INFO - Archivo adjuntado: Pedido_Semana_14_2026-02-03_interior.xlsx
2026-02-03 18:24:27 - INFO - Email enviado exitosamente a: ivan.delgado@viveverde.es
2026-02-03 18:24:27 - INFO - ✓ Email enviado exitosamente para interior
2026-02-03 18:24:27 - INFO - ✓ Email enviado exitosamente a interior
2026-02-03 18:24:27 - INFO - 
Enviando email para sección: fitos
2026-02-03 18:24:27 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_fitos.xlsx']
2026-02-03 18:24:27 - INFO - ============================================================
2026-02-03 18:24:27 - INFO - ENVIANDO EMAIL PARA SECCIÓN: FITOS
2026-02-03 18:24:27 - INFO - ============================================================
2026-02-03 18:24:27 - DEBUG - [DEBUG] Destinatarios para fitos: [{'email': 'ivan.delgado@viveverde.es', 'nombre': 'Encargado'}]
2026-02-03 18:24:27 - INFO - Destinatarios: ['ivan.delgado@viveverde.es']
2026-02-03 18:24:27 - INFO - Archivos a enviar: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_fitos.xlsx']
2026-02-03 18:24:27 - INFO - Archivo adjuntado: Pedido_Semana_14_2026-02-03_fitos.xlsx
2026-02-03 18:24:27 - INFO - Email enviado exitosamente a: ivan.delgado@viveverde.es
2026-02-03 18:24:27 - INFO - ✓ Email enviado exitosamente para fitos
2026-02-03 18:24:27 - INFO - ✓ Email enviado exitosamente a fitos
2026-02-03 18:24:27 - INFO - 
Enviando email para sección: vivero
2026-02-03 18:24:27 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_vivero.xlsx']
2026-02-03 18:24:27 - INFO - ============================================================
2026-02-03 18:24:27 - INFO - ENVIANDO EMAIL PARA SECCIÓN: VIVERO
2026-02-03 18:24:27 - INFO - ============================================================
2026-02-03 18:24:27 - DEBUG - [DEBUG] Destinatarios para vivero: [{'email': 'ivan.delgado@viveverde.es', 'nombre': 'Encargado'}]
2026-02-03 18:24:27 - INFO - Destinatarios: ['ivan.delgado@viveverde.es']
2026-02-03 18:24:27 - INFO - Archivos a enviar: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_vivero.xlsx']
2026-02-03 18:24:27 - INFO - Archivo adjuntado: Pedido_Semana_14_2026-02-03_vivero.xlsx
2026-02-03 18:24:27 - INFO - Email enviado exitosamente a: ivan.delgado@viveverde.es
2026-02-03 18:24:27 - INFO - ✓ Email enviado exitosamente para vivero
2026-02-03 18:24:27 - INFO - ✓ Email enviado exitosamente a vivero
2026-02-03 18:24:27 - INFO - 
Enviando email para sección: utiles_jardin
2026-02-03 18:24:27 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx']
2026-02-03 18:24:27 - INFO - ============================================================
2026-02-03 18:24:27 - INFO - ENVIANDO EMAIL PARA SECCIÓN: UTILES_JARDIN
2026-02-03 18:24:27 - INFO - ============================================================
2026-02-03 18:24:27 - DEBUG - [DEBUG] Destinatarios para utiles_jardin: [{'email': 'ivan.delgado@viveverde.es', 'nombre': 'Encargado'}]
2026-02-03 18:24:27 - INFO - Destinatarios: ['ivan.delgado@viveverde.es']
2026-02-03 18:24:27 - INFO - Archivos a enviar: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx']
2026-02-03 18:24:27 - INFO - Archivo adjuntado: Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx
2026-02-03 18:24:28 - INFO - Email enviado exitosamente a: ivan.delgado@viveverde.es
2026-02-03 18:24:28 - INFO - ✓ Email enviado exitosamente para utiles_jardin
2026-02-03 18:24:28 - INFO - ✓ Email enviado exitosamente a utiles_jardin
2026-02-03 18:24:28 - INFO - 
Enviando email para sección: tierras_aridos
2026-02-03 18:24:28 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx']
2026-02-03 18:24:28 - INFO - ============================================================
2026-02-03 18:24:28 - INFO - ENVIANDO EMAIL PARA SECCIÓN: TIERRAS_ARIDOS
2026-02-03 18:24:28 - INFO - ============================================================
2026-02-03 18:24:28 - DEBUG - [DEBUG] Destinatarios para tierras_aridos: [{'email': 'ivan.delgado@viveverde.es', 'nombre': 'Encargado'}]
2026-02-03 18:24:28 - INFO - Destinatarios: ['ivan.delgado@viveverde.es']
2026-02-03 18:24:28 - INFO - Archivos a enviar: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx']
2026-02-03 18:24:28 - INFO - Archivo adjuntado: Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx
2026-02-03 18:24:28 - INFO - Email enviado exitosamente a: ivan.delgado@viveverde.es
2026-02-03 18:24:28 - INFO - ✓ Email enviado exitosamente para tierras_aridos
2026-02-03 18:24:28 - INFO - ✓ Email enviado exitosamente a tierras_aridos
2026-02-03 18:24:28 - INFO - 
Enviando email para sección: deco_exterior
2026-02-03 18:24:28 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_deco_exterior.xlsx']
2026-02-03 18:24:28 - INFO - ============================================================
2026-02-03 18:24:28 - INFO - ENVIANDO EMAIL PARA SECCIÓN: DECO_EXTERIOR
2026-02-03 18:24:28 - INFO - ============================================================
2026-02-03 18:24:28 - DEBUG - [DEBUG] Destinatarios para deco_exterior: [{'email': 'ivan.delgado@viveverde.es', 'nombre': 'Encargado'}]
2026-02-03 18:24:28 - INFO - Destinatarios: ['ivan.delgado@viveverde.es']
2026-02-03 18:24:28 - INFO - Archivos a enviar: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_deco_exterior.xlsx']
2026-02-03 18:24:28 - INFO - Archivo adjuntado: Pedido_Semana_14_2026-02-03_deco_exterior.xlsx
2026-02-03 18:24:28 - INFO - Email enviado exitosamente a: ivan.delgado@viveverde.es
2026-02-03 18:24:28 - INFO - ✓ Email enviado exitosamente para deco_exterior
2026-02-03 18:24:28 - INFO - ✓ Email enviado exitosamente a deco_exterior
2026-02-03 18:24:28 - INFO - 
============================================================
2026-02-03 18:24:28 - INFO - RESUMEN DE ENVÍO DE EMAILS
2026-02-03 18:24:28 - INFO - ============================================================
2026-02-03 18:24:28 - INFO - Emails enviados exitosamente: 11
2026-02-03 18:24:28 - INFO - Emails fallidos: 0
2026-02-03 18:24:28 - INFO - Secciones procesadas: 11
2026-02-03 18:24:28 - INFO - 
======================================================================
2026-02-03 18:24:28 - INFO - RESUMEN DE EJECUCION
2026-02-03 18:24:29 - INFO - ======================================================================
2026-02-03 18:24:29 - INFO - Semana procesada: 14
2026-02-03 18:24:29 - INFO - Archivos generados: 12
2026-02-03 18:24:29 - INFO - Total articulos: 1510
2026-02-03 18:24:29 - INFO - Total importe: 48113.87€
2026-02-03 18:24:29 - INFO - 
✓ EMAILS ENVIADOS: 11
2026-02-03 18:24:29 - INFO - ======================================================================
2026-02-03 18:24:29 - INFO - 
¡PEDIDO GENERADO EXITOSAMENTE!
2026-02-03 18:24:29 - INFO - Archivo principal: .\./data/output\Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 18:24:29 - INFO - Artículos: 1510
2026-02-03 18:24:29 - INFO - Importe: 48113.87€
2026-02-03 18:24:29 - INFO - 
Emails enviados: 11
2026-02-03 19:16:46 - INFO - ======================================================================
2026-02-03 19:16:46 - INFO - SISTEMA DE PEDIDOS DE COMPRA - VIVERO ARANJUEZ V2
2026-02-03 19:16:46 - INFO - Fecha de ejecución: 2026-02-03 19:16:46
2026-02-03 19:16:46 - INFO - ======================================================================
2026-02-03 19:16:46 - INFO - Modo de ejecución: FASE 1 + FASE 2
2026-02-03 19:16:46 - INFO - Envío de emails: Sí
2026-02-03 19:16:46 - INFO - StateManager inicializado. Archivo de estado: .\./data\state.json
2026-02-03 19:16:46 - INFO - Cargando estado desde: .\./data\state.json
2026-02-03 19:16:46 - INFO - Estado cargado correctamente
2026-02-03 19:16:46 - INFO - SchedulerService inicializado correctamente
2026-02-03 19:16:46 - INFO - Horario configurado: sunday a las 15:00
2026-02-03 19:16:46 - INFO - Semana forzada por argumento: 14
2026-02-03 19:16:46 - INFO - ======================================================================
2026-02-03 19:16:46 - INFO - PROCESANDO PEDIDO PARA SEMANA 14
2026-02-03 19:16:46 - INFO - ======================================================================
2026-02-03 19:16:46 - INFO - MODO: FASE 1 (Forecast) + FASE 2 (Corrección)
2026-02-03 19:16:46 - INFO - DataLoader inicializado correctamente
2026-02-03 19:16:46 - INFO - ForecastEngine inicializado correctamente
2026-02-03 19:16:46 - INFO - OrderGenerator inicializado correctamente
2026-02-03 19:16:46 - INFO - SchedulerService inicializado correctamente
2026-02-03 19:16:46 - INFO - Horario configurado: sunday a las 15:00
2026-02-03 19:16:46 - INFO - Período de la semana: 2026-03-30 al 2026-04-05
2026-02-03 19:16:46 - INFO - Stock acumulado cargado: 2633 artículos
2026-02-03 19:16:46 - INFO - 
==================================================
2026-02-03 19:16:46 - INFO - SECCION: MAF
2026-02-03 19:16:46 - INFO - ==================================================
2026-02-03 19:16:46 - INFO - === LEYENDO DATOS PARA SECCIÓN: MAF ===
2026-02-03 19:16:46 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 19:16:46 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: maf
2026-02-03 19:16:46 - INFO - Archivo ABC encontrado para 'maf': .\./data/input\CLASIFICACION_ABC+D_maf.xlsx
2026-02-03 19:16:46 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_maf.xlsx
2026-02-03 19:16:46 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 19:16:46 - INFO - Clasificación ABC cargada para 'maf': 499 registros
2026-02-03 19:16:46 - DEBUG - [DEBUG] ABC leído: 499 registros
2026-02-03 19:16:46 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 19:16:46 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 19:16:46 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 19:16:50 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 19:16:50 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 19:16:50 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 19:16:50 - INFO - Ventas cargadas: 44082 registros
2026-02-03 19:16:50 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 19:16:50 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 19:16:50 - DEBUG - [DEBUG] Filtrando ventas por sección: maf
2026-02-03 19:16:50 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 19:16:50 - DEBUG -   maf: 10970 registros
2026-02-03 19:16:50 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 19:16:50 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 19:16:50 - DEBUG -   interior: 3624 registros
2026-02-03 19:16:50 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 19:16:50 - DEBUG -   deco_interior: 2468 registros
2026-02-03 19:16:50 - DEBUG -   vivero: 2460 registros
2026-02-03 19:16:50 - DEBUG -   fitos: 1987 registros
2026-02-03 19:16:50 - DEBUG -   semillas: 1180 registros
2026-02-03 19:16:50 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 19:16:50 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 19:16:50 - DEBUG - [DEBUG] Tras filtrar por 'maf': 10970 registros
2026-02-03 19:16:50 - INFO - Filtrados 10970 registros de sección 'maf' de 44082 total
2026-02-03 19:16:50 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 19:16:50 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 19:16:52 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 19:16:52 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 19:16:52 - INFO - Costes cargados: 22145 registros
2026-02-03 19:16:52 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 19:16:52 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 19:16:52 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MAF ===
2026-02-03 19:16:52 - INFO -   ABC: 499 registros
2026-02-03 19:16:52 - INFO -   Ventas: 10970 registros
2026-02-03 19:16:52 - INFO -   Costes: 22145 registros
2026-02-03 19:16:52 - DEBUG - [DEBUG] abc_df: 499 registros
2026-02-03 19:16:52 - DEBUG - [DEBUG] ventas_df: 10970 registros
2026-02-03 19:16:52 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 19:16:52 - INFO - Datos de ventas: 1011 registros
2026-02-03 19:16:52 - INFO - Calculando pedido para semana 14 (1011 registros)
2026-02-03 19:16:53 - INFO -   Objetivo: 7050.65€, Actual (ABC): 5843.77€
2026-02-03 19:16:53 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 19:16:53 - INFO -   Factor total: 1.3125
2026-02-03 19:16:53 - INFO -   Factor escalado: 1.5836
2026-02-03 19:16:53 - INFO -   Ventas preliminares (con ceil): 9931.01€
2026-02-03 19:16:53 - INFO -   Objetivo final: 9253.98€
2026-02-03 19:16:53 - INFO -   Delta: 677.03€
2026-02-03 19:16:53 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 19:16:53 - DEBUG -   Total registros: 222
2026-02-03 19:16:53 - DEBUG -   Registros con Unidades_Finales > 0: 191
2026-02-03 19:16:53 - DEBUG -   Ventas finales: 9259.59€
2026-02-03 19:16:53 - INFO -   Ventas finales: 9259.59€
2026-02-03 19:16:53 - INFO - 
============================================================
2026-02-03 19:16:53 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 19:16:53 - INFO - ============================================================
2026-02-03 19:16:53 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 19:16:53 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 19:16:53 - INFO - DataLoader inicializado correctamente
2026-02-03 19:16:53 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 19:16:53 - INFO - ============================================================
2026-02-03 19:16:53 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 19:16:53 - INFO - ============================================================
2026-02-03 19:16:53 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 19:16:53 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 19:16:53 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 19:16:53 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 19:16:53 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 19:16:53 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 19:16:53 - DEBUG - Usando hoja: Stock
2026-02-03 19:16:53 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 19:16:53 - INFO - Stock actual cargado: 30 registros
2026-02-03 19:16:53 - INFO -   Stock: 30 registros
2026-02-03 19:16:53 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 19:16:53 - INFO - Fusión completada: 222 registros
2026-02-03 19:16:53 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 19:16:53 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 19:16:53 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 19:16:53 - INFO - Corrección completada:
2026-02-03 19:16:53 - INFO -   - Artículos corregidos: 197/222
2026-02-03 19:16:53 - INFO -   - Artículos aumentados: 197
2026-02-03 19:16:53 - INFO -   - Artículos reducidos: 0
2026-02-03 19:16:53 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 19:16:53 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 19:16:53 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 19:16:53 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 222 registros
2026-02-03 19:16:53 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 19:16:53 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 19:16:53 - DEBUG -   Con valor 0: 28
2026-02-03 19:16:53 - DEBUG -   Con valor > 0: 185
2026-02-03 19:16:53 - DEBUG -   Suma Ventas_Objetivo: 9259.59€
2026-02-03 19:16:53 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 185 registros
2026-02-03 19:16:53 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 19:16:53 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 19:16:53 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 19:16:53 - INFO -   Articulos: 185
2026-02-03 19:16:53 - INFO -   Importe: 9197.06€
2026-02-03 19:16:53 - INFO - 
==================================================
2026-02-03 19:16:53 - INFO - SECCION: DECO_INTERIOR
2026-02-03 19:16:53 - INFO - ==================================================
2026-02-03 19:16:53 - INFO - === LEYENDO DATOS PARA SECCIÓN: DECO_INTERIOR ===
2026-02-03 19:16:53 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 19:16:53 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: deco_interior
2026-02-03 19:16:53 - INFO - Archivo ABC encontrado para 'deco_interior': .\./data/input\CLASIFICACION_ABC+D_deco_interior.xlsx
2026-02-03 19:16:53 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_deco_interior.xlsx
2026-02-03 19:16:53 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 19:16:53 - INFO - Clasificación ABC cargada para 'deco_interior': 1827 registros
2026-02-03 19:16:53 - DEBUG - [DEBUG] ABC leído: 1827 registros
2026-02-03 19:16:53 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 19:16:53 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 19:16:53 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 19:16:57 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 19:16:57 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 19:16:57 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 19:16:57 - INFO - Ventas cargadas: 44082 registros
2026-02-03 19:16:57 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 19:16:57 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 19:16:57 - DEBUG - [DEBUG] Filtrando ventas por sección: deco_interior
2026-02-03 19:16:57 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 19:16:57 - DEBUG -   maf: 10970 registros
2026-02-03 19:16:57 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 19:16:57 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 19:16:57 - DEBUG -   interior: 3624 registros
2026-02-03 19:16:57 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 19:16:57 - DEBUG -   deco_interior: 2468 registros
2026-02-03 19:16:57 - DEBUG -   vivero: 2460 registros
2026-02-03 19:16:57 - DEBUG -   fitos: 1987 registros
2026-02-03 19:16:57 - DEBUG -   semillas: 1180 registros
2026-02-03 19:16:57 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 19:16:57 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 19:16:57 - DEBUG - [DEBUG] Tras filtrar por 'deco_interior': 2468 registros
2026-02-03 19:16:57 - INFO - Filtrados 2468 registros de sección 'deco_interior' de 44082 total
2026-02-03 19:16:57 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 19:16:57 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 19:16:59 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 19:16:59 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 19:16:59 - INFO - Costes cargados: 22145 registros
2026-02-03 19:16:59 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 19:16:59 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 19:16:59 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA DECO_INTERIOR ===
2026-02-03 19:16:59 - INFO -   ABC: 1827 registros
2026-02-03 19:16:59 - INFO -   Ventas: 2468 registros
2026-02-03 19:16:59 - INFO -   Costes: 22145 registros
2026-02-03 19:16:59 - DEBUG - [DEBUG] abc_df: 1827 registros
2026-02-03 19:16:59 - DEBUG - [DEBUG] ventas_df: 2468 registros
2026-02-03 19:16:59 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 19:16:59 - INFO - Datos de ventas: 180 registros
2026-02-03 19:16:59 - INFO - Calculando pedido para semana 14 (180 registros)
2026-02-03 19:16:59 - INFO -   Objetivo: 1962.99€, Actual (ABC): 1636.15€
2026-02-03 19:16:59 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 19:16:59 - INFO -   Factor total: 1.3125
2026-02-03 19:16:59 - INFO -   Factor escalado: 1.5747
2026-02-03 19:16:59 - INFO -   Ventas preliminares (con ceil): 2950.01€
2026-02-03 19:16:59 - INFO -   Objetivo final: 2576.42€
2026-02-03 19:16:59 - INFO -   Delta: 373.59€
2026-02-03 19:16:59 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 19:16:59 - DEBUG -   Total registros: 139
2026-02-03 19:16:59 - DEBUG -   Registros con Unidades_Finales > 0: 135
2026-02-03 19:16:59 - DEBUG -   Ventas finales: 2580.73€
2026-02-03 19:16:59 - INFO -   Ventas finales: 2580.73€
2026-02-03 19:16:59 - INFO - 
============================================================
2026-02-03 19:16:59 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 19:16:59 - INFO - ============================================================
2026-02-03 19:16:59 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 19:16:59 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 19:16:59 - INFO - DataLoader inicializado correctamente
2026-02-03 19:16:59 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 19:16:59 - INFO - ============================================================
2026-02-03 19:16:59 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 19:16:59 - INFO - ============================================================
2026-02-03 19:16:59 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 19:16:59 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 19:16:59 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 19:16:59 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 19:16:59 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 19:16:59 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 19:16:59 - DEBUG - Usando hoja: Stock
2026-02-03 19:16:59 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 19:16:59 - INFO - Stock actual cargado: 30 registros
2026-02-03 19:16:59 - INFO -   Stock: 30 registros
2026-02-03 19:16:59 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 19:16:59 - INFO - Fusión completada: 139 registros
2026-02-03 19:16:59 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 19:16:59 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 19:16:59 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 19:16:59 - INFO - Corrección completada:
2026-02-03 19:16:59 - INFO -   - Artículos corregidos: 135/139
2026-02-03 19:16:59 - INFO -   - Artículos aumentados: 135
2026-02-03 19:16:59 - INFO -   - Artículos reducidos: 0
2026-02-03 19:16:59 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 19:16:59 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 19:16:59 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 19:16:59 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 139 registros
2026-02-03 19:16:59 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 19:16:59 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 19:16:59 - DEBUG -   Con valor 0: 4
2026-02-03 19:16:59 - DEBUG -   Con valor > 0: 135
2026-02-03 19:16:59 - DEBUG -   Suma Ventas_Objetivo: 2580.73€
2026-02-03 19:16:59 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 135 registros
2026-02-03 19:16:59 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_deco_interior.xlsx
2026-02-03 19:17:00 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_deco_interior.xlsx
2026-02-03 19:17:00 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_deco_interior.xlsx
2026-02-03 19:17:00 - INFO -   Articulos: 135
2026-02-03 19:17:00 - INFO -   Importe: 2580.73€
2026-02-03 19:17:00 - INFO - 
==================================================
2026-02-03 19:17:00 - INFO - SECCION: SEMILLAS
2026-02-03 19:17:00 - INFO - ==================================================
2026-02-03 19:17:00 - INFO - === LEYENDO DATOS PARA SECCIÓN: SEMILLAS ===
2026-02-03 19:17:00 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 19:17:00 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: semillas
2026-02-03 19:17:00 - INFO - Archivo ABC encontrado para 'semillas': .\./data/input\CLASIFICACION_ABC+D_semillas.xlsx
2026-02-03 19:17:00 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_semillas.xlsx
2026-02-03 19:17:00 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 19:17:00 - INFO - Clasificación ABC cargada para 'semillas': 218 registros
2026-02-03 19:17:00 - DEBUG - [DEBUG] ABC leído: 218 registros
2026-02-03 19:17:00 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 19:17:00 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 19:17:00 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 19:17:03 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 19:17:03 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 19:17:03 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 19:17:03 - INFO - Ventas cargadas: 44082 registros
2026-02-03 19:17:03 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 19:17:03 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 19:17:03 - DEBUG - [DEBUG] Filtrando ventas por sección: semillas
2026-02-03 19:17:03 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 19:17:03 - DEBUG -   maf: 10970 registros
2026-02-03 19:17:03 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 19:17:03 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 19:17:03 - DEBUG -   interior: 3624 registros
2026-02-03 19:17:03 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 19:17:03 - DEBUG -   deco_interior: 2468 registros
2026-02-03 19:17:03 - DEBUG -   vivero: 2460 registros
2026-02-03 19:17:03 - DEBUG -   fitos: 1987 registros
2026-02-03 19:17:03 - DEBUG -   semillas: 1180 registros
2026-02-03 19:17:03 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 19:17:03 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 19:17:03 - DEBUG - [DEBUG] Tras filtrar por 'semillas': 1180 registros
2026-02-03 19:17:03 - INFO - Filtrados 1180 registros de sección 'semillas' de 44082 total
2026-02-03 19:17:03 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 19:17:03 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 19:17:05 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 19:17:05 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 19:17:05 - INFO - Costes cargados: 22145 registros
2026-02-03 19:17:05 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 19:17:05 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 19:17:05 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA SEMILLAS ===
2026-02-03 19:17:05 - INFO -   ABC: 218 registros
2026-02-03 19:17:05 - INFO -   Ventas: 1180 registros
2026-02-03 19:17:05 - INFO -   Costes: 22145 registros
2026-02-03 19:17:05 - DEBUG - [DEBUG] abc_df: 218 registros
2026-02-03 19:17:05 - DEBUG - [DEBUG] ventas_df: 1180 registros
2026-02-03 19:17:05 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 19:17:05 - INFO - Datos de ventas: 136 registros
2026-02-03 19:17:05 - INFO - Calculando pedido para semana 14 (136 registros)
2026-02-03 19:17:06 - INFO -   Objetivo: 694.34€, Actual (ABC): 455.14€
2026-02-03 19:17:06 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 19:17:06 - INFO -   Factor total: 1.3125
2026-02-03 19:17:06 - INFO -   Factor escalado: 2.0023
2026-02-03 19:17:06 - INFO -   Ventas preliminares (con ceil): 1129.15€
2026-02-03 19:17:06 - INFO -   Objetivo final: 911.32€
2026-02-03 19:17:06 - INFO -   Delta: 217.83€
2026-02-03 19:17:06 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 19:17:06 - DEBUG -   Total registros: 84
2026-02-03 19:17:06 - DEBUG -   Registros con Unidades_Finales > 0: 84
2026-02-03 19:17:06 - DEBUG -   Ventas finales: 911.60€
2026-02-03 19:17:06 - INFO -   Ventas finales: 911.60€
2026-02-03 19:17:06 - INFO - 
============================================================
2026-02-03 19:17:06 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 19:17:06 - INFO - ============================================================
2026-02-03 19:17:06 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 19:17:06 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 19:17:06 - INFO - DataLoader inicializado correctamente
2026-02-03 19:17:06 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 19:17:06 - INFO - ============================================================
2026-02-03 19:17:06 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 19:17:06 - INFO - ============================================================
2026-02-03 19:17:06 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 19:17:06 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 19:17:06 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 19:17:06 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 19:17:06 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 19:17:06 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 19:17:06 - DEBUG - Usando hoja: Stock
2026-02-03 19:17:06 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 19:17:06 - INFO - Stock actual cargado: 30 registros
2026-02-03 19:17:06 - INFO -   Stock: 30 registros
2026-02-03 19:17:06 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 19:17:06 - INFO - Fusión completada: 84 registros
2026-02-03 19:17:06 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 19:17:06 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 19:17:06 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 19:17:06 - INFO - Corrección completada:
2026-02-03 19:17:06 - INFO -   - Artículos corregidos: 84/84
2026-02-03 19:17:06 - INFO -   - Artículos aumentados: 84
2026-02-03 19:17:06 - INFO -   - Artículos reducidos: 0
2026-02-03 19:17:06 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 19:17:06 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 19:17:06 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 19:17:06 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 84 registros
2026-02-03 19:17:06 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 19:17:06 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 19:17:06 - DEBUG -   Con valor 0: 0
2026-02-03 19:17:06 - DEBUG -   Con valor > 0: 84
2026-02-03 19:17:06 - DEBUG -   Suma Ventas_Objetivo: 911.60€
2026-02-03 19:17:06 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 84 registros
2026-02-03 19:17:06 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_semillas.xlsx
2026-02-03 19:17:06 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_semillas.xlsx
2026-02-03 19:17:06 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_semillas.xlsx
2026-02-03 19:17:06 - INFO -   Articulos: 84
2026-02-03 19:17:06 - INFO -   Importe: 911.60€
2026-02-03 19:17:06 - INFO - 
==================================================
2026-02-03 19:17:06 - INFO - SECCION: MASCOTAS_VIVO
2026-02-03 19:17:06 - INFO - ==================================================
2026-02-03 19:17:06 - INFO - === LEYENDO DATOS PARA SECCIÓN: MASCOTAS_VIVO ===
2026-02-03 19:17:06 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 19:17:06 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: mascotas_vivo
2026-02-03 19:17:06 - INFO - Archivo ABC encontrado para 'mascotas_vivo': .\./data/input\CLASIFICACION_ABC+D_mascotas_vivo.xlsx
2026-02-03 19:17:06 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_mascotas_vivo.xlsx
2026-02-03 19:17:06 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 19:17:06 - INFO - Clasificación ABC cargada para 'mascotas_vivo': 205 registros
2026-02-03 19:17:06 - DEBUG - [DEBUG] ABC leído: 205 registros
2026-02-03 19:17:06 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 19:17:06 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 19:17:06 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 19:17:10 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 19:17:10 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 19:17:10 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 19:17:10 - INFO - Ventas cargadas: 44082 registros
2026-02-03 19:17:10 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 19:17:10 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 19:17:10 - DEBUG - [DEBUG] Filtrando ventas por sección: mascotas_vivo
2026-02-03 19:17:10 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 19:17:10 - DEBUG -   maf: 10970 registros
2026-02-03 19:17:10 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 19:17:10 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 19:17:10 - DEBUG -   interior: 3624 registros
2026-02-03 19:17:10 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 19:17:10 - DEBUG -   deco_interior: 2468 registros
2026-02-03 19:17:10 - DEBUG -   vivero: 2460 registros
2026-02-03 19:17:10 - DEBUG -   fitos: 1987 registros
2026-02-03 19:17:10 - DEBUG -   semillas: 1180 registros
2026-02-03 19:17:10 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 19:17:10 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 19:17:10 - DEBUG - [DEBUG] Tras filtrar por 'mascotas_vivo': 1124 registros
2026-02-03 19:17:10 - INFO - Filtrados 1124 registros de sección 'mascotas_vivo' de 44082 total
2026-02-03 19:17:10 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 19:17:10 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 19:17:12 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 19:17:12 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 19:17:12 - INFO - Costes cargados: 22145 registros
2026-02-03 19:17:12 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 19:17:12 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 19:17:12 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MASCOTAS_VIVO ===
2026-02-03 19:17:12 - INFO -   ABC: 205 registros
2026-02-03 19:17:12 - INFO -   Ventas: 1124 registros
2026-02-03 19:17:12 - INFO -   Costes: 22145 registros
2026-02-03 19:17:12 - DEBUG - [DEBUG] abc_df: 205 registros
2026-02-03 19:17:12 - DEBUG - [DEBUG] ventas_df: 1124 registros
2026-02-03 19:17:12 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 19:17:12 - INFO - Datos de ventas: 88 registros
2026-02-03 19:17:12 - INFO - Calculando pedido para semana 14 (88 registros)
2026-02-03 19:17:12 - INFO -   Objetivo: 1087.15€, Actual (ABC): 846.63€
2026-02-03 19:17:12 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 19:17:12 - INFO -   Factor total: 1.3125
2026-02-03 19:17:12 - INFO -   Factor escalado: 1.6854
2026-02-03 19:17:12 - INFO -   Ventas preliminares (con ceil): 1773.66€
2026-02-03 19:17:12 - INFO -   Objetivo final: 1426.88€
2026-02-03 19:17:12 - INFO -   Delta: 346.78€
2026-02-03 19:17:12 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 19:17:12 - DEBUG -   Total registros: 43
2026-02-03 19:17:12 - DEBUG -   Registros con Unidades_Finales > 0: 36
2026-02-03 19:17:12 - DEBUG -   Ventas finales: 1455.34€
2026-02-03 19:17:12 - INFO -   Ventas finales: 1455.34€
2026-02-03 19:17:12 - INFO - 
============================================================
2026-02-03 19:17:12 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 19:17:12 - INFO - ============================================================
2026-02-03 19:17:12 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 19:17:12 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 19:17:12 - INFO - DataLoader inicializado correctamente
2026-02-03 19:17:12 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 19:17:12 - INFO - ============================================================
2026-02-03 19:17:12 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 19:17:12 - INFO - ============================================================
2026-02-03 19:17:12 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 19:17:12 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 19:17:12 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 19:17:12 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 19:17:12 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 19:17:12 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 19:17:12 - DEBUG - Usando hoja: Stock
2026-02-03 19:17:12 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 19:17:12 - INFO - Stock actual cargado: 30 registros
2026-02-03 19:17:12 - INFO -   Stock: 30 registros
2026-02-03 19:17:12 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 19:17:12 - INFO - Fusión completada: 43 registros
2026-02-03 19:17:12 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 19:17:12 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 19:17:12 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 19:17:12 - INFO - Corrección completada:
2026-02-03 19:17:12 - INFO -   - Artículos corregidos: 39/43
2026-02-03 19:17:12 - INFO -   - Artículos aumentados: 39
2026-02-03 19:17:12 - INFO -   - Artículos reducidos: 0
2026-02-03 19:17:12 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 19:17:12 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 19:17:12 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 19:17:12 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 43 registros
2026-02-03 19:17:12 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 19:17:12 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 19:17:12 - DEBUG -   Con valor 0: 4
2026-02-03 19:17:12 - DEBUG -   Con valor > 0: 36
2026-02-03 19:17:12 - DEBUG -   Suma Ventas_Objetivo: 1455.34€
2026-02-03 19:17:12 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 36 registros
2026-02-03 19:17:12 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx
2026-02-03 19:17:12 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx
2026-02-03 19:17:12 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx
2026-02-03 19:17:12 - INFO -   Articulos: 36
2026-02-03 19:17:12 - INFO -   Importe: 1455.34€
2026-02-03 19:17:12 - INFO - 
==================================================
2026-02-03 19:17:12 - INFO - SECCION: MASCOTAS_MANUFACTURADO
2026-02-03 19:17:12 - INFO - ==================================================
2026-02-03 19:17:12 - INFO - === LEYENDO DATOS PARA SECCIÓN: MASCOTAS_MANUFACTURADO ===
2026-02-03 19:17:12 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 19:17:12 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: mascotas_manufacturado
2026-02-03 19:17:12 - INFO - Archivo ABC encontrado para 'mascotas_manufacturado': .\./data/input\CLASIFICACION_ABC+D_mascotas_manufacturado.xlsx
2026-02-03 19:17:12 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_mascotas_manufacturado.xlsx
2026-02-03 19:17:13 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 19:17:13 - INFO - Clasificación ABC cargada para 'mascotas_manufacturado': 2749 registros
2026-02-03 19:17:13 - DEBUG - [DEBUG] ABC leído: 2749 registros
2026-02-03 19:17:13 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 19:17:13 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 19:17:13 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 19:17:16 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 19:17:16 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 19:17:16 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 19:17:17 - INFO - Ventas cargadas: 44082 registros
2026-02-03 19:17:17 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 19:17:17 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 19:17:17 - DEBUG - [DEBUG] Filtrando ventas por sección: mascotas_manufacturado
2026-02-03 19:17:17 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 19:17:17 - DEBUG -   maf: 10970 registros
2026-02-03 19:17:17 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 19:17:17 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 19:17:17 - DEBUG -   interior: 3624 registros
2026-02-03 19:17:17 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 19:17:17 - DEBUG -   deco_interior: 2468 registros
2026-02-03 19:17:17 - DEBUG -   vivero: 2460 registros
2026-02-03 19:17:17 - DEBUG -   fitos: 1987 registros
2026-02-03 19:17:17 - DEBUG -   semillas: 1180 registros
2026-02-03 19:17:17 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 19:17:17 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 19:17:17 - DEBUG - [DEBUG] Tras filtrar por 'mascotas_manufacturado': 9784 registros
2026-02-03 19:17:17 - INFO - Filtrados 9784 registros de sección 'mascotas_manufacturado' de 44082 total
2026-02-03 19:17:17 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 19:17:17 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 19:17:19 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 19:17:19 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 19:17:19 - INFO - Costes cargados: 22145 registros
2026-02-03 19:17:19 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 19:17:19 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 19:17:19 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA MASCOTAS_MANUFACTURADO ===
2026-02-03 19:17:19 - INFO -   ABC: 2749 registros
2026-02-03 19:17:19 - INFO -   Ventas: 9784 registros
2026-02-03 19:17:19 - INFO -   Costes: 22145 registros
2026-02-03 19:17:19 - DEBUG - [DEBUG] abc_df: 2749 registros
2026-02-03 19:17:19 - DEBUG - [DEBUG] ventas_df: 9784 registros
2026-02-03 19:17:19 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 19:17:20 - INFO - Datos de ventas: 822 registros
2026-02-03 19:17:20 - INFO - Calculando pedido para semana 14 (822 registros)
2026-02-03 19:17:21 - INFO -   Objetivo: 6839.82€, Actual (ABC): 8742.92€
2026-02-03 19:17:21 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 19:17:21 - INFO -   Factor total: 1.3125
2026-02-03 19:17:21 - INFO -   Factor escalado: 1.0268
2026-02-03 19:17:21 - INFO -   Ventas preliminares (con ceil): 12379.25€
2026-02-03 19:17:21 - INFO -   Objetivo final: 8977.26€
2026-02-03 19:17:21 - INFO -   Delta: 3401.99€
2026-02-03 19:17:21 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 19:17:21 - DEBUG -   Total registros: 538
2026-02-03 19:17:21 - DEBUG -   Registros con Unidades_Finales > 0: 411
2026-02-03 19:17:21 - DEBUG -   Ventas finales: 8993.98€
2026-02-03 19:17:21 - INFO -   Ventas finales: 8993.98€
2026-02-03 19:17:22 - INFO - 
============================================================
2026-02-03 19:17:22 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 19:17:22 - INFO - ============================================================
2026-02-03 19:17:22 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 19:17:22 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 19:17:22 - INFO - DataLoader inicializado correctamente
2026-02-03 19:17:22 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 19:17:22 - INFO - ============================================================
2026-02-03 19:17:22 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 19:17:22 - INFO - ============================================================
2026-02-03 19:17:22 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 19:17:22 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 19:17:22 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 19:17:22 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 19:17:22 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 19:17:22 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 19:17:22 - DEBUG - Usando hoja: Stock
2026-02-03 19:17:22 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 19:17:22 - INFO - Stock actual cargado: 30 registros
2026-02-03 19:17:22 - INFO -   Stock: 30 registros
2026-02-03 19:17:22 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 19:17:22 - INFO - Fusión completada: 538 registros
2026-02-03 19:17:22 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 19:17:22 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 19:17:22 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 19:17:22 - INFO - Corrección completada:
2026-02-03 19:17:22 - INFO -   - Artículos corregidos: 434/538
2026-02-03 19:17:22 - INFO -   - Artículos aumentados: 434
2026-02-03 19:17:22 - INFO -   - Artículos reducidos: 0
2026-02-03 19:17:22 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 19:17:22 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 19:17:22 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 19:17:22 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 538 registros
2026-02-03 19:17:22 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 19:17:22 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 19:17:22 - DEBUG -   Con valor 0: 107
2026-02-03 19:17:22 - DEBUG -   Con valor > 0: 407
2026-02-03 19:17:22 - DEBUG -   Suma Ventas_Objetivo: 8993.98€
2026-02-03 19:17:22 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 407 registros
2026-02-03 19:17:22 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx
2026-02-03 19:17:22 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx
2026-02-03 19:17:22 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx
2026-02-03 19:17:22 - INFO -   Articulos: 407
2026-02-03 19:17:22 - INFO -   Importe: 8966.44€
2026-02-03 19:17:22 - INFO - 
==================================================
2026-02-03 19:17:22 - INFO - SECCION: INTERIOR
2026-02-03 19:17:22 - INFO - ==================================================
2026-02-03 19:17:22 - INFO - === LEYENDO DATOS PARA SECCIÓN: INTERIOR ===
2026-02-03 19:17:22 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 19:17:22 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: interior
2026-02-03 19:17:22 - INFO - Archivo ABC encontrado para 'interior': .\./data/input\CLASIFICACION_ABC+D_interior.xlsx
2026-02-03 19:17:22 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_interior.xlsx
2026-02-03 19:17:22 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 19:17:22 - INFO - Clasificación ABC cargada para 'interior': 555 registros
2026-02-03 19:17:22 - DEBUG - [DEBUG] ABC leído: 555 registros
2026-02-03 19:17:22 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 19:17:22 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 19:17:22 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 19:17:26 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 19:17:26 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 19:17:26 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 19:17:26 - INFO - Ventas cargadas: 44082 registros
2026-02-03 19:17:26 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 19:17:26 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 19:17:26 - DEBUG - [DEBUG] Filtrando ventas por sección: interior
2026-02-03 19:17:26 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 19:17:26 - DEBUG -   maf: 10970 registros
2026-02-03 19:17:26 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 19:17:26 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 19:17:26 - DEBUG -   interior: 3624 registros
2026-02-03 19:17:26 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 19:17:26 - DEBUG -   deco_interior: 2468 registros
2026-02-03 19:17:26 - DEBUG -   vivero: 2460 registros
2026-02-03 19:17:26 - DEBUG -   fitos: 1987 registros
2026-02-03 19:17:26 - DEBUG -   semillas: 1180 registros
2026-02-03 19:17:26 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 19:17:26 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 19:17:26 - DEBUG - [DEBUG] Tras filtrar por 'interior': 3624 registros
2026-02-03 19:17:26 - INFO - Filtrados 3624 registros de sección 'interior' de 44082 total
2026-02-03 19:17:26 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 19:17:26 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 19:17:28 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 19:17:28 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 19:17:28 - INFO - Costes cargados: 22145 registros
2026-02-03 19:17:28 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 19:17:28 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 19:17:28 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA INTERIOR ===
2026-02-03 19:17:28 - INFO -   ABC: 555 registros
2026-02-03 19:17:28 - INFO -   Ventas: 3624 registros
2026-02-03 19:17:28 - INFO -   Costes: 22145 registros
2026-02-03 19:17:28 - DEBUG - [DEBUG] abc_df: 555 registros
2026-02-03 19:17:28 - DEBUG - [DEBUG] ventas_df: 3624 registros
2026-02-03 19:17:28 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 19:17:28 - INFO - Datos de ventas: 286 registros
2026-02-03 19:17:28 - INFO - Calculando pedido para semana 14 (286 registros)
2026-02-03 19:17:28 - INFO -   Objetivo: 2930.63€, Actual (ABC): 2409.44€
2026-02-03 19:17:28 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 19:17:28 - INFO -   Factor total: 1.3125
2026-02-03 19:17:28 - INFO -   Factor escalado: 1.5964
2026-02-03 19:17:28 - INFO -   Ventas preliminares (con ceil): 4541.81€
2026-02-03 19:17:28 - INFO -   Objetivo final: 3846.45€
2026-02-03 19:17:28 - INFO -   Delta: 695.36€
2026-02-03 19:17:28 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 19:17:28 - DEBUG -   Total registros: 138
2026-02-03 19:17:28 - DEBUG -   Registros con Unidades_Finales > 0: 121
2026-02-03 19:17:28 - DEBUG -   Ventas finales: 3855.17€
2026-02-03 19:17:28 - INFO -   Ventas finales: 3855.17€
2026-02-03 19:17:28 - INFO - 
============================================================
2026-02-03 19:17:28 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 19:17:28 - INFO - ============================================================
2026-02-03 19:17:28 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 19:17:28 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 19:17:28 - INFO - DataLoader inicializado correctamente
2026-02-03 19:17:28 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 19:17:28 - INFO - ============================================================
2026-02-03 19:17:28 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 19:17:28 - INFO - ============================================================
2026-02-03 19:17:28 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 19:17:28 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 19:17:28 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 19:17:28 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 19:17:28 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 19:17:28 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 19:17:28 - DEBUG - Usando hoja: Stock
2026-02-03 19:17:28 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 19:17:28 - INFO - Stock actual cargado: 30 registros
2026-02-03 19:17:28 - INFO -   Stock: 30 registros
2026-02-03 19:17:28 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 19:17:28 - INFO - Fusión completada: 138 registros
2026-02-03 19:17:28 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 19:17:28 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 19:17:28 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 19:17:28 - INFO - Corrección completada:
2026-02-03 19:17:28 - INFO -   - Artículos corregidos: 124/138
2026-02-03 19:17:28 - INFO -   - Artículos aumentados: 124
2026-02-03 19:17:28 - INFO -   - Artículos reducidos: 0
2026-02-03 19:17:28 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 19:17:28 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 19:17:28 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 19:17:28 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 138 registros
2026-02-03 19:17:28 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 19:17:28 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 19:17:28 - DEBUG -   Con valor 0: 15
2026-02-03 19:17:28 - DEBUG -   Con valor > 0: 118
2026-02-03 19:17:28 - DEBUG -   Suma Ventas_Objetivo: 3855.17€
2026-02-03 19:17:28 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 118 registros
2026-02-03 19:17:28 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_interior.xlsx
2026-02-03 19:17:28 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_interior.xlsx
2026-02-03 19:17:28 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_interior.xlsx
2026-02-03 19:17:28 - INFO -   Articulos: 118
2026-02-03 19:17:28 - INFO -   Importe: 3828.83€
2026-02-03 19:17:28 - INFO - 
==================================================
2026-02-03 19:17:28 - INFO - SECCION: FITOS
2026-02-03 19:17:28 - INFO - ==================================================
2026-02-03 19:17:28 - INFO - === LEYENDO DATOS PARA SECCIÓN: FITOS ===
2026-02-03 19:17:28 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 19:17:28 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: fitos
2026-02-03 19:17:28 - INFO - Archivo ABC encontrado para 'fitos': .\./data/input\CLASIFICACION_ABC+D_fitos.xlsx
2026-02-03 19:17:28 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_fitos.xlsx
2026-02-03 19:17:28 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 19:17:28 - INFO - Clasificación ABC cargada para 'fitos': 247 registros
2026-02-03 19:17:28 - DEBUG - [DEBUG] ABC leído: 247 registros
2026-02-03 19:17:28 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 19:17:28 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 19:17:28 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 19:17:33 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 19:17:33 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 19:17:33 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 19:17:33 - INFO - Ventas cargadas: 44082 registros
2026-02-03 19:17:33 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 19:17:33 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 19:17:33 - DEBUG - [DEBUG] Filtrando ventas por sección: fitos
2026-02-03 19:17:33 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 19:17:33 - DEBUG -   maf: 10970 registros
2026-02-03 19:17:33 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 19:17:33 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 19:17:33 - DEBUG -   interior: 3624 registros
2026-02-03 19:17:33 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 19:17:33 - DEBUG -   deco_interior: 2468 registros
2026-02-03 19:17:33 - DEBUG -   vivero: 2460 registros
2026-02-03 19:17:33 - DEBUG -   fitos: 1987 registros
2026-02-03 19:17:33 - DEBUG -   semillas: 1180 registros
2026-02-03 19:17:33 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 19:17:33 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 19:17:33 - DEBUG - [DEBUG] Tras filtrar por 'fitos': 1987 registros
2026-02-03 19:17:33 - INFO - Filtrados 1987 registros de sección 'fitos' de 44082 total
2026-02-03 19:17:33 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 19:17:33 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 19:17:35 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 19:17:35 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 19:17:35 - INFO - Costes cargados: 22145 registros
2026-02-03 19:17:35 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 19:17:35 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 19:17:35 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA FITOS ===
2026-02-03 19:17:35 - INFO -   ABC: 247 registros
2026-02-03 19:17:35 - INFO -   Ventas: 1987 registros
2026-02-03 19:17:35 - INFO -   Costes: 22145 registros
2026-02-03 19:17:35 - DEBUG - [DEBUG] abc_df: 247 registros
2026-02-03 19:17:35 - DEBUG - [DEBUG] ventas_df: 1987 registros
2026-02-03 19:17:35 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 19:17:35 - INFO - Datos de ventas: 157 registros
2026-02-03 19:17:35 - INFO - Calculando pedido para semana 14 (157 registros)
2026-02-03 19:17:36 - INFO -   Objetivo: 1798.25€, Actual (ABC): 1679.26€
2026-02-03 19:17:36 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 19:17:36 - INFO -   Factor total: 1.3125
2026-02-03 19:17:36 - INFO -   Factor escalado: 1.4055
2026-02-03 19:17:36 - INFO -   Ventas preliminares (con ceil): 2784.94€
2026-02-03 19:17:36 - INFO -   Objetivo final: 2360.20€
2026-02-03 19:17:36 - INFO -   Delta: 424.74€
2026-02-03 19:17:36 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 19:17:36 - DEBUG -   Total registros: 84
2026-02-03 19:17:36 - DEBUG -   Registros con Unidades_Finales > 0: 82
2026-02-03 19:17:36 - DEBUG -   Ventas finales: 2365.92€
2026-02-03 19:17:36 - INFO -   Ventas finales: 2365.92€
2026-02-03 19:17:36 - INFO - 
============================================================
2026-02-03 19:17:36 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 19:17:36 - INFO - ============================================================
2026-02-03 19:17:36 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 19:17:36 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 19:17:36 - INFO - DataLoader inicializado correctamente
2026-02-03 19:17:36 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 19:17:36 - INFO - ============================================================
2026-02-03 19:17:36 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 19:17:36 - INFO - ============================================================
2026-02-03 19:17:36 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 19:17:36 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 19:17:36 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 19:17:36 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 19:17:36 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 19:17:36 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 19:17:36 - DEBUG - Usando hoja: Stock
2026-02-03 19:17:36 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 19:17:36 - INFO - Stock actual cargado: 30 registros
2026-02-03 19:17:36 - INFO -   Stock: 30 registros
2026-02-03 19:17:36 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 19:17:36 - INFO - Fusión completada: 84 registros
2026-02-03 19:17:36 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 19:17:36 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 19:17:36 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 19:17:36 - INFO - Corrección completada:
2026-02-03 19:17:36 - INFO -   - Artículos corregidos: 83/84
2026-02-03 19:17:36 - INFO -   - Artículos aumentados: 83
2026-02-03 19:17:36 - INFO -   - Artículos reducidos: 0
2026-02-03 19:17:36 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 19:17:36 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 19:17:36 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 19:17:36 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 84 registros
2026-02-03 19:17:36 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 19:17:36 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 19:17:36 - DEBUG -   Con valor 0: 2
2026-02-03 19:17:36 - DEBUG -   Con valor > 0: 81
2026-02-03 19:17:36 - DEBUG -   Suma Ventas_Objetivo: 2365.92€
2026-02-03 19:17:36 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 81 registros
2026-02-03 19:17:36 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_fitos.xlsx
2026-02-03 19:17:36 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_fitos.xlsx
2026-02-03 19:17:36 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_fitos.xlsx
2026-02-03 19:17:36 - INFO -   Articulos: 81
2026-02-03 19:17:36 - INFO -   Importe: 2357.94€
2026-02-03 19:17:36 - INFO - 
==================================================
2026-02-03 19:17:36 - INFO - SECCION: VIVERO
2026-02-03 19:17:36 - INFO - ==================================================
2026-02-03 19:17:36 - INFO - === LEYENDO DATOS PARA SECCIÓN: VIVERO ===
2026-02-03 19:17:36 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 19:17:36 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: vivero
2026-02-03 19:17:36 - INFO - Archivo ABC encontrado para 'vivero': .\./data/input\CLASIFICACION_ABC+D_vivero.xlsx
2026-02-03 19:17:36 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_vivero.xlsx
2026-02-03 19:17:36 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 19:17:36 - INFO - Clasificación ABC cargada para 'vivero': 565 registros
2026-02-03 19:17:36 - DEBUG - [DEBUG] ABC leído: 565 registros
2026-02-03 19:17:36 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 19:17:36 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 19:17:36 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 19:17:40 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 19:17:40 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 19:17:40 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 19:17:40 - INFO - Ventas cargadas: 44082 registros
2026-02-03 19:17:40 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 19:17:40 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 19:17:40 - DEBUG - [DEBUG] Filtrando ventas por sección: vivero
2026-02-03 19:17:40 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 19:17:40 - DEBUG -   maf: 10970 registros
2026-02-03 19:17:40 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 19:17:40 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 19:17:40 - DEBUG -   interior: 3624 registros
2026-02-03 19:17:40 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 19:17:40 - DEBUG -   deco_interior: 2468 registros
2026-02-03 19:17:40 - DEBUG -   vivero: 2460 registros
2026-02-03 19:17:40 - DEBUG -   fitos: 1987 registros
2026-02-03 19:17:40 - DEBUG -   semillas: 1180 registros
2026-02-03 19:17:40 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 19:17:40 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 19:17:40 - DEBUG - [DEBUG] Tras filtrar por 'vivero': 2460 registros
2026-02-03 19:17:40 - INFO - Filtrados 2460 registros de sección 'vivero' de 44082 total
2026-02-03 19:17:40 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 19:17:40 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 19:17:42 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 19:17:42 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 19:17:42 - INFO - Costes cargados: 22145 registros
2026-02-03 19:17:42 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 19:17:42 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 19:17:42 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA VIVERO ===
2026-02-03 19:17:42 - INFO -   ABC: 565 registros
2026-02-03 19:17:42 - INFO -   Ventas: 2460 registros
2026-02-03 19:17:42 - INFO -   Costes: 22145 registros
2026-02-03 19:17:42 - DEBUG - [DEBUG] abc_df: 565 registros
2026-02-03 19:17:42 - DEBUG - [DEBUG] ventas_df: 2460 registros
2026-02-03 19:17:42 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 19:17:42 - INFO - Datos de ventas: 189 registros
2026-02-03 19:17:42 - INFO - Calculando pedido para semana 14 (189 registros)
2026-02-03 19:17:42 - INFO -   Objetivo: 5297.17€, Actual (ABC): 4113.14€
2026-02-03 19:17:42 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 19:17:42 - INFO -   Factor total: 1.3125
2026-02-03 19:17:42 - INFO -   Factor escalado: 1.6903
2026-02-03 19:17:42 - INFO -   Ventas preliminares (con ceil): 8761.94€
2026-02-03 19:17:42 - INFO -   Objetivo final: 6952.54€
2026-02-03 19:17:42 - INFO -   Delta: 1809.40€
2026-02-03 19:17:42 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 19:17:42 - DEBUG -   Total registros: 107
2026-02-03 19:17:42 - DEBUG -   Registros con Unidades_Finales > 0: 96
2026-02-03 19:17:42 - DEBUG -   Ventas finales: 6990.51€
2026-02-03 19:17:42 - INFO -   Ventas finales: 6990.51€
2026-02-03 19:17:42 - INFO - 
============================================================
2026-02-03 19:17:42 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 19:17:42 - INFO - ============================================================
2026-02-03 19:17:42 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 19:17:42 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 19:17:42 - INFO - DataLoader inicializado correctamente
2026-02-03 19:17:42 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 19:17:42 - INFO - ============================================================
2026-02-03 19:17:42 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 19:17:42 - INFO - ============================================================
2026-02-03 19:17:42 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 19:17:42 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 19:17:42 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 19:17:42 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 19:17:42 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 19:17:42 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 19:17:42 - DEBUG - Usando hoja: Stock
2026-02-03 19:17:42 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 19:17:42 - INFO - Stock actual cargado: 30 registros
2026-02-03 19:17:42 - INFO -   Stock: 30 registros
2026-02-03 19:17:42 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 19:17:42 - INFO - Fusión completada: 107 registros
2026-02-03 19:17:42 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 19:17:43 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 19:17:43 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 19:17:43 - INFO - Corrección completada:
2026-02-03 19:17:43 - INFO -   - Artículos corregidos: 97/107
2026-02-03 19:17:43 - INFO -   - Artículos aumentados: 97
2026-02-03 19:17:43 - INFO -   - Artículos reducidos: 0
2026-02-03 19:17:43 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 19:17:43 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 19:17:43 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 19:17:43 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 107 registros
2026-02-03 19:17:43 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 19:17:43 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 19:17:43 - DEBUG -   Con valor 0: 10
2026-02-03 19:17:43 - DEBUG -   Con valor > 0: 96
2026-02-03 19:17:43 - DEBUG -   Suma Ventas_Objetivo: 6990.51€
2026-02-03 19:17:43 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 96 registros
2026-02-03 19:17:43 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_vivero.xlsx
2026-02-03 19:17:43 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_vivero.xlsx
2026-02-03 19:17:43 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_vivero.xlsx
2026-02-03 19:17:43 - INFO -   Articulos: 96
2026-02-03 19:17:43 - INFO -   Importe: 6990.51€
2026-02-03 19:17:43 - INFO - 
==================================================
2026-02-03 19:17:43 - INFO - SECCION: UTILES_JARDIN
2026-02-03 19:17:43 - INFO - ==================================================
2026-02-03 19:17:43 - INFO - === LEYENDO DATOS PARA SECCIÓN: UTILES_JARDIN ===
2026-02-03 19:17:43 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 19:17:43 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: utiles_jardin
2026-02-03 19:17:43 - INFO - Archivo ABC encontrado para 'utiles_jardin': .\./data/input\CLASIFICACION_ABC+D_utiles_jardin.xlsx
2026-02-03 19:17:43 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_utiles_jardin.xlsx
2026-02-03 19:17:43 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 19:17:43 - INFO - Clasificación ABC cargada para 'utiles_jardin': 433 registros
2026-02-03 19:17:43 - DEBUG - [DEBUG] ABC leído: 433 registros
2026-02-03 19:17:43 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 19:17:43 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 19:17:43 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 19:17:47 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 19:17:47 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 19:17:47 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 19:17:47 - INFO - Ventas cargadas: 44082 registros
2026-02-03 19:17:47 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 19:17:47 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 19:17:47 - DEBUG - [DEBUG] Filtrando ventas por sección: utiles_jardin
2026-02-03 19:17:47 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 19:17:47 - DEBUG -   maf: 10970 registros
2026-02-03 19:17:47 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 19:17:47 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 19:17:47 - DEBUG -   interior: 3624 registros
2026-02-03 19:17:47 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 19:17:47 - DEBUG -   deco_interior: 2468 registros
2026-02-03 19:17:47 - DEBUG -   vivero: 2460 registros
2026-02-03 19:17:47 - DEBUG -   fitos: 1987 registros
2026-02-03 19:17:47 - DEBUG -   semillas: 1180 registros
2026-02-03 19:17:47 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 19:17:47 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 19:17:47 - DEBUG - [DEBUG] Tras filtrar por 'utiles_jardin': 1009 registros
2026-02-03 19:17:47 - INFO - Filtrados 1009 registros de sección 'utiles_jardin' de 44082 total
2026-02-03 19:17:47 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 19:17:47 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 19:17:49 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 19:17:49 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 19:17:49 - INFO - Costes cargados: 22145 registros
2026-02-03 19:17:49 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 19:17:49 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 19:17:49 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA UTILES_JARDIN ===
2026-02-03 19:17:49 - INFO -   ABC: 433 registros
2026-02-03 19:17:49 - INFO -   Ventas: 1009 registros
2026-02-03 19:17:49 - INFO -   Costes: 22145 registros
2026-02-03 19:17:49 - DEBUG - [DEBUG] abc_df: 433 registros
2026-02-03 19:17:49 - DEBUG - [DEBUG] ventas_df: 1009 registros
2026-02-03 19:17:49 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 19:17:49 - INFO - Datos de ventas: 89 registros
2026-02-03 19:17:49 - INFO - Calculando pedido para semana 14 (89 registros)
2026-02-03 19:17:50 - INFO -   Objetivo: 1044.77€, Actual (ABC): 818.79€
2026-02-03 19:17:50 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 19:17:50 - INFO -   Factor total: 1.3125
2026-02-03 19:17:50 - INFO -   Factor escalado: 1.6747
2026-02-03 19:17:50 - INFO -   Ventas preliminares (con ceil): 1929.56€
2026-02-03 19:17:50 - INFO -   Objetivo final: 1371.26€
2026-02-03 19:17:50 - INFO -   Delta: 558.30€
2026-02-03 19:17:50 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 19:17:50 - DEBUG -   Total registros: 78
2026-02-03 19:17:50 - DEBUG -   Registros con Unidades_Finales > 0: 78
2026-02-03 19:17:50 - DEBUG -   Ventas finales: 1390.00€
2026-02-03 19:17:50 - INFO -   Ventas finales: 1390.00€
2026-02-03 19:17:50 - INFO - 
============================================================
2026-02-03 19:17:50 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 19:17:50 - INFO - ============================================================
2026-02-03 19:17:50 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 19:17:50 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 19:17:50 - INFO - DataLoader inicializado correctamente
2026-02-03 19:17:50 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 19:17:50 - INFO - ============================================================
2026-02-03 19:17:50 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 19:17:50 - INFO - ============================================================
2026-02-03 19:17:50 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 19:17:50 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 19:17:50 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 19:17:50 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 19:17:50 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 19:17:50 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 19:17:50 - DEBUG - Usando hoja: Stock
2026-02-03 19:17:50 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 19:17:50 - INFO - Stock actual cargado: 30 registros
2026-02-03 19:17:50 - INFO -   Stock: 30 registros
2026-02-03 19:17:50 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 19:17:50 - INFO - Fusión completada: 78 registros
2026-02-03 19:17:50 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 19:17:50 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 19:17:50 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 19:17:50 - INFO - Corrección completada:
2026-02-03 19:17:50 - INFO -   - Artículos corregidos: 78/78
2026-02-03 19:17:50 - INFO -   - Artículos aumentados: 78
2026-02-03 19:17:50 - INFO -   - Artículos reducidos: 0
2026-02-03 19:17:50 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 19:17:50 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 19:17:50 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 19:17:50 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 78 registros
2026-02-03 19:17:50 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 19:17:50 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 19:17:50 - DEBUG -   Con valor 0: 0
2026-02-03 19:17:50 - DEBUG -   Con valor > 0: 78
2026-02-03 19:17:50 - DEBUG -   Suma Ventas_Objetivo: 1390.00€
2026-02-03 19:17:50 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 78 registros
2026-02-03 19:17:50 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx
2026-02-03 19:17:50 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx
2026-02-03 19:17:50 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx
2026-02-03 19:17:50 - INFO -   Articulos: 78
2026-02-03 19:17:50 - INFO -   Importe: 1390.00€
2026-02-03 19:17:50 - INFO - 
==================================================
2026-02-03 19:17:50 - INFO - SECCION: TIERRAS_ARIDOS
2026-02-03 19:17:50 - INFO - ==================================================
2026-02-03 19:17:50 - INFO - === LEYENDO DATOS PARA SECCIÓN: TIERRAS_ARIDOS ===
2026-02-03 19:17:50 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 19:17:50 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: tierras_aridos
2026-02-03 19:17:50 - WARNING - No se encontró archivo específico para 'tierras_aridos', usando: .\./data/input\CLASIFICACION_ABC+D_DECO_EXTERIOR.xlsx
2026-02-03 19:17:50 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_DECO_EXTERIOR.xlsx
2026-02-03 19:17:50 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 19:17:50 - INFO - Clasificación ABC cargada para 'tierras_aridos': 995 registros
2026-02-03 19:17:50 - DEBUG - [DEBUG] ABC leído: 995 registros
2026-02-03 19:17:50 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 19:17:50 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 19:17:50 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 19:17:54 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 19:17:54 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 19:17:54 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 19:17:54 - INFO - Ventas cargadas: 44082 registros
2026-02-03 19:17:54 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 19:17:54 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 19:17:54 - DEBUG - [DEBUG] Filtrando ventas por sección: tierras_aridos
2026-02-03 19:17:54 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 19:17:54 - DEBUG -   maf: 10970 registros
2026-02-03 19:17:54 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 19:17:54 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 19:17:54 - DEBUG -   interior: 3624 registros
2026-02-03 19:17:54 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 19:17:54 - DEBUG -   deco_interior: 2468 registros
2026-02-03 19:17:54 - DEBUG -   vivero: 2460 registros
2026-02-03 19:17:54 - DEBUG -   fitos: 1987 registros
2026-02-03 19:17:54 - DEBUG -   semillas: 1180 registros
2026-02-03 19:17:54 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 19:17:54 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 19:17:54 - DEBUG - [DEBUG] Tras filtrar por 'tierras_aridos': 3264 registros
2026-02-03 19:17:54 - INFO - Filtrados 3264 registros de sección 'tierras_aridos' de 44082 total
2026-02-03 19:17:54 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 19:17:54 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 19:17:56 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 19:17:56 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 19:17:56 - INFO - Costes cargados: 22145 registros
2026-02-03 19:17:56 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 19:17:56 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 19:17:56 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA TIERRAS_ARIDOS ===
2026-02-03 19:17:56 - INFO -   ABC: 995 registros
2026-02-03 19:17:56 - INFO -   Ventas: 3264 registros
2026-02-03 19:17:56 - INFO -   Costes: 22145 registros
2026-02-03 19:17:56 - DEBUG - [DEBUG] abc_df: 995 registros
2026-02-03 19:17:56 - DEBUG - [DEBUG] ventas_df: 3264 registros
2026-02-03 19:17:56 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 19:17:56 - INFO - Datos de ventas: 302 registros
2026-02-03 19:17:56 - INFO - Calculando pedido para semana 14 (302 registros)
2026-02-03 19:17:57 - INFO -   Objetivo: 4097.24€, Actual (ABC): 4019.19€
2026-02-03 19:17:57 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 19:17:57 - INFO -   Factor total: 1.3125
2026-02-03 19:17:57 - INFO -   Factor escalado: 1.3380
2026-02-03 19:17:57 - INFO -   Ventas preliminares (con ceil): 5809.66€
2026-02-03 19:17:57 - INFO -   Objetivo final: 5377.63€
2026-02-03 19:17:57 - INFO -   Delta: 432.03€
2026-02-03 19:17:57 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 19:17:57 - DEBUG -   Total registros: 72
2026-02-03 19:17:57 - DEBUG -   Registros con Unidades_Finales > 0: 71
2026-02-03 19:17:57 - DEBUG -   Ventas finales: 5387.14€
2026-02-03 19:17:57 - INFO -   Ventas finales: 5387.14€
2026-02-03 19:17:57 - INFO - 
============================================================
2026-02-03 19:17:57 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 19:17:57 - INFO - ============================================================
2026-02-03 19:17:57 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 19:17:57 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 19:17:57 - INFO - DataLoader inicializado correctamente
2026-02-03 19:17:57 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 19:17:57 - INFO - ============================================================
2026-02-03 19:17:57 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 19:17:57 - INFO - ============================================================
2026-02-03 19:17:57 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 19:17:57 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 19:17:57 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 19:17:57 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 19:17:57 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 19:17:57 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 19:17:57 - DEBUG - Usando hoja: Stock
2026-02-03 19:17:57 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 19:17:57 - INFO - Stock actual cargado: 30 registros
2026-02-03 19:17:57 - INFO -   Stock: 30 registros
2026-02-03 19:17:57 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 19:17:57 - INFO - Fusión completada: 72 registros
2026-02-03 19:17:57 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 19:17:57 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 19:17:57 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 19:17:57 - INFO - Corrección completada:
2026-02-03 19:17:57 - INFO -   - Artículos corregidos: 72/72
2026-02-03 19:17:57 - INFO -   - Artículos aumentados: 72
2026-02-03 19:17:57 - INFO -   - Artículos reducidos: 0
2026-02-03 19:17:57 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 19:17:57 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 19:17:57 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 19:17:57 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 72 registros
2026-02-03 19:17:57 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 19:17:57 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 19:17:57 - DEBUG -   Con valor 0: 1
2026-02-03 19:17:57 - DEBUG -   Con valor > 0: 70
2026-02-03 19:17:57 - DEBUG -   Suma Ventas_Objetivo: 5387.14€
2026-02-03 19:17:57 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 70 registros
2026-02-03 19:17:57 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx
2026-02-03 19:17:57 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx
2026-02-03 19:17:57 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx
2026-02-03 19:17:57 - INFO -   Articulos: 70
2026-02-03 19:17:57 - INFO -   Importe: 5381.35€
2026-02-03 19:17:57 - INFO - 
==================================================
2026-02-03 19:17:57 - INFO - SECCION: DECO_EXTERIOR
2026-02-03 19:17:57 - INFO - ==================================================
2026-02-03 19:17:57 - INFO - === LEYENDO DATOS PARA SECCIÓN: DECO_EXTERIOR ===
2026-02-03 19:17:57 - DEBUG - [DEBUG] Secciones activas configuradas: ['maf', 'deco_interior', 'semillas', 'mascotas_vivo', 'mascotas_manufacturado', 'interior', 'fitos', 'vivero', 'utiles_jardin', 'tierras_aridos', 'deco_exterior']
2026-02-03 19:17:57 - DEBUG - [DEBUG] Intentando leer clasificación ABC para sección: deco_exterior
2026-02-03 19:17:57 - INFO - Archivo ABC encontrado para 'deco_exterior': .\./data/input\CLASIFICACION_ABC+D_deco_exterior.xlsx
2026-02-03 19:17:57 - INFO - Leyendo archivo: .\./data/input\CLASIFICACION_ABC+D_deco_exterior.xlsx
2026-02-03 19:17:57 - INFO - Archivo leído exitosamente: 4 hojas
2026-02-03 19:17:57 - INFO - Clasificación ABC cargada para 'deco_exterior': 995 registros
2026-02-03 19:17:57 - DEBUG - [DEBUG] ABC leído: 995 registros
2026-02-03 19:17:57 - DEBUG - [DEBUG] Columnas en ABC: ['Artículo', 'Nombre artículo', 'Talla', 'Color', 'Familia', 'Nombre Familia', 'Rotación Familia (días)', 'Ventas (unidades)', 'Importe ventas (€)', 'Beneficio (importe €)', 'Tasa de venta (%)', 'Rotación excedida (unidades)', 'Stock mínimo (unidades)', 'Stock máximo (unidades)', 'Stock Final (unidades)', 'Antigüedad Última Venta (días)', 'Antigüedad Stock (días)', '% Rotación Consumido', 'Descuento Sugerido (%)', 'Riesgo de Merma/ inmovilizado', 'Acción Sugerida', 'Origen Stock Final', 'Escenario', 'Categoria', 'Clave']
2026-02-03 19:17:57 - DEBUG - [DEBUG] Intentando leer archivo de ventas...
2026-02-03 19:17:57 - INFO - Leyendo archivo: .\./data/input\Ventas.xlsx
2026-02-03 19:18:01 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 19:18:01 - INFO - Usando hoja: Ventas por vendedor
2026-02-03 19:18:01 - INFO - Filtrados 44082 registros de tipo 'Detalle'
2026-02-03 19:18:01 - INFO - Ventas cargadas: 44082 registros
2026-02-03 19:18:01 - DEBUG - [DEBUG] Ventas leído: 44082 registros
2026-02-03 19:18:01 - DEBUG - [DEBUG] Columnas en Ventas: ['Vendedor', 'Serie', 'Documento', 'Fecha', 'Factura', 'Artículo', 'Nombre artículo', 'Talla', 'Color', 'Unidades', 'Precio', 'Importe', 'Comisión', 'Tipo registro', 'Codigo', 'Nombre']
2026-02-03 19:18:01 - DEBUG - [DEBUG] Filtrando ventas por sección: deco_exterior
2026-02-03 19:18:01 - DEBUG - [DEBUG] Distribución de secciones antes de filtrar:
2026-02-03 19:18:01 - DEBUG -   maf: 10970 registros
2026-02-03 19:18:01 - DEBUG -   mascotas_manufacturado: 9784 registros
2026-02-03 19:18:01 - DEBUG -   deco_exterior: 4018 registros
2026-02-03 19:18:01 - DEBUG -   interior: 3624 registros
2026-02-03 19:18:01 - DEBUG -   tierras_aridos: 3264 registros
2026-02-03 19:18:01 - DEBUG -   deco_interior: 2468 registros
2026-02-03 19:18:01 - DEBUG -   vivero: 2460 registros
2026-02-03 19:18:01 - DEBUG -   fitos: 1987 registros
2026-02-03 19:18:01 - DEBUG -   semillas: 1180 registros
2026-02-03 19:18:01 - DEBUG -   mascotas_vivo: 1124 registros
2026-02-03 19:18:01 - DEBUG -   utiles_jardin: 1009 registros
2026-02-03 19:18:01 - DEBUG - [DEBUG] Tras filtrar por 'deco_exterior': 4018 registros
2026-02-03 19:18:01 - INFO - Filtrados 4018 registros de sección 'deco_exterior' de 44082 total
2026-02-03 19:18:01 - DEBUG - [DEBUG] Intentando leer archivo de costes...
2026-02-03 19:18:01 - INFO - Leyendo archivo: .\./data/input\Coste.xlsx
2026-02-03 19:18:03 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 19:18:03 - DEBUG - Usando primera hoja del archivo de costes: INFORME
2026-02-03 19:18:03 - INFO - Costes cargados: 22145 registros
2026-02-03 19:18:03 - DEBUG - [DEBUG] Costes leído: 22145 registros
2026-02-03 19:18:03 - DEBUG - [DEBUG] Columnas en Costes: ['Codigo', 'Nombre', 'Tarifa10', 'Talla', 'Color', 'Proveedor', 'Nombre proveedor', 'Barras', 'Codigo antiguo', 'Ref proveedor', 'Coste', 'Fecha ultcom', 'Margen subf', 'Margen', 'Clave']
2026-02-03 19:18:03 - INFO - === DATOS LEÍDOS CORRECTAMENTE PARA DECO_EXTERIOR ===
2026-02-03 19:18:03 - INFO -   ABC: 995 registros
2026-02-03 19:18:03 - INFO -   Ventas: 4018 registros
2026-02-03 19:18:03 - INFO -   Costes: 22145 registros
2026-02-03 19:18:03 - DEBUG - [DEBUG] abc_df: 995 registros
2026-02-03 19:18:03 - DEBUG - [DEBUG] ventas_df: 4018 registros
2026-02-03 19:18:03 - DEBUG - [DEBUG] costes_df: 22145 registros
2026-02-03 19:18:03 - INFO - Datos de ventas: 316 registros
2026-02-03 19:18:03 - INFO - Calculando pedido para semana 14 (316 registros)
2026-02-03 19:18:04 - INFO -   Objetivo: 3740.34€, Actual (ABC): 4104.66€
2026-02-03 19:18:04 - INFO -   Factor crecimiento: 0.05, Factor festivo: 0.25
2026-02-03 19:18:04 - INFO -   Factor total: 1.3125
2026-02-03 19:18:04 - INFO -   Factor escalado: 1.1960
2026-02-03 19:18:04 - INFO -   Ventas preliminares (con ceil): 6094.59€
2026-02-03 19:18:04 - INFO -   Objetivo final: 4909.20€
2026-02-03 19:18:04 - INFO -   Delta: 1185.39€
2026-02-03 19:18:04 - DEBUG - [DEBUG] Resumen final del cálculo:
2026-02-03 19:18:04 - DEBUG -   Total registros: 224
2026-02-03 19:18:04 - DEBUG -   Registros con Unidades_Finales > 0: 205
2026-02-03 19:18:04 - DEBUG -   Ventas finales: 4923.89€
2026-02-03 19:18:04 - INFO -   Ventas finales: 4923.89€
2026-02-03 19:18:04 - INFO - 
============================================================
2026-02-03 19:18:04 - INFO - FASE 2: APLICANDO CORRECCIÓN AL PEDIDO
2026-02-03 19:18:04 - INFO - ============================================================
2026-02-03 19:18:04 - INFO - Archivo de stock encontrado: Stock_actual.xlsx
2026-02-03 19:18:04 - INFO - Archivos de corrección disponibles: {'stock': True, 'ventas': False, 'compras': False}
2026-02-03 19:18:04 - INFO - DataLoader inicializado correctamente
2026-02-03 19:18:04 - INFO - CorrectionDataLoader inicializado correctamente
2026-02-03 19:18:04 - INFO - ============================================================
2026-02-03 19:18:04 - INFO - CARGANDO DATOS DE CORRECCIÓN PARA SEMANA 14
2026-02-03 19:18:04 - INFO - ============================================================
2026-02-03 19:18:04 - WARNING - Archivo de corrección no encontrado: Stock_actual_Semana_14.xlsx
2026-02-03 19:18:04 - WARNING - Archivo de corrección no encontrado: Stock_semana_14.xlsx
2026-02-03 19:18:04 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 19:18:04 - INFO - Archivo de corrección encontrado: .\./data/input\Stock_actual.xlsx
2026-02-03 19:18:04 - INFO - Leyendo archivo de corrección: .\./data/input\Stock_actual.xlsx
2026-02-03 19:18:04 - INFO - Archivo leído exitosamente: 1 hojas
2026-02-03 19:18:04 - DEBUG - Usando hoja: Stock
2026-02-03 19:18:04 - DEBUG - Columnas renombradas en stock: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Stock_Fisico', 'Fecha_Ultimo_Movimiento']
2026-02-03 19:18:04 - INFO - Stock actual cargado: 30 registros
2026-02-03 19:18:04 - INFO -   Stock: 30 registros
2026-02-03 19:18:04 - INFO - Fusionando datos de corrección con pedido teórico...
2026-02-03 19:18:04 - INFO - Fusión completada: 224 registros
2026-02-03 19:18:04 - INFO - CorrectionEngine inicializado correctamente
2026-02-03 19:18:04 - DEBUG - Política de stock mínimo: {'A': 1.5, 'B': 1.0, 'C': 0.5, 'D': 0.0}
2026-02-03 19:18:04 - INFO - Aplicando corrección a DataFrame de pedidos...
2026-02-03 19:18:04 - INFO - Corrección completada:
2026-02-03 19:18:04 - INFO -   - Artículos corregidos: 207/224
2026-02-03 19:18:04 - INFO -   - Artículos aumentados: 207
2026-02-03 19:18:04 - INFO -   - Artículos reducidos: 0
2026-02-03 19:18:04 - ERROR - Error al aplicar corrección: 'Unidades_Vendidas'
2026-02-03 19:18:04 - ERROR - Traceback (most recent call last):
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Unidades_Vendidas'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\main.py", line 276, in aplicar_correccion_pedido
    alertas = engine.generar_alertas(pedido_corregido)
  File "D:\ALMACENAMIENTO\Ivan\viveverde\Trabajos\IA\vivero_pedidos\PROGRAMA_PEDIDOS\src\correction_engine.py", line 590, in generar_alertas
    sin_ventas_con_stock = df[(df['Unidades_Vendidas'] == 0) & (df['Stock_Fisico'] > 0)]
                               ~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\idalo\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Unidades_Vendidas'

2026-02-03 19:18:04 - INFO - Usando pedido teórico (sin corrección)
2026-02-03 19:18:04 - DEBUG - [DEBUG generar_archivo_pedido] Recibido DataFrame con 224 registros
2026-02-03 19:18:04 - DEBUG - [DEBUG] Columnas disponibles: ['Codigo_Articulo', 'Nombre_Articulo', 'Talla', 'Color', 'Seccion', 'Unidades_Base', 'Unidades_ABC', 'PVP', 'Coste_Pedido', 'Proveedor', 'Categoria', 'Accion_Aplicada', 'Peso_Categoria', 'Ventas_Preliminares', 'Unidades_Escaladas', 'Unidades_Finales', 'Ventas_Objetivo', 'Beneficio_Objetivo', 'Stock_Minimo_Objetivo', 'Unidades_Pedido', 'Diferencia_Stock']
2026-02-03 19:18:04 - DEBUG - [DEBUG] Distribución de Unidades_Pedido:
2026-02-03 19:18:04 - DEBUG -   Con valor 0: 22
2026-02-03 19:18:04 - DEBUG -   Con valor > 0: 198
2026-02-03 19:18:04 - DEBUG -   Suma Ventas_Objetivo: 4923.89€
2026-02-03 19:18:04 - DEBUG - [DEBUG] Tras filtrar Unidades_Pedido > 0: 198 registros
2026-02-03 19:18:04 - INFO - Generando archivo: .\./data/output\Pedido_Semana_14_2026-02-03_deco_exterior.xlsx
2026-02-03 19:18:04 - INFO - Archivo guardado: .\./data/output\Pedido_Semana_14_2026-02-03_deco_exterior.xlsx
2026-02-03 19:18:04 - INFO - Archivo generado: .\./data/output\Pedido_Semana_14_2026-02-03_deco_exterior.xlsx
2026-02-03 19:18:04 - INFO -   Articulos: 198
2026-02-03 19:18:04 - INFO -   Importe: 4907.09€
2026-02-03 19:18:04 - INFO - Estado guardado correctamente
2026-02-03 19:18:04 - INFO - Generando resumen: .\./data/output\Resumen_Pedidos_VIVERO_2026-02-03.xlsx
2026-02-03 19:18:04 - ERROR - Error al generar resumen: [Errno 13] Permission denied: '.\\./data/output\\Resumen_Pedidos_VIVERO_2026-02-03.xlsx'
2026-02-03 19:18:04 - INFO - Estado guardado correctamente
2026-02-03 19:18:04 - INFO - 
============================================================
2026-02-03 19:18:04 - INFO - PREPARANDO ENVÍO DE EMAILS
2026-02-03 19:18:04 - INFO - ============================================================
2026-02-03 19:18:04 - DEBUG - [DEBUG] Archivos agrupados por sección: {'maf': ['.\\./data/output\\Pedido_Semana_14_2026-02-03_maf.xlsx'], 'deco_interior': ['.\\./data/output\\Pedido_Semana_14_2026-02-03_deco_interior.xlsx'], 'semillas': ['.\\./data/output\\Pedido_Semana_14_2026-02-03_semillas.xlsx'], 'mascotas_vivo': ['.\\./data/output\\Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx'], 'mascotas_manufacturado': ['.\\./data/output\\Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx'], 'interior': ['.\\./data/output\\Pedido_Semana_14_2026-02-03_interior.xlsx'], 'fitos': ['.\\./data/output\\Pedido_Semana_14_2026-02-03_fitos.xlsx'], 'vivero': ['.\\./data/output\\Pedido_Semana_14_2026-02-03_vivero.xlsx'], 'utiles_jardin': ['.\\./data/output\\Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx'], 'tierras_aridos': ['.\\./data/output\\Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx'], 'deco_exterior': ['.\\./data/output\\Pedido_Semana_14_2026-02-03_deco_exterior.xlsx']}
2026-02-03 19:18:04 - INFO - 
============================================================
2026-02-03 19:18:04 - INFO - ENVÍO DE EMAILS A RESPONSABLES
2026-02-03 19:18:04 - INFO - ============================================================
2026-02-03 19:18:04 - DEBUG - [DEBUG] SMTP configurado: {'servidor': 'smtp.serviciodecorreo.es', 'puerto': 465, 'usar_ssl': True, 'usar_tls': False}
2026-02-03 19:18:04 - DEBUG - [DEBUG] Remitente: {'email': 'ivan.delgado@viveverde.es', 'nombre': 'Sistema de Pedidos VIVEVERDE'}
2026-02-03 19:18:04 - DEBUG - [DEBUG] Destinatarios: {'maf': 'ivan.delgado@viveverde.es', 'interior': 'ivan.delgado@viveverde.es', 'mascotas_vivo': 'ivan.delgado@viveverde.es', 'mascotas_manufacturado': 'ivan.delgado@viveverde.es', 'deco_interior': ['ivan.delgado@viveverde.es', 'ivan.delgado@viveverde.es'], 'deco_exterior': 'ivan.delgado@viveverde.es', 'tierras_aridos': 'ivan.delgado@viveverde.es', 'fitos': 'ivan.delgado@viveverde.es', 'semillas': 'ivan.delgado@viveverde.es', 'utiles_jardin': 'ivan.delgado@viveverde.es', 'vivero': 'ivan.delgado@viveverde.es'}
2026-02-03 19:18:04 - INFO - EmailService inicializado correctamente
2026-02-03 19:18:04 - INFO - 
Enviando email para sección: maf
2026-02-03 19:18:04 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_maf.xlsx']
2026-02-03 19:18:04 - INFO - ============================================================
2026-02-03 19:18:04 - INFO - ENVIANDO EMAIL PARA SECCIÓN: MAF
2026-02-03 19:18:04 - INFO - ============================================================
2026-02-03 19:18:04 - DEBUG - [DEBUG] Destinatarios para maf: [{'email': 'ivan.delgado@viveverde.es', 'nombre': 'Encargado'}]
2026-02-03 19:18:04 - INFO - Destinatarios: ['ivan.delgado@viveverde.es']
2026-02-03 19:18:04 - INFO - Archivos a enviar: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_maf.xlsx']
2026-02-03 19:18:04 - INFO - Archivo adjuntado: Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 19:18:04 - INFO - Email enviado exitosamente a: ivan.delgado@viveverde.es
2026-02-03 19:18:04 - INFO - ✓ Email enviado exitosamente para maf
2026-02-03 19:18:04 - INFO - ✓ Email enviado exitosamente a maf
2026-02-03 19:18:04 - INFO - 
Enviando email para sección: deco_interior
2026-02-03 19:18:04 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_deco_interior.xlsx']
2026-02-03 19:18:04 - INFO - ============================================================
2026-02-03 19:18:04 - INFO - ENVIANDO EMAIL PARA SECCIÓN: DECO_INTERIOR
2026-02-03 19:18:04 - INFO - ============================================================
2026-02-03 19:18:04 - DEBUG - [DEBUG] Destinatarios para deco_interior: [{'email': 'ivan.delgado@viveverde.es', 'nombre': 'Encargado'}, {'email': 'ivan.delgado@viveverde.es', 'nombre': 'Encargado'}]
2026-02-03 19:18:04 - INFO - Destinatarios: ['ivan.delgado@viveverde.es', 'ivan.delgado@viveverde.es']
2026-02-03 19:18:04 - INFO - Archivos a enviar: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_deco_interior.xlsx']
2026-02-03 19:18:04 - INFO - Archivo adjuntado: Pedido_Semana_14_2026-02-03_deco_interior.xlsx
2026-02-03 19:18:05 - INFO - Email enviado exitosamente a: ivan.delgado@viveverde.es, ivan.delgado@viveverde.es
2026-02-03 19:18:05 - INFO - ✓ Email enviado exitosamente para deco_interior
2026-02-03 19:18:05 - INFO - ✓ Email enviado exitosamente a deco_interior
2026-02-03 19:18:05 - INFO - 
Enviando email para sección: semillas
2026-02-03 19:18:05 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_semillas.xlsx']
2026-02-03 19:18:05 - INFO - ============================================================
2026-02-03 19:18:05 - INFO - ENVIANDO EMAIL PARA SECCIÓN: SEMILLAS
2026-02-03 19:18:05 - INFO - ============================================================
2026-02-03 19:18:05 - DEBUG - [DEBUG] Destinatarios para semillas: [{'email': 'ivan.delgado@viveverde.es', 'nombre': 'Encargado'}]
2026-02-03 19:18:05 - INFO - Destinatarios: ['ivan.delgado@viveverde.es']
2026-02-03 19:18:05 - INFO - Archivos a enviar: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_semillas.xlsx']
2026-02-03 19:18:05 - INFO - Archivo adjuntado: Pedido_Semana_14_2026-02-03_semillas.xlsx
2026-02-03 19:18:05 - INFO - Email enviado exitosamente a: ivan.delgado@viveverde.es
2026-02-03 19:18:05 - INFO - ✓ Email enviado exitosamente para semillas
2026-02-03 19:18:05 - INFO - ✓ Email enviado exitosamente a semillas
2026-02-03 19:18:05 - INFO - 
Enviando email para sección: mascotas_vivo
2026-02-03 19:18:05 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx']
2026-02-03 19:18:05 - INFO - ============================================================
2026-02-03 19:18:05 - INFO - ENVIANDO EMAIL PARA SECCIÓN: MASCOTAS_VIVO
2026-02-03 19:18:05 - INFO - ============================================================
2026-02-03 19:18:05 - DEBUG - [DEBUG] Destinatarios para mascotas_vivo: [{'email': 'ivan.delgado@viveverde.es', 'nombre': 'Encargado'}]
2026-02-03 19:18:05 - INFO - Destinatarios: ['ivan.delgado@viveverde.es']
2026-02-03 19:18:05 - INFO - Archivos a enviar: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx']
2026-02-03 19:18:05 - INFO - Archivo adjuntado: Pedido_Semana_14_2026-02-03_mascotas_vivo.xlsx
2026-02-03 19:18:05 - INFO - Email enviado exitosamente a: ivan.delgado@viveverde.es
2026-02-03 19:18:05 - INFO - ✓ Email enviado exitosamente para mascotas_vivo
2026-02-03 19:18:05 - INFO - ✓ Email enviado exitosamente a mascotas_vivo
2026-02-03 19:18:05 - INFO - 
Enviando email para sección: mascotas_manufacturado
2026-02-03 19:18:05 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx']
2026-02-03 19:18:05 - INFO - ============================================================
2026-02-03 19:18:05 - INFO - ENVIANDO EMAIL PARA SECCIÓN: MASCOTAS_MANUFACTURADO
2026-02-03 19:18:05 - INFO - ============================================================
2026-02-03 19:18:05 - DEBUG - [DEBUG] Destinatarios para mascotas_manufacturado: [{'email': 'ivan.delgado@viveverde.es', 'nombre': 'Encargado'}]
2026-02-03 19:18:05 - INFO - Destinatarios: ['ivan.delgado@viveverde.es']
2026-02-03 19:18:05 - INFO - Archivos a enviar: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx']
2026-02-03 19:18:05 - INFO - Archivo adjuntado: Pedido_Semana_14_2026-02-03_mascotas_manufacturado.xlsx
2026-02-03 19:18:06 - INFO - Email enviado exitosamente a: ivan.delgado@viveverde.es
2026-02-03 19:18:06 - INFO - ✓ Email enviado exitosamente para mascotas_manufacturado
2026-02-03 19:18:06 - INFO - ✓ Email enviado exitosamente a mascotas_manufacturado
2026-02-03 19:18:06 - INFO - 
Enviando email para sección: interior
2026-02-03 19:18:06 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_interior.xlsx']
2026-02-03 19:18:06 - INFO - ============================================================
2026-02-03 19:18:06 - INFO - ENVIANDO EMAIL PARA SECCIÓN: INTERIOR
2026-02-03 19:18:06 - INFO - ============================================================
2026-02-03 19:18:06 - DEBUG - [DEBUG] Destinatarios para interior: [{'email': 'ivan.delgado@viveverde.es', 'nombre': 'Encargado'}]
2026-02-03 19:18:06 - INFO - Destinatarios: ['ivan.delgado@viveverde.es']
2026-02-03 19:18:06 - INFO - Archivos a enviar: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_interior.xlsx']
2026-02-03 19:18:06 - INFO - Archivo adjuntado: Pedido_Semana_14_2026-02-03_interior.xlsx
2026-02-03 19:18:06 - INFO - Email enviado exitosamente a: ivan.delgado@viveverde.es
2026-02-03 19:18:06 - INFO - ✓ Email enviado exitosamente para interior
2026-02-03 19:18:06 - INFO - ✓ Email enviado exitosamente a interior
2026-02-03 19:18:06 - INFO - 
Enviando email para sección: fitos
2026-02-03 19:18:06 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_fitos.xlsx']
2026-02-03 19:18:06 - INFO - ============================================================
2026-02-03 19:18:06 - INFO - ENVIANDO EMAIL PARA SECCIÓN: FITOS
2026-02-03 19:18:06 - INFO - ============================================================
2026-02-03 19:18:06 - DEBUG - [DEBUG] Destinatarios para fitos: [{'email': 'ivan.delgado@viveverde.es', 'nombre': 'Encargado'}]
2026-02-03 19:18:06 - INFO - Destinatarios: ['ivan.delgado@viveverde.es']
2026-02-03 19:18:06 - INFO - Archivos a enviar: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_fitos.xlsx']
2026-02-03 19:18:06 - INFO - Archivo adjuntado: Pedido_Semana_14_2026-02-03_fitos.xlsx
2026-02-03 19:18:06 - INFO - Email enviado exitosamente a: ivan.delgado@viveverde.es
2026-02-03 19:18:06 - INFO - ✓ Email enviado exitosamente para fitos
2026-02-03 19:18:06 - INFO - ✓ Email enviado exitosamente a fitos
2026-02-03 19:18:06 - INFO - 
Enviando email para sección: vivero
2026-02-03 19:18:06 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_vivero.xlsx']
2026-02-03 19:18:06 - INFO - ============================================================
2026-02-03 19:18:06 - INFO - ENVIANDO EMAIL PARA SECCIÓN: VIVERO
2026-02-03 19:18:06 - INFO - ============================================================
2026-02-03 19:18:06 - DEBUG - [DEBUG] Destinatarios para vivero: [{'email': 'ivan.delgado@viveverde.es', 'nombre': 'Encargado'}]
2026-02-03 19:18:07 - INFO - Destinatarios: ['ivan.delgado@viveverde.es']
2026-02-03 19:18:07 - INFO - Archivos a enviar: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_vivero.xlsx']
2026-02-03 19:18:07 - INFO - Archivo adjuntado: Pedido_Semana_14_2026-02-03_vivero.xlsx
2026-02-03 19:18:07 - INFO - Email enviado exitosamente a: ivan.delgado@viveverde.es
2026-02-03 19:18:07 - INFO - ✓ Email enviado exitosamente para vivero
2026-02-03 19:18:07 - INFO - ✓ Email enviado exitosamente a vivero
2026-02-03 19:18:07 - INFO - 
Enviando email para sección: utiles_jardin
2026-02-03 19:18:07 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx']
2026-02-03 19:18:07 - INFO - ============================================================
2026-02-03 19:18:07 - INFO - ENVIANDO EMAIL PARA SECCIÓN: UTILES_JARDIN
2026-02-03 19:18:07 - INFO - ============================================================
2026-02-03 19:18:07 - DEBUG - [DEBUG] Destinatarios para utiles_jardin: [{'email': 'ivan.delgado@viveverde.es', 'nombre': 'Encargado'}]
2026-02-03 19:18:07 - INFO - Destinatarios: ['ivan.delgado@viveverde.es']
2026-02-03 19:18:07 - INFO - Archivos a enviar: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx']
2026-02-03 19:18:07 - INFO - Archivo adjuntado: Pedido_Semana_14_2026-02-03_utiles_jardin.xlsx
2026-02-03 19:18:07 - INFO - Email enviado exitosamente a: ivan.delgado@viveverde.es
2026-02-03 19:18:07 - INFO - ✓ Email enviado exitosamente para utiles_jardin
2026-02-03 19:18:07 - INFO - ✓ Email enviado exitosamente a utiles_jardin
2026-02-03 19:18:07 - INFO - 
Enviando email para sección: tierras_aridos
2026-02-03 19:18:07 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx']
2026-02-03 19:18:07 - INFO - ============================================================
2026-02-03 19:18:07 - INFO - ENVIANDO EMAIL PARA SECCIÓN: TIERRAS_ARIDOS
2026-02-03 19:18:07 - INFO - ============================================================
2026-02-03 19:18:07 - DEBUG - [DEBUG] Destinatarios para tierras_aridos: [{'email': 'ivan.delgado@viveverde.es', 'nombre': 'Encargado'}]
2026-02-03 19:18:07 - INFO - Destinatarios: ['ivan.delgado@viveverde.es']
2026-02-03 19:18:07 - INFO - Archivos a enviar: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx']
2026-02-03 19:18:07 - INFO - Archivo adjuntado: Pedido_Semana_14_2026-02-03_tierras_aridos.xlsx
2026-02-03 19:18:07 - INFO - Email enviado exitosamente a: ivan.delgado@viveverde.es
2026-02-03 19:18:07 - INFO - ✓ Email enviado exitosamente para tierras_aridos
2026-02-03 19:18:07 - INFO - ✓ Email enviado exitosamente a tierras_aridos
2026-02-03 19:18:07 - INFO - 
Enviando email para sección: deco_exterior
2026-02-03 19:18:07 - INFO - Archivos: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_deco_exterior.xlsx']
2026-02-03 19:18:07 - INFO - ============================================================
2026-02-03 19:18:07 - INFO - ENVIANDO EMAIL PARA SECCIÓN: DECO_EXTERIOR
2026-02-03 19:18:07 - INFO - ============================================================
2026-02-03 19:18:07 - DEBUG - [DEBUG] Destinatarios para deco_exterior: [{'email': 'ivan.delgado@viveverde.es', 'nombre': 'Encargado'}]
2026-02-03 19:18:07 - INFO - Destinatarios: ['ivan.delgado@viveverde.es']
2026-02-03 19:18:07 - INFO - Archivos a enviar: ['.\\./data/output\\Pedido_Semana_14_2026-02-03_deco_exterior.xlsx']
2026-02-03 19:18:07 - INFO - Archivo adjuntado: Pedido_Semana_14_2026-02-03_deco_exterior.xlsx
2026-02-03 19:18:08 - INFO - Email enviado exitosamente a: ivan.delgado@viveverde.es
2026-02-03 19:18:08 - INFO - ✓ Email enviado exitosamente para deco_exterior
2026-02-03 19:18:08 - INFO - ✓ Email enviado exitosamente a deco_exterior
2026-02-03 19:18:08 - INFO - 
============================================================
2026-02-03 19:18:08 - INFO - RESUMEN DE ENVÍO DE EMAILS
2026-02-03 19:18:08 - INFO - ============================================================
2026-02-03 19:18:08 - INFO - Emails enviados exitosamente: 11
2026-02-03 19:18:08 - INFO - Emails fallidos: 0
2026-02-03 19:18:08 - INFO - Secciones procesadas: 11
2026-02-03 19:18:08 - INFO - 
======================================================================
2026-02-03 19:18:08 - INFO - RESUMEN DE EJECUCION
2026-02-03 19:18:08 - INFO - ======================================================================
2026-02-03 19:18:08 - INFO - Semana procesada: 14
2026-02-03 19:18:08 - INFO - Archivos generados: 11
2026-02-03 19:18:08 - INFO - Total articulos: 1488
2026-02-03 19:18:08 - INFO - Total importe: 47966.89€
2026-02-03 19:18:08 - INFO - 
✓ EMAILS ENVIADOS: 11
2026-02-03 19:18:08 - INFO - ======================================================================
2026-02-03 19:18:08 - INFO - 
¡PEDIDO GENERADO EXITOSAMENTE!
2026-02-03 19:18:08 - INFO - Archivo principal: .\./data/output\Pedido_Semana_14_2026-02-03_maf.xlsx
2026-02-03 19:18:08 - INFO - Artículos: 1488
2026-02-03 19:18:08 - INFO - Importe: 47966.89€
2026-02-03 19:18:08 - INFO - 
Emails enviados: 11
